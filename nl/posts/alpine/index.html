<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=nl><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/nl/posts/alpine/ rel=canonical><link title="site van toreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/nl/posts/alpine/ rel=amphtml><meta content="untoreh's site"property=og:title><meta content=website property=og:type><meta content=https://www.unto.re property=og:url><meta content=https://www.unto.re/assets/appa.png property=og:image><meta content="Articles, logs, infos, status and live updates are published here."property=og:description><meta content=English property=og:locale><meta content=English property=og:locale:alternate><meta content=German property=og:locale:alternate><meta content=Italian property=og:locale:alternate><meta content="Mandarin Chinese"property=og:locale:alternate><meta content=Spanish property=og:locale:alternate><meta content=Hindi property=og:locale:alternate><meta content=Arabic property=og:locale:alternate><meta content=Portuguese property=og:locale:alternate><meta content=Bengali property=og:locale:alternate><meta content=Russian property=og:locale:alternate><meta content=Japanese property=og:locale:alternate><meta content=Punjabi property=og:locale:alternate><meta content=Javanese property=og:locale:alternate><meta content=Vietnamese property=og:locale:alternate><meta content=French property=og:locale:alternate><meta content=Urdu property=og:locale:alternate><meta content=Turkish property=og:locale:alternate><meta content=Polish property=og:locale:alternate><meta content=Ukranian property=og:locale:alternate><meta content=Dutch property=og:locale:alternate><meta content=Greek property=og:locale:alternate><meta content=Swedish property=og:locale:alternate><meta content=Zulu property=og:locale:alternate><meta content=Romanian property=og:locale:alternate><meta content=Malay property=og:locale:alternate><meta content=Korean property=og:locale:alternate><meta content=Thai property=og:locale:alternate><meta content=Filipino property=og:locale:alternate><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/alpine/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"Pine, Alpine linux based on OSTree","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-04-19","dateCreated":"April 24, 2021","@id":"https://www.unto.re/posts/alpine/index.html","dateModified":"2021-04-19","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["tools","about"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-04-19","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/alpine/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/alpine","name":"Alpine","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/css/franklin.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/menu.css rel=stylesheet><link href=/css/pages.css rel=stylesheet><link href=/css/lunr.css rel=stylesheet><link href=/css/footer.css rel=stylesheet><link href=/css/responsive.css rel=stylesheet><link href=/css/animations.css rel=stylesheet><link href=/css/docco.css rel=stylesheet><link href=/css/flags-sprite.css rel=stylesheet><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Alpine</title><meta content="Pine, Alpine linux based on OSTree"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/nl/posts/alpine/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/nl/posts/alpine/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/alpine/"},"datePublished":"2021-10-26T18:55:08.421","inLanguage":"nl","name":"","mainEntityOfPage":{"@id":"/nl/posts/alpine/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/nl/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" ontereh-licht"class=flip-front src=/assets/appa.png><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Zoek website"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/nl/posts/><i class="fas fa-pen menu-icons"></i> berichten</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/nl/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Zoek website"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/nl/posts/><i class="fas fa-pen menu-icons"></i> berichten</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/nl/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/nl/posts/alpine> Alpine</a></h1><blockquote id=page-description style=font-style:italic>Pine, Alpine linux gebaseerd op OSTree</blockquote></div><div class=franklin-content><p>Kiezen wat?<a href=https://en.wikipedia.org/wiki/Operating_system> OS</a> draait op uw servers is een kwestie van gemak en vertrouwdheid. Gemak betekent dat je iets wilt waar je zo min mogelijk last van hebt, vertrouwdheid betekent dat je dat liever hebt<em> niet</em> om extra dingen te leren als dat niet nodig is.<p>Mijn servers zijn<a href=https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets> huisdieren</a>dus ik vind het oké om af en toe handmatig een paar commando's uit te geven en heb geen volledige automatisering nodig.<p>Na het uitproberen<a href=https://en.wikipedia.org/wiki/Container_Linux> CoreOS</a> voor een jaar ben ik overgestapt op mijn eigen vereenvoudigde<a href=https://en.wikipedia.org/wiki/Linux_distribution> distro</a> gebaseerd op alpine en<a href=https://en.wikipedia.org/wiki/OSTree> ostree</a>.<h2 id=goals><a class=header-anchor href=#goals> doelen</a></h2><p>Deze versie van Alpine is gebaseerd op:<a href=https://kinvolk.io/flatcar-container-linux/> platte wagen</a> en<a href=https://www.projectatomic.io/> project-atomaire</a> en wordt verondersteld te worden geïnstalleerd als een alleen-lezen rootbestandssysteem met updates die atomair plaatsvinden, dat wil zeggen, ze slagen of het systeem keert terug naar de vorige staat. Om dit mogelijk te maken moet het systeem altijd minimaal<strong> twee snapshots</strong> van de vrijgegeven versie van het bestandssysteem, beschikbaar op opslag.<h2 id=targets><a class=header-anchor href=#targets> doelen</a></h2><p>In welke omgevingen zal het systeem draaien? ik heb getarget<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> en [KVM], maar in het algemeen kun je zeggen<em> containers</em> en<em> virtuele machines</em> met het belangrijkste verschil dat containers niet hun eigen kernel draaien, in het bijzonder hebben ze geen opstartproces, ze roepen rechtstreeks in de<em> in het</em> systeem (dat bijvoorbeeld in een<code><a href=https://en.wikipedia.org/wiki/Docker_(software)>Dockerfile</a></code> het zou worden gedefinieerd door de<code>CMD</code> of<code>ENTRYPOINT</code> statements), die verantwoordelijk is voor het beheer van de structuur van processen die de container draaiende houden (net als bij een normale sessie, als het init-proces sterft, wordt de container beëindigd). Ook containers kunnen geen systeemknoppen configureren en kunnen aanvullende beperkingen hebben op de mogelijkheden.<h2 id=bisecting_the_build_process><a class=header-anchor href=#bisecting_the_build_process> Het bouwproces in tweeën delen</a></h2><p>Hoe is het beeld opgebouwd?<h3 id=dependencies><a class=header-anchor href=#dependencies> afhankelijkheden</a></h3><p>De<code>prepare.sh</code> script behandelt afhankelijkheden, waarvan de meeste de pakketten zijn die algemene cli-tools bieden, zoals:<code>coreutils</code>, <code>util-linux</code>, <code>binutils</code> , hulpprogramma's om te werken met blokapparaten zoals<code>blkid</code>, <code>sfdisk</code>, <code>multipath-tools</code> en bestandssystemen met<code>xfsprogs</code> en<code>e2fsprogs</code> . De<code>squashfs-tools</code> pakket wordt aan het einde gebruikt om het ingebouwde rootbestandssysteem te comprimeren. EEN<code>glib</code> compatibiliteitspakket is ook standaard geïnstalleerd omdat alpine is gebaseerd op:<code><a href=https://musl.libc.org/>musl</a></code>, werkt het compatibiliteitspakket door een aantal bibliotheken te bieden die zijn gebouwd tegen .<h3 id=the_tree><a class=header-anchor href=#the_tree> De boom</a></h3><p>Bestandsstructuren voor zowel VM's als containers zijn respectievelijk gebouwd met<code>make.sh</code> en<code>make_ovz.sh</code> . Dit is een vereenvoudigde beschrijving van de stappen<ul><li><p>stel de te bouwen versie in volgens de repository-tag<li><p>maak een map voor de nieuwe boom en wis de omgeving<li><p>maak basisdoelmappen en mappen die vereist zijn door ostree, zoals<code>sysroot</code><li><p>maak symbolische links om te voldoen aan de<a href=https://www.freedesktop.org/software/systemd/man/file-hierarchy.html> bestandssysteem hiërarchie standaard</a><li><p>kopieer aangepaste services en aangepaste configuraties<li><p>chroot instellen met aangekoppelde systeemmappen<li><p>bootstrap een alpine rootfs met basispakketten<li><p>minimale configuratie toepassen op de rootfs, zoals referenties, tijdzone, hostnaam.<li><p>kopieerservices die moeten worden gestart door init<li><p>stel de opstartconfiguratie in met de opgegeven kernel-image<li><p>optioneel aangepaste kernelmodules toevoegen<li><p>opruimen uitvoeren<li><p>commit de rootfs<sup id=fnref:rootfs><a class=fnref href=#fndef:rootfs>[1]</a></sup> naar de ostree-repository</ul><p>Voor containers is de volgorde hetzelfde, maar de configuratie verandert, omdat met een systeem dat niet is opgestart vanaf a<a href=https://en.wikipedia.org/wiki/Bootloader> bootloader</a> ostree heeft problemen met het verifiëren van de omgeving, we moeten wat toepassen<a href=https://github.com/untoreh/pine/blob/e65f12be70fd91edfd935e3ae9854c7be555ec73/make_ovz.sh#L73> tijdelijke oplossingen</a> en stel een aantal apparaten in die meestal worden afgehandeld door de<a href=https://en.wikipedia.org/wiki/Initial_ramdisk> initramfs</a> stap. Dit is hoe<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> of<a href=https://en.wikipedia.org/wiki/LXC> LXC</a> sjablonen zijn geconfigureerd.<h3 id=packaging><a class=header-anchor href=#packaging> verpakking</a></h3><p>Zodra we onze ostree-committed-bestandenstructuur hebben<code>build.sh</code> of<code>build-update.sh</code> zorgt voor de productie van het artefact dat wordt gedistribueerd. Het verschil tussen de scripts is dat de updateversie start vanaf een eerdere ostree-repository, en<em> ook</em> produceert een delta-artefact dat een draaiend systeem kan toepassen op zijn ostree-instantie om upgrades uit te voeren. Dit is een vereenvoudigde beschrijving van de bouwstappen<ul><li><p>als nieuwbouw<ul><li><p>maak nieuwe partities op een nieuwe afbeelding die is gemount als een loop-apparaat</ul><li><p>anders<ul><li><p>mount sysroot en opstartpartities van vorige build</ul><li><p>opschonen van eerdere ostree-implementaties (link farms) op gekoppelde build<li><p>commit nieuw gebouwde boom op gemonteerde build<li><p>verifieer integriteit en checksums<li><p>nieuwe delta maken voor upgrades<li><p>ostree-implementatie uitvoeren om de opstartconfiguratie opnieuw te genereren<li><p>verwijder oude ostree commits<li><p>controleer de integriteit van de opstartpartitie<li><p>ontkoppel nieuwe bijgewerkte build-afbeelding<li><p>genereer afbeeldingscontrolesom en comprimeer deze (met<code>squashfs</code> voor containers)</ul><p>De partitieconfiguratie wordt toegepast met een fdisk<code>layout.cfg</code> bestand dat de partitiegroottes definieert, hebben we één partitie voor de rootfs (<code>~430M</code> ), de opstartpartitie (<code>~40M</code> ) en een swappartitie (<code>~40M</code> ). Met containers waarbij je gewoon de vorige build over een loop-apparaat kunt overslaan en gewoon de nieuwe ostree-commit over de oude (geëxtraheerde) ostree-repository kunt trekken.<h2 id=customizations><a class=header-anchor href=#customizations> Aanpassingen</a></h2><p>Wat bundel ik in deze afbeelding (behalve geïnstalleerde pakketten)?<ul><li><p>Een kleine lib in<code>functions.sh</code> voor veelvoorkomende taken die binnen de shell worden uitgevoerd<li><p>op ostree gebaseerde upgradescripts met vergrendelingsmechanisme op basis van KV store<li><p>monitoringscripts voor IO zowel lokaal (<code>iomon</code> ) en netwerk (<code>tcpmon</code>)<li><p>setup-scripts voor andere container-runtimes dan<code>bubblewrap</code>: <code>podman</code>, <code>toolbox</code></ul><p>Wat was en niet meer is<ul><li><p><code>sup</code>: <a href=https://github.com/pressly/sup/> Sup</a> werd gebruikt voor orkestratie (implementatie van containers) en configuratie van de hostmachine, maar toen schakelde ik over naar<a href=https://www.ansible.com/> weerbaar</a> omdat er al lang bestaande bugs in sup waren die geen oplossing hadden, heb ik vanaf het begin niet voor ansible gekozen omdat ik niet wilde dat een python-afhankelijkheid op elke server zou worden geïnstalleerd, uiteindelijk heb ik genoegen genomen met een secundaire alpine<a href=https://en.wikipedia.org/wiki/Chroot> chroot</a> op de hostmachines, die zich in<code>/opt/alp</code>waar ik aanvullende, minder kritische software installeer. Vandaag zou ik echter weer overschakelen van ansible naar<a href=https://github.com/Fizzadar/pyinfra> pyinfra</a> , omdat<ul><li><p>het is python zonder boilerplate (ansible heeft pseudo<code>DSL</code> dat meer hoofdpijn veroorzaakt dan het oplost)<li><p>het voert zijn recepten uit met gewone ssh-opdrachten, dus er is geen python-afhankelijkheidsvereiste voor doelhosts</ul><li><p><code>containerpilot</code> : De use case voor containerpilot is om complexe afhankelijkheden tussen containers te beheren zonder shellscripts... het stopte met het ontvangen van updates van<a href=https://github.com/joyent/containerpilot> vreugdevol</a> en in onderhoudsmodus werd gezet, hield ik ook niet van de geheugenvereisten en het geheugengebruik zou constant toenemen voor een lange periode van uptime. Ik verwisselde het voor eenvoudige shell-scripts met<a href=https://www.consul.io/> consul</a> , zou ik naar meer geschikte alternatieven kunnen kijken als shellscripts te veel beginnen te groeien. Zwaardere oplossingen zoals<a href=https://kubernetes.io/> kubernetes</a>, <a href=https://docs.docker.com/engine/swarm/> zwerm</a> of<a href=https://www.nomadproject.io/> nomade</a> werden vanaf het begin weggegooid.<li><p><code>beegfs</code> : Ik heb de kernelmodule verzonden die nodig is voor<a href=https://en.wikipedia.org/wiki/BeeGFS> beegfs</a> maar na een tijdje brak de compatibiliteit en het feit dat er geen goed ondersteunde<a href=https://en.wikipedia.org/wiki/Filesystem_in_Userspace> lont</a> module gemaakt om het helemaal te laten vallen, ik gebruik momenteel geen [DFS] op mijn servers, maar de mogelijkheid om een ​​kant-en-klaar bestandssysteem te hebben om in een netwerk aan te sluiten, is nog steeds aantrekkelijk.<li><p></ul><h2 id=installation><a class=header-anchor href=#installation> Installatie</a></h2><p>Om de afbeelding te installeren, kunt u deze uploaden naar de hostingprovider en installeren vanaf VNC, in het geval van virtuele machines, maar ik kap meestal een bestaande installatie, omdat het altijd mogelijk is, zolang ik het installatiescript heb getest tegen de versie van de linux-distributie, in het algemeen gebruik ik debian-8 of ubuntu-14, heb geen andere getest omdat ik deze altijd beschikbaar heb gevonden. De installatiestappen volgen:<ul><li><p>zorg voor https-ondersteuning voor downloads<li><p>download een busybox-versie<li><p>installeer een busybox link-farm<li><p>ipv4/ipv6-adressen bepalen voor netwerkconfiguratie<li><p>zorgen voor chroot-mogelijkheden<li><p>download de afbeelding van de pijnboom en pak deze uit<li><p>als VM<ul><li><p>flits over doelapparaat<li><p>monteren over een lusapparaat</ul><li><p>schrijf de lokale netwerkconfiguratie over de<em> geflitst worden</em> rootfs<li><p>als container<ul><li><p>kopieer de init-service (voor containers) over het hoofd root-aankoppelpunt<code>/sbin/init</code></ul><li><p>als VM<ul><li><p>partitie de overgebleven schijf met standaard (<code>xfs</code> ) partities<li><p>ontkoppelen<li><p>integriteit van partities verifiëren</ul><li><p>opnieuw opstarten</ul><h2 id=conclusions><a class=header-anchor href=#conclusions> conclusies</a></h2><p>ik maakte<a href=https://github.com/untoreh/pine> pijnboom</a> 5 years from time of writing and I am still using it, and I see no reasons to switch to anything else. Alpine as a linux distro is great, simple, and I have never experienced breakage. I can easily deploy on <a href=https://en.wikipedia.org/wiki/Network_address_translation> NATed</a> servers die de neiging hebben om ultralage bronnen te bieden, eigenlijk heb ik een box met alleen<code>64M</code> van RAM, en heb nog steeds alle functies die ik nodig heb.<p><table class=fndef id=fndef:rootfs><tbody><tr><td class=fndef-backref><a href=#fnref:rootfs>[1]</a><td class=fndef-content>root bestandssysteem</table><p><div class=page-foot><div class=copyright></div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© totreh - Mogelijk gemaakt door<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/nl/sitemapxml> Sitemap</a></li> | <li><a href=/nl/tag> Tags</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>