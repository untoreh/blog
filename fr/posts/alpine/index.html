<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=fr><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/fr/posts/alpine/ rel=canonical><link title="le site d'untoreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/fr/posts/alpine/ rel=amphtml><meta content="untoreh's site"property=og:title><meta content=website property=og:type><meta content=https://www.unto.re property=og:url><meta content=https://www.unto.re/assets/appa.png property=og:image><meta content="Articles, logs, infos, status and live updates are published here."property=og:description><meta content=English property=og:locale><meta content=English property=og:locale:alternate><meta content=German property=og:locale:alternate><meta content=Italian property=og:locale:alternate><meta content="Mandarin Chinese"property=og:locale:alternate><meta content=Spanish property=og:locale:alternate><meta content=Hindi property=og:locale:alternate><meta content=Arabic property=og:locale:alternate><meta content=Portuguese property=og:locale:alternate><meta content=Bengali property=og:locale:alternate><meta content=Russian property=og:locale:alternate><meta content=Japanese property=og:locale:alternate><meta content=Punjabi property=og:locale:alternate><meta content=Javanese property=og:locale:alternate><meta content=Vietnamese property=og:locale:alternate><meta content=French property=og:locale:alternate><meta content=Urdu property=og:locale:alternate><meta content=Turkish property=og:locale:alternate><meta content=Polish property=og:locale:alternate><meta content=Ukranian property=og:locale:alternate><meta content=Dutch property=og:locale:alternate><meta content=Greek property=og:locale:alternate><meta content=Swedish property=og:locale:alternate><meta content=Zulu property=og:locale:alternate><meta content=Romanian property=og:locale:alternate><meta content=Malay property=og:locale:alternate><meta content=Korean property=og:locale:alternate><meta content=Thai property=og:locale:alternate><meta content=Filipino property=og:locale:alternate><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/alpine/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"Pine, Alpine linux based on OSTree","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-04-19","dateCreated":"April 24, 2021","@id":"https://www.unto.re/posts/alpine/index.html","dateModified":"2021-04-19","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["tools","about"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-04-19","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/alpine/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/alpine","name":"Alpine","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/css/franklin.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/menu.css rel=stylesheet><link href=/css/pages.css rel=stylesheet><link href=/css/lunr.css rel=stylesheet><link href=/css/footer.css rel=stylesheet><link href=/css/responsive.css rel=stylesheet><link href=/css/animations.css rel=stylesheet><link href=/css/docco.css rel=stylesheet><link href=/css/flags-sprite.css rel=stylesheet><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> Alpin</title><meta content="Pine, Alpine linux based on OSTree"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/fr/posts/alpine/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/fr/posts/alpine/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/alpine/"},"datePublished":"2021-10-26T14:51:07.542","inLanguage":"fr","name":"","mainEntityOfPage":{"@id":"/fr/posts/alpine/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/fr/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" untoreh-lumière"class=flip-front src=/assets/appa.png><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Rechercher sur le site Web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/fr/posts/><i class="fas fa-pen menu-icons"></i> des postes</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/fr/media/><i class="fas fa-tv menu-icons"></i> médias</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Rechercher sur le site Web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/fr/posts/><i class="fas fa-pen menu-icons"></i> des postes</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/fr/media/><i class="fas fa-tv menu-icons"></i> médias</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/fr/posts/alpine> Alpin</a></h1><blockquote id=page-description style=font-style:italic>Pine, Alpine Linux basé sur OSTree</blockquote></div><div class=franklin-content><p>Choisir quoi<a href=https://en.wikipedia.org/wiki/Operating_system> Système d'exploitation</a> s'exécute sur vos serveurs est une question de commodité et de familiarité. La commodité signifie que vous voulez quelque chose qui vous cause le moins de problèmes possible, la familiarité signifie que vous préférez<em> ne pas</em> pour apprendre des choses supplémentaires si vous n'y êtes pas obligé.<p>Mes serveurs sont<a href=https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets> animaux domestiques</a>Je peux donc émettre manuellement quelques commandes de temps en temps et ne nécessite pas une automatisation complète.<p>Après avoir essayé<a href=https://en.wikipedia.org/wiki/Container_Linux> CoreOS</a> pendant un an je suis passé au mien simplifié<a href=https://en.wikipedia.org/wiki/Linux_distribution> distribution</a> basé sur l'alpin et<a href=https://en.wikipedia.org/wiki/OSTree> ostrée</a>.<h2 id=goals><a class=header-anchor href=#goals> Buts</a></h2><p>Cette version de l'alpin s'inspire de<a href=https://kinvolk.io/flatcar-container-linux/> wagon plat</a> et<a href=https://www.projectatomic.io/> projet-atomique</a> et est censé être installé en tant que système de fichiers racine en lecture seule avec des mises à jour se produisant de manière atomique, c'est-à-dire qu'elles réussissent ou que le système revient à l'état précédent. Pour que cela soit possible, le système doit toujours avoir au moins<strong> deux instantanés</strong> de la version publiée du système de fichiers, disponible sur le stockage.<h2 id=targets><a class=header-anchor href=#targets> Cibles</a></h2><p>Dans quels environnements le système fonctionnera-t-il ? j'ai ciblé<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> et [KVM], mais en général vous pouvez dire<em> conteneurs</em> et<em> machines virtuelles</em> la principale différence étant que les conteneurs n'exécutent pas leur propre noyau, en particulier ils n'ont pas de processus de démarrage, ils appellent directement dans le<em> init</em> système (qui par exemple dans un<code><a href=https://en.wikipedia.org/wiki/Docker_(software)>Dockerfile</a></code> il serait défini par le<code>CMD</code> ou<code>ENTRYPOINT</code> instructions), qui est chargé de gérer l'arborescence des processus qui maintiendront le conteneur en cours d'exécution (tout comme une session normale, si le processus d'initialisation meurt, le conteneur se termine). De plus, les conteneurs ne peuvent pas configurer les boutons système et peuvent avoir des restrictions supplémentaires sur les capacités.<h2 id=bisecting_the_build_process><a class=header-anchor href=#bisecting_the_build_process> Bissection du processus de construction</a></h2><p>Comment se construit l'image ?<h3 id=dependencies><a class=header-anchor href=#dependencies> Dépendances</a></h3><p>Les<code>prepare.sh</code> le script gère les dépendances, dont la plupart sont les packages pour offrir des outils cli communs comme<code>coreutils</code>, <code>util-linux</code>, <code>binutils</code> , des utilitaires pour fonctionner avec des périphériques de bloc comme<code>blkid</code>, <code>sfdisk</code>, <code>multipath-tools</code> et les systèmes de fichiers avec<code>xfsprogs</code> et<code>e2fsprogs</code> . Les<code>squashfs-tools</code> package est utilisé à la fin pour compresser le système de fichiers racine construit. UNE<code>glib</code> le package de compatibilité est également installé par défaut car alpine est basé sur<code><a href=https://musl.libc.org/>musl</a></code>, le package de compatibilité fonctionne en fournissant des bibliothèques construites contre .<h3 id=the_tree><a class=header-anchor href=#the_tree> L'arbre</a></h3><p>Les arborescences de fichiers pour les machines virtuelles et les conteneurs sont construites avec respectivement<code>make.sh</code> et<code>make_ovz.sh</code> . Ceci est une description simplifiée des étapes<ul><li><p>définir la version à construire en fonction de la balise du référentiel<li><p>créer un répertoire pour la nouvelle arborescence et effacer l'environnement<li><p>créer des répertoires cibles de base et des répertoires requis par ostree, comme<code>sysroot</code><li><p>créer des liens symboliques pour se conformer à la<a href=https://www.freedesktop.org/software/systemd/man/file-hierarchy.html> norme de hiérarchie du système de fichiers</a><li><p>copier des services personnalisés et des configurations personnalisées<li><p>configuration du chroot avec les répertoires système montés<li><p>amorcer un rootfs alpin avec des packages de base<li><p>appliquez une configuration minimale au rootfs comme les informations d'identification, le fuseau horaire, le nom d'hôte.<li><p>services de copie à démarrer par init<li><p>configurer la configuration de démarrage avec l'image de noyau spécifiée<li><p>ajouter éventuellement des modules de noyau personnalisés<li><p>effectuer des nettoyages<li><p>commit le rootfs<sup id=fnref:rootfs><a class=fnref href=#fndef:rootfs>[1]</a></sup> au dépôt d'ostrée</ul><p>Pour les conteneurs, la séquence est la même, mais la configuration change, car avec un système non démarré à partir d'un<a href=https://en.wikipedia.org/wiki/Bootloader> chargeur de démarrage</a> ostree a du mal à vérifier l'environnement, nous devons appliquer<a href=https://github.com/untoreh/pine/blob/e65f12be70fd91edfd935e3ae9854c7be555ec73/make_ovz.sh#L73> solutions de contournement</a> et configurer certains périphériques qui sont généralement gérés par le<a href=https://en.wikipedia.org/wiki/Initial_ramdisk> initramfs</a> étape. C'est ainsi<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> ou<a href=https://en.wikipedia.org/wiki/LXC> LXC</a> les modèles sont configurés.<h3 id=packaging><a class=header-anchor href=#packaging> Emballage</a></h3><p>Une fois que nous avons notre arborescence de fichiers validés ostree<code>build.sh</code> ou<code>build-update.sh</code> se charge de produire l'artefact qui sera distribué. La différence entre les scripts est que la version de mise à jour démarre à partir d'un référentiel ostree précédent, et<em> aussi</em> produit un artefact delta qu'un système en cours d'exécution peut appliquer sur son instance ostree pour effectuer des mises à niveau. Ceci est une description simplifiée des étapes de construction<ul><li><p>si nouvelle construction<ul><li><p>créer de nouvelles partitions sur une nouvelle image montée en tant que périphérique de boucle</ul><li><p>autre<ul><li><p>monter sysroot et démarrer les partitions de la version précédente</ul><li><p>nettoyer les déploiements d'ostree précédents (fermes de liens) sur la construction montée<li><p>commit un nouvel arbre construit sur la construction montée<li><p>vérifier l'intégrité et les sommes de contrôle<li><p>créer un nouveau delta pour les mises à niveau<li><p>exécuter le déploiement d'ostree pour régénérer la configuration de démarrage<li><p>supprimer les anciens commits ostree<li><p>vérifier l'intégrité de la partition de démarrage<li><p>démonter la nouvelle image de build mise à jour<li><p>générer la somme de contrôle de l'image et la compresser (avec<code>squashfs</code> pour conteneurs)</ul><p>La configuration des partitions est appliquée avec un fdisk<code>layout.cfg</code> qui définit les tailles de partition, nous avons une partition pour le rootfs (<code>~430M</code> ), la partition de démarrage (<code>~40M</code> ) et une partition d'échange (<code>~40M</code> ). Avec des conteneurs, il suffit d'ignorer le montage de la version précédente sur un périphérique en boucle et de tirer simplement le nouveau commit ostree sur l'ancien référentiel ostree (extrait).<h2 id=customizations><a class=header-anchor href=#customizations> Personnalisations</a></h2><p>Qu'est-ce que je regroupe dans cette image (à part les packages installés) ?<ul><li><p>Une petite lib dans<code>functions.sh</code> pour les tâches courantes exécutées dans le shell<li><p>scripts de mise à niveau basés sur ostree avec mécanisme de verrouillage basé sur le magasin KV<li><p>scripts de surveillance pour les E/S à la fois locaux (<code>iomon</code> ) et réseau (<code>tcpmon</code>)<li><p>scripts de configuration pour les environnements d'exécution de conteneur autres que<code>bubblewrap</code>: <code>podman</code>, <code>toolbox</code></ul><p>Ce qui était et n'est plus<ul><li><p><code>sup</code>: <a href=https://github.com/pressly/sup/> Souper</a> a été utilisé pour l'orchestration (déployer des conteneurs) et la configuration de la machine hôte, mais je suis ensuite passé à<a href=https://www.ansible.com/> ansible</a> car il y avait des bugs de longue date dans sup qui manquaient de correctif, je n'ai pas choisi ansible dès le départ car je ne voulais pas qu'une dépendance python s'installe sur chaque serveur, finalement je me suis installé avec un alpin secondaire<a href=https://en.wikipedia.org/wiki/Chroot> chroot</a> sur les machines hôtes, situées dans<code>/opt/alp</code>si j'installais d'autres logiciels moins critiques. Aujourd'hui, cependant, je passerais à nouveau d'ansible à<a href=https://github.com/Fizzadar/pyinfra> pyinfra</a> , car<ul><li><p>c'est du python sans passe-partout (ansible a pseudo<code>DSL</code> qui cause plus de maux de tête que ceux qu'il résout)<li><p>il exécute ses recettes avec des commandes ssh simples, il n'y a donc pas d'exigence de dépendance python sur les hôtes cibles</ul><li><p><code>containerpilot</code> : Le cas d'utilisation du pilote de conteneur est de gérer les dépendances complexes entre les conteneurs sans scripts shell... il a cessé de recevoir les mises à jour de<a href=https://github.com/joyent/containerpilot> joyeux</a> et a été mis en mode maintenance, je n'aimais pas non plus les besoins en mémoire et l'utilisation de la mémoire augmenterait constamment pendant une longue période de disponibilité. Je l'ai remplacé par des scripts shell simples avec<a href=https://www.consul.io/> consul</a> , je pourrais chercher des alternatives plus appropriées si les scripts shell commencent à trop se développer. Des solutions plus lourdes comme<a href=https://kubernetes.io/> kubernetes</a>, <a href=https://docs.docker.com/engine/swarm/> essaim</a> ou<a href=https://www.nomadproject.io/> nomade</a> ont été écartés dès le départ.<li><p><code>beegfs</code> : J'avais l'habitude d'expédier le module noyau nécessaire pour<a href=https://en.wikipedia.org/wiki/BeeGFS> boeufs</a> mais après un certain temps, la compatibilité a été rompue et le fait qu'il n'y avait pas de support correctement pris en charge<a href=https://en.wikipedia.org/wiki/Filesystem_in_Userspace> fusible</a> module a été supprimé complètement, je n'exécute actuellement pas de [DFS] sur mes serveurs, mais la possibilité d'avoir un système de fichiers prêt à l'emploi pour se connecter à un réseau est toujours attrayante.<li><p></ul><h2 id=installation><a class=header-anchor href=#installation> Installation</a></h2><p>Pour installer l'image, vous pouvez soit la télécharger sur le fournisseur d'hébergement et l'installer à partir de VNC, dans le cas de machines virtuelles, mais je détourne généralement une installation existante, car c'est toujours possible, tant que j'ai testé le script d'installation par rapport à la version de la distribution linux, généralement j'utilise debian-8 ou ubuntu-14, n'en a pas testé d'autres car j'ai toujours trouvé qu'elles étaient disponibles. Les étapes de configuration suivent<ul><li><p>assurer la prise en charge https pour les téléchargements<li><p>télécharger une version busybox<li><p>installer une ferme de liens busybox<li><p>déterminer les adresses ipv4/ipv6 pour la configuration réseau<li><p>assurer les capacités chroot<li><p>téléchargez l'image du pin et extrayez-la<li><p>si VM<ul><li><p>flash sur l'appareil cible<li><p>monter sur un périphérique en boucle</ul><li><p>écrire la configuration du réseau local sur le<em> être flashé</em> rootfs<li><p>si conteneur<ul><li><p>copier le service init (pour les conteneurs) sur le point de montage racine principal<code>/sbin/init</code></ul><li><p>si VM<ul><li><p>partitionner le disque restant avec la norme (<code>xfs</code> ) partitions<li><p>démonter<li><p>vérifier l'intégrité des partitions</ul><li><p>redémarrer</ul><h2 id=conclusions><a class=header-anchor href=#conclusions> Conclusion</a></h2><p>J'ai fait<a href=https://github.com/untoreh/pine> pin</a> 5 years from time of writing and I am still using it, and I see no reasons to switch to anything else. Alpine as a linux distro is great, simple, and I have never experienced breakage. I can easily deploy on <a href=https://en.wikipedia.org/wiki/Network_address_translation> NAT</a> serveurs qui ont tendance à offrir des ressources ultra-faibles, en fait j'ai une boîte qui tourne avec juste<code>64M</code> de RAM, et j'ai toujours toutes les fonctionnalités dont j'ai besoin.<p><table class=fndef id=fndef:rootfs><tbody><tr><td class=fndef-backref><a href=#fnref:rootfs>[1]</a><td class=fndef-content>système de fichiers racine</table><p><div class=page-foot><div class=copyright></div></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Propulsé par<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/fr/sitemapxml> Plan du site</a></li> | <li><a href=/fr/tag> Mots clés</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>