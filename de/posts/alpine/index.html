<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=de><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/de/posts/alpine/ rel=canonical><link title="untorehs Seite"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/de/posts/alpine/ rel=amphtml><meta content=Alpine property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/alpine property=og:url><meta content=https://www.unto.re/assets/appa.png property=og:image><meta content="Pine, Alpine linux based on OSTree"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=English property=og:locale><meta content=English property=og:locale:alternate><meta content=German property=og:locale:alternate><meta content=Italian property=og:locale:alternate><meta content="Mandarin Chinese"property=og:locale:alternate><meta content=Spanish property=og:locale:alternate><meta content=Hindi property=og:locale:alternate><meta content=Arabic property=og:locale:alternate><meta content=Portuguese property=og:locale:alternate><meta content=Bengali property=og:locale:alternate><meta content=Russian property=og:locale:alternate><meta content=Japanese property=og:locale:alternate><meta content=Punjabi property=og:locale:alternate><meta content=Javanese property=og:locale:alternate><meta content=Vietnamese property=og:locale:alternate><meta content=French property=og:locale:alternate><meta content=Urdu property=og:locale:alternate><meta content=Turkish property=og:locale:alternate><meta content=Polish property=og:locale:alternate><meta content=Ukranian property=og:locale:alternate><meta content=Dutch property=og:locale:alternate><meta content=Greek property=og:locale:alternate><meta content=Swedish property=og:locale:alternate><meta content=Zulu property=og:locale:alternate><meta content=Romanian property=og:locale:alternate><meta content=Malay property=og:locale:alternate><meta content=Korean property=og:locale:alternate><meta content=Thai property=og:locale:alternate><meta content=Filipino property=og:locale:alternate><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/alpine/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"Pine, Alpine linux based on OSTree","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-04-19","dateCreated":"April 24, 2021","@id":"https://www.unto.re/posts/alpine/index.html","dateModified":"2021-04-19","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["tools","about"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-04-19","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/alpine/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/alpine","name":"Alpine","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/css/franklin.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/menu.css rel=stylesheet><link href=/css/pages.css rel=stylesheet><link href=/css/lunr.css rel=stylesheet><link href=/css/footer.css rel=stylesheet><link href=/css/responsive.css rel=stylesheet><link href=/css/animations.css rel=stylesheet><link href=/css/docco.css rel=stylesheet><link href=/css/flags-sprite.css rel=stylesheet><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> alpin</title><meta content="Pine, Alpine linux based on OSTree"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/de/posts/alpine/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/de/posts/alpine/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/alpine/"},"datePublished":"2021-11-02T20:42:02.060","inLanguage":"de","name":"","mainEntityOfPage":{"@id":"/de/posts/alpine/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/de/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" untoreh-light"class=flip-front src=/assets/appa.png><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Website durchsuchen"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/de/posts/><i class="fas fa-pen menu-icons"></i> Beiträge</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/de/media/><i class="fas fa-tv menu-icons"></i> Medien</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Website durchsuchen"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/de/posts/><i class="fas fa-pen menu-icons"></i> Beiträge</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/de/media/><i class="fas fa-tv menu-icons"></i> Medien</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn"title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/de/posts/alpine> alpin</a></h1><blockquote id=page-description style=font-style:italic>Kiefer, Alpine Linux basierend auf OSTree</blockquote></div><div class=franklin-content><p>Auswählen was<a href=https://en.wikipedia.org/wiki/Operating_system> Betriebssystem</a> auf Ihren Servern läuft, ist eine Frage der Bequemlichkeit und Vertrautheit. Bequemlichkeit bedeutet, dass Sie etwas wollen, das Ihnen so wenig Ärger wie möglich bereitet, Vertrautheit bedeutet, dass Sie es bevorzugen würden<em> nicht</em> um zusätzliche Dinge zu lernen, wenn Sie nicht müssen.<p>Meine Server sind<a href=https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets> Haustiere</a> Ich bin also in Ordnung, ab und zu ein paar Befehle manuell auszugeben, und benötige keine vollständige Automatisierung.<p>Nach dem Ausprobieren<a href=https://en.wikipedia.org/wiki/Container_Linux> CoreOS</a> für ein Jahr wechselte ich zu meiner eigenen vereinfachten<a href=https://en.wikipedia.org/wiki/Linux_distribution> verteilen</a> basierend auf alpinen und<a href=https://en.wikipedia.org/wiki/OSTree> Ostree</a>.<h2 id=goals><a class=header-anchor href=#goals> Ziele</a></h2><p>Diese Version von Alpine orientiert sich an<a href=https://kinvolk.io/flatcar-container-linux/> Flachwagen</a> und<a href=https://www.projectatomic.io/> projekt-atomar</a> und soll als schreibgeschütztes Root-Dateisystem installiert werden, wobei Aktualisierungen atomar erfolgen, dh entweder sie erfolgreich sind oder das System in den vorherigen Zustand zurückwechselt. Damit dies möglich ist, muss das System immer mindestens<strong> zwei Schnappschüsse</strong> der freigegebenen Dateisystemversion, die auf dem Speicher verfügbar ist.<h2 id=targets><a class=header-anchor href=#targets> Ziele</a></h2><p>In welchen Umgebungen wird das System laufen? Ich habe gezielt<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> und [KVM], aber im Allgemeinen kann man sagen<em> Behälter</em> und<em> virtuelle Maschinen</em> mit dem Hauptunterschied, dass Container keinen eigenen Kernel ausführen, insbesondere keinen Bootprozess haben, sie rufen direkt in die<em> drin</em> System (das zum Beispiel in a<code><a href=https://en.wikipedia.org/wiki/Docker_(software)>Dockerfile</a></code> es wäre definiert durch die<code>CMD</code> oder<code>ENTRYPOINT</code> -Anweisungen), die für die Verwaltung des Prozessbaums verantwortlich ist, der den Container am Laufen hält (genau wie eine normale Sitzung, wenn der Init-Prozess abbricht, wird der Container beendet). Außerdem können Container keine System-Knöpfe konfigurieren und können zusätzliche Einschränkungen hinsichtlich der Funktionen haben.<h2 id=bisecting_the_build_process><a class=header-anchor href=#bisecting_the_build_process>Halbieren des Build-Prozesses</a></h2><p>Wie ist das Bild aufgebaut?<h3 id=dependencies><a class=header-anchor href=#dependencies> Abhängigkeiten</a></h3><p>Die<code>prepare.sh</code> Das Skript behandelt Abhängigkeiten, von denen die meisten Pakete sind, die gängige CLI-Tools anbieten wie<code>coreutils</code>, <code>util-linux</code>, <code>binutils</code> , Dienstprogramme für den Betrieb mit Blockgeräten wie<code>blkid</code>, <code>sfdisk</code>, <code>multipath-tools</code> und Dateisysteme mit<code>xfsprogs</code> und<code>e2fsprogs</code> . Die<code>squashfs-tools</code> package wird am Ende verwendet, um das erstellte Root-Dateisystem zu komprimieren. EIN<code>glib</code> Kompatibilitätspaket wird ebenfalls standardmäßig installiert, da alpine auf basiert<code><a href=https://musl.libc.org/>musl</a></code> funktioniert das Kompatibilitätspaket, indem es einige Bibliotheken bereitstellt, die gegen .<h3 id=the_tree><a class=header-anchor href=#the_tree> Der Baum</a></h3><p>Dateibäume für VMs und Container werden entsprechend erstellt<code>make.sh</code> und<code>make_ovz.sh</code> . Dies ist eine vereinfachte Beschreibung der Schritte<ul><li><p>Legen Sie die Version fest, die gemäß dem Repository-Tag erstellt werden soll<li><p>Erstellen Sie ein Verzeichnis für den neuen Baum und löschen Sie die Umgebung<li><p>Erstellen Sie Basiszielverzeichnisse und Verzeichnisse, die von ostree benötigt werden, wie<code>sysroot</code><li><p>Erstellen Sie Symlinks, um mit den<a href=https://www.freedesktop.org/software/systemd/man/file-hierarchy.html> Dateisystemhierarchie-Standard</a><li><p>Kopieren Sie benutzerdefinierte Dienste und benutzerdefinierte Konfigurationen<li><p>chroot mit gemounteten Systemverzeichnissen einrichten<li><p>Bootstrap ein alpines Rootfs mit Basispaketen<li><p>Wenden Sie eine minimale Konfiguration auf die Rootfs an, z. B. Anmeldeinformationen, Zeitzone, Hostname.<li><p>Kopierdienste, die von init gestartet werden<li><p>Setup der Boot-Konfiguration mit dem angegebenen Kernel-Image<li><p>optional benutzerdefinierte Kernel-Module hinzufügen<li><p>Aufräumarbeiten durchführen<li><p>begehen die rootfs<sup id=fnref:rootfs><a class=fnref href=#fndef:rootfs>[1]</a></sup> zum ostree Repository</ul><p>Bei Containern ist die Reihenfolge dieselbe, jedoch ändert sich die Konfiguration, da bei einem System, das nicht von einem<a href=https://en.wikipedia.org/wiki/Bootloader> Bootloader</a> ostree hat Probleme bei der Überprüfung der Umgebung, wir müssen einige anwenden<a href=https://github.com/untoreh/pine/blob/e65f12be70fd91edfd935e3ae9854c7be555ec73/make_ovz.sh#L73> Problemumgehungen</a> und richten Sie einige Geräte ein, die normalerweise von der<a href=https://en.wikipedia.org/wiki/Initial_ramdisk> initramfs</a> Schritt. Das ist wie<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> oder<a href=https://en.wikipedia.org/wiki/LXC> LXC</a> Vorlagen konfiguriert sind.<h3 id=packaging><a class=header-anchor href=#packaging> Verpackung</a></h3><p>Sobald wir unseren Ostree-Commited-Dateibaum haben<code>build.sh</code> oder<code>build-update.sh</code> kümmert sich um die Produktion des zu verteilenden Artefakts. Der Unterschied zwischen den Skripten besteht darin, dass die Update-Version von einem früheren ostree-Repository startet und<em> Auch</em> erzeugt ein Delta-Artefakt, das ein laufendes System auf seine Ostree-Instanz anwenden kann, um Upgrades durchzuführen. Dies ist eine vereinfachte Beschreibung der Build-Schritte<ul><li><p>wenn neu gebaut<ul><li><p>Erstellen Sie neue Partitionen auf einem neuen Image, das als Loop-Gerät gemountet ist</ul><li><p>anders<ul><li><p>Mounten Sie sysroot und booten Sie Partitionen des vorherigen Builds</ul><li><p>Bereinigen Sie frühere ostree-Bereitstellungen (Link-Farmen) auf bereitgestellten Builds<li><p>Commit neu erstellten Baum auf gemounteten Build<li><p>Integrität und Prüfsummen überprüfen<li><p>Neues Delta für Upgrades erstellen<li><p>Führen Sie die ostree-Bereitstellung aus, um die Boot-Konfiguration zu regenerieren<li><p>alte Ostree-Commits entfernen<li><p>Integrität der Boot-Partition überprüfen<li><p>unmounten Sie das neue aktualisierte Build-Image<li><p>Bildprüfsumme generieren und komprimieren (mit<code>squashfs</code> für Container)</ul><p>Die Partitionskonfiguration wird mit einer fdisk . angewendet<code>layout.cfg</code> Datei, die die Partitionsgrößen definiert, haben wir eine Partition für die rootfs (<code>~430M</code> ), die Bootpartition (<code>~40M</code> ) und eine Swap-Partition (<code>~40M</code> ). Bei Containern überspringen Sie einfach das Mounten des vorherigen Builds über ein Loop-Gerät und ziehen einfach den neuen ostree-Commit über das alte (extrahierte) ostree-Repository.<h2 id=customizations><a class=header-anchor href=#customizations> Anpassungen</a></h2><p>Was bündele ich in diesem Image (abgesehen von installierten Paketen)?<ul><li><p>Eine kleine Bibliothek in<code>functions.sh</code> für allgemeine Aufgaben, die innerhalb der Shell ausgeführt werden<li><p>ostree-basierte Upgrade-Skripte mit Sperrmechanismus basierend auf KV Store<li><p>Überwachungsskripte für IO sowohl lokale (<code>iomon</code> ) und Netzwerk (<code>tcpmon</code>)<li><p>Setup-Skripte für andere Container-Laufzeiten als<code>bubblewrap</code>: <code>podman</code>, <code>toolbox</code></ul><p>Was war und ist nicht mehr<ul><li><p><code>sup</code>: <a href=https://github.com/pressly/sup/> Sup</a> wurde für die Orchestrierung (Bereitstellen von Containern) und die Konfiguration des Hostcomputers verwendet, aber dann wechselte ich zu<a href=https://www.ansible.com/> ansible</a> da es in sup seit langem fehler gab, die nicht behoben wurden, habe ich mich von vornherein nicht für ansible entschieden, da ich nicht wollte, dass auf jedem server eine python-abhängigkeit installiert wird, schlussendlich habe ich mich mit einem sekundären alpinen begnügt<a href=https://en.wikipedia.org/wiki/Chroot> chroot</a> auf den Host-Rechnern, die sich in befinden<code>/opt/alp</code> wo ich zusätzliche weniger kritische Software installiere. Heute würde ich aber wieder von ansible zu wechseln<a href=https://github.com/Fizzadar/pyinfra> pyinfra</a> , da<ul><li><p>es ist Python ohne Boilerplate (ansible hat pseudo<code>DSL</code> das verursacht mehr Kopfschmerzen als die, die es löst)<li><p>es führt seine Rezepte mit einfachen ssh-Befehlen aus, es gibt also keine Python-Abhängigkeitsanforderung auf Zielhosts</ul><li><p><code>containerpilot</code>: Der Anwendungsfall für Container Pilot besteht darin, komplexe Abhängigkeiten zwischen Containern ohne Shell-Skripte zu verwalten ... es werden keine Updates mehr von<a href=https://github.com/joyent/containerpilot> freudig</a> und in den Wartungsmodus versetzt wurde, gefiel mir auch der Speicherbedarf nicht und die Speicherauslastung stieg für eine lange Betriebszeit ständig an. Ich habe es auf einfache Shell-Skripte umgestellt mit<a href=https://www.consul.io/> Konsul</a> , könnte ich nach geeigneten Alternativen suchen, wenn Shell-Skripte zu stark anwachsen. Schwerere Lösungen wie<a href=https://kubernetes.io/> Kubernetes</a>, <a href=https://docs.docker.com/engine/swarm/> Schwarm</a> oder<a href=https://www.nomadproject.io/> Nomade</a> wurden von vornherein verworfen.<li><p><code>beegfs</code> : Früher habe ich das Kernel-Modul geliefert, das für . erforderlich ist<a href=https://en.wikipedia.org/wiki/BeeGFS> Rindfleisch</a> aber nach einer Weile brach es die Kompatibilität und die Tatsache, dass es kein richtig unterstütztes gab<a href=https://en.wikipedia.org/wiki/Filesystem_in_Userspace> Sicherung</a> Modul gemacht werden, es ganz wegzulassen, ich betreibe derzeit kein [DFS] auf meinen Servern, aber die Möglichkeit, ein einsatzbereites Dateisystem zu haben, um ein Netzwerk anzuschließen, ist immer noch attraktiv.<li><p></ul><h2 id=installation><a class=header-anchor href=#installation> Installation</a></h2><p>Um das Image zu installieren, können Sie es entweder beim Hosting-Provider hochladen und von VNC aus installieren, im Fall von virtuellen Maschinen, aber normalerweise hijacke ich eine vorhandene Installation, da dies immer möglich ist, solange ich das Setup-Skript gegen die Version von getestet habe die Linux-Distribution, im Allgemeinen verwende ich Debian-8 oder Ubuntu-14, habe andere nicht getestet, da ich diese immer als verfügbar gefunden habe. Die Einrichtungsschritte folgen<ul><li><p>https-Unterstützung für Downloads sicherstellen<li><p>Laden Sie eine Busybox-Version herunter<li><p>installiere eine Busybox Link-Farm<li><p>Bestimmen Sie IPv4-/IPv6-Adressen für die Netzwerkkonfiguration<li><p>chroot-Fähigkeiten sicherstellen<li><p>Laden Sie das Kiefernbild herunter und extrahieren Sie es<li><p>wenn VM<ul><li><p>über Zielgerät flashen<li><p>über einem Loop-Gerät montieren</ul><li><p>schreiben Sie die lokale Netzwerkkonfiguration über die<em> geflasht werden</em> rootfs<li><p>wenn Behälter<ul><li><p>Kopieren Sie den Init-Dienst (für Container) über den Haupt-Root-Mount-Punkt<code>/sbin/init</code></ul><li><p>wenn VM<ul><li><p>Partitionieren Sie die übrig gebliebene Festplatte mit Standard (<code>xfs</code> ) Partitionen<li><p>abmontieren<li><p>Integrität der Partitionen überprüfen</ul><li><p>neustarten</ul><h2 id=conclusions><a class=header-anchor href=#conclusions> Schlussfolgerungen</a></h2><p>ich machte<a href=https://github.com/untoreh/pine> Kiefer</a> 5 years from time of writing and I am still using it, and I see no reasons to switch to anything else. Alpine as a linux distro is great, simple, and I have never experienced breakage. I can easily deploy on <a href=https://en.wikipedia.org/wiki/Network_address_translation> NATed</a> Server, die dazu neigen, extrem niedrige Ressourcen anzubieten, eigentlich habe ich eine Box mit nur<code>64M</code> RAM und habe immer noch alle Funktionen, die ich benötige.<p><table class=fndef id=fndef:rootfs><tbody><tr><td class=fndef-backref><a href=#fnref:rootfs>[1]</a><td class=fndef-content>Root-Dateisystem</table><p><div id=post-tags-list>Post-Tags: <span class=post-tag><a href=https://www.unto.re/tag/tools> Werkzeuge</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/about> Über</a></span></div><div class=page-foot><div class=copyright>19. April 2021</div><script async crossorigin=anonymous issue-term=pathname label=Comment repo=untoreh/untoreh.github.io src=https://utteranc.es/client.js></script></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Powered by<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/de/sitemapxml> Seitenverzeichnis</a></li> | <li><a href=/de/tag> Stichworte</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer"title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>