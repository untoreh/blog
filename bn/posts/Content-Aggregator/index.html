<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=bn><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/bn/posts/Content-Aggregator/ rel=canonical><link href=https://www.unto.re/de/posts/Content-Aggregator hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/Content-Aggregator hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/Content-Aggregator hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/Content-Aggregator hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/Content-Aggregator hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/Content-Aggregator hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/Content-Aggregator hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/Content-Aggregator hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/Content-Aggregator hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/Content-Aggregator hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/Content-Aggregator hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/Content-Aggregator hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/Content-Aggregator hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/Content-Aggregator hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/Content-Aggregator hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/Content-Aggregator hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/Content-Aggregator hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/Content-Aggregator hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/Content-Aggregator hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/Content-Aggregator hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/Content-Aggregator hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/Content-Aggregator hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/Content-Aggregator hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/Content-Aggregator hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/Content-Aggregator hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/Content-Aggregator hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/Content-Aggregator hreflang=tl rel=alternate><link title="untoreh এর সাইট"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/bn/posts/Content-Aggregator/ rel=amphtml><meta content="Building a content aggregator for fun and profits?"property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/Content-Aggregator property=og:url><meta content=https://www.unto.re/assets/appa.webp property=og:image><meta content="A full app that scrapes, processes and presents content from the web...on the web."property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.webp","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/Content-Aggregator/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"A full app that scrapes, processes and presents content from the web...on the web.","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2022-12-11","dateCreated":"December 11, 2022","@id":"https://www.unto.re/posts/Content-Aggregator/index.html","dateModified":"2022-12-11","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["apps","programming","software"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2022-12-11","inLanguage":"English","image":"/assets/appa.webp","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/Content-Aggregator/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/Content-Aggregator","name":"Building a content aggregator for fun and profits?","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/libs/highlight/github.min.css rel=stylesheet><style>:root{--block-background:var(--accent2);--small:14px;--normal:19px;--text-color:hsv(0, 0%, 20%)}.franklin-content{position:relative;padding-left:12.5%;padding-right:12.5%;line-height:1.35em}@media (min-width:940px){.franklin-content{width:705px;margin-left:auto;margin-right:auto}}@media (max-width:480px){.franklin-content{padding-left:6%;padding-right:6%}}.franklin-content h2{font-size:22px}h2{text-align:left}.franklin-content h2{padding-bottom:.3em;border-bottom:1px solid #d3d3d3;margin-top:2em;margin-bottom:1em}.franklin-content h2 a{color:inherit}.franklin-content a{color:var(--alt2);text-decoration:none}body{counter-reset:eqnum}code{background-color:var(--block-background);padding:.1em .2em;border-radius:2px;font-size:var(--small);overflow:auto}@media (prefers-color-scheme:light){body{--accent:#3152ff;--accent2:#5a61ae;--accent3:#651b00;--alt:#ae6600;--alt2:#9e6c47;--alt3:#7f4200;--background-color:#ffebee;--foreground-color:#1c0005;--block-background:#423833;--red:#e42a2f;--yellow:#917329;--green:#29892d}}@media (prefers-color-scheme:dark){body{--accent:#72e200;--accent2:#add3a0;--accent3:#7a9eff;--alt:#8abeff;--alt2:#836bd1;--alt3:#a090de;--background-color:#001d49;--foreground-color:#dae2ff;--block-background:#011627;--red:#e42a2f;--yellow:#917329;--green:#29892d}}body{background:var(--background-color);font-style:var(--accent);font-family:Helvetica;padding:0 .5rem;line-height:2rem;color:var(--accent3);max-width:1280px;min-height:720px;margin:auto;min-width:320px}a{color:var(--accent)}a:visited{color:var(--accent2)}.franklin-content{color:var(--foreground-color)}.franklin-content .header-anchor{padding:.5rem!important;line-height:100%}.franklin-content a{outline-style:outset;outline-width:1px;padding:0 .1rem;margin:0 .1rem;outline-color:var(--alt2)}body>div>h1{text-align:center;color:var(--accent2)}body>div #page-description,body>div #title{text-align:center}.masthead__menu{height:4rem;line-height:4rem;padding:10px 0;position:relative}.site-title{float:left;font-weight:700;width:15rem;font-size:1.5rem;text-decoration:none;color:var(--accent)}.site-title:visited{color:var(--accent)}#site-nav{float:right;font-size:1.5rem;font-family:Courier New;font-weight:700;position:absolute;right:0}#site-nav .horiz ul{list-style-type:none;line-height:4rem;height:4rem;margin:0}#site-nav .horiz ul>li{padding:0 .5rem;box-shadow:.25rem -.025rem .05rem var(--alt)}#site-nav .horiz ul>li{float:left;border-top:0;border-bottom:0;border-left:0;border-radius:50% 25% 25% 50%}#site-nav ul>li>a,#site-nav ul>li>button{color:var(--alt);display:inline-block}#site-nav .menu-icons{position:relative;padding:0 .2rem}#site-nav{display:block;width:auto;height:auto}.author__avatar>img{width:4em;height:4em;border-radius:50%;-o-object-fit:cover;object-fit:cover;border-width:.1rem;border-color:var(--accent3);border-style:solid;box-shadow:.1rem .06rem var(--accent3),-.05rem -.025rem .2rem var(--accent3)}#site-nav a:link{text-decoration:none}#site-nav .ham,#site-nav .vert{display:none}.author__avatar{-o-object-fit:contain;object-fit:contain;float:left}.author__wrap>ul{float:left;height:inherit;margin:0;padding:0 10px}.author__wrap>ul>li{position:relative;float:left;list-style-type:none;font-size:1rem;padding:0 .2rem;text-align:center}ul>li.author__urls{font-size:2rem}ul>li.author__urls a:visited{color:var(--accent)}.author__wrap .author__avatar{float:left}.langs-dropdown-content{display:none;text-align:left}.langs-dropdown-content a{display:block}.menu-lang-btn:before{border-radius:25% 25% 25% 50%!important}.lang-link .flag{position:absolute;left:1rem;margin-top:.65rem}#site-nav .langs-dropdown-menu{left:1.5rem;position:relative;top:1rem}#site-nav .langs-dropdown-menu .lang-list{font-size:1rem;line-height:2rem;overflow-x:hidden;height:20rem;position:absolute;overflow-y:scroll;right:1rem;scrollbar-width:thin;border:solid;border-radius:25%;border-width:0 0 0 .25rem;padding-left:3rem}.lang-list{background-color:var(--background-color)}#site-nav ul>li>button{background:inherit;border:inherit;font-size:inherit;font-family:inherit;font-weight:inherit;padding:inherit;margin:inherit;list-style-type:inherit;line-height:inherit;height:inherit}.franklin-content{padding:0 0 2rem;z-index:0}.franklin-content{padding-top:1rem}.lunrSearchForm{margin-right:-.4rem;font-size:0;overflow:hidden}.lunrSearchForm .search-input{background:var(--background-color);color:var(--alt);border-width:.2rem;border:none;outline:0;border-radius:50% 25% 25% 50%;line-height:1.75rem;padding:.5rem 0 .5rem 2.25rem;width:7rem;position:relative;top:.5rem;font-family:Courier New;font-weight:700;font-size:1.5rem}.lunrSearchForm .search-button{color:var(--alt);background:0 0;border:none;font-size:1.5rem;padding:.2rem .2rem .2rem 0;position:absolute;top:1rem;left:.75rem;z-index:1}@media (min-width:680px) and (max-width:1300px){.lunrSearchForm .search-input{font-size:1rem;padding-left:2.75rem;width:4.5rem;border-radius:50% 100% 100% 50%}body{max-width:640px;min-height:320px}#site-nav{position:relative;z-index:1}#site-nav .ham{outline:0}#site-nav .ham,#site-nav .ham-icon{display:block;height:3rem;line-height:3rem;position:absolute;right:0;top:0;text-align:right;background:0 0;border:none;font-size:3rem;color:var(--accent)}#site-nav .horiz{display:none}#site-nav .vert{display:block;float:none;position:absolute;right:0;top:3rem;width:9rem;padding-left:1rem;max-height:0;overflow:hidden;filter:blur(1rem)}#site-nav .vert ul{margin:0;padding:10px 0}#site-nav .vert ul>li{width:100%;text-align:center;border-radius:25% 50% 50% 25%;padding:.5rem 1rem;box-shadow:-.25rem 0 .05rem var(--alt)}}@media (max-width:680px){.lang-link{height:3rem}.lunrSearchForm{display:block;width:28rem}.lunrSearch{position:absolute;top:-4rem;display:block;left:0;width:calc(2rem + 90%)}.lunrSearch .search-input{width:26rem}.masthead,.masthead__menu{display:block}.site-title{float:none;width:100%;display:block;text-align:center}.author__wrap{float:none;display:block;width:100%;height:4.4rem;text-align:center}.author__wrap ul{width:auto;float:none;padding:0;display:inline-block}#site-nav{float:none;padding:10px 0;position:relative;top:4rem}#site-nav ul li{float:none}.horiz{text-align:center}#site-nav ul{display:inline-block;padding:0}.masthead{height:14rem}}.lunrSearchForm{margin-top:1em}@media (max-width:480px){.lunrSearchForm .search-input{width:18rem;left:-4rem}.masthead{height:34rem}#site-nav{top:5rem}#site-nav .horiz ul{width:100%}#site-nav .horiz ul>li{width:calc(100% - 2rem);float:none}}@media (min-width:480px) and (max-width:680px){.masthead{height:20rem}}@media (max-width:680px){body{overflow-x:hidden}#site-nav{z-index:1}#site-nav .horiz ul>li{float:none;top:-4rem;position:relative;margin-top:1rem;margin-bottom:0}}@-webkit-keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@keyframes chars{0%,1.8105942029%{content:"u"}1.8115942029%,3.6221884058%{content:"un"}3.6231884058%,5.4337826087%{content:"unt"}5.4347826087%,7.2453768116%{content:"unto"}7.2463768116%,9.0569710145%{content:"untor"}10.8685652174%,9.0579710145%{content:"untore"}10.8695652174%,12.6801594203%{content:"untoreh"}12.6811594203%,14.4917536232%{content:"untoreh'"}14.4927536232%,16.3033478261%{content:"untoreh's"}16.3043478261%,18.114942029%{content:"untoreh's "}18.115942029%,19.9265362319%{content:"untoreh's s"}19.9275362319%,21.7381304348%{content:"untoreh's si"}21.7391304348%,23.5497246377%{content:"untoreh's sit"}23.5507246377%,to{content:"untoreh's site"}}@-webkit-keyframes cursor{75%{border-color:transparent}}@keyframes cursor{75%{border-color:transparent}}.site-title{-webkit-backface-visibility:hidden;backface-visibility:hidden;font-size:1.5rem;font-family:VT323,monospace,sans-serif;color:var(--accent2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.site-title:after{content:"​";position:relative;padding-right:.5em;border-right:.5em solid var(--accent);white-space:nowrap;-webkit-animation:5.52s linear 1s forwards chars,1s 3 cursor;animation:5.52s linear 1s forwards chars,1s 3 cursor}.franklin-content a{display:inline-block;vertical-align:middle;text-decoration:none;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative;overflow:hidden}.franklin-content a:before{content:"";position:absolute;z-index:-1;left:51%;right:51%;bottom:0;background:var(--accent);height:4px}.hvr-outline-in{display:inline-block;vertical-align:middle;transform:perspective(1px) translateZ(0);box-shadow:0 0 1px var(--alt2);position:relative}.horiz .hvr-outline-in:before{border-radius:50% 25% 25% 50%;right:-.25rem}.vert .hvr-outline-in:before{border-radius:25% 50% 50% 25%;left:-.25rem}.hvr-outline-in:before{content:"";position:absolute;border:var(--alt) solid .25rem;top:0;bottom:0;left:0;opacity:0}#site-nav .vert:before{background-color:var(--background-color);filter:blur(.25rem);content:"";height:100%;width:100%;position:absolute}.author__avatar{background-color:transparent;perspective:1000px}.masthead__menu ul li.author__avatar img{transform-style:preserve-3d}.flag{display:inline-block;position:relative;width:16px;height:11px;background:url(/assets/flags.png) no-repeat}.flag.flag-th{background-position:-16px -143px}.flag.flag-tr{background-position:-144px -143px}.flag.flag-fr{background-position:-80px -44px}.flag.flag-nl{background-position:-240px -99px}.flag.flag-ms{background-position:-16px -99px}.flag.flag-es{background-position:-224px -33px}.flag.flag-vn{background-position:-128px -154px}.flag.flag-za{background-position:-256px -154px}.flag.flag-ph{background-position:-144px -110px}.flag.flag-ru{background-position:-96px -121px}.flag.flag-pl{background-position:-176px -110px}.flag.flag-gb{background-position:-112px -44px}.flag.flag-ro{background-position:-64px -121px}.flag.flag-pt{background-position:-256px -110px}.flag.flag-in{background-position:-64px -66px}.flag.flag-kr{background-position:-80px -77px}.flag.flag-ua{background-position:-224px -143px}.flag.flag-jp{background-position:-224px -66px}.flag.flag-de{background-position:-32px -33px}.flag.flag-se{background-position:-208px -121px}.flag.flag-gr{background-position:-48px -55px}.flag.flag-id{background-position:-256px -55px}.flag.flag-pk{background-position:-160px -110px}.flag.flag-bd{background-position:-16px -11px}.flag.flag-it{background-position:-144px -66px}.flag.flag-sa{background-position:-128px -121px}.flag.flag-cn{background-position:-176px -22px}</style><link as=style href=/css/bundle.css rel=preload><link href=/css/bundle.css media=print onload=this.onload=null;this.removeAttribute('media'); rel=stylesheet><noscript><link href=/css/bundle.css rel=stylesheet></noscript><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> মজা এবং লাভের জন্য একটি বিষয়বস্তু সংগ্রাহক তৈরি করছেন?</title><meta content="A full app that scrapes, processes and presents content from the web...on the web."name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/bn/posts/Content-Aggregator/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/bn/posts/Content-Aggregator/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/Content-Aggregator/"},"datePublished":"2022-12-11T11:21:30.148","inLanguage":"bn","name":"","mainEntityOfPage":{"@id":"/bn/posts/Content-Aggregator/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/bn/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.webp"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" অস্পষ্ট আলো"class=flip-front src=/assets/appa.webp><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="ওয়েবসাইট অনুসন্ধান করুন"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/bn/posts/><i class="fas fa-pen menu-icons"></i> পোস্ট</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/bn/media/><i class="fas fa-tv menu-icons"></i> মিডিয়া</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/Content-Aggregator><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/Content-Aggregator><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/Content-Aggregator><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/Content-Aggregator><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/Content-Aggregator><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/Content-Aggregator><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/Content-Aggregator><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/Content-Aggregator><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/Content-Aggregator><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/Content-Aggregator><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/Content-Aggregator><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/Content-Aggregator><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/Content-Aggregator><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/Content-Aggregator><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/Content-Aggregator><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/Content-Aggregator><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/Content-Aggregator><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/Content-Aggregator><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/Content-Aggregator><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/Content-Aggregator><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/Content-Aggregator><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/Content-Aggregator><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/Content-Aggregator><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/Content-Aggregator><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/Content-Aggregator><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/Content-Aggregator><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/Content-Aggregator><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/Content-Aggregator><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="ওয়েবসাইট অনুসন্ধান করুন"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/bn/posts/><i class="fas fa-pen menu-icons"></i> পোস্ট</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/bn/media/><i class="fas fa-tv menu-icons"></i> মিডিয়া</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/Content-Aggregator><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/Content-Aggregator><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/Content-Aggregator><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/Content-Aggregator><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/Content-Aggregator><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/Content-Aggregator><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/Content-Aggregator><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/Content-Aggregator><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/Content-Aggregator><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/Content-Aggregator><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/Content-Aggregator><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/Content-Aggregator><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/Content-Aggregator><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/Content-Aggregator><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/Content-Aggregator><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/Content-Aggregator><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/Content-Aggregator><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/Content-Aggregator><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/Content-Aggregator><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/Content-Aggregator><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/Content-Aggregator><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/Content-Aggregator><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/Content-Aggregator><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/Content-Aggregator><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/Content-Aggregator><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/Content-Aggregator><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/Content-Aggregator><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/Content-Aggregator><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/bn/posts/Content-Aggregator> মজা এবং লাভের জন্য একটি বিষয়বস্তু সংগ্রাহক তৈরি করছেন?</a></h1><blockquote id=page-description style=font-style:italic>একটি সম্পূর্ণ অ্যাপ যা ওয়েবে...ওয়েব থেকে বিষয়বস্তু স্ক্র্যাপ, প্রক্রিয়া এবং উপস্থাপন করে।</blockquote></div><div class=franklin-content><h1 id=why><a class=header-anchor href=#why> কেন?</a></h1><p><a href=https://en.wikipedia.org/wiki/Information_overload> তথ্য ওভারলোড</a> ? আজকাল এটি কিছুটা খারাপ, তথ্যের শব্দের উত্সের জন্য অনেক কম সংকেত, আপনার "ফিডগুলি" সংকুচিত করা যাতে আপনি অভিভূত না হন। একটি টুল যা তথ্য ফিল্টার করে এবং একটি বিন্যাসে উপস্থাপন করে যা সহজ এবং দ্রুত হজম করা যায়। এই জন্য আমি বিবেচনা<em> বিষয়বস্তু একত্রীকরণ</em> বাধার জন্য একটি চিরহরিৎ মাঠ। এটি সর্বদা আছে এবং থাকবে (যতক্ষণ ইন্টারনেট বিনামূল্যে থাকে এবং মুক্ত বক্তব্য থাকে) একটি ভাল ব্যবসার সুযোগ। এটি সেই উদাহরণগুলির মধ্যে একটি যেখানে এটি মৃত্যুদন্ডের বিষয়ে (এবং ধারণা সম্পর্কে কিছুই নয়)।<h1 id=managing_expectations><a class=header-anchor href=#managing_expectations> প্রত্যাশা পরিচালনা</a></h1><p>বলেছে যে, শেষ পর্যন্ত আমার অ্যাপটি কোনো প্রকৃত ফিল্টারিং করে না। আসলে এটা সহজভাবে<em> সমষ্টি</em> ওয়েব থেকে সামগ্রী। এর কারণ হল আমি এতে ব্যবহারকারীদের তৈরি করিনি, এবং ফিল্টারিং করার বিষয়ে সামান্য উৎসাহ আছে যদি এটি ব্যবহারকারীর জন্য উপযোগী করা না যায়।<h1 id=the_architecture><a class=header-anchor href=#the_architecture> স্থাপত্য</a></h1><p>স্থাপত্যের চিত্র:<img alt=" কন্টেন্ট-এগ্রিগেটর-ডায়াগ্রাম"src=/assets/posts/img/content-aggregator-diagram.png style=float:none;padding:.5rem;margin-left:auto;margin-right:auto;display:block>এটার মধ্যে সত্যিই অনেক বৃত্ত আছে!...আপনি জানেন...মাইক্রো...সার্ভিস? আমি যে অ্যাপগুলি তৈরি করেছি তা হল "স্ক্র্যাপার" এবং "সার্ভার", যখন "প্রকাশক" সার্ভারে এমবেড করা একটি রুটিন। "অনুসন্ধান" এবং "প্রক্সি" হল বাহ্যিক সরঞ্জাম যা তাদের কাজ করে। "ফ্রন্টএন্ড" বিশেষ কিছু নয়, ওয়েবপ্যাকের সাথে একত্রিত js এবং css এর মিশ্রণ।<p>যেহেতু বিভিন্ন মুভিং পার্টস আছে আমি কন্টেন্টের ফ্লো অনুযায়ী যাব, কন্টেন্ট প্রথমবার দেখা হওয়ার পর থেকে।<h1 id=the_scraper><a class=header-anchor href=#the_scraper> স্ক্র্যাপার</a></h1><p>স্ক্র্যাপিং করা হয়েছে... আপনি অনুমান করেছেন, পাইথন। তবে কোন অ্যাডহক "স্ক্র্যাপিং" মডিউল ব্যবহার করা হয় না।<h2 id=what_do_you_scrape><a class=header-anchor href=#what_do_you_scrape> আপনি কি স্ক্র্যাপ করবেন?</a></h2><p>কী স্ক্র্যাপ করতে হবে তা নির্ধারণ করা বিষয়বস্তুর বিভাগের উপর নির্ভর করে। আমরা বিভাগকে "বিষয়" বলি।<ul><li><p>প্রতিটি বিষয়ের কীওয়ার্ডের একটি তালিকা রয়েছে।<li><p>কিওয়ার্ডের তালিকা যদি গুগল অ্যাডওয়ার্ডস থেকে টানা হয় তাদের ব্যবহার করে<a href=https://github.com/googleads/google-ads-python> পাইথন এপিআই</a><li><p>একাধিক সার্চ ইঞ্জিনে কীওয়ার্ডগুলি পর্যায়ক্রমে রাউন্ড রবিন ক্রমে জিজ্ঞাসা করা হয়। দৃষ্টান্তে একাধিক বিষয় থাকলে, কম উপলভ্য বিষয়বস্তু নিয়ে প্রথমে অনুসন্ধান করা হয়। অনুসন্ধানগুলি সম্পাদন করার জন্য আমরা নির্ভর করি<a href=https://github.com/searxng/searxng> searx</a> প্রক্সি সহ। Searx ঠিক লাইব্রেরি বান্ধব নয়, যেহেতু এটির প্রাথমিক ব্যবহার এটির ফ্রন্টএন্ডের জন্য তাই মডিউলটি শুরু করার জন্য প্রশ্নগুলি সম্পাদন করার জন্য সঠিক প্রক্রিয়াটি খনন করতে হবে। একসাথে একাধিক প্রশ্ন সম্পাদন করতে থ্রেডপুল ব্যবহার করে জিনিসগুলিকে গতি বাড়ানোর জন্য, আমরা পুরো প্রকল্প জুড়ে ঘন ঘন থ্রেডপুল ব্যবহার করব।<li><p>প্রতিটি কীওয়ার্ড অনুসন্ধান সম্ভাব্য বিষয়বস্তুর উত্সগুলির একটি তালিকা তৈরি করে (সার্চ ইঞ্জিনের ফলাফল) যা পরবর্তী প্রক্রিয়াকরণের জন্য স্টোরেজে সংরক্ষিত হয়।<li><p>যখন আমরা একটি নির্দিষ্ট বিষয়ের জন্য নতুন বিষয়বস্তু খুঁজতে চাই তখন আমরা প্রথমে উপলব্ধ উত্স আছে কিনা তা পরীক্ষা করি, অন্যথায় আমরা কীওয়ার্ড তালিকা থেকে নতুন উত্স তৈরি করি।<img alt=" বিষয়বস্তু পাইপলাইন"src=/assets/posts/img/content-pipeline.png style=float:none;padding:.5rem;margin-left:auto;margin-right:auto;display:block><li><p>উৎস দুটি লাইব্রেরি মাধ্যমে প্রক্রিয়া করা হয়<a href=https://github.com/adbar/trafilatura> ট্রাফিলাতুরা</a> প্রধান একটি, যদি এটি ব্যর্থ হয় আমরা ব্যাকআপ<a href=https://github.com/goose3/goose3> হংস</a> . আমরা অতিরিক্ত লিঙ্কগুলির জন্য ফিডগুলি সন্ধান করার চেষ্টা করি (যা নতুন উত্স হিসাবে বিবেচিত হবে)। ফিডের জন্য আমরা ব্যবহার করি<a href=https://github.com/dfm/feedfinder2> ফিডফাইন্ডার</a> কিন্তু আরএসএস এর জন্য এইচটিএমএল এর একটি সহজ পার্সিং<code>link</code> ট্যাগগুলিও যথেষ্ট।<li><p>আমাদের প্রধান বিষয়বস্তুর ধরন একটি<code>Article</code> , যা পাইথনের দিক থেকে এটি কেবল একটি নির্দেশ, নিম পাশ থেকে এটিকে অবজেক্ট হিসাবে পার্স করুন। কী:<ul><li><p><code>title</code> : নিবন্ধের শিরোনাম<li><p><code>content</code> : নিবন্ধ নিজেই. একটি ভাল নিবন্ধ কি তা নির্ধারণ করতে আমরা বিভিন্ন ফিল্টারিং ধাপের মধ্য দিয়ে যাই:<ul><li><p>প্রথমে আমরা ট্রাফিলাতুরা বা হংসের টেক্সট আছে কিনা এবং তা যথেষ্ট দীর্ঘ কিনা তা পরীক্ষা করি। আমাদের সর্বনিম্ন আকার 300 শব্দ. যদি আকার মেলে না, আমরা উত্সটি বাতিল করি (কিছুই ফেরত দেয় না)।<li><p>তারপরে আমরা শিরোনামটি নিয়ে আসি, এবং ইউআরএল এবং হোয়াইটস্পেসগুলি সরিয়ে এটিকে স্যানিটাইজ করি<li><p>যদি ল্যাংটি বিদেশী হয়, আমরা বিষয়বস্তু এবং শিরোনাম উভয়ই ইংরেজিতে অনুবাদ করি (আমরা ইংরেজিতে স্বাভাবিক করি)।<li><p>এই মুহুর্তে আমরা ব্যবহার করে অশ্লীলতা পরীক্ষা করি<a href=https://github.com/dimitrismistriotis/alt-profanity-check> অশ্লীলতা_চেক</a> . এমন নয় যে পূর্ববর্তী অনুবাদের উপর ভিত্তি করে অশ্লীলতা পরীক্ষা করা ইংরেজিতে প্রয়োজনীয়। অন্যথায় আমাদের সমস্ত ভাষার জন্য একটি অশ্লীল মডেলের প্রয়োজন হবে৷<li><p>আমরা অশ্লীল ফিল্টার ব্যবহার করে খারাপ শব্দ প্রতিস্থাপন করার পরে, আমরা বিষয়বস্তু স্যানিটাইজ করে চালিয়ে যাচ্ছি। নিবন্ধটি প্রাসঙ্গিক কিনা তা আমরা পরীক্ষা করি। আমরা যে নিয়মগুলি ব্যবহার করি তা হল:<ul><li><p>বিষয়বস্তু আলফানিউমেরিক অক্ষর দিয়ে শুরু করা আবশ্যক, অন্যথায় এটি আবর্জনা যে একটি উচ্চ পরিবর্তন আছে.<li><p>শিরোনাম এবং বিষয়বস্তু উভয়ই "গোলমাল" হতে পারে না। গোলমাল একটি রেজেক্স দ্বারা সংজ্ঞায়িত করা হয় যা "লগইন", "সাইনআপ", "অ্যাক্সেস অস্বীকার করা"...ইত্যাদির মতো কীওয়ার্ড ক্যাপচার করে।<li><p>শিরোনামে অন্তত একটি শব্দ শরীরে উপস্থিত থাকতে হবে। অন্যথায় এটা সম্ভব যে পার্সিং বিষয়বস্তুর জন্য উৎস পৃষ্ঠার ভুল অংশ বেছে নিয়েছে।</ul><li><p>প্রাসঙ্গিকতা পরীক্ষায় উত্তীর্ণ হলে, চূড়ান্ত পদক্ষেপ হিসাবে আমরা অনেকগুলি বন্ধনী, হোয়াইট-স্পেস, বারবার অক্ষর এবং বিশেষ অক্ষরগুলির উপস্থিতির বিরুদ্ধে বিষয়বস্তু পরিষ্কার করি।<li><p>যদি পরিষ্কার করা সবকিছু মুছে না ফেলে তবে আমরা নিবন্ধটি প্রক্রিয়াকরণ চালিয়ে যাই।</ul><li><p><code>source</code> : লিঙ্কটি মূল উৎসের দিকে নির্দেশ করে যা আমরা পার্স করেছি<li><p><code>lang</code> : নিবন্ধের ভাষা, আমরা ব্যবহার করি<a href=https://github.com/pemistahl/lingua-py> ভাষা</a> ভাষা সনাক্ত করতে<li><p><code>desc</code> : সারাংশ, অন্যথায় বিষয়বস্তু থেকে একটি উদ্ধৃতি<li><p><code>author</code> : লেখক, অন্যথায় সোর্সলিংকের হোমপেজের শিরোনাম<li><p><code>pubDate</code> : নিবন্ধ প্রকাশের তারিখ, বা এখন<li><p><code>topic</code> : এই নিবন্ধটি যে বিষয়ের সাথে সম্পর্কিত৷<li><p><code>tags</code> : একটি নিবন্ধের জন্য প্রাসঙ্গিক কীওয়ার্ড, আমরা দ্রুততম kw নিষ্কাশন lib ব্যবহার করি, যা<a href=https://github.com/csurfer/rake-nltk> রেক</a> , বিকল্প বিবেচনা করা হয়<a href=https://github.com/kevinlu1248/pyate> pyate</a> (কম্বোব্যাসিক),<a href=https://github.com/DerwenAI/pytextrank> পাঠ্যক্রম</a> এবং<a href=https://github.com/slanglab/phrasemachine> ফ্রেজমেশিন</a><li><p><code>imageTitle</code> : ছবির জন্য বিকল্প পাঠ্য<li><p><code>imageOrigin</code> : যদি উৎস পার্সিং (ছবির জন্য আমরা ব্যবহার করি<a href=https://github.com/michaelhelmick/lassie> লাসি</a> ) একটি চিত্র খুঁজে পায়নি, আমরা একটি প্রাসঙ্গিক চিত্রের জন্য অনুসন্ধান ইঞ্জিনগুলিকে জিজ্ঞাসা করি, তাই imageOrigin মূল পৃষ্ঠায় নির্দেশ করে যা ছবিটি হোস্ট করেছে, অন্যথায় এটি উত্স url-এর সমান৷<li><p><code>imageUrl</code> : ছবির আসল লিঙ্ক। আমরা ডুপ্লিকেট ছবিগুলির জন্য একটি ব্লুম ফিল্টার চেক ব্যবহার করি, কারণ আমরা সদৃশ পছন্দ করি না।<li><p><code>icon</code> : উৎস লিঙ্কের ফেভিকন</ul><li><p>আমরা একটি কীওয়ার্ড প্রক্রিয়া করার পরে, আমরা এটির পাওয়া নিবন্ধ এবং সঞ্চয়স্থানে ফিড সংরক্ষণ করি। তারা প্রকাশক দ্বারা ব্যবহার করা হবে.</ul><p>ক্রমাগত স্ক্র্যাপিং ঘটে, এটি একটি রাক্ষস। প্রধান লুপ ছদ্ম কোড এই মত দেখায়, এবং এটি কনফিগার করা হয়<em> সাইট প্রতি</em>:<ul><li><p>চিরতরে প্রক্সি সিঙ্ক করুন<li><p>অপ্রকাশিত (নিবন্ধ) গণনা (নিম্ন থেকে উচ্চ) অনুসারে সাজানো প্রতিটি বিষয়ের জন্য নিম্নলিখিতগুলি করুন<ul><li><p>শেষ কাজ থেকে ন্যূনতম ব্যবধান পাস হলে, বিষয়ের জন্য একটি পার্স কাজ চালান। একটি বিষয়ের জন্য আমাদের কাছে যত বেশি অপ্রকাশিত নিবন্ধ আছে সেই ব্যবধানটি বৃদ্ধি করে এবং যদি আমাদের কোনো অপ্রকাশিত নিবন্ধ না থাকে তবে তা সবসময় 0 হয়।<li><p>একই কাজ করুন কিন্তু ফিডের জন্য (যা আমরা উৎস থেকে সংগ্রহ করেছি, যদি আমাদের কাছে থাকে)<li><p>যদি সাইটটি নতুন বিষয় তৈরি করার উদ্দেশ্যে হয় তবে একটি তৈরি করুন। (এটি শুধুমাত্র তখনই বোঝা যায় যদি আপনি সাইট তৈরির সময় বিষয় তালিকা নির্ধারণ না করেন।)<li><p>প্রকাশিত নিবন্ধগুলি থেকে একটি নিবন্ধ চয়ন করুন এবং একটি টুইট পাঠান (আমরা ব্যবহার করে প্রতিদিন 3টি টুইট পাঠাই<a href=https://github.com/bear/python-twitter> python-twitter</a>)<li><p>প্রকাশিত নিবন্ধগুলি থেকে একটি নিবন্ধ চয়ন করুন এবং একটি ফেসবুক পৃষ্ঠা আপডেট করুন (আমরা প্রতিদিন 1টি আপডেট করি, ব্যবহার করে<a href=https://github.com/jgorset/facepy> মুখচ্ছবি</a>)</ul><p>(আমরা রেডডিটকেও সংযুক্ত করেছি, কিন্তু রেডডিট ক্রস পোস্টিংয়ের অনুমতি দেয় না, তাই এটি একটি নষ্ট প্রচেষ্টা ছিল।)</ul><h1 id=publishing><a class=header-anchor href=#publishing> প্রকাশনা</a></h1><p>একবার আমাদের প্রকাশ করার মতো বিষয়বস্তু হয়ে গেলে, আমাদের সিদ্ধান্ত নিতে হবে কী প্রকাশ করব এবং কত ঘন ঘন করব৷ আমি এখানে কোন কৌশল নিয়ে আসিনি, কারণ আমি আগে উল্লেখ করেছি যে কি প্রদর্শন করতে হবে তা ব্যবহারকারী নির্ভর। তাই আমরা শুধু থেকে প্রকাশ<em> নতুন থেকে পুরাতন</em> , এই যুক্তির সাথে যে কিছু যা আমরা সম্প্রতি স্ক্র্যাপ করেছি তা আরও প্রাসঙ্গিক, এটি একটি<a href=https://en.wikipedia.org/wiki/Stack_(abstract_data_type)> LIFO</a> কিউ. যদিও প্রকাশনাটি পাইথন টুলের উপর নির্ভরশীল, নিমে ঘটে, কারণ এটি সার্ভারের সাথে সংলগ্নভাবে চলে, যা নিমেও রয়েছে।<h2 id=the_publishing_logic><a class=header-anchor href=#the_publishing_logic> প্রকাশনার যুক্তি</a></h2><p>প্রকাশনা ক্রমাগত ঘটে, এবং স্ক্র্যাপিং-এর যেমন নিষ্ক্রিয় ব্যবধান থাকে, তেমনি প্রকাশনাও স্ক্র্যাপিংয়ের বিপরীতে করে। যখন আমরা স্ক্র্যাপ করি, তখন আমরা ধীর হয়ে যাই যখন আমাদের একটি থাকে<em> যথেষ্ট দীর্ঘ</em> অপ্রকাশিত নিবন্ধের ক্যাশে, যখন আমাদের ক্যাশে খুব বেশি সঙ্কুচিত হতে শুরু করে তখন আমরা প্রকাশের গতি কমিয়ে দিই। এই ভাবে, scraping সঙ্গে মিলিত, সবসময় থাকা উচিত<em> কিছু বিষয়বস্তু</em> প্রকাশিত হবে<em> কিছু সময়</em> ভবিষ্যতে প্রকৃত প্রকাশনার যুক্তি:<ul><li><p>ক্যাশে থেকে অপ্রকাশিত নিবন্ধগুলির একটি ব্যাচ আনুন। (আমরা প্রতি রানে 3টি নতুন নিবন্ধ প্রকাশ করতে পছন্দ করি।)<li><p>তারা ডুপ্লিকেট কিনা চেক করুন. ডুপ চেকিং স্থানীয় সংবেদনশীল হ্যাশিংয়ের মাধ্যমে করা হয়, একটি নিম লিব ব্যবহার করে,<a href=https://github.com/Nim-NLP/minhash/> মিনহাশ</a> . এলএসএইচ বেশ CPU নিবিড় (আপনি জানেন...হ্যাশিং), এবং এর নিজস্ব থ্রেড প্রয়োজন, (আরও কিছু কাজ আছে যা আমরা পরিচালনা করি যার জন্য তাদের নিজস্ব থ্রেড প্রয়োজন)।<li><p>পৃষ্ঠা রেন্ডারিং: এটির প্রয়োজন নেই, যেহেতু সার্ভার অন-দ্য-ফ্লাই প্রশ্নগুলি পরিচালনা করে, তবে এখানে রেন্ডারিং হল প্রাক-ক্যাশিংয়ের একটি ফর্ম৷<li><p>পৃষ্ঠা পরিচালনা। যেহেতু আমরা একটি সাইটের সাথে কাজ করছি আমাদের প্রতি পৃষ্ঠায় কতগুলি নিবন্ধ প্রদর্শন করতে হবে তা নির্বাচন করতে হবে এবং আরও নিবন্ধ প্রকাশ করার সাথে সাথে পৃষ্ঠাগুলি বৃদ্ধি করতে হবে। আমরা ~10 পৃষ্ঠায় নিবন্ধগুলিকে গোষ্ঠীবদ্ধ করতে বেছে নিই। সর্বশেষ পৃষ্ঠায় সর্বদা 10টির কম নিবন্ধ থাকে।<li><p>প্রকাশিত নিবন্ধগুলির অবস্থা সংরক্ষণ করুন, এর অর্থ হল নিবন্ধগুলিকে "অপ্রকাশিত" থেকে "প্রকাশিত" স্থিতিতে এবং LSH ডাটাবেসে স্থানান্তর করা।<li><p>নতুন নিবন্ধ প্রকাশ করার পরে আমাদের বাসি ক্যাশে সাফ করতে হবে। আমাদের হোমপেজ, টপিক পেজ এবং সাইটম্যাপ এবং আরএসএস ফিড সাফ করতে হবে।</ul><h1 id=serving><a class=header-anchor href=#serving> ভজনা</a></h1><p>আমরা একটি প্রকাশের বিষয়বস্তু স্ক্র্যাপ করার জন্য উভয় কাজ সেটআপ করি, যা বাকি থাকে তা পরিবেশন করা হয়।<h2 id=the_web_server><a class=header-anchor href=#the_web_server> ওয়েব সার্ভার</a></h2><p>থাকার পর<a href=https://github.com/dom96/jester> চেষ্টা</a><a href=https://github.com/dom96/httpbeast> ভিন্ন</a><a href=https://github.com/olliNiinivaara/GuildenStern/> ওয়েব</a><a href=https://github.com/status-im/nim-chronos/blob/master/chronos/apps/http/httpserver.nim> সার্ভার</a>, কারণ বিভিন্ন বাগ আমি সঙ্গে বসতি স্থাপন<a href=https://github.com/bung87/scorper> scorper</a>.<h2 id=handling_a_request><a class=header-anchor href=#handling_a_request> একটি অনুরোধ হ্যান্ডলিং</a></h2><h3 id=the_router><a class=header-anchor href=#the_router> রাউটার</a></h3><p>আমরা নিম ব্যবহার করি<a href=https://nim-lang.github.io/fusion/src/fusion/matching.html> প্যাটার্ন ম্যাচিং বাস্তবায়ন</a> রেজেক্স ক্যাপচারের একটি টুপল মেলে। এটি এমন রেজেক্স যা মোটেও আরামদায়ক নয়:<pre><code class="nim hljs"><span class=hljs-keyword>const</span>
  rxend = <span class=hljs-string>"(?=/+|(?=[?].*)|$)"</span>
  rxAmp = <span class=hljs-string>fmt"(/+amp{rxend})"</span>
  rxLang = <span class=hljs-string>"(/[a-z]{2}(?:-[A-Z]{2})?"</span> & <span class=hljs-string>fmt"{rxend})"</span><span class=hljs-comment># split to avoid formatting regex `{}` usage</span>
  rxTopic = <span class=hljs-string>fmt"(/+.*?{rxend})"</span>
  rxPage = <span class=hljs-string>fmt"(/+(?:[0-9]+|s|g|feed\.xml|sitemap\.xml){rxend})"</span>
  rxArt = <span class=hljs-string>fmt"(/+.*?{rxend})"</span>
  rxPath = <span class=hljs-string>fmt"{rxAmp}?{rxLang}?{rxTopic}?{rxPage}?{rxArt}?"</span></code></pre><p><code>rxPath</code> একটি পথ থাকতে পারে এমন সমস্ত সম্ভাব্য নোড দেখায়। তারপর আমাদের রাউটিং এর মত দেখায়:<pre><code class="nim hljs"><span class=hljs-keyword>let</span> capts = uriTuple(reqCtx.url.path)
<span class=hljs-keyword>case</span> capts:
  <span class=hljs-keyword>of</span> (topic: <span class=hljs-string>""</span>): <span class=hljs-comment># homepage...</span><span class=hljs-keyword>of</span> (topic: <span class=hljs-string>"assets"</span>): <span class=hljs-comment># assets</span><span class=hljs-keyword>of</span> (topic: <span class=hljs-string>"i"</span>): <span class=hljs-comment># images</span><span class=hljs-keyword>of</span> (topic: <span class=hljs-string>"robots.txt"</span>): <span class=hljs-comment># robots.txt</span><span class=hljs-keyword>of</span> (page: <span class=hljs-string>"sitemap.xml"</span>): <span class=hljs-comment># sitemap for topics</span><span class=hljs-keyword>of</span> (art: <span class=hljs-string>"index.xml"</span>): <span class=hljs-comment># sitemap index for topic pages</span>
  etc...</code></pre><p>এটি সুন্দর নয়, তবে কোনও নির্দিষ্ট রাউটারের উপর নির্ভর না করা আমাকে পরীক্ষার সময় খুব ঝগড়া ছাড়াই আন্ডারলিং ওয়েব সার্ভার অদলবদল করতে দেয়। এটা কর্মক্ষম? অস্পষ্ট ! এটিকে অন্য কিছুর সাথে তুলনা করে কোনো বেঞ্চমার্ক করেননি। যাইহোক, regex এর কি গন্ধ আছে যেটিতে বাগ থাকতে পারে এবং মামলার ক্রম নির্ধারণ করা গুরুত্বপূর্ণ।<blockquote><p>একটি মিনিট অপেক্ষা করুন...</blockquote><p>প্রকৃত পৃষ্ঠা রাউটিং করার আগে আমরা প্রতিটি অনুরোধে এমন একগুচ্ছ জিনিস আছে:<p>প্রাথমিকভাবে আমরা ক্লিনআপ কোড সেট করি (এর সাথে<code>defer:</code> ) যা<em> উচিত</em> কোন ফাঁস ঘটতে নিশ্চিত করুন.<pre><code class="nim hljs">defer:
  <span class=hljs-comment># <span class=hljs-doctag>FIXME:</span> is this cleanup required?</span><span class=hljs-keyword>var</span> futs: <span class=hljs-type>seq</span>[<span class=hljs-type>Future</span>[<span class=hljs-type>void</span>]]
  <span class=hljs-keyword>let</span> resp =
    <span class=hljs-keyword>if</span> ctx.response.issome: ctx.response.get
    <span class=hljs-keyword>else</span>: <span class=hljs-keyword>nil</span><span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> resp.isnil <span class=hljs-keyword>and</span><span class=hljs-keyword>not</span> resp.connection.isnil:
    futs.add resp.connection.closeWait()
  <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> ctx.isnil:
    <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> ctx.connection.isnil:
      futs.add ctx.connection.closeWait()
    futs.add ctx.closeWait()
  await allFutures(futs)</code></pre><p>থ্রেডটি আরম্ভ করা হয়েছে কিনা তা আমরা পরীক্ষা করি:<pre><code class="nim hljs">initThread()</code></pre><p>এটি সত্যিই শুধুমাত্র একবার চালানো উচিত (এটি পরীক্ষা করার জন্য আরম্ভ করার পরে একটি বিশ্বব্যাপী বুল সেট করে), এবং অনুরোধ হ্যান্ডলারের বাইরে করা যেতে পারে। কিন্তু আসলে কি আরম্ভ করা হয়? আচ্ছা...বেশ অনেক কিছু! মূলত আমরা (ab) বৈশ্বিক ধ্রুবক ব্যবহার করি যার জন্য প্রাথমিককরণের প্রয়োজন হয়, এছাড়াও এর মধ্যে কিছু আসলেই থ্রেড সম্পর্কিত নয়, যেহেতু তারা স্তূপে মেমরি শুরু করে এবং থ্রেড জুড়ে শেয়ার করা হয়<pre><code class="nim hljs"><span class=hljs-keyword>if</span> threadInitialized:
  debug <span class=hljs-string>"thread: already initialized"</span><span class=hljs-keyword>return</span>
debug <span class=hljs-string>"thread: base"</span>
initThreadBase()
debug <span class=hljs-string>"thread: sonic"</span>
initSonic() <span class=hljs-comment># Must be on top</span>
debug <span class=hljs-string>"thread: http"</span>
initHttp()
debug <span class=hljs-string>"thread: html"</span>
initHtml()
debug <span class=hljs-string>"thread: ldj"</span>
initLDJ()
debug <span class=hljs-string>"thread: feed"</span>
initFeed()
debug <span class=hljs-string>"thread: img"</span>
startImgFlow()
debug <span class=hljs-string>"thread: lsh"</span>
startLsh()
debug <span class=hljs-string>"thread: mimes"</span>
initMimes()
<span class=hljs-comment># ... and other stuff</span></code></pre><p>তারপর আমরা পরামিতি পার্স<pre><code class="nim hljs"><span class=hljs-keyword>var</span>
  relpath = ctx.rawPath
  page: <span class=hljs-type>string</span>
  rqlocked: <span class=hljs-type>bool</span>
relpath.removeSuffix('/')
debug <span class=hljs-string>"handling: {relpath:.120}"</span>

handleParams()</code></pre><p>আমরা কি জন্য পরামিতি ব্যবহার করি? দ্য<code>ParamKey</code> enum টাইপ এটি বর্ণনা করে:<pre><code class="nim hljs"><span class=hljs-keyword>type</span><span class=hljs-type>ParamKey</span> = <span class=hljs-keyword>enum</span>
    none,
    q, p, <span class=hljs-comment># sonic</span>
    c, <span class=hljs-comment># cache</span>
    d, <span class=hljs-comment># delete</span>
    t,  <span class=hljs-comment># translations</span>
    u <span class=hljs-comment># imgUrls</span></code></pre><p>আমরা করি<em> মাইক্রোক্যাচিং</em> অনুরোধের জন্য তাই প্রতিটি অনুরোধ টিপল অনুযায়ী ক্যাশে করা হয়<code>(path, query, accetEncoding)</code> , এনকোডিং প্রয়োজন কারণ আমরা উভয় (নন) সংকুচিত বডি পরিবেশন করতে পারি। একটি অনুরোধ প্রসঙ্গ এই মত দেখায়:<pre><code class="nim hljs"><span class=hljs-keyword>let</span> reqCtx = reqCtxCache.lcheckOrPut(reqCacheKey):
  <span class=hljs-keyword>let</span> reqCtx <span class=hljs-meta>{.gensym.}</span> = new(<span class=hljs-type>ReqContext</span>)
  <span class=hljs-keyword>block</span>:
    <span class=hljs-keyword>let</span> l = newAsyncLock()
    checkNil(l):
      reqCtx.lock = l
  reqCtx.url = move url
  reqCtx.params = params
  reqCtx.file = reqCtx.url.path.fp
  reqCtx.key = hash(reqCtx.file)
  reqCtx.rq = initTable[<span class=hljs-type>ReqId</span>, <span class=hljs-type>HttpRequestRef</span>]()
  new(reqCtx.respBody)
  reqCtx</code></pre><ul><li><p>দ্য<code>key</code> ক্ষেত্রটি সঠিক ক্যাশে করা পৃষ্ঠা (বডি) থেকে আনতে ব্যবহৃত হয়<code>pageCache</code>. একই সময়ে ঘটছে একাধিক অনুরোধ যাতে রেন্ডারিং কাজের নকল না করে তা নিশ্চিত করার জন্য লকটি প্রয়োজন (যদি অন্য একটি অনুরোধ ইতিমধ্যেই পৃষ্ঠা তৈরি করে, এটি শেষ হওয়ার জন্য অপেক্ষা করুন)। প্রতিটি ভিত্তি<code>HttpRequestRef</code> chronos httpsserver থেকে সংরক্ষণ করা হয়<code>rq</code> ক্ষেত্র দ্য<code>params</code> পূর্ববর্তী থেকে ইতিমধ্যে পার্স করা হয়<code>handleParams</code>.<li><p>আমরা মাধ্যমে বিষয়বস্তু অপসারণ সমর্থন<code>d</code> param, যা আমাদেরকে একটি সাধারণ http গেট রিকোয়েস্টের সাহায্যে নিউক আর্টিকেল (ফিল্টারিং ব্যর্থ হলে, কিন্তু বাস্তবে কখনোই ব্যবহার করা উচিত নয়, শুধু ডিবাগিংয়ের জন্য) অনুমতি দেয়। কার অন্য http পদ্ধতি প্রয়োজন? আমি না.<li><p>আমরা ক্যাশে ক্লিয়ারও সমর্থন করি। আমরা হয় পাতা মুছে দিতে পারি,<code>c=0</code> বা সমস্ত পৃষ্ঠা<code>c=1</code> . বিরক্তিকর বিটগুলি হল আমাদের পাথটি একটি নিবন্ধ, একটি পৃষ্ঠা, একটি চিত্র বা একটি সম্পদ কিনা তা পরীক্ষা করতে হবে এবং উপযুক্ত ক্যাশে কাঠামো পরিষ্কার করতে হবে৷ রাউটারের সাথে এখানে কিছু সুস্পষ্ট লজিক ডুপ্লিকেশন রয়েছে, কিন্তু যেহেতু এটি প্রি-রাউটিং করা হয়েছে, তাই এটি অ্যাড-হক হতে হবে, শুধুমাত্র ক্যাশে শুদ্ধ করার জন্য প্রাসঙ্গিক কেস পরিচালনা করতে হবে। এটি প্রি-রাউটিং করা হয় কারণ ক্যাশেও রাউটিং ছাড়াই পরিবেশন করা হয়, যেহেতু অনুরোধটি ইতিমধ্যেই তৈরি করা হয়ে থাকে, তাহলে আমরা কেবল সংরক্ষিত বডি দিয়ে উত্তর দিতে পারি।<code>respBody</code> ক্ষেত্র (এবং<code>respHeaders</code>, <code>respCode</code>).<li><p>ক্যাশে অপারেশন পরিচালনা করার পরে, আমরা পাথ পার্স করি।<li><p>এর পরে আরেকটি ছিনতাই চলছে:</ul><pre><code class="nim hljs"><span class=hljs-keyword>if</span> handleTranslation():
  <span class=hljs-keyword>return</span></code></pre><p>কেন এটিও রাউটিং করার আগে করা হয়? ডিফল্টরূপে আমরা আংশিকভাবে অনুবাদিত পৃষ্ঠাগুলি পরিবেশন করি। আমরা দরিদ্র :( এবং অনুবাদগুলি বিনামূল্যে পরিষেবার উপর ভিত্তি করে করা হয়, কিন্তু আমরা অত্যাধিক লোডের সময় বহন করতে পারি না, তাই আমরা অনুবাদটি স্থগিত করি যখন আমরা আমাদের অনুবাদ ডাটাবেসে ক্যাশে করা শুধুমাত্র স্নিপেটগুলির সাথে অনুবাদ করা পৃষ্ঠাটি পরিবেশন করি৷<p>এই মুহুর্তে রাউটিং রয়েছে, একটি ব্যতিক্রমের মধ্যে মোড়ানো যাতে সঠিক পৃষ্ঠাটি পরিবেশন করা ব্যর্থ হলে, আমরা একটি ইস্যু করি<code>503</code> . জারি করা a<code>503</code> বোঝায় যে আমরা একটি বৈধ url রুট করার চেষ্টা করেছি কিন্তু আমরা একটি পৃষ্ঠা তৈরি করতে পারিনি৷ অবৈধ url এর জন্য আমরা একটি ইস্যু করি<code>301</code> পুনঃনির্দেশ যা বোঝায় যে url বৈধ নয়। আমরা 11টি ভিন্ন ধরনের url পরিবেশন করি:<ul><li><p>হোমপেজ: সাম্প্রতিক বিষয়গুলি থেকে নিবন্ধগুলি টেনে আনে, ছদ্ম এলোমেলোভাবে, আমরা জনপ্রিয়তার উপর ভিত্তি করে কোনও বাছাই করি না।<li><p>সাধারণ সম্পদ (এর অধীনে<code>/assets/</code> পথ): সরাসরি একটি ডেডিকেটেড ডিরেক্টরিতে ম্যাপ করা হয়<li><p>জেনেরিক ছবি (নীচে<code>/i/</code> pah): আমরা আমাদের প্রতিক্রিয়াশীল ওয়েবসাইটের সাথে মানানসই আকার তৈরি করতে বাহ্যিক চিত্রগুলিকে প্রক্সি করি, যখন চিত্রগুলি অনুপলব্ধ হয় হয় একটি স্বচ্ছ পিক্সেল বা চিত্র আইকন ডিফল্ট হিসাবে পরিবেশন করা হয়৷<li><p>robots.txt ফাইল<li><p>সাইটম্যাপ (হোমপেজ এবং বিষয় এবং পৃষ্ঠাগুলির জন্য): হোমপেজটি হোস্ট করে সাইটম্যাপিন্ডেক্স সমস্ত বিষয়ের সাইটম্যাপের দিকে নির্দেশ করে, বিষয়ের সাইটম্যাপগুলি বিষয়ের সমস্ত পৃষ্ঠাগুলিকে নির্দেশ করে, পৃষ্ঠাগুলির সাইটম্যাপগুলি পৃষ্ঠার সমস্ত নিবন্ধের দিকে নির্দেশ করে৷<li><p>pwa ম্যানিফেস্ট: pwa ম্যানিফেস্টকে ওয়েবসাইটটিকে pwa হিসাবে ইনস্টল করার অনুমতি দেওয়া উচিত (তবে খোলাখুলিভাবে এটি পরীক্ষা করা হয়নি)<li><p>অনুসন্ধান: অনুসন্ধান লিভারেজ<a href=https://github.com/valeriansaliou/sonic> সোনিক</a> সঙ্গে<a href=https://github.com/alongwy/pysonic> পাইসোনিক</a> বাঁধাই<li><p>পরামর্শ: পরামর্শগুলিও সোনিক লাইব্রেরির মাধ্যমে পরিচালনা করা হয়। কিন্তু তাদের প্রয়োজন<li><p>ফিডস: সাইটম্যাপের মতো আমাদের হোমপেজের জন্য বিভিন্ন ফিড রয়েছে, এবং বিভিন্ন বিষয়ের জন্য, যদিও সুস্পষ্ট কারণে একক পৃষ্ঠাগুলির জন্য কোনও ফিড নেই৷<li><p>বিষয় পৃষ্ঠা: প্রতিটি বিষয়ের জন্য উৎসর্গীকৃত পৃষ্ঠা (যেমন পথ সহ<code>domain.com/my-topic/</code> ) বিষয়ের জন্য প্রকাশিত সর্বশেষ নিবন্ধগুলিকে টেনে আনে, যা একটির অন্তর্গত<em> অসমাপ্ত</em> পৃষ্ঠা<li><p>নিবন্ধের পৃষ্ঠা: নিবন্ধের পৃষ্ঠাটি নিবন্ধের শিরোনাম, বিবরণ, উত্স লিঙ্ক, ট্যাগ, প্রকাশিত সময় (ফুটারে) দেখায় এবং নীচে আমরা 3টি সম্পর্কিত নিবন্ধ টানছি। সম্পর্কিত নিবন্ধগুলি নিবন্ধের শিরোনাম বা ট্যাগগুলিতে অনুসন্ধান ক্যোয়ারী ব্যবহার করে আনা হয়।</ul><h2 id=about_the_rendering><a class=header-anchor href=#about_the_rendering> রেন্ডারিং সম্পর্কে</a></h2><p>পৃষ্ঠা রেন্ডারিং ব্যবহার করে নিম পাশ থেকে প্রক্রিয়া করা হয়<a href=https://github.com/karaxnim/karax> কারাক্স</a><h3 id=general_page_layout><a class=header-anchor href=#general_page_layout> সাধারণ পৃষ্ঠা বিন্যাস</a></h3><p>ওয়েবসাইটটি একটি শীর্ষ স্থির বার দ্বারা গঠিত যা দেখায়:<ul><li><p>হোমপেজ ইউআরএল, লোগো এসভিজি ইমেজের মাধ্যমে।<li><p>হালকা/গাঢ় থিম বোতাম<li><p>বর্তমান পাথ ব্যবহার করে বর্তমান url<em> crumbs</em> লিঙ্ক টেক্সট হিসাবে<li><p>সবচেয়ে সাম্প্রতিক ~10টি বিষয়ের ইউআরএল<li><p>অনুসন্ধান বার (সার্চ বোতাম সহ), যেখানে টাইপ করা পরামর্শ পপ আপ হয়<li><p>ভাষা বোতাম, যেখানে ক্লিক করা হলে ভাষার তালিকা ভেসে ওঠে</ul><p>যেহেতু এটি একটি প্রতিক্রিয়াশীল নকশা, যখন ভিউপোর্টটি ছোট হয়, তখন উপরের বারটি শুধুমাত্র অনুসন্ধান বাক্সটি ধরে রাখে এবং বাকিটি একটি টগলযোগ্য সাইডবারে প্রদর্শিত হয়।<ul><li><p>ফুটার, সাইটম্যাপ, আরএসএস, সামাজিক, আইনি জন্য লিঙ্ক ধারণ করে<li><p>বিভিন্ন অবস্থানে বিজ্ঞাপন সমর্থিত</ul><h2 id=rss><a class=header-anchor href=#rss> আরএসএস</a></h2><p>এটি একটি উদাহরণ ফাংশন, ফিড আপডেট করার জন্য একটি নতুন পোস্ট প্রকাশিত হলে আমরা কী করি তা দেখায়:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> update*(tfeed: <span class=hljs-type>Feed</span>, topic: <span class=hljs-type>string</span>, newArts: <span class=hljs-type>seq</span>[<span class=hljs-type>Article</span>], dowrite = <span class=hljs-literal>false</span>) =
    <span class=hljs-comment>## Load existing feed for given topic and update the feed (in-memory)</span><span class=hljs-comment>## with the new articles provided, it does not write to storage.</span>
    checkNil tfeed
    <span class=hljs-keyword>let</span>
        chann = tfeed.findel(<span class=hljs-string>"channel"</span>)
        itms = chann.drainChannel
        arl = itms.len
        narl = newArts.len

    debug <span class=hljs-string>"rss: newArts: {narl}, previous: {arl}"</span><span class=hljs-keyword>let</span>
        fill = <span class=hljs-type>RSS_N_ITEMS</span> - arl
        rem = max(<span class=hljs-number>0</span>, narl - fill)
        shrinked = <span class=hljs-keyword>if</span> (rem > <span class=hljs-number>0</span><span class=hljs-keyword>and</span> arl > <span class=hljs-number>0</span>):
                       itms[<span class=hljs-number>0</span>..<(max(<span class=hljs-number>0</span>, arl-rem))]
                   <span class=hljs-keyword>else</span>: itms
    debug <span class=hljs-string>"rss: articles tail len {len(shrinked)}, newarts: {len(newArts)}"</span>
    assert shrinked.len + narl <= <span class=hljs-type>RSS_N_ITEMS</span>, <span class=hljs-string>fmt"shrinked: {shrinked.len}, newarticles: {narl}"</span><span class=hljs-keyword>for</span> a <span class=hljs-keyword>in</span> newArts:
        chann.add articleItem(a)
    <span class=hljs-keyword>for</span> itm <span class=hljs-keyword>in</span> shrinked:
        chann.add itm
    <span class=hljs-keyword>if</span> dowrite:
   
        pageCache[][topic.feedKey] = tfeed.toXmlString</code></pre><h2 id=sitemaps><a class=header-anchor href=#sitemaps> সাইটম্যাপ</a></h2><p>এটি সাইটম্যাপে url যোগ করার মূল বিষয়:<pre><code class="nim hljs"><span class=hljs-keyword>template</span> addUrlToFeed(getLoc, getLocLang) =
  <span class=hljs-keyword>if</span> unlikely(nEntries > maxEntries):
      warn <span class=hljs-string>"Number of URLs for sitemap of topic: {topic} exceeds limit! {nEntries}/{maxEntries}"</span><span class=hljs-keyword>break</span><span class=hljs-keyword>let</span>
      url = newElement(<span class=hljs-string>"url"</span>)
      loc = newElement(<span class=hljs-string>"loc"</span>)
  loc.add getLoc().escape.newText
  url.add loc
  addLangs(url, getLocLang)
  <span class=hljs-built_in>result</span>.add url

<span class=hljs-keyword>proc</span> buildTopicPagesSitemap*(topic: <span class=hljs-type>string</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>XmlNode</span>] <span class=hljs-meta>{.async.}</span> =
    initSitemapIndex()
    await syncTopics()
    <span class=hljs-keyword>var</span> nEntries = <span class=hljs-number>0</span><span class=hljs-keyword>let</span> done = await topicDonePages(topic)
    <span class=hljs-keyword>template</span> langUrl(lang): untyped <span class=hljs-meta>{.dirty.}</span> = $(<span class=hljs-type>WEBSITE_URL</span> / lang / topic / pages[n])
    withPyLock:
        <span class=hljs-comment># add the most recent articles first (pages with higher idx)</span><span class=hljs-keyword>let</span> pages = pybi[].list(done.keys()).to(<span class=hljs-type>seq</span>[<span class=hljs-type>string</span>])
        <span class=hljs-keyword>for</span> n <span class=hljs-keyword>in</span> countDown(pages.len - <span class=hljs-number>1</span>, <span class=hljs-number>0</span>):
          <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> (await isEmptyPage(topic, pages[n].parseInt, <span class=hljs-literal>false</span>)):
            <span class=hljs-keyword>discard</span> sitemapUrl(topic, pages[n]).sitemapEl

<span class=hljs-keyword>template</span> addArticleToFeed() =
  <span class=hljs-keyword>template</span> baseUrl(): untyped =
    getArticleUrl(a, topic)

  <span class=hljs-keyword>template</span> langUrl(lang): untyped =
    getArticleUrl(a, topic, lang)

  <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> a.isValidArticlePy:
      <span class=hljs-keyword>continue</span>

  addUrlToFeed(baseUrl, langUrl)

<span class=hljs-keyword>proc</span> buildTopicSitemap(topic: <span class=hljs-type>string</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>XmlNode</span>] <span class=hljs-meta>{.async.}</span> =
    initUrlSet()
    await syncTopics()
    <span class=hljs-keyword>let</span> done = await topicDonePages(topic)
    <span class=hljs-keyword>var</span> nEntries = <span class=hljs-number>0</span>
    withPyLock:
        <span class=hljs-comment># add the most recent articles first (pages with higher idx)</span><span class=hljs-keyword>for</span> pagenum <span class=hljs-keyword>in</span> countDown(len(done) - <span class=hljs-number>1</span>, <span class=hljs-number>0</span>):
            <span class=hljs-keyword>if</span> unlikely(nEntries > maxEntries):
                warn <span class=hljs-string>"Number of URLs for sitemap of topic: {topic} exceeds limit! {nEntries}/{maxEntries}"</span><span class=hljs-keyword>break</span>
            checkTrue pagenum <span class=hljs-keyword>in</span> done, <span class=hljs-string>"Mismatching number of pages"</span><span class=hljs-keyword>for</span> a <span class=hljs-keyword>in</span> done[pagenum]:
                addArticleToFeed()</code></pre><h2 id=templates><a class=header-anchor href=#templates> টেমপ্লেট</a></h2><p>আমরা একটি টেমপ্লেট ইঞ্জিন ব্যবহার করি না যেহেতু বেশিরভাগ রেন্ডারিং করাক্স দিয়ে করা হয়, তবে ToS-এর মতো পৃষ্ঠাগুলির জন্য আমরা ফাইল টেমপ্লেট ব্যবহার করি, যেখানে আমরা কেবল একটি গুচ্ছ ভেরিয়েবল প্রতিস্থাপন করি, যেমন<code>envsubst</code> আদেশ<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> pageFromTemplate*(tpl, lang, amp: <span class=hljs-type>string</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>string</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>var</span> txt = await readfileAsync(<span class=hljs-type>ASSETS_PATH</span> / <span class=hljs-string>"templates"</span> / tpl & <span class=hljs-string>".html"</span>)
  <span class=hljs-keyword>let</span> (vars, title, desc) =
    <span class=hljs-keyword>case</span> tpl:
      <span class=hljs-keyword>of</span><span class=hljs-string>"dmca"</span>: (tplRep, <span class=hljs-string>"DMCA"</span>, <span class=hljs-string>fmt"dmca compliance for {WEBSITE_DOMAIN}"</span>)
      <span class=hljs-keyword>of</span><span class=hljs-string>"tos"</span>: (ppRep, <span class=hljs-string>"Terms of Service"</span>,
          <span class=hljs-string>fmt"Terms of Service for {WEBSITE_DOMAIN}"</span>)
      <span class=hljs-keyword>of</span><span class=hljs-string>"privacy-policy"</span>: (ppRep, <span class=hljs-string>"Privacy Policy"</span>,
          <span class=hljs-string>fmt"Privacy Policy for {WEBSITE_DOMAIN}"</span>)
      <span class=hljs-keyword>else</span>: (tplRep, tpl, <span class=hljs-string>""</span>)
  txt = multiReplace(txt, vars)
  <span class=hljs-keyword>let</span>
    slug = slugify(title)
    page = await buildPage(title = title, content = txt, wrap = <span class=hljs-literal>true</span>)
  checkNil(page):
    <span class=hljs-keyword>let</span> processed = await processPage(lang, amp, page, relpath = tpl)
    checkNil(processed, <span class=hljs-string>fmt"failed to process template {tpl}, {lang}, {amp}"</span>):
      <span class=hljs-keyword>return</span> processed.asHtml(minify_css = (amp == <span class=hljs-string>""</span>))</code></pre><h2 id=articles_pages><a class=header-anchor href=#articles_pages> প্রবন্ধ পাতা</a></h2><p>যখন আমরা হোম/বিষয় এবং সংখ্যাযুক্ত পৃষ্ঠাগুলির মতো পৃষ্ঠাগুলিকে রেন্ডার করি তখন আমাদের নিবন্ধগুলির একটি তালিকা দেখাতে হয়, এই ফাংশনটিকে একটি লুপে বলা হয় আমরা কতগুলি নিবন্ধ দেখাতে চাই:<pre><code class="nim hljs"><span class=hljs-keyword>import</span> htmlparser
<span class=hljs-keyword>proc</span> articleEntry(ar: <span class=hljs-type>Article</span>, topic = <span class=hljs-string>""</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>VNode</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>if</span> ar.topic == <span class=hljs-string>""</span><span class=hljs-keyword>and</span> topic != <span class=hljs-string>""</span>:
    ar.topic = topic
  <span class=hljs-keyword>let</span> relpath = getArticlePath(ar)
  <span class=hljs-keyword>try</span>:
    <span class=hljs-keyword>return</span> buildHtml(article(class = <span class=hljs-string>"entry"</span>)):
      h2(class = <span class=hljs-string>"entry-title"</span>, id = ar.slug):
        a(href = relpath):
          text ar.title
      tdiv(class = <span class=hljs-string>"entry-info"</span>):
        span(class = <span class=hljs-string>"entry-author"</span>):
          text ar.getAuthor & <span class=hljs-string>", "</span>
        time(class = <span class=hljs-string>"entry-date"</span>, datetime = ($ar.pubDate)):
          italic:
            text format(ar.pubDate, <span class=hljs-string>"dd/MMM"</span>)
      tdiv(class = <span class=hljs-string>"entry-tags"</span>):
        <span class=hljs-keyword>if</span> ar.tags.len == <span class=hljs-number>0</span>:
          span(class = <span class=hljs-string>"entry-tag-name"</span>):
            a(href = (await nextAdsLink()), target = <span class=hljs-string>"_blank"</span>):
              icon(<span class=hljs-string>"i-mdi-tag"</span>)
              text <span class=hljs-string>"none"</span><span class=hljs-keyword>else</span>:
          <span class=hljs-keyword>for</span> t <span class=hljs-keyword>in</span> ar.tags:
            <span class=hljs-keyword>if</span> likely(t.isSomething):
              span(class = <span class=hljs-string>"entry-tag-name"</span>):
                a(href = (await nextAdsLink()), target = <span class=hljs-string>"_blank"</span>):
                  icon(<span class=hljs-string>"i-mdi-tag"</span>)
                  text t
      buildImgUrl(ar)
      tdiv(class = <span class=hljs-string>"entry-content"</span>):
        verbatim(articleExcerpt(ar))
        a(class = <span class=hljs-string>"entry-more"</span>, href = relpath):
          text <span class=hljs-string>"[continue]"</span>
      hr()
  <span class=hljs-keyword>except</span><span class=hljs-type>Exception</span><span class=hljs-keyword>as</span> e:
    logexc()
    warn <span class=hljs-string>"articles: entry creation failed."</span><span class=hljs-keyword>raise</span> e

<span class=hljs-keyword>proc</span> buildShortPosts*(arts: <span class=hljs-type>seq</span>[<span class=hljs-type>Article</span>], topic = <span class=hljs-string>""</span>): <span class=hljs-type>Future</span>[
    <span class=hljs-type>string</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>for</span> a <span class=hljs-keyword>in</span> arts:
    <span class=hljs-built_in>result</span>.add $(await articleEntry(a, topic))</code></pre><p>কিছু লাইনে কীভাবে "বিজ্ঞাপনগুলি" X তে ক্রমাগত হয় তা লক্ষ্য করুন)<h2 id=topics_list><a class=header-anchor href=#topics_list> বিষয় তালিকা</a></h2><p>উপরের বারে আমরা বিষয় তালিকা দেখাই, এটি এটি প্রিন্ট করে:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> topicsList*(ucls: <span class=hljs-type>string</span>; icls: <span class=hljs-type>string</span>; small: <span class=hljs-keyword>static</span>[
    <span class=hljs-type>bool</span>] = <span class=hljs-literal>true</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>VNode</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-built_in>result</span> = newVNode(<span class=hljs-type>VNodeKind</span>.ul)
  <span class=hljs-built_in>result</span>.setAttr(<span class=hljs-string>"class"</span>, ucls)
  <span class=hljs-keyword>let</span> topics = await loadTopics(-<span class=hljs-type>MENU_TOPICS</span>) <span class=hljs-comment># <span class=hljs-doctag>NOTE:</span> the sign is negative, we load the most recent N topics</span><span class=hljs-built_in>result</span>.add buildHtml(tdiv(class = <span class=hljs-string>"topics-shadow"</span>))
  <span class=hljs-keyword>var</span> topic_slug, topic_name: <span class=hljs-type>string</span><span class=hljs-keyword>var</span> isEmpty: <span class=hljs-type>bool</span><span class=hljs-keyword>for</span> i <span class=hljs-keyword>in</span><span class=hljs-number>0</span>..&LTtopics.len:
    withPyLock:
      (topic_slug, topic_name) = ($topics[i][<span class=hljs-number>0</span>], $topics[i][<span class=hljs-number>1</span>])
      isEmpty = isEmptyTopic(topic_slug)
    <span class=hljs-keyword>if</span> isEmpty:
      <span class=hljs-keyword>continue</span><span class=hljs-keyword>let</span> liNode = buildHtml(li(class = <span class=hljs-string>fmt"{icls}"</span>)):
      <span class=hljs-comment># tdiv(class = "mdc-icon-button__ripple") # not used without material icons</span>
      a(href = ($(<span class=hljs-type>WEBSITE_URL</span> / topic_slug)), title = topic_name,
          class = <span class=hljs-string>"mdc-ripple-button"</span>):
        tdiv(class = <span class=hljs-string>"mdc-ripple-surface  mdc-ripple-upgraded"</span>)
        <span class=hljs-keyword>when</span> small:
          <span class=hljs-comment># only use the first letter</span>
          text $topic_name.runeAt(<span class=hljs-number>0</span>).toUpper <span class=hljs-comment># loadTopics iterator returns pyobjects</span><span class=hljs-keyword>else</span>:
          text topic_name
      <span class=hljs-keyword>when</span> small:
        br()
      <span class=hljs-keyword>else</span>:
        span(class = <span class=hljs-string>"separator"</span>)
    <span class=hljs-built_in>result</span>.add liNode</code></pre><p>এখানে কিছু দুর্গন্ধযুক্ত হার্ড কোডেড উপাদান ডিজাইন ক্লাস আছে। সত্যি বলতে গুগল ম্যাটেরিয়াল ডিজাইনের কম্পোনেন্টগুলো চুষছে।<h2 id=post_footer><a class=header-anchor href=#post_footer> পোস্ট ফুটার</a></h2><p>পোস্টের পাদচরণ একটি নিবন্ধ পৃষ্ঠার নীচে ডানদিকে প্রদর্শিত হয় (ltr-এ) এবং এটি সত্যিই শুধুমাত্র প্রকাশিত তারিখ প্রিন্ট করে।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> postFooter(pubdate: <span class=hljs-type>Time</span>): <span class=hljs-type>VNode</span> =
  <span class=hljs-keyword>let</span> dt = inZone(pubdate, utc())
  buildHtml(tdiv(class = <span class=hljs-string>"post-footer"</span>)):
    time(datetime = ($dt)):
      text <span class=hljs-string>"Published date: "</span>
      italic:
        text format(dt, <span class=hljs-string>"dd MMM yyyy"</span>)</code></pre><h2 id=excerpts><a class=header-anchor href=#excerpts> উদ্ধৃতি</a></h2><p>নিবন্ধের এন্ট্রি তৈরি করার সময় আমাদের উদ্ধৃতির প্রয়োজন হতে পারে যদি কোনো সারাংশ পাওয়া না যায়।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> articleExcerpt(a: <span class=hljs-type>Article</span>): <span class=hljs-type>string</span> =
  <span class=hljs-keyword>let</span> alen = len(a.content) - <span class=hljs-number>1</span><span class=hljs-keyword>let</span> maxlen = min(alen, <span class=hljs-type>ARTICLE_EXCERPT_SIZE</span>)
  <span class=hljs-keyword>if</span> maxlen == alen:
    <span class=hljs-keyword>return</span> a.content
  <span class=hljs-keyword>else</span>:
    <span class=hljs-keyword>let</span> runesize = runeLenAt(a.content, maxlen)
    <span class=hljs-comment># If article contains html tags, the excerpt might have broken html</span><span class=hljs-keyword>return</span> parseHtml(a.content[<span class=hljs-number>0</span>..maxlen+runesize]).innerText & <span class=hljs-string>"..."</span></code></pre><p>Wtf হল<code>parseHtml</code> এখানে করছেন? এটা হল যে আমরা নিবন্ধের বিষয়বস্তুর ভিতরে এইচটিএমএলকে অনুমতি দিই (কিন্তু শুধুমাত্র কিছু ট্যাগ), এটি পাইথন মডিউল ট্রাফিলাটুরার একটি বিকল্প, যা আমরা সক্রিয় রাখি কারণ এটি নিবন্ধের বিন্যাসকে প্রভাবিত করতে পারে। আমাদের utf-8 স্ট্রিংগুলিকে খণ্ডিত করার বিষয়েও সতর্ক থাকতে হবে...<h2 id=minification><a class=header-anchor href=#minification> মিনিফিকেশন</a></h2><p>কারাক্স নির্মাণের পর শেষ কাজ<code>VNode</code> গাছ বাইট ডাম্প করা হয়. এইচটিএমএল শিরোলেখের সাথে উপসর্গ থাকলে গাছটি, এবং ঐচ্ছিকভাবে ছোট করা হয়।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> asHtml*(data: <span class=hljs-type>string</span> ; minify: <span class=hljs-keyword>static</span>[<span class=hljs-type>bool</span>] = <span class=hljs-literal>true</span>; minify_css: <span class=hljs-type>bool</span> = <span class=hljs-literal>true</span>): <span class=hljs-type>string</span> =
  <span class=hljs-keyword>let</span> html = <span class=hljs-string>"&LT!DOCTYPE html>"</span> & <span class=hljs-string>"\n"</span> & data
  sdebug <span class=hljs-string>"html: raw size {len(html)}"</span><span class=hljs-built_in>result</span> = <span class=hljs-keyword>when</span> minify:
             html.minifyHtml(minify_css = <span class=hljs-literal>false</span>,
                             minify_js = <span class=hljs-literal>false</span>,
                             keep_closing_tags = <span class=hljs-literal>true</span>,
                             do_not_minify_doctype = <span class=hljs-literal>true</span>,
                             keep_spaces_between_attributes = <span class=hljs-literal>true</span>,
                             ensure_spec_compliant_unquoted_attribute_values = <span class=hljs-literal>true</span>)
           <span class=hljs-keyword>else</span>:
             html
  sdebug <span class=hljs-string>"html: minified size {len(result)}"</span></code></pre><p>মিনিফিকেশন দ্বারা পরিচালিত হয়<a href=https://github.com/wilsonzlin/minify-html> minify-html</a> যা আমরা ব্যবহার করতে বাধ্য<a href=https://github.com/nim-lang/c2nim> c2nim</a> , বাইন্ডিং ফাইলে রয়েছে:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> minify*(code: <span class=hljs-type>cstring</span>,
             do_not_minify_doctype = <span class=hljs-literal>false</span>,
             ensure_spec_compliant_unquoted_attribute_values = <span class=hljs-literal>false</span>,
             keep_closing_tags = <span class=hljs-literal>true</span>,
             keep_comments = <span class=hljs-literal>false</span>,
             keep_html_and_head_opening_tags = <span class=hljs-literal>true</span>,
             keep_spaces_between_attributes = <span class=hljs-literal>false</span>,
             minify_css = <span class=hljs-literal>true</span>,
             minify_js = <span class=hljs-literal>true</span>,
             remove_bangs = <span class=hljs-literal>false</span>,
             remove_processing_instructions = <span class=hljs-literal>true</span>): <span class=hljs-type>cstring</span><span class=hljs-meta>{.importc: "minify".}</span><span class=hljs-keyword>proc</span> minifyHtml*(tree: <span class=hljs-type>VNode</span>): <span class=hljs-type>string</span> = $minify(($tree).<span class=hljs-type>cstring</span>)
<span class=hljs-keyword>proc</span> minifyHtml*(data: <span class=hljs-type>string</span>): <span class=hljs-type>string</span> = $minify(data.<span class=hljs-type>cstring</span>)
<span class=hljs-keyword>template</span> minifyHtml*(data: <span class=hljs-type>string</span>, args: <span class=hljs-type>varargs</span>[untyped]): <span class=hljs-type>string</span> =
    $minify(data.<span class=hljs-type>cstring</span>, args)</code></pre><p>কিন্তু বিল্ডিংয়ের জন্য আমাদের স্ট্যাটিক লাইব্রেরি প্রদান করতে হবে, আমাদের মধ্যে এই লাইনটি যোগ করুন<code>nim.cfg</code><pre><code class="toml hljs">--passL:"$PROJECT_DIR/src/rust/target/release/libminify_html_c.a"</code></pre><p>আমি বলতে চাচ্ছি ... যে আমার পথ আমি মিনিফাই লাইব্রেরি তৈরি করা হয়েছে যা<em> btw</em> প্রকৃতপক্ষে একটি বহিরাগত সি ফাংশন নেই যা নিম গ্রাস করতে পারে, তাই আমাদের এটি নিজেরাই লিখতে হয়েছিল।<pre><code class="rust hljs"><span class=hljs-keyword>use</span> minify_html::{Cfg, minify <span class=hljs-keyword>as</span> minify_html_native};
<span class=hljs-keyword>use</span> std::ffi::CStr;
<span class=hljs-keyword>use</span> std::ffi::CString;
<span class=hljs-keyword>use</span> std::os::raw::c_char;

<span class=hljs-meta>#[no_mangle]</span><span class=hljs-keyword>pub</span><span class=hljs-keyword>extern</span><span class=hljs-string>"C"</span><span class=hljs-keyword>fn</span><span class="hljs-title function_">minify</span>(
    code: *<span class=hljs-keyword>const</span> c_char,
    do_not_minify_doctype: <span class=hljs-type>bool</span>,
    ensure_spec_compliant_unquoted_attribute_values: <span class=hljs-type>bool</span>,
    keep_closing_tags: <span class=hljs-type>bool</span>,
    keep_comments: <span class=hljs-type>bool</span>,
    keep_html_and_head_opening_tags: <span class=hljs-type>bool</span>,
    keep_spaces_between_attributes: <span class=hljs-type>bool</span>,
    minify_css: <span class=hljs-type>bool</span>,
    minify_js: <span class=hljs-type>bool</span>,
    remove_bangs: <span class=hljs-type>bool</span>,
    remove_processing_instructions: <span class=hljs-type>bool</span>,
) <span class=hljs-punctuation>-></span> *<span class=hljs-keyword>const</span> c_char {

    <span class=hljs-keyword>let</span><span class=hljs-variable>code</span> = <span class=hljs-keyword>unsafe</span> { CStr::<span class="hljs-title function_ invoke__">from_ptr</span>(code) };
    <span class=hljs-keyword>let</span><span class=hljs-variable>code_vec</span> = code.<span class="hljs-title function_ invoke__">to_bytes</span>();

    <span class=hljs-keyword>let</span><span class=hljs-variable>cfg</span> = Cfg {
        do_not_minify_doctype,
        ensure_spec_compliant_unquoted_attribute_values,
        keep_closing_tags,
        keep_comments,
        keep_html_and_head_opening_tags,
        keep_spaces_between_attributes,
        minify_css,
        minify_js,
        remove_bangs,
        remove_processing_instructions,
    };

    <span class=hljs-keyword>let</span><span class=hljs-variable>minified</span> = <span class="hljs-title function_ invoke__">minify_html_native</span>(code_vec, &cfg);

    <span class=hljs-keyword>let</span><span class=hljs-variable>s</span> = <span class=hljs-keyword>unsafe</span> { CString::<span class="hljs-title function_ invoke__">from_vec_unchecked</span>(minified).<span class="hljs-title function_ invoke__">into_raw</span>() };
    <span class=hljs-keyword>return</span> s;
}</code></pre><h1 id=nimpy_and_the_quest_for_crash_free_garbage_deletion><a class=header-anchor href=#nimpy_and_the_quest_for_crash_free_garbage_deletion> নিম্পি এবং ক্র্যাশ মুক্ত আবর্জনা মুছে ফেলার জন্য অনুসন্ধান</a></h1><p><a href=https://github.com/yglukhov/nimpy/> নিমের জন্য পাইথন বাঁধাই</a> অজগর অবজেক্ট বিনামূল্যে বাতিল করতে হবে। সমস্যা হল যখন নিম জিসি করে তখন আমাদের নিয়ন্ত্রণ করতে হবে। নিম্পি লাইব্রেরি অনুমান করে যে জিআইএল সর্বদা লক থাকে (এটি এটিকে শুরুতে লক করে), যখনই পাইথনে কল করা বিনামূল্যে। কিন্তু আমরা একটি পাইথন থ্রেডপুলকে কোড চালানোর অনুমতি দেওয়ার জন্য গিলটি আনলক করি যখন নিম অন্যান্য জিনিস চালায়। যদি পাইথন জিআইএল সর্বদা নিম দ্বারা লক করা থাকে তবে থ্রেডপুলটি বেশিরভাগ সময় নিষ্ক্রিয় থাকবে।<pre><code class="nim hljs"><span class=hljs-keyword>when</span> defined(pyAsync):
  <span class=hljs-keyword>type</span><span class=hljs-type>PyGilObj</span> = <span class=hljs-keyword>object</span>
      lock: <span class=hljs-type>ThreadLock</span>
      currentLockHolder: <span class=hljs-type>int</span>
      state: <span class=hljs-type>PyGILState_STATE</span><span class=hljs-type>PyGil</span> = <span class=hljs-keyword>ptr</span><span class=hljs-type>PyGilObj</span><span class=hljs-keyword>var</span> pyGil*: <span class=hljs-type>PyGil</span><span class=hljs-keyword>var</span> pyGilLock*: <span class=hljs-type>ThreadLock</span><span class=hljs-keyword>var</span> pyMainThread: <span class=hljs-type>PyThreadState</span><span class=hljs-keyword>proc</span> initPyGil*() =
    assert <span class=hljs-type>PyGILState_Check</span>()
    pyGil = create(<span class=hljs-type>PyGilObj</span>)
    pyGil.currentLockHolder = getThreadID()
    pyGil.lock = newThreadLock()
    pyGilLock = pyGil.lock
    pyMainThread = <span class=hljs-type>PyEval_SaveThread</span>()

  <span class=hljs-keyword>proc</span> acquire*(gil: <span class=hljs-type>PyGil</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>void</span>] <span class=hljs-meta>{.async.}</span> =
    await gil.lock.acquire
    <span class=hljs-keyword>let</span> id = getThreadId()
    gil.currentLockHolder = id
    gil.state = <span class=hljs-type>Py_GILState_Ensure</span>()

  <span class=hljs-keyword>proc</span> tryAcquire*(gil: <span class=hljs-type>PyGil</span>): <span class=hljs-type>bool</span> =
    <span class=hljs-keyword>if</span> gil.lock.tryAcquire():
      <span class=hljs-keyword>let</span> id = getThreadId()
      gil.currentLockHolder = id
      gil.state = <span class=hljs-type>Py_GILState_Ensure</span>()
      <span class=hljs-keyword>return</span><span class=hljs-literal>true</span><span class=hljs-keyword>proc</span> release*(gil: <span class=hljs-type>PyGil</span>) <span class=hljs-meta>{.inline.}</span> =
    doassert gil.currentLockHolder == getThreadId(), <span class=hljs-string>"Can't release gil lock from a different thread."</span>
    doassert gilLocked()
    <span class=hljs-type>Py_GILState_Release</span>(gil.state)
    gil.lock.release</code></pre><p>এটি জিআইএল ধারণ করে পাইথন কোড চালানোর অনুমতি দেয়, তবে শুধুমাত্র বর্তমান থ্রেডে। বিভিন্ন নিম থ্রেডে জিআইএল অর্জন/মুক্ত করার জন্য বাস্তবায়নের জন্য বিভিন্ন পাইথন সি এবি ফাংশন কল করা প্রয়োজন, কারণ জিআইএল একটি মিউটেক্স। আমরা তখন এই টেমপ্লেটটি ব্যবহার করে পাইথনকে কল করি:<pre><code class="nim hljs"><span class=hljs-keyword>template</span> withPyLock*(code): untyped =
  <span class=hljs-meta>{.locks: [pyGil].}</span>:
    <span class=hljs-keyword>try</span>:
      <span class=hljs-comment># echo getThreadId(), " -- ", getCurrentProcessId(), " -- ", procName()</span>
      await pygil.acquire()
      code
    <span class=hljs-keyword>except</span>:
      <span class=hljs-keyword>raise</span> getCurrentException()
    <span class=hljs-keyword>finally</span>:
      <span class=hljs-comment># echo getThreadId(), " -- ", getCurrentProcessId(),  " -- unlocked"</span>
      pygil.release()</code></pre><p>আমরা নিম লক এবং গার্ড বৈশিষ্ট্য ব্যবহার করি, নিশ্চিত করতে যে পাইথনের ধরনগুলি শুধুমাত্র যখন GIL অনুষ্ঠিত হয় তখনই অ্যাক্সেস করা যায়। তবে এর জন্য গার্ডের সাথে পাইবজেক্ট সংজ্ঞায়িত করা প্রয়োজন:<pre><code class="nim hljs"><span class=hljs-keyword>macro</span> pyObjPtr*(defs: <span class=hljs-type>varargs</span>[untyped]): untyped =
  <span class=hljs-built_in>result</span> = newNimNode(nnkStmtList)
  <span class=hljs-keyword>for</span> d <span class=hljs-keyword>in</span> defs:
    <span class=hljs-keyword>let</span>
      name = d[<span class=hljs-number>0</span>]
      def = d[<span class=hljs-number>1</span>]
    <span class=hljs-built_in>result</span>.add quote <span class=hljs-keyword>do</span>:
      <span class=hljs-keyword>let</span> `name` <span class=hljs-meta>{.guard: pyGil.}</span> = create(<span class=hljs-type>PyObject</span>)
      `name`[] = `def`</code></pre><p>তাই আমি করতে পারি:<pre><code class="nim hljs">pyObjPtr(myVar, pyimport(<span class=hljs-string>"datetime"</span>).datetime))</code></pre><p>আর যখনই ডাকি<code>myVar</code> যা ডেটটাইম অবজেক্ট ধারণ করে, আমাকে এটিকে এভাবে মোড়ানো হবে:<pre><code class="nim hljs">withPyLock():
  myVar.fromunixtimestamp(<span class=hljs-number>1</span>)</code></pre><p>এখন আমরা গিল লক করতে পারি যখন আমাদের জিসি চালাতে হবে, নিম্পি ওভাররাইড করে<code>PyObject</code> এর সাথে ধ্বংসকারী:<pre><code class="nim hljs"><span class=hljs-keyword>var</span> garbage: <span class=hljs-type>seq</span>[<span class=hljs-type>PPyObject</span>]

<span class=hljs-keyword>proc</span> `=destroy`*(p: <span class=hljs-keyword>var</span><span class=hljs-type>PyObject</span>) =
  <span class=hljs-keyword>if</span> pygil.tryAcquire:
    <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> p.rawPyObj.isnil:
      decRef p.rawPyObj
      p.rawPyObj = <span class=hljs-keyword>nil</span><span class=hljs-keyword>while</span> garbage.len > <span class=hljs-number>1</span>:
      <span class=hljs-keyword>var</span> pp = garbage.pop() <span class=hljs-comment># <span class=hljs-doctag>TODO:</span> Does this leak a pointer?</span><span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> pp.isnil:
        decRef pp
      pp = <span class=hljs-keyword>nil</span>
    pygil.release
  <span class=hljs-keyword>else</span>:
    <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> p.rawPyObj.isnil:
      garbage.add p.rawPyObj</code></pre><p>আমরা ধ্বংসকারীর ভিতরে যে লকটি ব্যবহার করি সেটি একটি নয়<code>AsyncLock</code> যে খুব ব্যয়বহুল হবে, এবং আমরা<em> না</em> সবসময় লক, যে স্টল কারণ হবে! যদি আমরা গিলটি লক করতে না পারি, আমরা সংগ্রহে দেরি করি এবং কাঁচা পাইথন পয়েন্টারটি রেখে দিই যখন আমরা এটি পরিষ্কার করতে সক্ষম হব। সত্যই আমি জানি না যে এটি অন্যান্য ধরণের সমস্যার কারণ হয়, তবে এটি কাজ করে বলে মনে হচ্ছে<em> যথেষ্ট ভাল</em>.<p>আমরা নামক একটি নিম মডিউল আছে<code>pyutils.nim</code> যেটি একগুচ্ছ নিম<>পাইথন স্টাফ করে, উদাহরণস্বরূপ:<pre><code class="nim hljs"><span class=hljs-keyword>from</span> utils <span class=hljs-keyword>import</span> withLocks
<span class=hljs-keyword>proc</span> pyhasAttr*(o: <span class=hljs-type>PyObject</span>; a: <span class=hljs-type>string</span>): <span class=hljs-type>bool</span><span class=hljs-meta>{.withLocks: [pyGil].}</span> = pybi[].hasattr(
    o, a).to(<span class=hljs-type>bool</span>)

<span class=hljs-keyword>proc</span> pyclass(py: <span class=hljs-type>PyObject</span>): <span class=hljs-type>PyObject</span><span class=hljs-meta>{.inline, withLocks: [pyGil].}</span> =
  pybi[].<span class=hljs-keyword>type</span>(py)

<span class=hljs-keyword>proc</span> pytype*(py: <span class=hljs-type>PyObject</span>): <span class=hljs-type>string</span> =
  py.pyclass.getattr(<span class=hljs-string>"__name__"</span>).to(<span class=hljs-type>string</span>)

<span class=hljs-keyword>proc</span> pyisbool*(py: <span class=hljs-type>PyObject</span>): <span class=hljs-type>bool</span><span class=hljs-meta>{.withLocks: [pyGil].}</span> =
  <span class=hljs-keyword>return</span> pybi[].isinstance(py, <span class=hljs-type>PyBoolClass</span>[]).to(<span class=hljs-type>bool</span>)

<span class=hljs-keyword>proc</span> pyisnone*(py: <span class=hljs-type>PyObject</span>): <span class=hljs-type>bool</span><span class=hljs-meta>{.gcsafe, withLocks: [pyGil].}</span> =
  <span class=hljs-keyword>return</span> py.isnil <span class=hljs-keyword>or</span> pybi[].isinstance(py, <span class=hljs-type>PyNoneClass</span>[]).to(<span class=hljs-type>bool</span>)</code></pre><p>এই একটি বেশ অনেক ব্যবহার করা হয়:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> pyget*[T](py: <span class=hljs-type>PyObject</span>; k: <span class=hljs-type>string</span>; def: T = <span class=hljs-string>""</span>): T =
  <span class=hljs-keyword>try</span>:
    <span class=hljs-keyword>let</span> v = py.callMethod(<span class=hljs-string>"get"</span>, k)
    <span class=hljs-keyword>if</span> pyisnone(v):
      <span class=hljs-keyword>return</span> def
    <span class=hljs-keyword>else</span>:
      <span class=hljs-keyword>return</span> v.to(T)
  <span class=hljs-keyword>except</span>:
    pyErrClear()
    <span class=hljs-keyword>if</span> pyisnone(py):
      <span class=hljs-keyword>return</span> def
    <span class=hljs-keyword>else</span>:
      <span class=hljs-keyword>return</span> py.to(T)</code></pre><p>এটি ব্যবহার করা হয় যখন আমরা একটি পাইথন কাজের সময় নির্ধারণ করি, এবং আমরা এটি অ্যাসিঙ্ক্রোনাসভাবে শেষ হওয়ার জন্য অপেক্ষা করতে চাই:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> pywait*(j: <span class=hljs-type>PyObject</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>PyObject</span>] <span class=hljs-meta>{.async, gcsafe.}</span> =
  <span class=hljs-keyword>var</span> rdy: <span class=hljs-type>bool</span><span class=hljs-keyword>var</span> res: <span class=hljs-type>PyObject</span><span class=hljs-keyword>while</span><span class=hljs-literal>true</span>:
    withPyLock:
      checkNil(j)
      rdy = j.callMethod(<span class=hljs-string>"ready"</span>).to(<span class=hljs-type>bool</span>)
    <span class=hljs-keyword>if</span> rdy:
      withPyLock:
        checkNil(j)
        res = j.callMethod(<span class=hljs-string>"get"</span>)
      <span class=hljs-keyword>break</span>
    await sleepAsync(<span class=hljs-number>250</span>.milliseconds)
  withPyLock:
    <span class=hljs-keyword>if</span> (<span class=hljs-keyword>not</span> res.isnil) <span class=hljs-keyword>and</span> (<span class=hljs-keyword>not</span> pyisnone(res)) <span class=hljs-keyword>and</span> (<span class=hljs-keyword>not</span> pyErrOccurred()):
      <span class=hljs-keyword>return</span> res
    <span class=hljs-keyword>else</span>:
      <span class=hljs-keyword>raise</span> newException(<span class=hljs-type>ValueError</span>, <span class=hljs-string>"Python job failed."</span>)</code></pre><p>সঠিক পাইথন অ্যাসিঙ্ক বাইন্ডিংয়ের জন্য পাইথন নির্ধারিত কাজের শেষে পাইথন থেকে একটি নিম অ্যাসিঙ্ক ভবিষ্যত সম্পন্ন করতে হবে, যা আমরা করি না কারণ আমরা পাইথন থেকে নিম বস্তুগুলি পরিচালনা করার জন্য যথেষ্ট গভীরভাবে দেখিনি।<h2 id=ampification><a class=header-anchor href=#ampification> প্রশস্তকরণ</a></h2><p>আমরা google amp সমর্থন করি, তাই আমরা কিছুটা amp কমপ্লায়েন্ট amp পৃষ্ঠা তৈরি করি। আমরা 1:1 সমর্থনের জন্য লক্ষ্য করি না। আসলে আমরা আমাদের কাছে থাকা সমস্ত জাভাস্ক্রিপ্টকে পরমাণু ব্যবহার করি এবং শুধুমাত্র html/css পরিবেশন করি। তারপরও আমাদের সতর্ক থাকতে হবে এইচটিএমএল ট্যাগ বা শুধু কাস্টম এইচটিএমএল ট্যাগে কাস্টম অ্যাট্রিবিউট যোগ না করার জন্য, amp এর মতো খারাপ... স্বয়ংক্রিয় amp পৃষ্ঠা রূপান্তরের জন্য আমরা হ্যান্ডেল করি<code>head</code> এবং<code>body</code> ভিন্নভাবে ট্যাগ করুন।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> processHead(inHead: <span class=hljs-type>VNode</span>, outHead: <span class=hljs-type>VNode</span>, level = <span class=hljs-number>0</span>) <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>var</span> canonicalUnset = level == <span class=hljs-number>0</span>
  debug <span class=hljs-string>"iterating over {inHead.kind}"</span><span class=hljs-keyword>for</span> el <span class=hljs-keyword>in</span> inHead.preorder(withStyles = <span class=hljs-literal>true</span>):
    <span class=hljs-keyword>case</span> el.kind:
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.text, skipNodes:
        <span class=hljs-keyword>continue</span><span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.style:
        <span class=hljs-keyword>if</span> el.len > <span class=hljs-number>0</span>:
          el[<span class=hljs-number>0</span>].text.maybeStyle
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.link:
        <span class=hljs-keyword>if</span> canonicalUnset <span class=hljs-keyword>and</span> el.isLink(canonical):
          outHead.add el
          canonicalUnset = <span class=hljs-literal>false</span><span class=hljs-keyword>elif</span> el.isLink(stylesheet) <span class=hljs-keyword>and</span> (<span class=hljs-keyword>not</span> (<span class=hljs-string>"flags-sprite"</span><span class=hljs-keyword>in</span> el.getattr(<span class=hljs-string>"href"</span>))):
          await el.fetchStyle()
        <span class=hljs-keyword>elif</span> el.isLink(preload) <span class=hljs-keyword>and</span> el.getattr(<span class=hljs-string>"as"</span>) == <span class=hljs-string>"style"</span>:
          await el.fetchStyle()
        <span class=hljs-keyword>else</span>:
          outHead.add el
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.script:
        <span class=hljs-keyword>if</span> el.getAttr(<span class=hljs-string>"type"</span>) == $ldjson:
          outHead.add el
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.meta:
        <span class=hljs-keyword>if</span> (el.getAttr(<span class=hljs-string>"name"</span>) == <span class=hljs-string>"viewport"</span>) <span class=hljs-keyword>or</span> (el.getAttr(<span class=hljs-string>"charset"</span>) != <span class=hljs-string>""</span>):
          <span class=hljs-keyword>continue</span><span class=hljs-keyword>else</span>:
          outHead.add el
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.verbatim:
        <span class=hljs-keyword>let</span> data = el.toXmlNode
        <span class=hljs-keyword>if</span> data.kind == xnElement:
          <span class=hljs-keyword>if</span> data.tag == <span class=hljs-string>"noscript"</span>:
            processNoScript()
          <span class=hljs-keyword>elif</span> data.tag == <span class=hljs-string>"script"</span>:
            <span class=hljs-keyword>continue</span><span class=hljs-keyword>elif</span> data.tag == <span class=hljs-string>"style"</span>:
            <span class=hljs-keyword>if</span> data.len > <span class=hljs-number>0</span>:
              data[<span class=hljs-number>0</span>].text.maybeStyle
          <span class=hljs-keyword>else</span>:
            outHead.add el
      <span class=hljs-keyword>of</span><span class=hljs-type>VNodekind</span>.noscript:
        processNoScript()
      <span class=hljs-keyword>else</span>:
        debug <span class=hljs-string>"amphead: adding element {el.kind} to outHead."</span>
        outHead.add el</code></pre><p>সমস্ত শৈলী একটি একক ইনলাইন স্ক্রিপ্টে একত্রিত হয়, যা রাখা হয় তা হল<code>link</code> ট্যাগ যা শৈলী/jscript নয়, যেমন ল্যাং। জন্য স্ক্রিপ্ট ট্যাগ<code>ldljson</code>, <code>meta</code> ট্যাগ. Verbatim হ্যান্ডেল নোড যা হয়<em> আক্ষরিক</em> , আমরা তাদের রূপান্তর করতে হবে<code>XmlNode</code> (যার অর্থ পার্সিং) এবং এটি সঠিকভাবে পরিচালনা করুন। প্রসেস বডি একই রকম, আমরা কিছু ট্যাগ রাখি, অন্যদের সরিয়ে দিই, অন্যদের নাম পরিবর্তন করি:<pre><code class="nim hljs"><span class=hljs-keyword>template</span> process(el: <span class=hljs-type>VNode</span>, after: untyped): <span class=hljs-type>bool</span> =
  <span class=hljs-keyword>var</span> isprocessed = <span class=hljs-literal>true</span><span class=hljs-keyword>case</span> el.kind:
    <span class=hljs-keyword>of</span> skipNodes: <span class=hljs-keyword>discard</span><span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.link:
      <span class=hljs-keyword>if</span> el.isLink(stylesheet):
        await el.fetchStyle()
      <span class=hljs-keyword>else</span>:
        outBody.add el
    <span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.style:
      el.text.maybeStyle
      el.text = <span class=hljs-string>""</span><span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.script:
      <span class=hljs-keyword>if</span> el.getAttr(<span class=hljs-string>"type"</span>) == $ldjson:
        outHead.add el
      el.text = <span class=hljs-string>""</span><span class=hljs-keyword>of</span><span class=hljs-type>VNodeKind</span>.form:
      el.setAttr(<span class=hljs-string>"amp-form"</span>, <span class=hljs-string>""</span>)
    <span class=hljs-keyword>else</span>:
      isprocessed = <span class=hljs-literal>false</span><span class=hljs-keyword>if</span> isprocessed:
    after
  isprocessed</code></pre><p>দ্য<code>form</code> ট্যাগ দিয়ে প্রতিস্থাপিত হয়<code>amp-form</code> , amp-এ এই ট্যাগগুলির অনেকগুলি রয়েছে...<p>আমাদের নিশ্চিত করতে হবে যে ইনলাইন শৈলীগুলি সঠিক দৈর্ঘ্যের মধ্যে রয়েছে:<pre><code class="nim hljs">styleStr = styleStr
  <span class=hljs-comment># .join("\n")</span><span class=hljs-comment># <span class=hljs-doctag>NOTE:</span> the replacement should be ordered from most frequent to rarest</span><span class=hljs-comment># # remove troublesome animations</span>
  .replace(<span class=hljs-string>pre"""\s*?@(\-[a-zA-Z]+-)?keyframes\s+?.+?{\s*?.+?({.+?})+?\s*?}"""</span>, <span class=hljs-string>""</span>)
  <span class=hljs-comment># # remove !important hints</span>
  .replace(<span class=hljs-string>pre"""!important"""</span>, <span class=hljs-string>""</span>)
  <span class=hljs-comment># remove charset since not allowed</span>
  .replace(<span class=hljs-string>pre"""@charset\s+\"</span>utf-<span class=hljs-number>8</span>\<span class=hljs-string>"\s*;?/i"</span><span class=hljs-string>""</span>, <span class=hljs-string>""</span>)

<span class=hljs-keyword>if</span> unlikely(styleStr.len > <span class=hljs-type>CSS_MAX_SIZE</span>):
  <span class=hljs-keyword>raise</span> newException(<span class=hljs-type>ValueError</span>, <span class=hljs-string>fmt"Style size above limit for amp pages. {styleStr.len}"</span>)</code></pre><p>আমাদের amp প্রজন্ম সম্পূর্ণ amp স্পেক কভার করে না, তবে এটি আমাদের বিষয়বস্তুর জন্য কাজ করে (ট্রায়াল এবং ত্রুটির মাধ্যমে :S)।<h2 id=search><a class=header-anchor href=#search> অনুসন্ধান করুন</a></h2><p>যখনই একটি নিবন্ধ প্রকাশিত হয়, এটি সোনিক ডাটাবেসে প্রবেশ করা হয়, সোনিক ডাটাবেস "সংগ্রহ", "বালতি" এবং "বস্তু" পরিচালনা করে; আমরা একটি সংগ্রহকে একটি ওয়েবসাইট হিসাবে সংজ্ঞায়িত করি, তাই প্রতিটি ওয়েবসাইট যা সামগ্রী সংগ্রহকারী স্থাপন করতে চায় তার নিজস্ব সংগ্রহ রয়েছে৷ আমরা ব্যবহার করি না<code>buckets</code> , যদিও আমরা প্রতিটি বিষয়কে একটি বালতি হিসাবে বিবেচনা করতে পারি যা অনুসন্ধানকে খুব বেশি সংকুচিত করবে, তাই প্রতিটি সাইটে শুধুমাত্র একটি বালতি "ডিফল্ট" থাকে এবং বাকেটের প্রতিটি বস্তু একটি নিবন্ধ (যা বিভিন্ন বিষয়ের হতে পারে)।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> push*(capts: <span class=hljs-type>UriCaptures</span>, content: <span class=hljs-type>string</span>) <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-comment>## Push the contents of an article page to the search database</span><span class=hljs-comment>## <span class=hljs-doctag>NOTE:</span> NOT thread safe</span><span class=hljs-keyword>var</span> ofs = <span class=hljs-number>0</span><span class=hljs-keyword>while</span> ofs <= content.len:
    <span class=hljs-keyword>let</span> view = content[ofs..^<span class=hljs-number>1</span>]
    <span class=hljs-keyword>let</span> key = join([capts.topic, capts.page, capts.art], <span class=hljs-string>"/"</span>)
    <span class=hljs-keyword>let</span> cnt = runeSubStr(view, <span class=hljs-number>0</span>, min(view.len, bufsize - key.len))
    ofs += cnt.len
    <span class=hljs-keyword>if</span> cnt.len == <span class=hljs-number>0</span>:
      <span class=hljs-keyword>break</span><span class=hljs-keyword>try</span>:
      <span class=hljs-keyword>let</span> lang = await capts.lang.toISO3
      <span class=hljs-keyword>var</span> pushed: <span class=hljs-type>bool</span><span class=hljs-keyword>var</span> j: <span class=hljs-type>PyObject</span>
      withPyLock:
        j = pySched[].apply(
          pySonic[].push,
          <span class=hljs-type>WEBSITE_DOMAIN</span>,
          <span class=hljs-string>"default"</span>, <span class=hljs-comment># <span class=hljs-doctag>TODO:</span> Should we restrict search to `capts.topic`?</span>
          key,
          cnt,
          lang = <span class=hljs-keyword>if</span> capts.lang != <span class=hljs-string>"en"</span>: lang <span class=hljs-keyword>else</span>: <span class=hljs-string>""</span>
          )
      j = await j.pywait()
      withPyLock:
        pushed = <span class=hljs-keyword>not</span> pyisnone(j) <span class=hljs-keyword>and</span> j.to(<span class=hljs-type>bool</span>)
      <span class=hljs-keyword>when</span><span class=hljs-keyword>not</span> defined(release):
        <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> pushed:
          capts.addToBackLog()
          <span class=hljs-keyword>break</span><span class=hljs-keyword>except</span><span class=hljs-type>Exception</span>:
      logexc()
      debug <span class=hljs-string>"sonic: couldn't push content, \n {capts} \n {key} \n {cnt}"</span><span class=hljs-keyword>when</span><span class=hljs-keyword>not</span> defined(release):
        capts.addToBackLog()
        <span class=hljs-keyword>block</span>:
          <span class=hljs-keyword>var</span> f: <span class=hljs-type>File</span><span class=hljs-keyword>try</span>:
            await pushLock[].acquire
            f = open(<span class=hljs-string>"/tmp/sonic_debug.log"</span>, fmWrite)
            write(f, cnt)
          <span class=hljs-keyword>finally</span>:
            pushLock[].release
            <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> f.isnil:
              f.close()
      <span class=hljs-keyword>break</span></code></pre><p>সোনিকের মধ্যে বিষয়বস্তু পুশ করার সময় আমাদের ডেটাকে খণ্ডে ভাগ করতে হবে, যার সর্বাধিক দৈর্ঘ্য সংযোগের পরে জানা যায়। কিছু নির্দিষ্ট অক্ষর পরিচালনা করতে সক্ষম হয় না বলে মনে হয় ডেটা ইনজেস্ট করা কখনও কখনও বাজি বলে মনে হয়। যদি কোনোভাবে সোনিক সার্ভার ভেঙে যায়, আমাদের কাছে সমস্ত বিষয়বস্তু পুনরায় গেস্ট করার জন্য একটি ফাংশন রয়েছে:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> pushAllSonic*() <span class=hljs-meta>{.async.}</span> =
  await syncTopics()
  <span class=hljs-keyword>var</span> total, c, pagenum: <span class=hljs-type>int</span><span class=hljs-keyword>let</span> pushLog = await readPushLog()
  <span class=hljs-keyword>if</span> pushLog.len == <span class=hljs-number>0</span>:
    withPyLock:
      <span class=hljs-keyword>discard</span> pySonic[].flush(<span class=hljs-type>WEBSITE_DOMAIN</span>)
  defer:
    withPyLock:
      <span class=hljs-keyword>discard</span> pySonic[].consolidate()
  <span class=hljs-keyword>for</span> (topic, state) <span class=hljs-keyword>in</span> topicsCache:
    <span class=hljs-keyword>if</span> topic <span class=hljs-keyword>notin</span> pushLog:
      pushLog[topic] = %<span class=hljs-number>0</span>
    await pygil.acquire
    defer: pygil.release
    <span class=hljs-keyword>let</span> done = state.group[][<span class=hljs-string>"done"</span>]
    <span class=hljs-keyword>for</span> page <span class=hljs-keyword>in</span> done:
      pagenum = ($page).parseint
      c = len(done[page])
      <span class=hljs-keyword>if</span> pushLog[topic].to(<span class=hljs-type>int</span>) >= pagenum:
        <span class=hljs-keyword>continue</span><span class=hljs-keyword>var</span> futs: <span class=hljs-type>seq</span>[<span class=hljs-type>Future</span>[<span class=hljs-type>void</span>]]
      <span class=hljs-keyword>for</span> n <span class=hljs-keyword>in</span><span class=hljs-number>0</span>..&LTc:
        <span class=hljs-keyword>let</span> ar = done[page][n]
        <span class=hljs-keyword>if</span> ar.isValidArticlePy:
          <span class=hljs-keyword>var</span> relpath = getArticlePath(ar, topic)
          relpath.removeSuffix(<span class=hljs-string>"/"</span>)
          <span class=hljs-keyword>let</span>
            capts = uriTuple(relpath)
            content = ar.pyget(<span class=hljs-string>"content"</span>).sanitize
          echo <span class=hljs-string>"pushing "</span>, relpath
          futs.add push(capts, content)
          total.inc
      pygil.release
      await allFutures(futs)
      pushLog[topic] = %pagenum
      await writePushLog(pushLog)
      await pygil.acquire
  info <span class=hljs-string>"Indexed search for {WEBSITE_DOMAIN} with {total} objects."</span></code></pre><h2 id=translation><a class=header-anchor href=#translation> অনুবাদ</a></h2><p>অনুবাদ বেশ এলোমেলো গল্প। আমি আমার 4র্থ (!) অনুবাদ মোড়কের বাস্তবায়নে আছি, php এ লেখার পরে, যান এবং<a href=https://github.com/untoreh/Translator.jl> জুলিয়া</a> এটাও নিমে লেখা। php/go ভেরিয়েন্টগুলি আজকাল একটু পচা, যখন জুলিয়া ভেরিয়েন্ট সক্রিয়ভাবে এই ব্লগের জন্য ব্যবহার করা হয়৷ যাইহোক, ওয়েব সার্ভারের জন্য কম বিলম্ব অর্জন করার জন্য, জুলিয়াতে যেভাবে অনুবাদ প্রয়োগ করা হয়েছে তা বাস্তব সময়ের পরিষেবার জন্য উপযুক্ত নয় (এটি স্ট্যাটিক ফাইলগুলিকে অনুবাদ করে), এবং যাইহোক জুলিয়াকে একটি নির্ভরতা হিসাবে যুক্ত করা একবার আমাদের কাছে পাইথন হয়ে গেলে তা অনেক বড় হবে। প্রয়োজন<p>তাই আমাকে নিমে একটি নতুন অনুবাদ মডিউল বাস্তবায়ন করতে হয়েছিল। প্রকৃতপক্ষে, প্রাথমিক নিম অনুবাদ মডিউলটি দেখতে অনেকটা জুলিয়া বাস্তবায়নের মতো, যেখানে আমরা স্ট্যাটিক ফাইলগুলি অনুবাদ করছিলাম<sup id=fnref:1><a class=fnref href=#fndef:1>[1]</a></sup> . এরপরে, যখন ওয়েব সার্ভারটি আকার ধারণ করা শুরু করে, আমি চাহিদা অনুযায়ী ক্যারাক্স নোডগুলি অনুবাদ করতে এটি স্যুইচ করি। এটি অনুরোধের জন্য ঠিক সময়ে প্রতিটি ওয়েব পৃষ্ঠা অনুবাদ করতে দেয়।<pre><code class="nim hljs"><span class=hljs-keyword>template</span> translateVbtm(node: <span class=hljs-type>VNode</span>, q: <span class=hljs-type>QueueDom</span>) =
  assert node.kind == <span class=hljs-type>VNodeKind</span>.verbatim
  <span class=hljs-keyword>let</span> tree = ($node).parseHtml() <span class=hljs-comment># <span class=hljs-doctag>FIXME:</span> this should be a conversion, but the conversion doesn't preserve whitespace??</span><span class=hljs-keyword>if</span> tree.kind == xnElement <span class=hljs-keyword>and</span> tree.tag == <span class=hljs-string>"document"</span>:
    tree.tag = <span class=hljs-string>"div"</span>
  takeOverFields(tree.toVNode, node)
  translateIter(node, vbtm = <span class=hljs-literal>false</span>)

<span class=hljs-keyword>template</span> translateIter(otree; vbtm: <span class=hljs-keyword>static</span>[<span class=hljs-type>bool</span>] = <span class=hljs-literal>true</span>) =
  <span class=hljs-keyword>for</span> el <span class=hljs-keyword>in</span> otree.preorder():
    <span class=hljs-keyword>case</span> el.kind:
      <span class=hljs-keyword>of</span> vdom.<span class=hljs-type>VNodeKind</span>.text:
        <span class=hljs-keyword>if</span> el.text.isEmptyOrWhitespace:
          <span class=hljs-keyword>continue</span><span class=hljs-keyword>if</span> isTranslatable(el):
          translate(q.<span class=hljs-keyword>addr</span>, el, srv)
      <span class=hljs-keyword>else</span>:
        <span class=hljs-keyword>let</span> t = el.kind
        <span class=hljs-keyword>if</span> t <span class=hljs-keyword>in</span> tformsTags:
          getTForms(dom)[t](el, file_path, url_path, pair)
        <span class=hljs-keyword>if</span> t == <span class=hljs-type>VNodeKind</span>.a:
          <span class=hljs-keyword>if</span> el.hasAttr(<span class=hljs-string>"href"</span>):
            rewriteUrl(el, rewrite_path, hostname)
        <span class=hljs-keyword>if</span> t == <span class=hljs-type>VNodeKind</span>.verbatim:
          <span class=hljs-keyword>when</span> vbtm:
            debug <span class=hljs-string>"dom: translating verbatim"</span>, <span class=hljs-literal>false</span>
            translateVbtm(el, q)
        <span class=hljs-keyword>else</span>:
          <span class=hljs-keyword>if</span>(el.hasAttr(<span class=hljs-string>"alt"</span>) <span class=hljs-keyword>and</span> el.isTranslatable(<span class=hljs-string>"alt"</span>)) <span class=hljs-keyword>or</span>
            (el.hasAttr(<span class=hljs-string>"title"</span>) <span class=hljs-keyword>and</span> el.isTranslatable(<span class=hljs-string>"title"</span>)):
            translate(q.<span class=hljs-keyword>addr</span>, el, srv)</code></pre><p>উপরে প্রধান পুনরাবৃত্তি লুপ<code>translateIter</code>:<ul><li><p><code>getTforms</code> এইচটিএমএল ট্যাগের সাথে মানচিত্র ফাংশন, কেস বাই কেস ভিত্তিতে মিউটেশন সঞ্চালনের অনুমতি দেয়।<li><p><code>rewriteUrl</code> ল্যাং পাথ সন্নিবেশ করায় (যেমন<code>/en/</code> ) url পাথে।<li><p><code>translateVbtm</code> verbatim নোড পরিচালনা করে যার পার্সিং প্রয়োজন।</ul><p>অনুবাদ সব টেক্সট নোড এবং তে প্রয়োগ করা হয়<code>alt</code> এবং<code>title</code> গুণাবলী<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> translate*[T](q: <span class=hljs-keyword>ptr</span>[<span class=hljs-type>QueueXml</span> | <span class=hljs-type>QueueDom</span>], el: T, srv: service) =
  <span class=hljs-keyword>if</span> q.isnil:
    warn <span class=hljs-string>"translate: queue can't be nil"</span><span class=hljs-keyword>return</span><span class=hljs-keyword>let</span> (success, length) = setFromDB(q[].pair, el)
  <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> success:
    <span class=hljs-keyword>if</span> length > q[].bufsize:
      debug <span class=hljs-string>"Translating element singularly since it is big"</span>
      elUpdate(q[], el, srv)
    <span class=hljs-keyword>else</span>:
      <span class=hljs-keyword>if</span> reachedBufSize(length, q[]):
        q[].push()
      q[].bucket.add(el)
      q[].sz += length

<span class=hljs-keyword>proc</span> translate*[T](q: <span class=hljs-keyword>ptr</span>[<span class=hljs-type>QueueXml</span> | <span class=hljs-type>QueueDom</span>], el: T, srv: service,
    finish: <span class=hljs-type>bool</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>bool</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>if</span> finish:
    <span class=hljs-keyword>if</span> q.isnil:
      <span class=hljs-keyword>return</span><span class=hljs-literal>true</span><span class=hljs-keyword>let</span> (success, _) = setFromDB(q[].pair, el)
    <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> success:
      addJob(@[el], q[], el.getText)
      debug <span class=hljs-string>"translate: waiting for pair: {q[].pair}"</span>
      await doTrans()
  <span class=hljs-keyword>return</span><span class=hljs-literal>true</span><span class=hljs-keyword>proc</span> translate*(q: <span class=hljs-keyword>ptr</span>[<span class=hljs-type>QueueXml</span> | <span class=hljs-type>QueueDom</span>], srv: service,
    finish: <span class=hljs-type>bool</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>bool</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>if</span> finish <span class=hljs-keyword>and</span> q[].sz > <span class=hljs-number>0</span>:
    q[].push()
    await doTrans()
    saveToDB(force = <span class=hljs-literal>true</span>)
  <span class=hljs-keyword>return</span><span class=hljs-literal>true</span></code></pre><p>কারণ আমাদের প্রতিটি টেক্সট নোডকে আলাদাভাবে অনুবাদ করতে হবে (অন্যথায় আমরা এইচটিএমএল ফিরিয়ে দিতে পারব না) প্রতিটি নোড অনুবাদ একটি পৃথক কাজ। যেহেতু চাকরিগুলি নেট অনুবাদ পরিষেবাগুলি জিজ্ঞাসা করতে পারে, সেগুলিকে অ্যাসিঙ্ক্রোনাসভাবে করতে হবে৷ আমরা এপিআই কলগুলি বাড়ানোর জন্য অনুবাদের প্রশ্নগুলিকে বিভক্ত এবং মার্জ করি, তবে অনুবাদ ইঞ্জিনের অভ্যন্তরীণগুলি জানা গুরুত্বপূর্ণ নয়৷ লক্ষ্য করার মতো বিষয় হল প্রথমদিকে আমি একটি ব্যবহার করছিলাম<a href=https://github.com/nidhaloff/deep-translator> পাইথন মোড়ক</a> (যা আমি এখনও স্ক্র্যাপ করা বিষয়বস্তু অনুবাদের জন্য ব্যবহার করি) কারণ বাহ্যিক apis-এর জন্য র‌্যাপার স্ব-ব্যবস্থাপনা করা একটি যন্ত্রণাদায়ক, কিন্তু তারপরে স্বয়ং র‌্যাপড google এবং yandex ট্রান্সলেশন সার্ভিসে নিমে স্যুইচ করা হয়েছে, কারণ অনেক সমসাময়িক অনুবাদ পরিচালনা করার সময় পাইথন একটি উল্লেখযোগ্য বাধা হয়ে দাঁড়ায়।<table class=fndef id=fndef:1><tbody><tr><td class=fndef-backref><a href=#fnref:1>[1]</a><td class=fndef-content>আসলে মূলত কন্টেন্ট অ্যাগ্রিগেটরের জন্য স্ট্যাটিক ফাইল তৈরি করার কথা ছিল<code>caddy</code> পরিবেশন করার জন্য, কিন্তু যেহেতু পৃষ্ঠার পরিমাণ (যা n_lang(20) x amp(2) x পৃষ্ঠার ম্যাট্রিক্স তৈরি করতে হবে), অলস রেন্ডারিং ছিল ভাল বিকল্প।</table><h2 id=stats><a class=header-anchor href=#stats> পরিসংখ্যান</a></h2><p>বিষয় এবং নিবন্ধ পৃষ্ঠাগুলি হিট সংখ্যার জন্য ট্র্যাক করা হয়.<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> updateHits*(capts: <span class=hljs-type>UriCaptures</span>) =
  <span class=hljs-keyword>let</span> ak = join([capts.topic, capts.art])
  <span class=hljs-keyword>let</span> tk = capts.topic
  <span class=hljs-keyword>var</span>
    artCount: <span class=hljs-type>int32</span> = statsDB[ak]
    topicCount: <span class=hljs-type>int32</span> = statsDB[tk]
  artCount += <span class=hljs-number>1</span>
  topicCount += <span class=hljs-number>1</span>
  statsDB[ak] = artCount
  statsDB[tk] = topicCount</code></pre><p>আমরা পর্যায়ক্রমে কম গণনা সহ পৃষ্ঠাগুলি পরিষ্কার করতে হিট কাউন্ট ব্যবহার করি।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> deleteLowTrafficArts*(topic: <span class=hljs-type>string</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>void</span>] <span class=hljs-meta>{.gcsafe, async.}</span> =
  <span class=hljs-keyword>let</span> now = getTime()
  <span class=hljs-keyword>var</span>
    pagenum: <span class=hljs-type>int</span>
    pagesToReset: <span class=hljs-type>seq</span>[<span class=hljs-type>int</span>]
    pubTime: <span class=hljs-type>Time</span>
    pubTimeTs: <span class=hljs-type>int</span><span class=hljs-keyword>var</span> capts = mUriCaptures()
  capts.topic = topic
  <span class=hljs-keyword>for</span> (art, _) <span class=hljs-keyword>in</span> (await publishedArticles[<span class=hljs-type>string</span>](topic, <span class=hljs-string>""</span>)):
    withPyLock:
      <span class=hljs-keyword>if</span> pyisnone(art):
        <span class=hljs-keyword>continue</span>
      capts.art = pyget[<span class=hljs-type>string</span>](art, <span class=hljs-string>"slug"</span>)
      pagenum = pyget(art, <span class=hljs-string>"page"</span>, <span class=hljs-number>0</span>)
    capts.page = pagenum.intToStr
    <span class=hljs-keyword>try</span>:
      withPyLock:
        pubTimeTs = pyget(art, <span class=hljs-string>"pubTime"</span>, <span class=hljs-number>0</span>)
      pubTime = fromUnix(pubTimeTs)
    <span class=hljs-keyword>except</span>:
      pubTime = default(<span class=hljs-type>Time</span>)
    <span class=hljs-keyword>if</span> pubTime == default(<span class=hljs-type>Time</span>):
      <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> (pagenum <span class=hljs-keyword>in</span> pagesToReset):
        debug <span class=hljs-string>"tasks: resetting pubTime for page {pagenum}"</span>
        pagesToReset.add pagenum
    <span class=hljs-comment># article is old enough</span><span class=hljs-keyword>elif</span> inSeconds(now - pubTime) > cfg.<span class=hljs-type>CLEANUP_AGE</span>:
      <span class=hljs-keyword>let</span> hits = topic.getHits(capts.art)
      <span class=hljs-comment># article has low hit count</span><span class=hljs-keyword>if</span> hits < cfg.<span class=hljs-type>CLEANUP_HITS</span>:
        await deleteArt(capts)
  <span class=hljs-keyword>for</span> n <span class=hljs-keyword>in</span> pagesToReset:
    withPyLock:
      <span class=hljs-keyword>discard</span> site[].update_pubtime(topic, n)</code></pre><h2 id=databases><a class=header-anchor href=#databases> ডাটাবেস</a></h2><p>আমরা ব্যাবহার করি<code>libmdbx</code> মাধ্যম<a href=https://github.com/snej/nimdbx> এই lib</a> . সম্ভবত overkill, এবং leveldb ব্যবহার করা যথেষ্ট হবে। আমরা একটি টাইপ আছে<code>LRUTrans</code> যেখানে প্রাথমিক ধারণা ছিল ডাটাবেসটিকে একটি LRU ক্যাশে হিসাবে সেটআপ করা, তবে এটি যথেষ্ট ধীর ছিল। বাস্তবায়ন পাওয়া যাবে<a href=https://github.com/untoreh/lrudbx/blob/main/lrudbx.nim> এখানে</a><pre><code class="nim hljs"><span class=hljs-keyword>type</span><span class=hljs-type>CollectionNotNil</span> = <span class=hljs-keyword>ptr</span><span class=hljs-type>Collection</span><span class=hljs-keyword>not</span><span class=hljs-keyword>nil</span><span class=hljs-type>LRUTransObj</span> = <span class=hljs-keyword>object</span>
        db: nimdbx.<span class=hljs-type>Database</span>.<span class=hljs-type>Database</span><span class=hljs-keyword>not</span><span class=hljs-keyword>nil</span>
        coll: <span class=hljs-type>CollectionNotNil</span>
        zstd_c: <span class=hljs-keyword>ptr</span><span class=hljs-type>ZSTD_CCtx</span>
        zstd_d: <span class=hljs-keyword>ptr</span><span class=hljs-type>ZSTD_DCtx</span><span class=hljs-type>LRUTrans</span>* = <span class=hljs-keyword>ptr</span><span class=hljs-type>LRUTransObj</span><span class=hljs-keyword>proc</span> getImpl(t: <span class=hljs-type>LRUTrans</span>, k: <span class=hljs-type>int64</span>, throw: <span class=hljs-keyword>static</span><span class=hljs-type>bool</span>): <span class=hljs-type>string</span> =
    withLock(tLock):
        <span class=hljs-keyword>var</span> o: <span class=hljs-type>seq</span>[byte]
        t.coll.inSnapshot <span class=hljs-keyword>do</span> (cs: <span class=hljs-type>CollectionSnapshot</span>):
            <span class=hljs-comment># debug "nimdbx: looking for key {k}, {v}"</span>
            o.add cs[k.asData].asByteSeq
        <span class=hljs-keyword>if</span> len(o) > <span class=hljs-number>0</span>:
            <span class=hljs-built_in>result</span> = <span class=hljs-keyword>cast</span>[<span class=hljs-type>string</span>](decompress(t.zstd_d, o))
            <span class=hljs-comment># debug "nimdbx: got key {k}, with {o.len} bytes"</span><span class=hljs-keyword>elif</span> throw:
            <span class=hljs-keyword>raise</span> newException(<span class=hljs-type>KeyError</span>, <span class=hljs-string>"nimdbx: key not found"</span>)

<span class=hljs-keyword>proc</span> getImpl[T: <span class=hljs-keyword>not</span><span class=hljs-type>int64</span>](t: <span class=hljs-type>LRUTrans</span>, k: T, throw: <span class=hljs-keyword>static</span><span class=hljs-type>bool</span>): <span class=hljs-type>string</span> =
    getImpl(t, hash(k).<span class=hljs-type>int64</span>, throw)


<span class=hljs-keyword>proc</span> `[]`*[T](t: <span class=hljs-type>LRUTrans</span>, k: T): <span class=hljs-type>auto</span> = t.getImpl(k, <span class=hljs-literal>false</span>)
<span class=hljs-keyword>proc</span> `get`*[K](t: <span class=hljs-type>LRUTrans</span>, k: K): <span class=hljs-type>auto</span> = t.getImpl(k, <span class=hljs-literal>true</span>)

<span class=hljs-keyword>proc</span> `[]=`*(t: <span class=hljs-type>LRUTrans</span>, k: <span class=hljs-type>int64</span>, v: <span class=hljs-type>string</span>) <span class=hljs-meta>{.gcsafe.}</span> =
    <span class=hljs-keyword>var</span> o: <span class=hljs-type>seq</span>[byte]
    <span class=hljs-keyword>if</span> likely(v.len != <span class=hljs-number>0</span>):
      o = compress(t.zstd_c, v, cfg.<span class=hljs-type>ZSTD_COMPRESSION_LEVEL</span>)
    withLock(tLock):
        logall <span class=hljs-string>"nimdbx: saving key {k}"</span>
        t.coll.inTransaction <span class=hljs-keyword>do</span> (ct: <span class=hljs-type>CollectionTransaction</span>):
            <span class=hljs-meta>{.cast(gcsafe).}</span>:
                ct[k] = o
            ct.commit()
        logall <span class=hljs-string>"nimdbx: commited key {k}"</span><span class=hljs-keyword>proc</span> `[]=`*[K: <span class=hljs-keyword>not</span><span class=hljs-type>int64</span>](t: <span class=hljs-type>LRUTrans</span>, k: K, v: <span class=hljs-type>string</span>) = t[hash(k).<span class=hljs-type>int64</span>] = v</code></pre><p>এই ধরনের চারটি পৃথক ডাটাবেসের জন্য ব্যবহৃত হয়:<ul><li><p>অনুবাদ<li><p>পৃষ্ঠা ক্যাশে<li><p>ইমেজ ক্যাশে<li><p>পরিসংখ্যান</ul><p>ডাটাবেস টাইপ গেটার এবং সেটারের সাথে প্রয়োগ করা হয় তারপর রিড/রাইটের উপর স্বয়ংক্রিয় ডি/কম্প্রেশন করে। এই কারণে এটি ছবির জন্য ব্যবহার করা উচিত নয়...কিন্তু হায়...এছাড়াও একগুচ্ছ ছোট মাইক্রো ক্যাশে রয়েছে:<ul><li><p>vbtm: পার্স করা (শব্দটিম) বিষয়বস্তুর জন্য<li><p>অনুসন্ধান: অনুসন্ধান প্রশ্নের জন্য<li><p>ফিড: বিষয় ফিড VNodes জন্য<li><p>rxcache: regex-এর জন্য, কারণ কম্পাইল টাইম স্ট্যাটিক রেজেক্সগুলি এখনও মানসম্মত নয় (এছাড়াও কারণ নিমে একাধিক রেজেক্স লাইব্রেরি রয়েছে)</ul><p>এই হিসাবে বাস্তবায়িত হয়<a href=https://github.com/jackhftang/lrucache.nim> lru ক্যাশে</a><sup id=fnref:2><a class=fnref href=#fndef:2>[2]</a></sup> , আরও সুনির্দিষ্টভাবে "লক করা" lru ক্যাশে হিসাবে, যেখানে প্রতিটি গেট এবং সেট অপারেশন একটি (থ্রেড) লকের চারপাশে আবৃত থাকে। এই লকগুলি অ্যাসিঙ্ক রানটাইমের সাথে স্টল সৃষ্টি করতে পারে না কারণ লকটি অধিগ্রহণ করা হয় এবং কোনও ফলন বিবৃতি ছাড়াই ছেড়ে দেওয়া হয়, তাই সেগুলি সেই অর্থে পারমাণবিক, তবে আমরা বিভিন্ন কাজের জন্য থ্রেড ব্যবহার করার কারণে এগুলি এখনও কার্যকর।<table class=fndef id=fndef:2><tbody><tr><td class=fndef-backref><a href=#fnref:2>[2]</a><td class=fndef-content>যাহোক<a href=https://github.com/status-im/nim-stew/blob/master/stew/keyed_queue.nim> নিম স্টু</a> lru ক্যাশের জন্য একটি সহজ বাস্তবায়ন রয়েছে যা আমি যদি তাড়াতাড়ি পাওয়া যায় তবে ব্যবহার করতাম।</table><h1 id=background_jobs><a class=header-anchor href=#background_jobs> পটভূমি কাজ</a></h1><p>আমরা যে কয়েকটি কাজ ব্যবহার করি তা হল CPU ক্ষুধার্ত, তাই আমরা তাদের জন্য একটি ভিন্ন থ্রেড ব্যবহার করি:<ul><li><p>lsh: স্থানীয় সংবেদনশীল হ্যাশিং অনেক গণনা করে<li><p>ইমেজ: ইমেজ রিসাইজ করার জন্য ডিকোডিং/এনকোডিং ইমেজ প্রয়োজন তাই এটি ব্যয়বহুল</ul><p>সম্পদ ফাইলের তালিকা এবং বিজ্ঞাপনগুলি আপডেট করতে আরও দুটি থ্রেড ব্যবহার করা হয়, যদিও cpu ক্ষুধার্ত নয়, ফাইল পর্যবেক্ষক দ্বারা সৃষ্ট স্টল এড়াতে একটি থ্রেড প্রয়োজন।<p>আমাদের কাছে দীর্ঘ সময়ের কাজগুলিও অ্যাসিঙ্ক আছে:<ul><li><p>অনুবাদ<li><p>http অনুরোধ</ul><p>Lsh, ছবি, অনুবাদ এবং HTTP অনুরোধের কাজগুলি একটি প্রযোজক/ভোক্তা সেটআপ ব্যবহার করে পরিচালনা করা হয়। আমরা চ্যানেলগুলি ব্যবহার করি না, কারণ চ্যানেলগুলি ব্লক করে এবং আমাদের কাছে সেগুলির একটি অ্যাসিঙ্ক বাস্তবায়ন নেই যা থ্রেডসেফও। আমরা একটি async বাস্তবায়ন ব্যবহার করেছি<a href=https://github.com/mashingan/nim-etc/blob/master/sharedseq.nim> এই</a><sup id=fnref:1><a class=fnref href=#fndef:1>[1]</a></sup> . এবং একটি অ্যাসিঙ্ক টেবিল, যা একটি ইভেন্ট বাসের মতো<pre><code class="nim hljs"><span class=hljs-keyword>type</span><span class=hljs-type>AsyncTableObj</span>[K, V] = <span class=hljs-keyword>object</span>
    lock: <span class=hljs-type>ThreadLock</span>
    waiters: <span class=hljs-type>Table</span>[K, <span class=hljs-type>seq</span>[<span class=hljs-keyword>ptr</span><span class=hljs-type>Future</span>[V]]]
    table: <span class=hljs-type>Table</span>[K, V]
  <span class=hljs-type>AsyncTable</span>*[K, V] = <span class=hljs-keyword>ptr</span><span class=hljs-type>AsyncTableObj</span>[K, V]

<span class=hljs-keyword>proc</span> pop*[K, V](t: <span class=hljs-type>AsyncTable</span>[K, V], k: K): <span class=hljs-type>Future</span>[V] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>var</span> popped = <span class=hljs-literal>false</span>
  withLock(t.lock):
    <span class=hljs-keyword>if</span> k <span class=hljs-keyword>in</span> t.table:
      popped = t.table.pop(k, <span class=hljs-built_in>result</span>)
  <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> popped:
    <span class=hljs-keyword>if</span> k <span class=hljs-keyword>notin</span> t.waiters:
      t.waiters[k] = newSeq[<span class=hljs-keyword>ptr</span><span class=hljs-type>Future</span>[V]]()
    <span class=hljs-keyword>var</span> fut = newFuture[V](<span class=hljs-string>"AsyncTable.pop"</span>)
    t.waiters[k].add fut.<span class=hljs-keyword>addr</span><span class=hljs-built_in>result</span> = await fut

<span class=hljs-keyword>proc</span> put*[K, V](t: <span class=hljs-type>AsyncTable</span>[K, V], k: K, v: V) <span class=hljs-meta>{.async.}</span> =
  withLock(t.lock):
    <span class=hljs-keyword>if</span> k <span class=hljs-keyword>in</span> t.waiters:
      <span class=hljs-keyword>var</span> ws: <span class=hljs-type>seq</span>[<span class=hljs-keyword>ptr</span><span class=hljs-type>Future</span>[V]]
      doassert t.waiters.pop(k, ws)
      <span class=hljs-keyword>while</span> ws.len > <span class=hljs-number>0</span>:
        <span class=hljs-keyword>let</span> w = ws.pop()
        <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> w.isnil <span class=hljs-keyword>and</span><span class=hljs-keyword>not</span> w[].isnil <span class=hljs-keyword>and</span><span class=hljs-keyword>not</span> w[].finished:
          w[].complete(v)
    <span class=hljs-keyword>else</span>:
      t.table[k] = v</code></pre><p>নিম সার্ভার তিনটি অ্যাসিঙ্ক কাজ পরিচালনা করে:<pre><code class="nim hljs"><span class=hljs-keyword>type</span><span class=hljs-type>TaskKind</span> = <span class=hljs-keyword>enum</span> pub, cleanup, mem

<span class=hljs-keyword>proc</span> scheduleTasks(): <span class=hljs-type>TaskTable</span> =
  <span class=hljs-keyword>template</span> addTask(t) =
    <span class=hljs-keyword>let</span> fut = (selectTask t)()
    <span class=hljs-built_in>result</span>[t] = fut
  <span class=hljs-comment># Publishes new articles for one topic every x seconds</span>
  addTask pub
  <span class=hljs-comment># cleanup task for deleting low traffic articles</span>
  addTask cleanup
  <span class=hljs-comment># quit when max memory usage reached</span>
  addTask mem</code></pre><p>কন্টেইনারাইজড প্রসেস এবং ডকারের মধ্যে ওওএম সমস্যা এড়াতে মেম ব্যবহার নিরীক্ষণ করা কাজটি চমৎকার, কারণ ডকার (বা কার্নেল) প্রক্রিয়াটিকে অবিলম্বে মেরে ফেলে না এবং এই সময়ের মধ্যে সার্ভারটি প্রতিক্রিয়াহীন হয়ে যেতে পারে, তাই অবিলম্বে ম্যানুয়ালি পুনরায় চালু করা ভাল।<table class=fndef id=fndef:1><tbody><tr><td class=fndef-backref><a href=#fnref:1>[1]</a><td class=fndef-content>যদিও অ্যাসিঙ্ক রুটিনে একটি প্লেইন চ্যানেল মোড়ানো সম্ভবত ভাল...হায়</table><h1 id=images><a class=header-anchor href=#images> ছবি</a></h1><p>আমরা লিভারেজ<a href=https://github.com/imazen/imageflow/releases> চিত্রপ্রবাহ</a> স্থানীয়ভাবে চিত্রের আকার পরিবর্তন এবং ক্যাশে করতে। বাইন্ডিংগুলি সহজ, তবে প্রক্রিয়াটি কিছুটা জড়িত। সঙ্গে<code>getImg</code> আমরা দূরবর্তী url থেকে ইমেজ ডেটা আনব:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> getImg*(src: <span class=hljs-type>string</span>, kind: <span class=hljs-type>Source</span>): <span class=hljs-type>Future</span>[<span class=hljs-type>string</span>] <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>return</span><span class=hljs-keyword>case</span> kind:
    <span class=hljs-keyword>of</span> urlsrc:
      (await get(src.parseUri, decode = <span class=hljs-literal>false</span>, proxied = <span class=hljs-literal>false</span>)).body
    <span class=hljs-keyword>elif</span> fileExists(src):
      await readFileAsync(src)
    <span class=hljs-keyword>else</span>:
      <span class=hljs-string>""</span></code></pre><p>তারপরে আমাদের এটি একটি ইমেজফ্লো প্রসঙ্গে যোগ করতে হবে:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> addImg*(img: <span class=hljs-type>string</span>): <span class=hljs-type>bool</span> =
  <span class=hljs-comment>## a lock should be held here throughout the `processImg` call.</span><span class=hljs-keyword>if</span> img == <span class=hljs-string>""</span>: <span class=hljs-keyword>return</span><span class=hljs-literal>false</span>
  reset(ctx)
  doassert ctx.check
  <span class=hljs-keyword>let</span> a = imageflow_context_add_input_buffer(
    ctx.p,
    inputIoId,
    <span class=hljs-comment># <span class=hljs-doctag>NOTE:</span> The image is held in cache, but it might be collected</span><span class=hljs-keyword>cast</span>[<span class=hljs-keyword>ptr</span><span class=hljs-type>uint8</span>](img[<span class=hljs-number>0</span>].unsafeAddr),
    img.len.csize_t,
    imageflow_lifetime_lifetime_outlives_context)
  <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> a:
    doassert ctx.check
    cmdStr[<span class=hljs-string>"decode"</span>] = %inputIoId
  <span class=hljs-keyword>return</span><span class=hljs-literal>true</span></code></pre><p>যদি ছবিটি যোগ করা না যায়, তাহলে এর অর্থ হল ইমেজফ্লো ডেটাটিকে একটি বৈধ ছবি হিসেবে স্বীকৃতি দিতে ব্যর্থ হয়েছে। আমরা ডেটা পাঠানোর পরে, আমাদের প্রসঙ্গে একটি প্রশ্ন পাঠাতে হবে, তারপর প্রতিক্রিয়াটি পড়তে হবে এবং আউটপুট পেতে হবে:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> doProcessImg(input: <span class=hljs-type>string</span>, mtd = execMethod): (<span class=hljs-type>string</span>, <span class=hljs-type>string</span>) =
  setCmd(input)
  <span class=hljs-keyword>let</span> c = $cmd
  <span class=hljs-comment># debug "{hash(c)} - {c}"</span><span class=hljs-keyword>let</span> json_res = imageflow_context_send_json(
      ctx.p,
      mtd,
      <span class=hljs-keyword>cast</span>[<span class=hljs-keyword>ptr</span><span class=hljs-type>uint8</span>](c[<span class=hljs-number>0</span>].unsafeAddr),
      c.len.csize_t
    )
  <span class=hljs-keyword>discard</span> imageflow_json_response_read(ctx.p, json_res,
                                       status.<span class=hljs-keyword>addr</span>,
                                       resPtr,
                                       resLen)
  defer: doassert imageflow_json_response_destroy(ctx.p, json_res)

  <span class=hljs-keyword>var</span> mime: <span class=hljs-type>string</span><span class=hljs-keyword>if</span> status != <span class=hljs-number>200</span>:
    <span class=hljs-keyword>let</span> msg = resPtr[].toString(resLen[].<span class=hljs-type>int</span>)
    debug <span class=hljs-string>"imageflow: conversion failed {msg}"</span>
    doassert ctx.check
  <span class=hljs-keyword>else</span>:
    mime = getMime()
  <span class=hljs-keyword>discard</span> imageflow_context_get_output_buffer_by_id(
      ctx.p,
      outputIoId,
      outputBuffer,
      outputBufferLen)
  doassert ctx.check
  <span class=hljs-built_in>result</span> = (outputBuffer[].toString(outputBufferLen[].<span class=hljs-type>int</span>), mime)</code></pre><p>আমরা প্রতিক্রিয়া থেকে মাইম টাইপ পাই, যা ওয়েব সার্ভারের প্রতিক্রিয়ায় ফরোয়ার্ড করা হবে। সার্ভারের দিক থেকে url পাথ থেকে চিত্র প্রবাহে অনুবাদটি এইভাবে পরিচালনা করা হয়:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> processImgData(q: <span class=hljs-keyword>ptr</span><span class=hljs-type>ImgQuery</span>) <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-comment># push img to imageflow context</span>
  initImageFlow() <span class=hljs-comment># <span class=hljs-doctag>NOTE:</span> this initializes thread vars</span><span class=hljs-keyword>var</span> acquired, submitted: <span class=hljs-type>bool</span><span class=hljs-keyword>let</span> data = (await q.url.rawImg)
  defer:
    <span class=hljs-keyword>if</span> acquired: imgLock[].release
    <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> submitted:
      imgOut[q] = <span class=hljs-literal>true</span><span class=hljs-keyword>if</span> data.len > <span class=hljs-number>0</span>:
    <span class=hljs-keyword>try</span>:
      await imgLock[].acquire
      acquired = <span class=hljs-literal>true</span><span class=hljs-keyword>if</span> addImg(data):
        <span class=hljs-keyword>let</span> query = <span class=hljs-string>fmt"width={q.width}&height={q.height}&mode=max&format=webp"</span>
        logall <span class=hljs-string>"ifl server: serving image hash: {hash(await q.url.rawImg)}, size: {q.width}x{q.height}"</span><span class=hljs-comment># process and send back</span>
        (q.processed.data, q.processed.mime) = processImg(query)
        imgOut[q] = <span class=hljs-literal>true</span>
        submitted = <span class=hljs-literal>true</span><span class=hljs-keyword>except</span><span class=hljs-type>Exception</span>:
      <span class=hljs-keyword>discard</span></code></pre><p>ইমেজ url zstd সংকুচিত আকারে একটি প্যারামিটার হিসাবে পাঠানো হয়। কম্প্রেশন ইউআরএল ছোট করে (বেশিরভাগ সময়)। এইভাবে আমি গুগল ক্রোমে একটি বাগ খুঁজে পেয়েছি, যেখানে এটি ইউআরএলগুলি পরিচালনা করতে পারে না যেখানে ক্যোয়ারীতে url-এনকোডেড সংকুচিত ডেটা ছিল। ফায়ারফক্স পরিবর্তে ভাল ছিল.<h2 id=ld-json><a class=header-anchor href=#ld-json> LD-JSON</a></h2><p>আমরা প্রতিটি ওয়েবপেজে ldjson স্ক্রিপ্ট যোগ করি।<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> jwebpage(id, title, url, mtime, selector, description: <span class=hljs-type>auto</span>, keywords: <span class=hljs-type>seq</span>[<span class=hljs-type>string</span>], name = <span class=hljs-string>""</span>, headline = <span class=hljs-string>""</span>,
            image = <span class=hljs-string>""</span>, entity = <span class=hljs-string>"Article"</span>, status = <span class=hljs-string>"Published"</span>, lang = <span class=hljs-string>"english"</span>, mentions: <span class=hljs-type>seq</span>[
            <span class=hljs-type>string</span>] = (@[]), access_mode = (@[<span class=hljs-string>"textual"</span>, <span class=hljs-string>"visual"</span>]), access_sufficient: <span class=hljs-type>seq</span>[
            <span class=hljs-type>string</span>] = @[], access_summary = <span class=hljs-string>""</span>, created = <span class=hljs-string>""</span>, published = <span class=hljs-string>""</span>,
            props = default(<span class=hljs-type>JsonNode</span>)): <span class=hljs-type>JsonNode</span> =
    <span class=hljs-keyword>let</span>
        d_mtime = coerce(mtime, <span class=hljs-string>""</span>)
        s_created = created.toIsoDate
        description = coerce(description, to = title)
        prd = (v: <span class=hljs-type>seq</span>[<span class=hljs-type>string</span>]) => v.len == <span class=hljs-number>0</span><span class=hljs-keyword>let</span> data = %*{
        <span class=hljs-string>"@context"</span>: <span class=hljs-string>"https://schema.org"</span>,
        <span class=hljs-string>"@type"</span>: <span class=hljs-string>"https://schema.org/WebPage"</span>,
        <span class=hljs-string>"@id"</span>: id,
        <span class=hljs-string>"url"</span>: url,
        <span class=hljs-string>"lastReviewed"</span>: coerce(mtime, <span class=hljs-string>""</span>),
        <span class=hljs-string>"mainEntityOfPage"</span>: {
            <span class=hljs-string>"@type"</span>: entity,
            <span class=hljs-string>"@id"</span>: url
        },
        <span class=hljs-string>"mainContentOfPage"</span>:
        {
            <span class=hljs-string>"@type"</span>: <span class=hljs-string>"WebPageElement"</span>, <span class=hljs-string>"cssSelector"</span>: selector},
        <span class=hljs-string>"accessMode"</span>: access_mode,
        <span class=hljs-string>"accessModeSufficient"</span>: {
            <span class=hljs-string>"@type"</span>: <span class=hljs-string>"itemList"</span>,
            <span class=hljs-string>"itemListElement"</span>: coercf(access_sufficient, prd, to = access_mode),
        },
        <span class=hljs-string>"creativeWorkStatus"</span>: status,
        <span class=hljs-comment># <span class=hljs-doctag>NOTE:</span> datePublished should always be provided</span><span class=hljs-string>"datePublished"</span>: ensure_time(d_mtime.toIsoDate, s_created),
        <span class=hljs-string>"dateModified"</span>: d_mtime,
        <span class=hljs-string>"dateCreated"</span>: coerce(s_created, to = d_mtime),
        <span class=hljs-string>"name"</span>: coerce(name, to = title),
        <span class=hljs-string>"description"</span>: coerce(description, <span class=hljs-string>""</span>),
        <span class=hljs-string>"keywords"</span>: coerce(keywords, to = (@[]))
    }
    setArgs data, %*{<span class=hljs-string>"inLanguage"</span>: lang, <span class=hljs-string>"accessibilitySummary"</span>: access_summary,
                    <span class=hljs-string>"headline"</span>: coerce(headline, to = description), <span class=hljs-string>"image"</span>: image,
                    <span class=hljs-string>"mentions"</span>: mentions}
    setProps
    data</code></pre><p>এবং অনূদিত পৃষ্ঠাগুলির জন্য:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> translation*(src_url, trg_url, lang, title, mtime, selector, description: <span class=hljs-type>auto</span>, keywords: <span class=hljs-type>seq</span>[<span class=hljs-type>string</span>],
                     image = <span class=hljs-string>""</span>, headline = <span class=hljs-string>""</span>, props = default(<span class=hljs-type>JsonNode</span>),
                     translator_name = <span class=hljs-string>"Google"</span>, translator_url = <span class=hljs-string>"https://translate.google.com/"</span>): <span class=hljs-type>auto</span> =
    <span class=hljs-comment>## file path must be relative to the project directory, assumes the published website is under '__site/'</span><span class=hljs-comment># id, title, url, mtime, selector, description: auto, keywords: seq[string], name = "", headline = "",</span><span class=hljs-keyword>let</span> data = jwebpage(id = trg_url, title, url = trg_url, mtime, selector, description,
                            keywords = keywords, image = image, headline = headline, lang = lang, props = props)
    data[<span class=hljs-string>"translator"</span>] = %*{<span class=hljs-string>"@type"</span>: <span class=hljs-string>"https://schema.org/Organization"</span>,
                             <span class=hljs-string>"name"</span>: translator_name,
                             <span class=hljs-string>"url"</span>: translator_url}
    data[<span class=hljs-string>"translationOfWork"</span>] = %*{<span class=hljs-string>"@id"</span>: src_url}
    data</code></pre><h2 id=opengraph><a class=header-anchor href=#opengraph> ওপেনগ্রাফ</a></h2><p>ldjson এর মতোই, আমরা ওপেনগ্রাফ মেটা ট্যাগও প্রদান করি:<pre><code class="nim hljs"><span class=hljs-keyword>proc</span> opgBasic(title, tp, url, image: <span class=hljs-type>string</span>, prefix = <span class=hljs-string>""</span>): <span class=hljs-type>seq</span>[<span class=hljs-type>XmlNode</span>] =
  <span class=hljs-keyword>if</span> prefix != <span class=hljs-string>""</span>:
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>fmt"{prefix}:title"</span>, title)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>fmt"{prefix}:type"</span>, tp)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>fmt"{prefix}:url"</span>, url)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>fmt"{prefix}:image"</span>, image)
  <span class=hljs-keyword>else</span>:
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"title"</span>, image)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"type"</span>, image)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"url"</span>, image)
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"image"</span>, image)

<span class=hljs-keyword>proc</span> opgTags(title, tp, url,
             image: <span class=hljs-type>string</span>,
             description = <span class=hljs-string>""</span>,
             siteName = <span class=hljs-string>""</span>,
             locale = <span class=hljs-string>""</span>,
             audio = <span class=hljs-string>""</span>,
             video = <span class=hljs-string>""</span>,
             determiner = <span class=hljs-string>""</span>,
             prefix = <span class=hljs-string>""</span>): <span class=hljs-type>seq</span>[<span class=hljs-type>XmlNode</span>] <span class=hljs-meta>{.gcsafe.}</span> =
  <span class=hljs-comment>## Generates an HTML String containing opengraph meta result for one item.</span><span class=hljs-keyword>var</span><span class=hljs-built_in>result</span> = opgBasic(title, tp, url, image, prefix)
  <span class=hljs-built_in>result</span>.add opgOptional(description, siteName, locale, audio, video, determiner)
  <span class=hljs-keyword>return</span><span class=hljs-built_in>result</span><span class=hljs-keyword>proc</span> opgPage*(a: <span class=hljs-type>Article</span>): <span class=hljs-type>seq</span>[<span class=hljs-type>XmlNode</span>] =
  <span class=hljs-keyword>let</span> locale = <span class=hljs-keyword>static</span>(<span class=hljs-type>DEFAULT_LOCALE</span>)
  <span class=hljs-keyword>let</span>
    tp = <span class=hljs-keyword>static</span>(<span class=hljs-string>"article"</span>)
    url = getArticleUrl(a)
    siteName = <span class=hljs-keyword>static</span>(<span class=hljs-type>WEBSITE_TITLE</span>)
  <span class=hljs-built_in>result</span> = opgTags(a.title, tp, url, a.imageUrl, a.desc, siteName, locale, prefix = <span class=hljs-string>"article"</span>)
  <span class=hljs-keyword>for</span> t <span class=hljs-keyword>in</span> a.tags:
    <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"article:tag"</span>, t)
  <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"article:author"</span>, a.author)
  <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"article:published_time"</span>, $a.pubTime)
  <span class=hljs-built_in>result</span>.add metaTag(<span class=hljs-string>"article:section"</span>, a.desc)
  <span class=hljs-comment># result.add metaTag("article:modified_time", a.pubTime)</span><span class=hljs-comment># result.add metaTag("article:expiration_time", a.pubTime)</span><span class=hljs-built_in>result</span>.add twitterMeta(<span class=hljs-string>"card"</span>, <span class=hljs-string>"summary"</span>)
  <span class=hljs-built_in>result</span>.add twitterMeta(<span class=hljs-string>"creator"</span>, twitterUrl[])</code></pre><p>এই সমস্ত বয়লারপ্লেট ভারী কোডের সাথে কাজ করার সময় নিম ম্যাক্রো এবং টেমপ্লেটগুলি কাজে আসে৷<h2 id=server_side_http_requests><a class=header-anchor href=#server_side_http_requests> সার্ভার সাইড HTTP অনুরোধ</a></h2><p>আরেকটি কাজ আছে, যা ওয়েব সার্ভারের দিক থেকে সমস্ত http অনুরোধ (চিত্র, স্ক্রিপ্ট ইত্যাদি আনার জন্য) পরিচালনা করে। আমরা chronos httpclient ব্যবহার করি:<pre><code class="nim hljs"><span class=hljs-keyword>const</span> proxiedFlags = {<span class=hljs-type>NoVerifyHost</span>, <span class=hljs-type>NoVerifyServerName</span>, <span class=hljs-type>NewConnectionAlways</span>}
<span class=hljs-keyword>const</span> sessionFlags = {<span class=hljs-type>NoVerifyHost</span>, <span class=hljs-type>NoVerifyServerName</span>, <span class=hljs-type>NoInet6Resolution</span>}
<span class=hljs-keyword>proc</span> requestTask(q: sink <span class=hljs-keyword>ptr</span><span class=hljs-type>Request</span>) <span class=hljs-meta>{.async.}</span> =
  <span class=hljs-keyword>var</span> trial = <span class=hljs-number>0</span><span class=hljs-keyword>var</span>
    sess: <span class=hljs-type>HttpSessionRef</span>
    req: <span class=hljs-type>HttpClientRequestRef</span>
    resp: <span class=hljs-type>HttpClientResponseRef</span>
    cleanup: <span class=hljs-type>seq</span>[<span class=hljs-type>Future</span>[<span class=hljs-type>void</span>]]
  <span class=hljs-keyword>while</span> trial < q[].retries:
    <span class=hljs-keyword>try</span>:
      trial.inc
      sess = new(<span class=hljs-type>HttpSessionRef</span>,
                proxyTimeout = <span class=hljs-number>10</span>.seconds.<span class=hljs-keyword>div</span>(<span class=hljs-number>3</span>),
                headersTimeout = <span class=hljs-number>10</span>.seconds.<span class=hljs-keyword>div</span>(<span class=hljs-number>2</span>),
                connectTimeout = <span class=hljs-number>10</span>.seconds,
                proxy = <span class=hljs-keyword>if</span> q[].proxied: selectProxy(trial) <span class=hljs-keyword>else</span>: <span class=hljs-string>""</span>,
                flags = <span class=hljs-keyword>if</span> q[].proxied: proxiedFlags <span class=hljs-keyword>else</span>: sessionFlags
      )
      req = new(<span class=hljs-type>HttpClientRequestRef</span>,
                sess,
                sess.getAddress(q[].url).get,
                q[].meth,
                headers = q[].headers.toHeaderTuple,
                body = q[].body.tobytes,
        )
      resp = await req.fetch(followRedirects = q[].redir, raw = <span class=hljs-literal>true</span>)
      checkNil(resp):
        defer:
          cleanup.add resp.closeWait()
          resp = <span class=hljs-keyword>nil</span>
        q.response.code = httpcore.<span class=hljs-type>HttpCode</span>(resp.status)
        checkNil(resp.connection):
          q.response.body = bytesToString (await resp.getBodyBytes)
          q.response.headers = newHttpHeaders(<span class=hljs-keyword>cast</span>[<span class=hljs-type>seq</span>[(<span class=hljs-type>string</span>, <span class=hljs-type>string</span>)]](
              resp.headers.toList))
        <span class=hljs-keyword>break</span><span class=hljs-keyword>except</span>:
      cdebug():
        logexc()
        debug <span class=hljs-string>"cronhttp: request failed"</span><span class=hljs-keyword>finally</span>:
      <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> req.isnil:
        cleanup.add req.closeWait()
      <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> resp.isnil:
        cleanup.add resp.closeWait()
      <span class=hljs-keyword>if</span><span class=hljs-keyword>not</span> sess.isnil:
        cleanup.add sess.closeWait()
  httpOut[q] = <span class=hljs-literal>true</span>
  await allFutures(cleanup)</code></pre><p>আমাকে যোগ করতে হয়েছিল<a href=https://github.com/untoreh/nim-chronos/tree/update> https এবং socks5 প্রক্সিগুলির জন্য সমর্থন</a> httpক্লায়েন্টের কাছে অনুবাদগুলি কার্যকরভাবে ব্যবহার করতে সক্ষম হবেন।<h1 id=config><a class=header-anchor href=#config> কনফিগার</a></h1><p>আপনি পুরো কোড জুড়ে ক্যাপিটালাইজড ভেরিয়েবল লক্ষ্য করেছেন। এই সবগুলি কনফিগার ভেরিয়েবল, যেগুলি একটি ফাইলে সংজ্ঞায়িত করা হয়, যা প্রতি ওয়েবসাইট কাস্টমাইজ করা যায়।<pre><code class="nim hljs"><span class=hljs-keyword>const</span><span class=hljs-type>BASE_URL</span>* = <span class=hljs-type>Uri</span>()
  <span class=hljs-type>SITE_PATH</span>* = <span class=hljs-type>PROJECT_PATH</span> / <span class=hljs-string>"site"</span><span class=hljs-type>SITE_ASSETS_PATH</span>* = <span class=hljs-type>BASE_URL</span> / <span class=hljs-string>"assets"</span> / <span class=hljs-type>WEBSITE_NAME</span><span class=hljs-type>SITE_ASSETS_DIR</span>* = <span class=hljs-type>SITE_PATH</span> / <span class=hljs-string>"assets"</span> / <span class=hljs-type>WEBSITE_NAME</span><span class=hljs-type>DATA_PATH</span>* = <span class=hljs-type>PROJECT_PATH</span> / <span class=hljs-string>"data"</span><span class=hljs-type>DATA_ASSETS_PATH</span>* = <span class=hljs-type>DATA_PATH</span> / <span class=hljs-string>"assets"</span> / <span class=hljs-type>WEBSITE_NAME</span><span class=hljs-type>DATA_ADS_PATH</span>* = <span class=hljs-type>DATA_PATH</span> / <span class=hljs-string>"ads"</span> / <span class=hljs-type>WEBSITE_NAME</span><span class=hljs-type>ASSETS_PATH</span>* = <span class=hljs-type>PROJECT_PATH</span> / <span class=hljs-string>"src"</span> / <span class=hljs-string>"assets"</span><span class=hljs-type>DEFAULT_IMAGE</span>* = <span class=hljs-type>ASSETS_PATH</span> / <span class=hljs-string>"empty.png"</span><span class=hljs-type>DEFAULT_IMAGE_MIME</span>* = <span class=hljs-string>"image/png"</span><span class=hljs-type>CSS_BUN_URL</span>* = $(<span class=hljs-type>SITE_ASSETS_PATH</span> / <span class=hljs-string>"bundle.css"</span>)
  <span class=hljs-type>CSS_CRIT_PATH</span>* = <span class=hljs-type>SITE_ASSETS_DIR</span> / <span class=hljs-string>"bundle-crit.css"</span><span class=hljs-type>JS_REL_URL</span>* = $(<span class=hljs-type>SITE_ASSETS_PATH</span> / <span class=hljs-string>"bundle.js"</span>)
  <span class=hljs-type>LOGO_PATH</span>* = <span class=hljs-type>BASE_URL</span> / <span class=hljs-string>"assets"</span> / <span class=hljs-string>"logo"</span> / <span class=hljs-type>WEBSITE_NAME</span><span class=hljs-type>LOGO_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo.svg"</span>)
  <span class=hljs-type>LOGO_SMALL_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-small.svg"</span>)
  <span class=hljs-type>LOGO_ICON_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-icon.svg"</span>)
  <span class=hljs-type>LOGO_DARK_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-dark.svg"</span>)
  <span class=hljs-type>LOGO_DARK_SMALL_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-small-dark.svg"</span>)
  <span class=hljs-type>LOGO_DARK_ICON_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-icon-dark.svg"</span>)
  <span class=hljs-type>FAVICON_PNG_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-icon.png"</span>)
  <span class=hljs-type>FAVICON_SVG_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"logo-icon.svg"</span>)
  <span class=hljs-type>APPLE_PNG180_URL</span>* = $(<span class=hljs-type>LOGO_PATH</span> / <span class=hljs-string>"apple-touch-icon.png"</span>)
  <span class=hljs-type>MAX_DIR_FILES</span>* = <span class=hljs-number>10</span><span class=hljs-comment># ...</span></code></pre><h1 id=conclusion><a class=header-anchor href=#conclusion> উপসংহার</a></h1><p>অনেকগুলি জিনিস আছে যা আমি উল্লেখ করিনি, যেহেতু শয়তান বিশদে রয়েছে...তবে এটি পুরো কোড বেসের রুক্ষ সফর যার পরিমাণ:<ul><li><p>নিমের ~12k লাইন<li><p>Js এর ~400 লাইন<li><p>~1000 লাইন scss<li><p>পাইথনের ~3500 লাইন<li><p>74 lines of rust (for bindings :P)</ul><p>আমি ভিন্নভাবে কি করব?<ul><li><p>সম্ভবত পুরো জিনিসটি মরিচায় পুনরায় লিখুন, নিম বর্তমানে মেমরির সুরক্ষা সুন্দরভাবে পরিচালনা করে না, এবং ক্র্যাশগুলি ঠিক করতে আমাকে যে পরিমাণ সময় জিডিবি-তে নির্ভর করতে হয়েছিল তা খুব বেশি ছিল এবং আমি সেগুলি ঠিক করতেও পারিনি। এটি একটি বড় সমস্যা যখন অর্ধেক ইকোসিস্টেম GC এর উপর এবং বাকি অর্ধেক ORC এর উপর নির্ভর করে (বা এমনকি orc এবং শুধু ARC নয়)। অ্যাসিঙ্ক এবং থ্রেডগুলি মিশ্রিত করাও বেদনাদায়ক এবং অ্যাসিঙ্ক স্ট্যাকট্রেসগুলি একটি দুঃস্বপ্ন, (যদিও আমি জানি না এই ক্ষেত্রে মরিচা আরও ভাল কিনা।)<li><p>লক্ষ্য a<a href=https://en.wikipedia.org/wiki/Progressive_web_app> পিডব্লিউএ</a> গেগো থেকে প্রকল্পটি বেশ ঝামেলাপূর্ণ শুরু হয়েছিল। শুরুতে এটি একটি ওয়েব সার্ভার দ্বারা পরিবেশিত স্ট্যাটিক পেজ হওয়ার কথা ছিল, তারপর এটি নিজেই একটি ওয়েব সার্ভারে পরিণত হয়। ইন্টারঅ্যাকটিভিটি একটি আফটার থট হিসাবে এসেছে, তাই এটি রেন্ডার করা html প্লাস js/css এর মিশ্রণে পরিণত হয়েছে। এটি আমাকে API-তে খুব শিথিল করে তুলেছে, যা কোনও কাঠামো ছাড়াই বেরিয়ে এসেছে (সম্পূর্ণভাবে<a href=https://en.wikipedia.org/wiki/Representational_state_transfer> অস্থির</a> ) পুনর্লিখনে আমি একটি ui ফ্রেমওয়ার্ক ব্যবহার করব, হয়<a href=https://preactjs.com/> preact</a> যার সম্পূর্ণ AMP সমর্থন আছে, বা<a href=https://www.solidjs.com/> solidjs</a>.<li><p>জনপ্রিয় প্ল্যাটফর্মের জন্য আরও অ্যাড-হক পার্সার যোগ করুন। প্লেইন আর্টিকেল পার্সিং ভালভাবে কাজ করে না (বা মোটেও) যখন আজকাল সবচেয়ে জনপ্রিয় প্ল্যাটফর্মগুলি খুব কম বিষয়বস্তু এবং প্রচুর ভিডিও এবং চিত্র অফার করে, তাই স্ক্র্যাপিংকে কেবল পাঠ্যের পরিবর্তে সমৃদ্ধ মিডিয়াকে আরও লক্ষ্য করা উচিত, যদি এটি না হয় স্ক্র্যাপার আর্কিটেকচারের পরিকল্পনা করার সময়, APP যে বিষয়বস্তু এবং তথ্য পরিবেশন করবে তা ভারসাম্যহীন হবে।</ul><div id=post-tags-list>পোস্ট ট্যাগ: <span class=post-tag><a href=https://www.unto.re/tag/apps> অ্যাপস</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/programming> প্রোগ্রামিং</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/software> সফটওয়্যার</a></span></div><div class=page-foot><div class=copyright>11 ডিসেম্বর, 2022</div><script async crossorigin=anonymous issue-term=pathname label=Comment repo=untoreh/untoreh.github.io src=https://utteranc.es/client.js></script></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - দ্বারা চালিত<a href=https://github.com/tlienart/Franklin.jl> ফ্রাঙ্কলিন</a></div><div class=page__footer-links>- <ul><li><a href=/bn/sitemapxml> সাইটম্যাপ</a></li> | <li><a href=/bn/tag> ট্যাগ</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> আরএসএস</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>