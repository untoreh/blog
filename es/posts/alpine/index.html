<!doctypehtml><html prefix="og: https://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#"lang=es><meta charset=UTF-8><meta content=width=device-width,initial-scale=1 name=viewport><link href=https://www.unto.re/es/posts/alpine/ rel=canonical><link href=https://www.unto.re/de/posts/alpine hreflang=de rel=alternate><link href=https://www.unto.re/it/posts/alpine hreflang=it rel=alternate><link href=https://www.unto.re/zh/posts/alpine hreflang=zh rel=alternate><link href=https://www.unto.re/es/posts/alpine hreflang=es rel=alternate><link href=https://www.unto.re/hi/posts/alpine hreflang=hi rel=alternate><link href=https://www.unto.re/ar/posts/alpine hreflang=ar rel=alternate><link href=https://www.unto.re/pt/posts/alpine hreflang=pt rel=alternate><link href=https://www.unto.re/bn/posts/alpine hreflang=bn rel=alternate><link href=https://www.unto.re/ru/posts/alpine hreflang=ru rel=alternate><link href=https://www.unto.re/ja/posts/alpine hreflang=ja rel=alternate><link href=https://www.unto.re/pa/posts/alpine hreflang=pa rel=alternate><link href=https://www.unto.re/jw/posts/alpine hreflang=jw rel=alternate><link href=https://www.unto.re/vi/posts/alpine hreflang=vi rel=alternate><link href=https://www.unto.re/fr/posts/alpine hreflang=fr rel=alternate><link href=https://www.unto.re/ur/posts/alpine hreflang=ur rel=alternate><link href=https://www.unto.re/tr/posts/alpine hreflang=tr rel=alternate><link href=https://www.unto.re/pl/posts/alpine hreflang=pl rel=alternate><link href=https://www.unto.re/uk/posts/alpine hreflang=uk rel=alternate><link href=https://www.unto.re/nl/posts/alpine hreflang=nl rel=alternate><link href=https://www.unto.re/el/posts/alpine hreflang=el rel=alternate><link href=https://www.unto.re/sv/posts/alpine hreflang=sv rel=alternate><link href=https://www.unto.re/zu/posts/alpine hreflang=zu rel=alternate><link href=https://www.unto.re/ro/posts/alpine hreflang=ro rel=alternate><link href=https://www.unto.re/ms/posts/alpine hreflang=ms rel=alternate><link href=https://www.unto.re/ko/posts/alpine hreflang=ko rel=alternate><link href=https://www.unto.re/th/posts/alpine hreflang=th rel=alternate><link href=https://www.unto.re/tl/posts/alpine hreflang=tl rel=alternate><link title="sitio de untoreh"href=https://www.unto.re/feed.xml rel=alternate type=application/rss+xml><link href=https://www.unto.re/amp/es/posts/alpine/ rel=amphtml><meta content=Alpine property=og:title><meta content=article property=og:type><meta content=https://www.unto.re/posts/alpine property=og:url><meta content=https://www.unto.re/assets/appa.png property=og:image><meta content="Pine, Alpine linux based on OSTree"property=og:description><meta content="untoreh's site"property=og:site_name><meta content=en_US property=og:locale><meta content=summary name=twitter:card><meta content=@untoreh name=twitter:creator><script type=application/ld+json>{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2022,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script><script id=ldj-webpage type=application/ld+json>{"audience":"cool people","url":"https://www.unto.re/posts/alpine/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"Pine, Alpine linux based on OSTree","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-04-19","dateCreated":"April 24, 2021","@id":"https://www.unto.re/posts/alpine/index.html","dateModified":"2021-04-19","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["tools","about"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa-60px.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-04-19","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/alpine/index.html","@type":"Article"}}</script><script id=ldj-breadcrumbs type=application/ld+json>{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/alpine","name":"Alpine","@type":"ListItem"}],"@type":"BreadcrumbList"}</script><link href=/css/franklin.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/menu.css rel=stylesheet><link href=/css/pages.css rel=stylesheet><link href=/css/lunr.css rel=stylesheet><link href=/css/footer.css rel=stylesheet><link href=/css/responsive.css rel=stylesheet><link href=/css/animations.css rel=stylesheet><link href=/css/docco.css rel=stylesheet><link href=/css/flags-sprite.css rel=stylesheet><link href=/assets/favicon.png rel=icon type=image/x-icon><link href=/assets/favicon.svg rel=icon type=image/svg+xml><title> alpino</title><meta content="Pine, Alpine linux based on OSTree"name=description><script src=/libs/load.js></script><script type=application/ld+json>{"url":"/es/posts/alpine/","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"mentions":null,"description":"","@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"","dateCreated":"","@id":"/es/posts/alpine/","dateModified":"","keywords":[],"creativeWorkStatus":"Published","translator":{"url":"http://google.translate.com","name":"Google Translate","@type":"https://schema.org/Organization"},"translationOfWork":{"@id":"https://www.unto.re/posts/alpine/"},"datePublished":"2022-03-05T20:57:14.096","inLanguage":"es","name":"","mainEntityOfPage":{"@id":"/es/posts/alpine/","@type":"Article"}}</script><body><div class=masthead><div class=masthead__menu__inner-wrap><div class=masthead__menu><a title="untoreh's site"class=site-title href=/es/></a><div class=author__wrap><script type=application/ld+json>{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script><ul><li class=author__avatar onclick=toggleTheme()><img alt=" untoreh-light"class=flip-front src=/assets/appa.png><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></div><nav id=site-nav><div class=horiz><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Buscar sitio web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/es/posts/><i class="fas fa-pen menu-icons"></i> publicaciones</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/es/media/><i class="fas fa-tv menu-icons"></i> medios de comunicación</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div><button name="Website Menu"class=ham type=button><i class="fas fa-bars ham-icon"></i></button><div class=vert><ul><li class="lunrSearch masthead__menu-item hvr-outline-in"><form class=lunrSearchForm name=lunrSearchForm><button title="Buscar sitio web"class=search-button formaction=/search/index.html value=Search><i class="fas fa-search menu-icons"></i></button><input class=search-input name=q placeholder=Search…></form><li class="masthead__menu-item hvr-outline-in"><a title="All the articles that I have written"href=/es/posts/><i class="fas fa-pen menu-icons"></i> publicaciones</a><li class="masthead__menu-item hvr-outline-in"><a title="Video and audio content from streaming websites."href=/es/media/><i class="fas fa-tv menu-icons"></i> medios de comunicación</a><li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language"><button title="Languages Menu"class=langs-dropdown-wrapper type=button><i class="fas fa-language menu-icons"></i> Lang <div class="langs-dropdown-content langs-dropdown-menu"><ul class=lang-list><a class="lang-link lang-ar"href=/ar/posts/alpine><span class="flag flag-sa"></span>Arabic</a><a class="lang-link lang-bn"href=/bn/posts/alpine><span class="flag flag-bd"></span>Bengali</a><a class="lang-link lang-nl"href=/nl/posts/alpine><span class="flag flag-nl"></span>Dutch</a><a class="lang-link lang-en"href=/posts/alpine><span class="flag flag-gb"></span>English</a><a class="lang-link lang-tl"href=/tl/posts/alpine><span class="flag flag-ph"></span>Filipino</a><a class="lang-link lang-fr"href=/fr/posts/alpine><span class="flag flag-fr"></span>French</a><a class="lang-link lang-de"href=/de/posts/alpine><span class="flag flag-de"></span>German</a><a class="lang-link lang-el"href=/el/posts/alpine><span class="flag flag-gr"></span>Greek</a><a class="lang-link lang-hi"href=/hi/posts/alpine><span class="flag flag-in"></span>Hindi</a><a class="lang-link lang-it"href=/it/posts/alpine><span class="flag flag-it"></span>Italian</a><a class="lang-link lang-ja"href=/ja/posts/alpine><span class="flag flag-jp"></span>Japanese</a><a class="lang-link lang-jw"href=/jw/posts/alpine><span class="flag flag-id"></span>Javanese</a><a class="lang-link lang-ko"href=/ko/posts/alpine><span class="flag flag-kr"></span>Korean</a><a class="lang-link lang-ms"href=/ms/posts/alpine><span class="flag flag-ms"></span>Malay</a><a class="lang-link lang-zh"href=/zh/posts/alpine><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link lang-pl"href=/pl/posts/alpine><span class="flag flag-pl"></span>Polish</a><a class="lang-link lang-pt"href=/pt/posts/alpine><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link lang-pa"href=/pa/posts/alpine><span class="flag flag-in"></span>Punjabi</a><a class="lang-link lang-ro"href=/ro/posts/alpine><span class="flag flag-ro"></span>Romanian</a><a class="lang-link lang-ru"href=/ru/posts/alpine><span class="flag flag-ru"></span>Russian</a><a class="lang-link lang-es"href=/es/posts/alpine><span class="flag flag-es"></span>Spanish</a><a class="lang-link lang-sv"href=/sv/posts/alpine><span class="flag flag-se"></span>Swedish</a><a class="lang-link lang-th"href=/th/posts/alpine><span class="flag flag-th"></span>Thai</a><a class="lang-link lang-tr"href=/tr/posts/alpine><span class="flag flag-tr"></span>Turkish</a><a class="lang-link lang-uk"href=/uk/posts/alpine><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link lang-ur"href=/ur/posts/alpine><span class="flag flag-pk"></span>Urdu</a><a class="lang-link lang-vi"href=/vi/posts/alpine><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link lang-zu"href=/zu/posts/alpine><span class="flag flag-za"></span>Zulu</a></ul></div></button></ul></div></nav></div></div></div><div><h1 id=title><a href=/es/posts/alpine> alpino</a></h1><blockquote id=page-description style=font-style:italic>Pine, linux alpino basado en OSTree</blockquote></div><div class=franklin-content><p>Elegir que<a href=https://en.wikipedia.org/wiki/Operating_system> SO</a> se ejecuta en sus servidores es una cuestión de conveniencia y familiaridad. La conveniencia significa que desea algo que le cause la menor cantidad de problemas posible, la familiaridad significa que preferiría<em> no</em> para aprender cosas adicionales si no es necesario.<p>Mis servidores son<a href=https://devops.stackexchange.com/questions/653/what-is-the-definition-of-cattle-not-pets> mascotas</a> así que estoy bien emitiendo manualmente algunos comandos de vez en cuando, y no requiero una automatización completa.<p>Después de probar<a href=https://en.wikipedia.org/wiki/Container_Linux> CoreOS</a> durante un año cambié a mi propio simplificado<a href=https://en.wikipedia.org/wiki/Linux_distribution> distro</a> basado en alpino y<a href=https://en.wikipedia.org/wiki/OSTree> ostree</a>.<h2 id=goals><a class=header-anchor href=#goals> Metas</a></h2><p>Esta versión de alpine se inspira en<a href=https://kinvolk.io/flatcar-container-linux/> vagón</a> y<a href=https://www.projectatomic.io/> proyecto-atómico</a> y se supone que debe instalarse como un sistema de archivos raíz de solo lectura con actualizaciones que se realizan de forma atómica, es decir, tienen éxito o el sistema vuelve al estado anterior. Para que esto sea posible, el sistema debe tener siempre al menos<strong> dos instantáneas</strong> de la versión del sistema de archivos publicada, disponible en almacenamiento.<h2 id=targets><a class=header-anchor href=#targets> Objetivos</a></h2><p>¿En qué entornos funcionará el sistema? Yo apunté<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> y [KVM], pero en general puedes decir<em> contenedores</em> y<em> maquinas virtuales</em> con la principal diferencia de que los contenedores no ejecutan su propio kernel, en particular no tienen un proceso de arranque, llaman directamente al<em> en eso</em> sistema (que por ejemplo en un<code><a href=https://en.wikipedia.org/wiki/Docker_(software)>Dockerfile</a></code> estaría definido por el<code>CMD</code> o<code>ENTRYPOINT</code> sentencias), que es responsable de administrar el árbol de procesos que mantendrá el contenedor en ejecución (al igual que una sesión normal, si el proceso init muere, el contenedor termina). Además, los contenedores no pueden configurar las perillas del sistema y pueden tener restricciones adicionales en las capacidades.<h2 id=bisecting_the_build_process><a class=header-anchor href=#bisecting_the_build_process>Bisecar el proceso de construcción</a></h2><p>¿Cómo se construye la imagen?<h3 id=dependencies><a class=header-anchor href=#dependencies> Dependencias</a></h3><p>los<code>prepare.sh</code> script maneja dependencias, la mayoría de las cuales son paquetes para ofrecer herramientas cli comunes como<code>coreutils</code>, <code>util-linux</code>, <code>binutils</code> , utilidades para operar con dispositivos de bloque como<code>blkid</code>, <code>sfdisk</code>, <code>multipath-tools</code> y sistemas de archivos con<code>xfsprogs</code> y<code>e2fsprogs</code> . los<code>squashfs-tools</code> El paquete se utiliza al final para comprimir el sistema de archivos raíz construido. A<code>glib</code> El paquete de compatibilidad también se instala de forma predeterminada porque alpine se basa en<code><a href=https://musl.libc.org/>musl</a></code> , el paquete de compatibilidad funciona proporcionando algunas bibliotecas construidas contra.<h3 id=the_tree><a class=header-anchor href=#the_tree> El árbol</a></h3><p>Los árboles de archivos para VM y contenedores se compilan respectivamente con<code>make.sh</code> y<code>make_ovz.sh</code> . Esta es una descripción simplificada de los pasos<ul><li><p>establecer la versión que se creará de acuerdo con la etiqueta del repositorio<li><p>cree un directorio para el nuevo árbol y borre el entorno<li><p>crear directorios de destino base y directorios requeridos por ostree, como<code>sysroot</code><li><p>crear enlaces simbólicos para ajustarse a la<a href=https://www.freedesktop.org/software/systemd/man/file-hierarchy.html> estándar de jerarquía del sistema de archivos</a><li><p>copiar servicios personalizados y configuraciones personalizadas<li><p>configurar chroot con directorios del sistema montados<li><p>arranca un rootfs alpino con paquetes base<li><p>aplique una configuración mínima a los rootfs como credenciales, zona horaria, nombre de host.<li><p>servicios de copia que iniciará init<li><p>configurar la configuración de arranque con la imagen del kernel especificada<li><p>opcionalmente agregue módulos de kernel personalizados<li><p>realizar limpiezas<li><p>cometer el rootfs<sup id=fnref:rootfs><a class=fnref href=#fndef:rootfs>[1]</a></sup> al repositorio ostree</ul><p>Para los contenedores, la secuencia es la misma, pero la configuración cambia, porque con un sistema no arrancado desde un<a href=https://en.wikipedia.org/wiki/Bootloader> cargador de arranque</a> ostree tiene problemas para verificar el entorno, tenemos que aplicar algunos<a href=https://github.com/untoreh/pine/blob/e65f12be70fd91edfd935e3ae9854c7be555ec73/make_ovz.sh#L73> soluciones alternativas</a> y configurar algunos dispositivos que generalmente son manejados por el<a href=https://en.wikipedia.org/wiki/Initial_ramdisk> initramfs</a> paso. Así es como<a href=https://en.wikipedia.org/wiki/OpenVZ> OVZ</a> o<a href=https://en.wikipedia.org/wiki/LXC> LXC</a> las plantillas están configuradas.<h3 id=packaging><a class=header-anchor href=#packaging> embalaje</a></h3><p>Una vez que tenemos nuestro árbol de archivos confirmados de ostree<code>build.sh</code> o<code>build-update.sh</code> se encarga de producir el artefacto que se distribuirá. La diferencia entre los scripts es que la versión de actualización comienza desde un repositorio de ostree anterior, y<em> además</em> produce un artefacto delta que un sistema en ejecución puede aplicar en su instancia de ostree para realizar actualizaciones. Esta es una descripción simplificada de los pasos de compilación<ul><li><p>si es nueva construcción<ul><li><p>crear nuevas particiones en una nueva imagen montada como un dispositivo de bucle</ul><li><p>demás<ul><li><p>montar sysroot y particiones de arranque de compilación anterior</ul><li><p>limpiar implementaciones anteriores de ostree (granjas de enlaces) en la compilación montada<li><p>cometer un nuevo árbol construido en una construcción montada<li><p>verificar la integridad y las sumas de verificación<li><p>crear un nuevo delta para actualizaciones<li><p>ejecutar la implementación de ostree para regenerar la configuración de arranque<li><p>eliminar antiguas confirmaciones de ostree<li><p>verificar la integridad de la partición de arranque<li><p>desmontar nueva imagen de compilación actualizada<li><p>generar suma de comprobación de imagen y comprimirla (con<code>squashfs</code> para contenedores)</ul><p>La configuración de las particiones se aplica con un fdisk<code>layout.cfg</code> archivo que define los tamaños de las particiones, tenemos una partición para rootfs (<code>~430M</code> ), la partición de arranque (<code>~40M</code> ) y una partición de intercambio (<code>~40M</code> ). Con contenedores, simplemente omita el montaje de la compilación anterior sobre un dispositivo de bucle, y simplemente extraiga la nueva confirmación de ostree sobre el antiguo repositorio de ostree (extraído).<h2 id=customizations><a class=header-anchor href=#customizations> Personalizaciones</a></h2><p>¿Qué estoy empaquetando en esta imagen (aparte de los paquetes instalados)?<ul><li><p>Una pequeña biblioteca en<code>functions.sh</code> para tareas comunes ejecutadas dentro del shell<li><p>Scripts de actualización basados ​​en ostree con mecanismo de bloqueo basado en la tienda KV<li><p>scripts de monitorización para IO tanto locales (<code>iomon</code> ) y red (<code>tcpmon</code>)<li><p>scripts de configuración para tiempos de ejecución de contenedores que no sean<code>bubblewrap</code>: <code>podman</code>, <code>toolbox</code></ul><p>Lo que solía ser y lo que ya no es<ul><li><p><code>sup</code>: <a href=https://github.com/pressly/sup/> Sorber</a> se utilizó para la orquestación (implementación de contenedores) y la configuración de la máquina host, pero luego cambié a<a href=https://www.ansible.com/> ansible</a> debido a que había errores de larga data en sup que carecían de una solución, no elegí ansible desde el principio porque no quería que se instalara una dependencia de Python en cada servidor, finalmente me conformé con un alpine secundario<a href=https://en.wikipedia.org/wiki/Chroot> chroot</a> en las máquinas host, ubicadas en<code>/opt/alp</code> donde instalé software adicional menos crítico. Hoy, sin embargo, volvería a cambiar de ansible a<a href=https://github.com/Fizzadar/pyinfra> pyinfra</a> , porque<ul><li><p>es python sin repetición (ansible tiene pseudo<code>DSL</code> que causa más dolores de cabeza que los que resuelve)<li><p>ejecuta sus recetas con comandos ssh simples, por lo que no hay un requisito de dependencia de Python en los hosts de destino</ul><li><p><code>containerpilot</code>: El caso de uso del piloto de contenedores es administrar dependencias complejas entre contenedores sin scripts de shell ... dejó de recibir actualizaciones de<a href=https://github.com/joyent/containerpilot> alegre</a> y se puso en modo de mantenimiento, tampoco me gustó que los requisitos de memoria y el uso de la memoria aumentaran constantemente durante un largo período de tiempo de actividad. Lo cambié por simples scripts de shell con<a href=https://www.consul.io/> cónsul</a> , Podría buscar alternativas más adecuadas si los scripts de shell comienzan a crecer demasiado. Soluciones más pesadas como<a href=https://kubernetes.io/> kubernetes</a>, <a href=https://docs.docker.com/engine/swarm/> enjambre</a> o<a href=https://www.nomadproject.io/> nómada</a> fueron descartados desde el principio.<li><p><code>beegfs</code> : Solía ​​enviar el módulo del kernel necesario para<a href=https://en.wikipedia.org/wiki/BeeGFS> Beegfs</a> pero después de un tiempo rompió la compatibilidad, y el hecho de que no había un soporte adecuado<a href=https://en.wikipedia.org/wiki/Filesystem_in_Userspace> fusible</a> El módulo se eliminó por completo, actualmente no estoy ejecutando un [DFS] en mis servidores, pero la posibilidad de tener un sistema de archivos listo para usar para conectar una red sigue siendo atractiva.<li><p></ul><h2 id=installation><a class=header-anchor href=#installation> Instalación</a></h2><p>Para instalar la imagen, puede cargarla en el proveedor de alojamiento e instalarla desde VNC, en el caso de máquinas virtuales, pero generalmente secuestro una instalación existente, porque siempre es posible, siempre que haya probado el script de configuración con la versión de la distribución de Linux, generalmente uso debian-8 o ubuntu-14, no he probado otras, ya que siempre las he encontrado disponibles. Los pasos de configuración son los siguientes<ul><li><p>garantizar la compatibilidad con https para las descargas<li><p>descargar una versión de busybox<li><p>instalar una granja de enlaces de busybox<li><p>determinar las direcciones ipv4 / ipv6 para la configuración de red<li><p>garantizar las capacidades de chroot<li><p>descargar la imagen del pino y extraerla<li><p>si VM<ul><li><p>flash sobre el dispositivo de destino<li><p>montar sobre un dispositivo de bucle</ul><li><p>escribir la configuración de la red local en el<em> para ser destellado</em> rootfs<li><p>si contenedor<ul><li><p>copie el servicio init (para contenedores) sobre el punto de montaje raíz principal<code>/sbin/init</code></ul><li><p>si VM<ul><li><p>particione el disco sobrante con estándar (<code>xfs</code> ) particiones<li><p>desmontar<li><p>verificar la integridad de las particiones</ul><li><p>reiniciar</ul><h2 id=conclusions><a class=header-anchor href=#conclusions> Conclusiones</a></h2><p>hice<a href=https://github.com/untoreh/pine> pino</a> 5 years from time of writing and I am still using it, and I see no reasons to switch to anything else. Alpine as a linux distro is great, simple, and I have never experienced breakage. I can easily deploy on <a href=https://en.wikipedia.org/wiki/Network_address_translation> NATed</a> servidores que tienden a ofrecer recursos ultra bajos, en realidad tengo una caja que se ejecuta con solo<code>64M</code> de RAM, y todavía tengo todas las funciones que necesito.<p><table class=fndef id=fndef:rootfs><tbody><tr><td class=fndef-backref><a href=#fnref:rootfs>[1]</a><td class=fndef-content>sistema de archivos raíz</table><p><div id=post-tags-list>Etiquetas de publicación: <span class=post-tag><a href=https://www.unto.re/tag/tools> instrumentos</a>, </span><span class=post-tag><a href=https://www.unto.re/tag/about> sobre</a></span></div><div class=page-foot><div class=copyright>19 de abril de 2021</div><script async crossorigin=anonymous issue-term=pathname label=Comment repo=untoreh/untoreh.github.io src=https://utteranc.es/client.js></script></div></div><div class=page__footer><footer><div class=page__footer-copyright>© untoreh - Desarrollado por<a href=https://github.com/tlienart/Franklin.jl> Franklin</a></div><div class=page__footer-links>- <ul><li><a href=/es/sitemapxml> Mapa del sitio</a></li> | <li><a href=/es/tag> Etiquetas</a></li> | <li><a href=https://www.unto.re/tag/feed.xml> RSS</a></ul></div><ul class=author__wrap><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="Twitter link"href=https://twitter.com/untoreh><i class="fab fa-fw fa-twitter-square"aria-hidden=true></i></a><li class="author__urls social-icons"><a rel="nofollow noopener noreferrer" title="GitHub link"href=https://github.com/untoreh><i class="fab fa-fw fa-github"aria-hidden=true></i></a><li class="author__urls social-icons"><a href=mailto:contact@unto.re title=email><i class="fas fa-envelope"></i></a><li><script type=application/ld+json>{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></ul></footer></div><script crossorigin=anonymous defer id=fa integrity=sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH src=https://use.fontawesome.com/releases/v5.8.2/js/all.js></script><script src=/libs/colors.js></script><script src=/libs/menu.js></script><script defer src=/libs/lunr/lunr.min.js></script>