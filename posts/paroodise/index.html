<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://www.unto.re/posts/paroodise">
        <link rel="amphtml" href="https://www.unto.re/amp/posts/paroodise">
        <script type="application/ld+json" id="" class="">{"copyrightHolder":"untoreh","@id":"https://www.unto.re","url":"https://www.unto.re","copyrightYear":2021,"@context":"https://schema.org/","image":"/assets/appa.png","@type":"WebSite"}</script>
        <script type="application/ld+json" id="" class="">{"audience":"cool people","url":"https://www.unto.re/posts/paroodise/index.html","mainContentOfPage":{"@type":"WebPageElement","cssSelector":".franklin-content"},"accessMode":["textual","visual"],"accessibilitySummary":"Visual elements are tentatively described.","description":"A small utility for live modification of file systems","author":{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"},"mentions":[],"@context":"https://schema.org","accessModeSufficient":{"itemListElement":["textual","visual"],"@type":"itemList"},"@type":"https://schema.org/WebPage","lastReviewed":"2021-04-08","dateCreated":"April 24, 2021","@id":"https://www.unto.re/posts/paroodise/index.html","dateModified":"2021-04-08","availableLanguage":[{"name":"English","@type":"Language"},{"name":"German","@type":"Language"},{"name":"Italian","@type":"Language"},{"name":"Mandarin Chinese","@type":"Language"},{"name":"Spanish","@type":"Language"},{"name":"Hindi","@type":"Language"},{"name":"Arabic","@type":"Language"},{"name":"Portuguese","@type":"Language"},{"name":"Bengali","@type":"Language"},{"name":"Russian","@type":"Language"},{"name":"Japanese","@type":"Language"},{"name":"Punjabi","@type":"Language"},{"name":"Javanese","@type":"Language"},{"name":"Vietnamese","@type":"Language"},{"name":"French","@type":"Language"},{"name":"Urdu","@type":"Language"},{"name":"Turkish","@type":"Language"},{"name":"Polish","@type":"Language"},{"name":"Ukranian","@type":"Language"},{"name":"Dutch","@type":"Language"},{"name":"Greek","@type":"Language"},{"name":"Swedish","@type":"Language"},{"name":"Zulu","@type":"Language"},{"name":"Romanian","@type":"Language"},{"name":"Malay","@type":"Language"},{"name":"Korean","@type":"Language"},{"name":"Thai","@type":"Language"},{"name":"Filipino","@type":"Language"}],"keywords":["tools","hosting","about"],"creativeWorkStatus":"Published","publisher":{"url":"https://www.unto.re","sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"contactPoint":{"contactType":"info","email":"contact@unto.re","@type":"ContactPoint","telephone":""},"logo":"/assets/appa.png","name":"untoreh's site","@type":"Organization"},"datePublished":"2021-04-08","inLanguage":"English","image":"/assets/appa.png","name":"","mainEntityOfPage":{"@id":"https://www.unto.re/posts/paroodise/index.html","@type":"Article"}}</script>
        <script type="application/ld+json" id="ldj-breadcrumbs" class="">{"itemListElement":[{"position":1,"item":"https://www.unto.re","name":"Home","@type":"ListItem"},{"position":2,"item":"/posts/","name":"Posts List","@type":"ListItem"},{"position":3,"item":"https://www.unto.re/posts/paroodise","name":"Paroodise","@type":"ListItem"}],"@type":"BreadcrumbList"}</script>
        
        
        
        <link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/menu.css">
<link rel="stylesheet" href="/css/pages.css">
<link rel="stylesheet" href="/css/lunr.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/responsive.css">
<link rel="stylesheet" href="/css/animations.css">
<link rel="stylesheet" href="/css/docco.css">
<!-- <link rel="stylesheet" href="/css/flag-icon.min.css"> -->
<link rel="stylesheet" href="/css/flags-sprite.css">
<link rel="icon" href="/assets/favicon.png" type="image/x-icon">
<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
<!--[if IE ]>
<![endif]-->

        <title>Paroodise</title>
        <meta name="description" content="A small utility for live modification of file systems"/>
        <!-- {{insert lunr_include.html}} -->
        <script src="/libs/load.js"></script>
        <!-- end custom head snippets -->
    </head>
    <body class="">
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <a class="site-title" href="/"></a> <div class="author__wrap">
    <script type="application/ld+json" id="" class="">{"sameAs":["https://github.com/untoreh","https://twitter.com/untoreh"],"email":"contact@unto.re","name":"untoreh","@type":"https://schema.org/Person","image":"/assets/appa.png"}</script>
    <ul>
        <li onclick="toggleTheme()" class="author__avatar">
        <img class="flip-front" src="/assets/appa.png" alt=
        "untoreh-light"></li><li class="author__urls social-icons">
    <a href="https://twitter.com/untoreh" rel=
    "nofollow noopener noreferrer"><i class=
    "fab fa-fw fa-twitter-square" aria-hidden="true"></i></a>
</li>
<li class="author__urls social-icons">
    <a href="https://github.com/untoreh" rel=
    "nofollow noopener noreferrer"><i class="fab fa-fw fa-github"
    aria-hidden="true"></i></a>
</li>
<li class="author__urls social-icons">
    <a href="mailto:contact@unto.re"><i class=
    "fas fa-envelope"></i></a>
</li>
<li><script type="application/ld+json" id="" class="">{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></li>

    </ul>
</div>

      <nav id="site-nav">
        <div class="horiz">
          <ul>
    <li id="lunrSearch" class="masthead__menu-item hvr-outline-in"><form id="lunrSearchForm" name="lunrSearchForm">
<button class="search-button" type="submit" value="Search" formaction="/search/index.html">
    <i class= "fas fa-search menu-icons"></i></button>
<input class="search-input" name="q" placeholder="Search&#8230;" type="text">
</form>
</li>
    <li class="masthead__menu-item hvr-outline-in">
        <a href="/posts/" title="All the articles that I have written"><i class="fas fa-pen menu-icons"></i>posts</a>
    </li>
    <li class="masthead__menu-item hvr-outline-in">
        <a href="/media/" title="Video and audio content from streaming websites."><i class="fas fa-tv menu-icons"></i>media</a>
    </li>
    <li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language">
        <button class="langs-dropdown-wrapper">
            <i class="fas fa-language menu-icons"></i> Lang
            <div id="langs-dropdown-menu" class="langs-dropdown-content">
                <ul id="lang-list"><a class="lang-link" id="lang-ar" href="/ar/posts/paroodise"><span class="flag flag-sa"></span>Arabic</a><a class="lang-link" id="lang-bn" href="/bn/posts/paroodise"><span class="flag flag-bd"></span>Bengali</a><a class="lang-link" id="lang-nl" href="/nl/posts/paroodise"><span class="flag flag-nl"></span>Dutch</a><a class="lang-link" id="lang-en" href="/posts/paroodise"><span class="flag flag-gb"></span>English</a><a class="lang-link" id="lang-tl" href="/tl/posts/paroodise"><span class="flag flag-ph"></span>Filipino</a><a class="lang-link" id="lang-fr" href="/fr/posts/paroodise"><span class="flag flag-fr"></span>French</a><a class="lang-link" id="lang-de" href="/de/posts/paroodise"><span class="flag flag-de"></span>German</a><a class="lang-link" id="lang-el" href="/el/posts/paroodise"><span class="flag flag-gr"></span>Greek</a><a class="lang-link" id="lang-hi" href="/hi/posts/paroodise"><span class="flag flag-in"></span>Hindi</a><a class="lang-link" id="lang-it" href="/it/posts/paroodise"><span class="flag flag-it"></span>Italian</a><a class="lang-link" id="lang-ja" href="/ja/posts/paroodise"><span class="flag flag-jp"></span>Japanese</a><a class="lang-link" id="lang-jw" href="/jw/posts/paroodise"><span class="flag flag-id"></span>Javanese</a><a class="lang-link" id="lang-ko" href="/ko/posts/paroodise"><span class="flag flag-kr"></span>Korean</a><a class="lang-link" id="lang-ms" href="/ms/posts/paroodise"><span class="flag flag-ms"></span>Malay</a><a class="lang-link" id="lang-zh" href="/zh/posts/paroodise"><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link" id="lang-pl" href="/pl/posts/paroodise"><span class="flag flag-pl"></span>Polish</a><a class="lang-link" id="lang-pt" href="/pt/posts/paroodise"><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link" id="lang-pa" href="/pa/posts/paroodise"><span class="flag flag-in"></span>Punjabi</a><a class="lang-link" id="lang-ro" href="/ro/posts/paroodise"><span class="flag flag-ro"></span>Romanian</a><a class="lang-link" id="lang-ru" href="/ru/posts/paroodise"><span class="flag flag-ru"></span>Russian</a><a class="lang-link" id="lang-es" href="/es/posts/paroodise"><span class="flag flag-es"></span>Spanish</a><a class="lang-link" id="lang-sv" href="/sv/posts/paroodise"><span class="flag flag-se"></span>Swedish</a><a class="lang-link" id="lang-th" href="/th/posts/paroodise"><span class="flag flag-th"></span>Thai</a><a class="lang-link" id="lang-tr" href="/tr/posts/paroodise"><span class="flag flag-tr"></span>Turkish</a><a class="lang-link" id="lang-uk" href="/uk/posts/paroodise"><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link" id="lang-ur" href="/ur/posts/paroodise"><span class="flag flag-pk"></span>Urdu</a><a class="lang-link" id="lang-vi" href="/vi/posts/paroodise"><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link" id="lang-zu" href="/zu/posts/paroodise"><span class="flag flag-za"></span>Zulu</a></ul>
            </div>
        </button>
    </li>
</ul>

        </div><button class="ham"><i class=
        "fas fa-bars ham-icon"></i></button>
        <div class="vert">
          <ul>
    <li id="lunrSearch" class="masthead__menu-item hvr-outline-in"><form id="lunrSearchForm" name="lunrSearchForm">
<button class="search-button" type="submit" value="Search" formaction="/search/index.html">
    <i class= "fas fa-search menu-icons"></i></button>
<input class="search-input" name="q" placeholder="Search&#8230;" type="text">
</form>
</li>
    <li class="masthead__menu-item hvr-outline-in">
        <a href="/posts/" title="All the articles that I have written"><i class="fas fa-pen menu-icons"></i>posts</a>
    </li>
    <li class="masthead__menu-item hvr-outline-in">
        <a href="/media/" title="Video and audio content from streaming websites."><i class="fas fa-tv menu-icons"></i>media</a>
    </li>
    <li class="masthead__menu-item hvr-outline-in menu-lang-btn" title="Change website's language">
        <button class="langs-dropdown-wrapper">
            <i class="fas fa-language menu-icons"></i> Lang
            <div id="langs-dropdown-menu" class="langs-dropdown-content">
                <ul id="lang-list"><a class="lang-link" id="lang-ar" href="/ar/posts/paroodise"><span class="flag flag-sa"></span>Arabic</a><a class="lang-link" id="lang-bn" href="/bn/posts/paroodise"><span class="flag flag-bd"></span>Bengali</a><a class="lang-link" id="lang-nl" href="/nl/posts/paroodise"><span class="flag flag-nl"></span>Dutch</a><a class="lang-link" id="lang-en" href="/posts/paroodise"><span class="flag flag-gb"></span>English</a><a class="lang-link" id="lang-tl" href="/tl/posts/paroodise"><span class="flag flag-ph"></span>Filipino</a><a class="lang-link" id="lang-fr" href="/fr/posts/paroodise"><span class="flag flag-fr"></span>French</a><a class="lang-link" id="lang-de" href="/de/posts/paroodise"><span class="flag flag-de"></span>German</a><a class="lang-link" id="lang-el" href="/el/posts/paroodise"><span class="flag flag-gr"></span>Greek</a><a class="lang-link" id="lang-hi" href="/hi/posts/paroodise"><span class="flag flag-in"></span>Hindi</a><a class="lang-link" id="lang-it" href="/it/posts/paroodise"><span class="flag flag-it"></span>Italian</a><a class="lang-link" id="lang-ja" href="/ja/posts/paroodise"><span class="flag flag-jp"></span>Japanese</a><a class="lang-link" id="lang-jw" href="/jw/posts/paroodise"><span class="flag flag-id"></span>Javanese</a><a class="lang-link" id="lang-ko" href="/ko/posts/paroodise"><span class="flag flag-kr"></span>Korean</a><a class="lang-link" id="lang-ms" href="/ms/posts/paroodise"><span class="flag flag-ms"></span>Malay</a><a class="lang-link" id="lang-zh" href="/zh/posts/paroodise"><span class="flag flag-cn"></span>Mandarin Chinese</a><a class="lang-link" id="lang-pl" href="/pl/posts/paroodise"><span class="flag flag-pl"></span>Polish</a><a class="lang-link" id="lang-pt" href="/pt/posts/paroodise"><span class="flag flag-pt"></span>Portuguese</a><a class="lang-link" id="lang-pa" href="/pa/posts/paroodise"><span class="flag flag-in"></span>Punjabi</a><a class="lang-link" id="lang-ro" href="/ro/posts/paroodise"><span class="flag flag-ro"></span>Romanian</a><a class="lang-link" id="lang-ru" href="/ru/posts/paroodise"><span class="flag flag-ru"></span>Russian</a><a class="lang-link" id="lang-es" href="/es/posts/paroodise"><span class="flag flag-es"></span>Spanish</a><a class="lang-link" id="lang-sv" href="/sv/posts/paroodise"><span class="flag flag-se"></span>Swedish</a><a class="lang-link" id="lang-th" href="/th/posts/paroodise"><span class="flag flag-th"></span>Thai</a><a class="lang-link" id="lang-tr" href="/tr/posts/paroodise"><span class="flag flag-tr"></span>Turkish</a><a class="lang-link" id="lang-uk" href="/uk/posts/paroodise"><span class="flag flag-ua"></span>Ukranian</a><a class="lang-link" id="lang-ur" href="/ur/posts/paroodise"><span class="flag flag-pk"></span>Urdu</a><a class="lang-link" id="lang-vi" href="/vi/posts/paroodise"><span class="flag flag-vn"></span>Vietnamese</a><a class="lang-link" id="lang-zu" href="/zu/posts/paroodise"><span class="flag flag-za"></span>Zulu</a></ul>
            </div>
        </button>
    </li>
</ul>

        </div>
      </nav>
    </div>
  </div>
</div>

    
            <div>
            <h1 id="title"><a href="/posts/paroodise">Paroodise</a></h1>
            <blockquote id="page-description" style="font-style: italic;">
                A small utility for live modification of file systems
            </blockquote>
            </div>
          


    <!-- Content appended here -->
<div class="franklin-content">
<p>When I was first settling on what linux distribution use for my remote servers I needed a way to quickly install different root file systems on a target host, so I wrote &#91;paroodise&#93;.</p>
<p>To be able to flash a booted block device you need to <em>unmount</em>. You can only unmount if you stop using it. To stop using it you need to restart your services in place, from another root file system. This is akin to what the <a href="https://en.wikipedia.org/wiki/Initial_ramdisk">initramfs</a> does when it boots a linux based OS, the kernel executes a boot image which setups the file system from where the true <a href="https://en.wikipedia.org/wiki/Init">init</a> service is launched.</p>
<p>To achieve this on an <em>already running</em> system we have to be careful how we restart our processes. We can&#39;t kill ssh unless we are sure our script will run until successful.</p>
<p>The whole process is much easier on non systemd based distros, since systemd hooks deeply into the linux kernel, mangling with its processes recklessly can cause kernel panics...in fact on more recent distributions that&#39;s what usually happens :&#41;</p>
<p>When I wrote this mini utility it seems I didn&#39;t know stable ways to spawn processes that outlived the original ssh sessions, It should be rewritten with more consistent methods.</p>
<p>The whole process consists of</p>
<ul>
<li><p>copying the minimal files required to re-bootstrap the file system on memory</p>
</li>
<li><p>moving &#40;or recreating&#41; the kernel mount points &#40;<code>/dev</code>, <code>/proc</code>, <code>/sys</code>&#41;</p>
</li>
<li><p>killing previous services spawned by the standing systemd process tree</p>
</li>
<li><p>re-executing systemd unto the new pivoted file-system, <a href="https://www.freedesktop.org/software/systemd/man/systemctl.html#Manager&#37;20State&#37;20Commands"><code>systemctl daemon-reexec</code></a></p>
</li>
</ul>
<p>If everything completes successfully it is possible at this point to spawn a new ssh service and login into a session where the original mount points are available for modifications.</p>
<p></p>
<div id="post-tags-list">
Post Tags:
<span class="post-tag"><a href="tag/tools" style=""> tools </a>, </span>
<span class="post-tag"><a href="tag/hosting" style=""> hosting </a>, </span>
<span class="post-tag"><a href="tag/about" style=""> about </a></span></div>
<div class="page-foot">
    
    <div class="copyright">
        April 08, 2021
    </div>
        <script src="https://utteranc.es/client.js"
        repo="untoreh/untoreh.github.io"
        issue-term="pathname"
        label="Comment"
        crossorigin="anonymous"
        async>
    </script>

    
</div>
</div><div class="page__footer">
    <footer>
        <!-- start custom footer snippets -->
        <!-- end custom footer snippets -->
        <div class="page__footer-copyright">
            Â© untoreh - Powered by <a href=
                                                     "https://github.com/tlienart/Franklin.jl">Franklin</a>
        </div>
        <div class="page__footer-links">
            -
            <ul>
                <li> <a href="/sitemap.xml">Sitemap</a> </li>
                |
                <li> <a href="/tag">Tags</a> </li>
                |
                <li> <a href="/feed.xml">RSS</a> </li>
            </ul>
        </div>
        <ul class="author__wrap">
            <li class="author__urls social-icons">
    <a href="https://twitter.com/untoreh" rel=
    "nofollow noopener noreferrer"><i class=
    "fab fa-fw fa-twitter-square" aria-hidden="true"></i></a>
</li>
<li class="author__urls social-icons">
    <a href="https://github.com/untoreh" rel=
    "nofollow noopener noreferrer"><i class="fab fa-fw fa-github"
    aria-hidden="true"></i></a>
</li>
<li class="author__urls social-icons">
    <a href="mailto:contact@unto.re"><i class=
    "fas fa-envelope"></i></a>
</li>
<li><script type="application/ld+json" id="" class="">{"potentialAction":{"query-input":"required maxlength=100 name=input","actionStatus":"https://schema.org/PotentialActionStatus","query":"required","@type":"SearchAction","target":{"uri":"","scheme":"https","userinfo":"","host":"www.unto.re","port":"","path":"/search","query":"q=%7Binput%7D","fragment":""}}}</script></li>

        </ul>
    </footer>
</div>
<!-- ensure font-awesome script has "fa" id for parsing purposes -->
<script id="fa" defer src=
            "https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity=
            "sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH"
        crossorigin="anonymous"></script>



<script src="/libs/colors.js"></script>
<script src="/libs/menu.js"></script>
<script defer src="/libs/lunr/lunr.min.js"></script>
</body>
</html>
