var path=require("path"),fs=require("fs"),lunr=require("lunr"),cheerio=require("cheerio"),SummarizerManager=require("node-summarizer").SummarizerManager;const PATH_PREPEND="..",HTML_FOLDER="../../__site",OUTPUT_INDEX="lunr_index.js";function isHtml(e){return lower=e.toLowerCase(),lower.endsWith(".htm")||lower.endsWith(".html")}function findHtml(e){if(!fs.existsSync(e)){console.log("Could not find folder: ",e);return}for(var i=fs.readdirSync(e),n=[],r=0;r<i.length;r++){var l=path.join(e,i[r]),t=fs.lstatSync(l);if(!(l.endsWith("posts/index.html")||l.endsWith("tag/index.html")))if(t.isDirectory()){if(t=="assets"||t=="css"||t=="libs")continue;for(var o=findHtml(l),s=0;s<o.length;s++)o[s]=path.join(i[r],o[s]).replace(/\\/g,"/");n.push.apply(n,o)}else isHtml(l)&&n.push(i[r])}return n}function readHtml(e,i,n){var r=path.join(e,i),l=fs.readFileSync(r).toString(),t=cheerio.load(l),o=t("title").text();typeof o=="undefined"&&(o=i),t("code").remove();var s=t(".franklin-content").text();typeof s=="undefined"&&(s="");let u=new SummarizerManager(s,3).getSummaryByFrequency().summary;var f={id:n,l:r,t:o,b:u};return f}function buildIndex(e){var i=lunr(function(){this.ref("id"),this.field("t"),this.field("b"),e.forEach(function(n){this.add(n)},this)});return i}function buildPreviews(e){for(var i={},n=0;n<e.length;n++){var r=e[n];i[r.id]={t:r.t,l:r.l.replace(/^\.\.\/\.\.\/__site/gi,"/"+PATH_PREPEND),b:r.b}}return i}function main(){files=findHtml(HTML_FOLDER);for(var e=[],i=0;i<files.length;i++)e.push(readHtml(HTML_FOLDER,files[i],i));var n=buildIndex(e),r=buildPreviews(e),l="const LUNR_DATA = "+JSON.stringify(n)+`;
const PREVIEW_LOOKUP = `+JSON.stringify(r)+";";fs.writeFile(OUTPUT_INDEX,l,function(t){if(t)return console.log(t)})}main();