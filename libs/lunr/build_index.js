var path=require("path"),fs=require("fs"),lunr=require("lunr"),cheerio=require("cheerio"),SummarizerManager=require("node-summarizer").SummarizerManager;const PATH_PREPEND="..",HTML_FOLDER="../../__site",OUTPUT_INDEX="lunr_index.js";function isHtml(r){return lower=r.toLowerCase(),lower.endsWith(".htm")||lower.endsWith(".html")}function findHtml(r){if(!fs.existsSync(r)){console.log("Could not find folder: ",r);return}for(var e=fs.readdirSync(r),n=[],t=0;t<e.length;t++){var a=path.join(r,e[t]),i=fs.lstatSync(a);if(!(a.endsWith("posts/index.html")||a.endsWith("tag/index.html")))if(i.isDirectory()){if(i=="assets"||i=="css"||i=="libs")continue;for(var s=findHtml(a),o=0;o<s.length;o++)s[o]=path.join(e[t],s[o]).replace(/\\/g,"/");n.push.apply(n,s)}else isHtml(a)&&n.push(e[t])}return n}function readHtml(r,e,n){var t=path.join(r,e),a=fs.readFileSync(t).toString(),i=cheerio.load(a),s=i("title").text();typeof s=="undefined"&&(s=e),i("code").remove();var o=i(".franklin-content").text();typeof o=="undefined"&&(o="");let l=new SummarizerManager(o,3).getSummaryByFrequency().summary;var u={id:n,l:t,t:s,b:l};return u}function buildIndex(r){var e=lunr(function(){this.ref("id"),this.field("t"),this.field("b"),r.forEach(function(n){this.add(n)},this)});return e}function buildPreviews(r){for(var e={},n=0;n<r.length;n++){var t=r[n];e[t.id]={t:t.t,l:t.l.replace(/^\.\.\/\.\.\/__site/gi,"/"+PATH_PREPEND),b:t.b}}return e}function main(){files=findHtml(HTML_FOLDER);for(var r=[],e=0;e<files.length;e++)r.push(readHtml(HTML_FOLDER,files[e],e));var n=buildIndex(r),t=buildPreviews(r),a="const LUNR_DATA = "+JSON.stringify(n)+`;
const PREVIEW_LOOKUP = `+JSON.stringify(t)+";";fs.writeFile(OUTPUT_INDEX,a,function(i){if(i)return console.log(i)})}main();