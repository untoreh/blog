var path=require("path"),fs=require("fs"),lunr=require("lunr"),cheerio=require("cheerio"),SummarizerManager=require("node-summarizer").SummarizerManager;const PATH_PREPEND="..",HTML_FOLDER="../../__site",OUTPUT_INDEX="lunr_index.js";function isHtml(e){return lower=e.toLowerCase(),lower.endsWith(".htm")||lower.endsWith(".html")}function findHtml(e){if(!fs.existsSync(e)){console.log("Could not find folder: ",e);return}for(var i=fs.readdirSync(e),n=[],r=0;r<i.length;r++){var o=path.join(e,i[r]),t=fs.lstatSync(o);if(!(o.endsWith("posts/index.html")||o.endsWith("tag/index.html")))if(t.isDirectory()){if(t=="assets"||t=="css"||t=="libs")continue;for(var s=findHtml(o),l=0;l<s.length;l++)s[l]=path.join(i[r],s[l]).replace(/\\/g,"/");n.push.apply(n,s)}else isHtml(o)&&n.push(i[r])}return n}function readHtml(e,i,n){var r=path.join(e,i),o=fs.readFileSync(r).toString(),t=cheerio.load(o),s=t("title").text();typeof s=="undefined"&&(s=i),t("code").remove();var l=t(".franklin-content").text();typeof l=="undefined"&&(l="");let u=new SummarizerManager(l,3).getSummaryByFrequency().summary;var a={id:n,l:r,t:s,b:u};return a}function buildIndex(e){var i=lunr(function(){this.ref("id"),this.field("t"),this.field("b"),e.forEach(function(n){this.add(n)},this)});return i}function buildPreviews(e){for(var i={},n=0;n<e.length;n++){var r=e[n];i[r.id]={t:r.t,l:r.l.replace(/^\.\.\/\.\.\/__site/gi,"/"+PATH_PREPEND),b:r.b}}return i}function main(){files=findHtml(HTML_FOLDER);for(var e=[],i=0;i<files.length;i++)e.push(readHtml(HTML_FOLDER,files[i],i));var n=buildIndex(e),r=buildPreviews(e),o="const LUNR_DATA = "+JSON.stringify(n)+`;
const PREVIEW_LOOKUP = `+JSON.stringify(r)+";";fs.writeFile(OUTPUT_INDEX,o,function(t){if(t)return console.log(t)})}main();</script><script></script><script>