var path=require("path"),fs=require("fs"),lunr=require("lunr"),cheerio=require("cheerio"),SummarizerManager=require("node-summarizer").SummarizerManager;const PATH_PREPEND="..",HTML_FOLDER="../../__site",OUTPUT_INDEX="lunr_index.js";function isHtml(e){return lower=e.toLowerCase(),lower.endsWith(".htm")||lower.endsWith(".html")}function findHtml(e){if(!fs.existsSync(e)){console.log("Could not find folder: ",e);return}for(var r=fs.readdirSync(e),n=[],t=0;t<r.length;t++){var o=path.join(e,r[t]),i=fs.lstatSync(o);if(!(o.endsWith("posts/index.html")||o.endsWith("tag/index.html")))if(i.isDirectory()){if(i=="assets"||i=="css"||i=="libs")continue;for(var s=findHtml(o),l=0;l<s.length;l++)s[l]=path.join(r[t],s[l]).replace(/\\/g,"/");n.push.apply(n,s)}else isHtml(o)&&n.push(r[t])}return n}function readHtml(e,r,n){var t=path.join(e,r),o=fs.readFileSync(t).toString(),i=cheerio.load(o),s=i("title").text();typeof s=="undefined"&&(s=r),i("code").remove();var l=i(".franklin-content").text();typeof l=="undefined"&&(l="");let u=new SummarizerManager(l,3).getSummaryByFrequency().summary;var a={id:n,l:t,t:s,b:u};return a}function buildIndex(e){var r=lunr(function(){this.ref("id"),this.field("t"),this.field("b"),e.forEach(function(n){this.add(n)},this)});return r}function buildPreviews(e){for(var r={},n=0;n<e.length;n++){var t=e[n];r[t.id]={t:t.t,l:t.l.replace(/^\.\.\/\.\.\/__site/gi,"/"+PATH_PREPEND),b:t.b}}return r}function main(){files=findHtml(HTML_FOLDER);for(var e=[],r=0;r<files.length;r++)e.push(readHtml(HTML_FOLDER,files[r],r));var n=buildIndex(e),t=buildPreviews(e),o="const LUNR_DATA = "+JSON.stringify(n)+`;
const PREVIEW_LOOKUP = `+JSON.stringify(t)+";";fs.writeFile(OUTPUT_INDEX,o,function(i){if(i)return console.log(i)})}main();